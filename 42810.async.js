"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[42810],{615:function(e,t,n){n.d(t,{cW:function(){return l},ij:function(){return a},rM:function(){return c}});var r=n(88194),o=n(60123),s=n(13928),i=n(8971);function a(e,t,n){try{return function(e){if(!e||0===e.length)return null;if(function(e){const t=e[0];return!!t&&"scale"in t}(e)){const t=[];for(const n of e)t.push({scale:n.scale,value:c(n.value)});return t}return c(e)}(e)}catch(e){n?.messages?.push(e)}return null}function l(e,t,n,r){try{const r=function(e){const t=(0,s.Q)(e);return t?(0,i.Cb)(t)?t.map((e=>e.toJSON())):t.map((({scale:e,effects:t})=>({scale:e,value:t.map((e=>e.toJSON()))}))):null}(e);(0,o.RB)(n,r,t)}catch(e){r.messages&&r.messages.push(e)}}function c(e){if(!e?.length)return"";const t=[];for(const n of e){let e=[];switch(n.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":e=[u(n,"amount")];break;case"blur":e=[u(n,"radius","pt")];break;case"hue-rotate":e=[u(n,"angle","deg")];break;case"drop-shadow":e=[u(n,"xoffset","pt"),u(n,"yoffset","pt"),u(n,"blurRadius","pt"),f(n,"color")];break;case"bloom":e=[u(n,"strength"),u(n,"radius","pt"),u(n,"threshold")]}const r=`${n.type}(${e.filter(Boolean).join(" ")})`;(0,s.Q)(r),t.push(r)}return t.join(" ")}function u(e,t,n){if(null==e[t])throw new r.Z("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return n?e[t]+n:""+e[t]}function f(e,t){if(null==e[t])throw new r.Z("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const n=e[t];return`rgba(${n[0]||0}, ${n[1]||0}, ${n[2]||0}, ${n[3]/255||0})`}},13928:function(e,t,n){n.d(t,{Q:function(){return c}});var r=n(38461),o=n(88194),s=n(71480),i=n(8971);class a extends SyntaxError{constructor(e,t,n,r){super(e),this.expected=t,this.found=n,this.location=r,this.name="SyntaxError"}format(e){let t="Error: "+this.message;if(this.location){let n=null;const r=e.find((e=>e.source===this.location.source));r&&(n=r.text.split(/\r\n|\n|\r/g));const o=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(o):o,i=this.location.source+":"+s.line+":"+s.column;if(n){const e=this.location.end,r="".padEnd(s.line.toString().length," "),a=n[o.line-1],l=(o.line===e.line?e.column:a.length+1)-o.column||1;t+="\n --\x3e "+i+"\n"+r+" |\n"+s.line+" | "+a+"\n"+r+" | "+"".padEnd(o.column-1," ")+"".padEnd(l,"^")}else t+="\n at "+i}return t}static buildMessage(e,t){function n(e){return e.codePointAt(0).toString(16).toUpperCase()}const r=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function o(e){return r?e.replace(r,(e=>"\\u{"+n(e)+"}")):e}function s(e){return o(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+n(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+n(e))))}function i(e){return o(e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+n(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+n(e))))}const a={literal:e=>'"'+s(e.text)+'"',class(e){const t=e.parts.map((e=>Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e)));return"["+(e.inverted?"^":"")+t.join("")+"]"+(e.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:e=>e.description};function l(e){return a[e.type](e)}return"Expected "+function(e){const t=e.map(l);if(t.sort(),t.length>0){let e=1;for(let n=1;n<t.length;n++)t[n-1]!==t[n]&&(t[e]=t[n],e++);t.length=e}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(e)+" but "+function(e){return e?'"'+s(e)+'"':"end of input"}(t)+" found."}}function l(e,t){const n={},r=(t=void 0!==t?t:{}).grammarSource,o={start:le};let s=le;const i="none",l=",",c="grad",u="turn",f=/^[ \t\n\r]/,h=/^[a-z\-]/,d=/^[0-9a-fA-F]/,p=/^[+\-]/,m=/^[0-9]/,y=oe("none"),g=ne("none",!1),b=ne(")",!1),_=ne(",",!1),w=re([" ","\t","\n","\r"],!1,!1,!1),C=oe("function"),I=ne("(",!1),v=oe("identifier"),M=re([["a","z"],"-"],!1,!1,!1),x=oe("percentage"),k=ne("%",!1),S=oe("length"),P=ne("px",!1),R=ne("cm",!1),A=ne("mm",!1),E=ne("in",!1),F=ne("pt",!1),B=ne("pc",!1),L=oe("angle"),T=ne("deg",!1),Z=ne("rad",!1),j=ne("grad",!1),G=ne("turn",!1),O=oe("number"),z=oe("color"),U=ne("#",!1),$=re([["0","9"],["a","f"],["A","F"]],!1,!1,!1),Y=re(["+","-"],!1,!1,!1),N=re([["0","9"]],!1,!1,!1),J=ne(".",!1),q=ne("e",!1);function V(e,t){return t.length>0?function(e,t,n){return[e].concat(function(e,t){return e.map((function(e){return e[t]}))}(t,n))}(e,t,3):[e]}let X=0|t.peg$currPos,W=X;const Q=[{line:1,column:1}];let H,D=X,K=t.peg$maxFailExpected||[],ee=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in o))throw new Error("Can't start parsing from rule \""+t.startRule+'".');s=o[t.startRule]}function te(){return e.substring(W,X)}function ne(e,t){return{type:"literal",text:e,ignoreCase:t}}function re(e,t,n,r){return{type:"class",parts:e,inverted:t,ignoreCase:n,unicode:r}}function oe(e){return{type:"other",description:e}}function se(t){let n,r=Q[t];if(r)return r;if(t>=Q.length)n=Q.length-1;else for(n=t;!Q[--n];);for(r=Q[n],r={line:r.line,column:r.column};n<t;)10===e.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return Q[t]=r,r}function ie(e,t,n){const o=se(e),s=se(t);return{source:r,start:{offset:e,line:o.line,column:o.column},end:{offset:t,line:s.line,column:s.column}}}function ae(e){X<D||(X>D&&(D=X,K=[]),K.push(e))}function le(){let e;return e=ce(),e===n&&(e=function(){let e,t;if(e=[],t=ue(),t!==n)for(;t!==n;)e.push(t),t=ue();else e=n;return e}()),e}function ce(){let t,r;return ee++,t=X,he(),e.substr(X,4)===i?(r=i,X+=4):(r=n,0===ee&&ae(g)),r!==n?(he(),W=t,t=[]):(X=t,t=n),ee--,t===n&&0===ee&&ae(y),t}function ue(){let t,r,o,s;return t=X,he(),r=function(){let t,r,o;return ee++,t=X,r=de(),r!==n?(40===e.charCodeAt(X)?(o="(",X++):(o=n,0===ee&&ae(I)),o!==n?(W=t,t=r):(X=t,t=n)):(X=t,t=n),ee--,t===n&&(r=n,0===ee&&ae(C)),t}(),r!==n?(he(),o=function(){let t,r,o,s,i,a,c,u;if(t=X,r=fe(),r!==n){for(o=[],s=X,i=he(),44===e.charCodeAt(X)?(a=l,X++):(a=n,0===ee&&ae(_)),a===n&&(a=null),c=he(),u=fe(),u!==n?(i=[i,a,c,u],s=i):(X=s,s=n);s!==n;)o.push(s),s=X,i=he(),44===e.charCodeAt(X)?(a=l,X++):(a=n,0===ee&&ae(_)),a===n&&(a=null),c=he(),u=fe(),u!==n?(i=[i,a,c,u],s=i):(X=s,s=n);W=t,t=V(r,o)}else X=t,t=n;return t}(),o===n&&(o=null),he(),41===e.charCodeAt(X)?(s=")",X++):(s=n,0===ee&&ae(b)),s!==n?(he(),W=t,t=function(e,t){return{type:"function",name:e,parameters:t||[]}}(r,o)):(X=t,t=n)):(X=t,t=n),t}function fe(){let e,t;return e=X,t=pe(),t===n&&(t=me(),t===n&&(t=ye(),t===n&&(t=function(){let e,t;return ee++,e=X,he(),t=be(),t!==n?(W=e,e=function(e){return{value:e,unit:null}}(t)):(X=e,e=n),ee--,e===n&&0===ee&&ae(O),e}()))),t!==n&&(W=e,t=function(e){return{type:"quantity",value:e.value,unit:e.unit}}(t)),e=t,e===n&&(e=X,t=ge(),t!==n&&(W=e,t=function(e){return{type:"color",colorType:e.type,value:e.value}}(t)),e=t),e}function he(){let t,r;for(ee++,t=[],r=e.charAt(X),f.test(r)?X++:(r=n,0===ee&&ae(w));r!==n;)t.push(r),r=e.charAt(X),f.test(r)?X++:(r=n,0===ee&&ae(w));return ee--,t}function de(){let t,r,o;if(ee++,t=X,r=[],o=e.charAt(X),h.test(o)?X++:(o=n,0===ee&&ae(M)),o!==n)for(;o!==n;)r.push(o),o=e.charAt(X),h.test(o)?X++:(o=n,0===ee&&ae(M));else r=n;return r!==n&&(W=t,r=te()),t=r,ee--,t===n&&(r=n,0===ee&&ae(v)),t}function pe(){let t,r,o;return ee++,t=X,he(),r=be(),r!==n?(37===e.charCodeAt(X)?(o="%",X++):(o=n,0===ee&&ae(k)),o!==n?(W=t,t=function(e){return{value:e,unit:"%"}}(r)):(X=t,t=n)):(X=t,t=n),ee--,t===n&&0===ee&&ae(x),t}function me(){let t,r,o;return ee++,t=X,he(),r=be(),r!==n?("px"===e.substr(X,2)?(o="px",X+=2):(o=n,0===ee&&ae(P)),o!==n?(W=t,t=function(e){return{value:e,unit:"px"}}(r)):(X=t,t=n)):(X=t,t=n),t===n&&(t=X,he(),r=be(),r!==n?("cm"===e.substr(X,2)?(o="cm",X+=2):(o=n,0===ee&&ae(R)),o!==n?(W=t,t=function(e){return{value:e,unit:"cm"}}(r)):(X=t,t=n)):(X=t,t=n),t===n&&(t=X,he(),r=be(),r!==n?("mm"===e.substr(X,2)?(o="mm",X+=2):(o=n,0===ee&&ae(A)),o!==n?(W=t,t=function(e){return{value:e,unit:"mm"}}(r)):(X=t,t=n)):(X=t,t=n),t===n&&(t=X,he(),r=be(),r!==n?("in"===e.substr(X,2)?(o="in",X+=2):(o=n,0===ee&&ae(E)),o!==n?(W=t,t=function(e){return{value:e,unit:"in"}}(r)):(X=t,t=n)):(X=t,t=n),t===n&&(t=X,he(),r=be(),r!==n?("pt"===e.substr(X,2)?(o="pt",X+=2):(o=n,0===ee&&ae(F)),o!==n?(W=t,t=function(e){return{value:e,unit:"pt"}}(r)):(X=t,t=n)):(X=t,t=n),t===n&&(t=X,he(),r=be(),r!==n?("pc"===e.substr(X,2)?(o="pc",X+=2):(o=n,0===ee&&ae(B)),o!==n?(W=t,t=function(e){return{value:e,unit:"pc"}}(r)):(X=t,t=n)):(X=t,t=n)))))),ee--,t===n&&0===ee&&ae(S),t}function ye(){let t,r,o;return ee++,t=X,r=be(),r!==n?("deg"===e.substr(X,3)?(o="deg",X+=3):(o=n,0===ee&&ae(T)),o!==n?(W=t,t=function(e){return{value:e,unit:"deg"}}(r)):(X=t,t=n)):(X=t,t=n),t===n&&(t=X,r=be(),r!==n?("rad"===e.substr(X,3)?(o="rad",X+=3):(o=n,0===ee&&ae(Z)),o!==n?(W=t,t=function(e){return{value:e,unit:"rad"}}(r)):(X=t,t=n)):(X=t,t=n),t===n&&(t=X,r=be(),r!==n?(e.substr(X,4)===c?(o=c,X+=4):(o=n,0===ee&&ae(j)),o!==n?(W=t,t=function(e){return{value:e,unit:"grad"}}(r)):(X=t,t=n)):(X=t,t=n),t===n&&(t=X,r=be(),r!==n?(e.substr(X,4)===u?(o=u,X+=4):(o=n,0===ee&&ae(G)),o!==n?(W=t,t=function(e){return{value:e,unit:"turn"}}(r)):(X=t,t=n)):(X=t,t=n)))),ee--,t===n&&(r=n,0===ee&&ae(L)),t}function ge(){let t,r,o,s;if(ee++,t=X,35===e.charCodeAt(X)?(r="#",X++):(r=n,0===ee&&ae(U)),r!==n){if(o=[],s=e.charAt(X),d.test(s)?X++:(s=n,0===ee&&ae($)),s!==n)for(;s!==n;)o.push(s),s=e.charAt(X),d.test(s)?X++:(s=n,0===ee&&ae($));else o=n;o!==n?(W=t,t={type:"hex",value:te()}):(X=t,t=n)}else X=t,t=n;return t===n&&(t=X,r=ue(),r!==n&&(W=t,r=function(e){return{type:"function",value:e}}(r)),t=r,t===n&&(t=X,r=de(),r!==n&&(W=t,r={type:"named",value:te()}),t=r)),ee--,t===n&&(r=n,0===ee&&ae(z)),t}function be(){let t,r,o,s,i,a,l,c;for(t=X,r=e.charAt(X),p.test(r)?X++:(r=n,0===ee&&ae(Y)),r===n&&(r=null),o=X,s=[],i=e.charAt(X),m.test(i)?X++:(i=n,0===ee&&ae(N));i!==n;)s.push(i),i=e.charAt(X),m.test(i)?X++:(i=n,0===ee&&ae(N));if(46===e.charCodeAt(X)?(i=".",X++):(i=n,0===ee&&ae(J)),i!==n){if(a=[],l=e.charAt(X),m.test(l)?X++:(l=n,0===ee&&ae(N)),l!==n)for(;l!==n;)a.push(l),l=e.charAt(X),m.test(l)?X++:(l=n,0===ee&&ae(N));else a=n;a!==n?(s=[s,i,a],o=s):(X=o,o=n)}else X=o,o=n;if(o===n)if(o=[],s=e.charAt(X),m.test(s)?X++:(s=n,0===ee&&ae(N)),s!==n)for(;s!==n;)o.push(s),s=e.charAt(X),m.test(s)?X++:(s=n,0===ee&&ae(N));else o=n;if(o!==n){if(s=X,101===e.charCodeAt(X)?(i="e",X++):(i=n,0===ee&&ae(q)),i!==n){if(a=e.charAt(X),p.test(a)?X++:(a=n,0===ee&&ae(Y)),a===n&&(a=null),l=[],c=e.charAt(X),m.test(c)?X++:(c=n,0===ee&&ae(N)),c!==n)for(;c!==n;)l.push(c),c=e.charAt(X),m.test(c)?X++:(c=n,0===ee&&ae(N));else l=n;l!==n?(i=[i,a,l],s=i):(X=s,s=n)}else X=s,s=n;s===n&&(s=null),W=t,t=parseFloat(te())}else X=t,t=n;return t}H=s();const _e=H!==n&&X===e.length;function we(){throw H!==n&&X<e.length&&ae({type:"end"}),function(e,t,n){return new a(a.buildMessage(e,t),e,t,n)}(K,D<e.length?function(t=X){const n=e.codePointAt(t);return void 0===n?"":String.fromCodePoint(n)}(D):null,D<e.length?ie(D,D+1):ie(D,D))}return t.peg$library?{peg$result:H,peg$currPos:X,peg$FAILED:n,peg$maxFailExpected:K,peg$maxFailPos:D,peg$success:_e,peg$throw:_e?void 0:we}:_e?H:void we()}function c(e){if(!e||0===e.length)return null;if("string"==typeof e){const t=u(e);return t&&0!==t.length?t:null}const t=e.map((e=>{if(!Number.isFinite(e.scale)||e.scale<=0)throw new o.Z("effect:invalid-scale","scale must be finite and greater than 0",{stop:e});return{scale:e.scale,effects:u(e.value)}}));t.sort(((e,t)=>t.effects.length-e.effects.length));for(let e=0;e<t.length-1;e++){if(!(0,i.AS)(t[e].effects,t[e+1].effects))throw new o.Z("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[e].effects,b:t[e+1].effects});(0,i.uF)(t[e].effects,t[e+1].effects)}return t.sort(((e,t)=>t.scale-e.scale)),t}function u(e){let t;if(!e)return[];try{t=l(e)}catch(t){throw new o.Z("effect:invalid-syntax","Invalid effect syntax",{value:e,error:t})}return t.map((e=>function(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(e){let t=1;return f(e.parameters,1),1===e.parameters.length&&(t=y(e.parameters[0])),new s.GI(e.name,t)}(e);case"opacity":return function(e){let t=1;return f(e.parameters,1),1===e.parameters.length&&(t=y(e.parameters[0])),new s.Zx(t)}(e);case"hue-rotate":return function(e){let t=0;return f(e.parameters,1),1===e.parameters.length&&(t=function(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=p[e.unit]))throw new o.Z("effect:type-error",`Expected <angle>, Actual: ${h(e)}`,{term:e})}(e),e.value*p[e.unit]||0}(e.parameters[0])),new s.Tq(t)}(e);case"blur":return function(e){let t=0;return f(e.parameters,1),1===e.parameters.length&&(t=b(e.parameters[0]),d(t,e.parameters[0])),new s.Tj(t)}(e);case"drop-shadow":return function(e){const t=[];let n=null;for(const r of e.parameters)if("color"===r.type){if(t.length&&Object.freeze(t),n)throw new o.Z("effect:type-error","Accepts only one color",{});n=_(r)}else{const e=b(r);if(Object.isFrozen(t))throw new o.Z("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(e),3===t.length&&d(e,r)}if(t.length<2||t.length>3)throw new o.Z("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new s.CE(t[0],t[1],t[2]||0,n||w("black"))}(e);case"bloom":return function(e){let t=1,n=0,r=0;return f(e.parameters,3),e.parameters[0]&&(t=y(e.parameters[0])),e.parameters[1]&&(n=b(e.parameters[1]),d(n,e.parameters[1])),e.parameters[2]&&(r=y(e.parameters[2])),new s.rk(t,n,r)}(e)}}catch(t){throw t.details.filter=e,t}throw new o.Z("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}(e)))}function f(e,t){if(e.length>t)throw new o.Z("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function h(e){if("color"===e.type)return"<color>";if(e.unit){if(e.unit in m)return"<length>";if(e.unit in p)return"<angle>";if("%"===e.unit)return"<percentage>"}return"<double>"}function d(e,t){if(e<0)throw new o.Z("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}const p={deg:1,grad:.9,rad:180/Math.PI,turn:360};const m={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function y(e){!function(e){if("quantity"!==e.type||null!==e.unit&&"%"!==e.unit)throw new o.Z("effect:type-error",`Expected <double> or <percentage>, Actual: ${h(e)}`,{term:e})}(e);const t=e.value;return d(t,e),"%"===e.unit?.01*t:t}function g(e){return function(e){if("quantity"!==e.type||null!==e.unit)throw new o.Z("effect:type-error",`Expected <double>, Actual: ${h(e)}`,{term:e})}(e),d(e.value,e),e.value}function b(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=m[e.unit]))throw new o.Z("effect:type-error",`Expected <length>, Actual: ${h(e)}`,{term:e})}(e),e.value*m[e.unit]||0}function _(e){switch(e.colorType){case"hex":return(0,r.a7)(e.value);case"named":return w(e.value);case"function":return function(e){if(f(e.parameters,4),C.test(e.name))return[y(e.parameters[0]),y(e.parameters[1]),y(e.parameters[2]),e.parameters[3]?y(e.parameters[3]):1];if(I.test(e.name))return(0,r.Y6)(g(e.parameters[0]),y(e.parameters[1]),y(e.parameters[2]),e.parameters[3]?y(e.parameters[3]):1);throw new o.Z("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}(e.value)}}function w(e){if(!(0,r.St)(e))throw new o.Z("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return(0,r.VL)(e)}const C=/^rgba?/i,I=/^hsla?/i},70677:function(e,t,n){n.d(t,{H:function(){return l}});var r=n(61432),o=n(96946),s=n(47566);const i={minX:0,minY:0,maxX:0,maxY:0};function a(e,t,n){(function(e){i.minX=e[0],i.minY=e[1],i.maxX=e[2],i.maxY=e[3]})(t),e.search(i,n)}class l{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new o.Q(9,(0,r.Z)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach(((n,r)=>{e[t++]=r})),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((e=>this._idByBounds.has(e)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=(0,s.cS)();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),a(this._index,e,(e=>t(this._idByBounds.get(e))))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},95014:function(e,t,n){n.d(t,{Z:function(){return p}});var r=n(3480),o=n(88194),s=n(87833),i=n(96711),a=n(16447),l=n(47566),c=n(64246),u=n(70677),f=n(14588),h=n(80613);const d=(0,a.Ue)();class p{constructor(e){this.geometryInfo=e,this._boundsStore=new u.H,this._featuresById=new Map,this._usedMemory=0,this.events=new s.Z,this.featureAdapter=h.n}get usedMemory(){return this._usedMemory}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,n,r,o]=this.fullBounds;return{xmin:t,ymin:n,xmax:r,ymax:o,spatialReference:(0,f.S2)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(e){const t=e.map((e=>this._upsert(e)));return this._emitChanged(),t.filter(r.pC)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged(),this._usedMemory=0}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const n of e){const e=this._boundsStore.get(n.objectId);e&&t((0,a.JR)(d,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const t=e.objectId;if(null==t)return void i.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new o.Z("featurestore:invalid-feature","feature id is missing",{feature:e}));const n=this._featuresById.get(t);let r;if(n?(e.displayId=n.displayId,r=this._boundsStore.get(t),this._boundsStore.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(n)??0):null!=this.onFeatureAdd&&this.onFeatureAdd(e),!e.geometry?.coords?.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=(0,c.$)(null!=r?r:(0,l.Ue)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=r&&this._boundsStore.set(t,r),this._featuresById.set(t,e),this._usedMemory+=this.estimateFeatureUsedMemory?.(e)??0}_upsert(e){const t=e?.objectId;if(null==t)return i.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new o.Z("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const n=this._featuresById.get(t);if(!n)return this._add(e),e;this._usedMemory-=this.estimateFeatureUsedMemory?.(n)??0;const{geometry:r,attributes:s}=e;for(const e in s)n.attributes[e]=s[e];return r&&(n.geometry=r,this._boundsStore.set(t,(0,c.$)((0,l.Ue)(),r,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),this._usedMemory+=this.estimateFeatureUsedMemory?.(n)??0,n}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._boundsStore.delete(t),this._featuresById.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(e)??0,e}}},13878:function(e,t,n){n.d(t,{Z:function(){return b}});var r,o=n(73440),s=n(46451),i=n(41773),a=n(63255),l=n(28947),c=n(17155),u=(n(61432),n(96711),n(1194)),f=n(48023),h=n(29884),d=n(45213),p=n(90756),m=n(98842),y=n(49651);const g=new i.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let b=r=class extends a.Z{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){return this.readFeaturesWithClass(e,t,s.Z)}writeGeometryType(e,t,n,r){if(e)return void g.write(e,t,n,r);const{features:o}=this;if(o)for(const e of o)if(null!=e?.geometry)return void g.write(e.geometry.type,t,n,r)}readQueryGeometry(e,t){if(!e)return null;const n=!!e.spatialReference,r=(0,p.im)(e);return r&&!n&&t.spatialReference&&(r.spatialReference=d.Z.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:n}=this;if(n)for(const e of n)if(e&&null!=e.geometry&&e.geometry.spatialReference)return void(t.spatialReference=e.geometry.spatialReference.toJSON())}clone(){return new r(this.cloneProperties())}cloneProperties(){return(0,l.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let n=0;n<t.features.length;n++){const r=t.features[n];if(r.geometry){const t=e?.[n];r.geometry=t?.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,n],translate:[r,o]}=e,s=this.features,i=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-r)/t)),(e=>Math.round((o-e)/n)));for(let e=0,t=s.length;e<t;e++)i?.(s[e].geometry)||(s.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:n}=this;if(!n)return this;const{translate:[r,o],scale:[s,i]}=n;let a=null,l=null;if(this.hasZ&&null!=n?.scale?.[2]){const{translate:[,,e],scale:[,,t]}=n;a=n=>n*t+e}if(this.hasM&&null!=n?.scale?.[3]){const{translate:[,,,e],scale:[,,,t]}=n;l=n=>null==n?n:n*t+e}const c=this._getHydrationFunction(e,(e=>e*s+r),(e=>o-e*i),a,l);for(const{geometry:e}of t)null!=e&&c&&c(e);return this.transform=null,this}readFeaturesWithClass(e,t,n){const r=d.Z.fromJSON(t.spatialReference),o=[];for(let t=0;t<e.length;t++){const s=e[t],i=n.fromJSON(s),a=s.geometry?.spatialReference;null==i.geometry||a||(i.geometry.spatialReference=r);const l=s.aggregateGeometries,c=i.aggregateGeometries;if(l&&null!=c)for(const e in c){const t=c[e],n=l[e]?.spatialReference;null==t||n||(t.spatialReference=r)}o.push(i)}return o}_quantizePoints(e,t,n){let r,o;const s=[];for(let i=0,a=e.length;i<a;i++){const a=e[i];if(i>0){const e=t(a[0]),i=n(a[1]);e===r&&i===o||(s.push([e-r,i-o]),r=e,o=i)}else r=t(a[0]),o=n(a[1]),s.push([r,o])}return s.length>0?s:null}_getQuantizationFunction(e,t,n){return"point"===e?e=>(e.x=t(e.x),e.y=n(e.y),e):"polyline"===e||"polygon"===e?e=>{const r=(0,p.oU)(e)?e.rings:e.paths,o=[];for(let e=0,s=r.length;e<s;e++){const s=r[e],i=this._quantizePoints(s,t,n);i&&o.push(i)}return o.length>0?((0,p.oU)(e)?e.rings=o:e.paths=o,e):null}:"multipoint"===e?e=>{const r=this._quantizePoints(e.points,t,n);return r&&r.length>0?(e.points=r,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,n,r,o){return"point"===e?e=>{e.x=t(e.x),e.y=n(e.y),r&&(e.z=r(e.z))}:"polyline"===e||"polygon"===e?e=>{const s=(0,p.oU)(e)?e.rings:e.paths;let i,a;for(let e=0,r=s.length;e<r;e++){const r=s[e];for(let e=0,o=r.length;e<o;e++){const o=r[e];e>0?(i+=o[0],a+=o[1]):(i=o[0],a=o[1]),o[0]=t(i),o[1]=n(a)}}if(r&&o)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,n=t.length;e<n;e++){const n=t[e];n[2]=r(n[2]),n[3]=o(n[3])}}else if(r)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,n=t.length;e<n;e++){const n=t[e];n[2]=r(n[2])}}else if(o)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,n=t.length;e<n;e++){const n=t[e];n[2]=o(n[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=n(e.ymin),e.xmax=t(e.xmax),e.ymax=n(e.ymax),r&&null!=e.zmax&&null!=e.zmin&&(e.zmax=r(e.zmax),e.zmin=r(e.zmin)),o&&null!=e.mmax&&null!=e.mmin&&(e.mmax=o(e.mmax),e.mmin=o(e.mmin))}:"multipoint"===e?e=>{const s=e.points;let i,a;for(let e=0,r=s.length;e<r;e++){const r=s[e];e>0?(i+=r[0],a+=r[1]):(i=r[0],a=r[1]),r[0]=t(i),r[1]=n(a)}if(r&&o)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=r(t[2]),t[3]=o(t[3])}else if(r)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=r(t[2])}else if(o)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=o(t[2])}}:null}};(0,o._)([(0,c.Cb)({type:String,json:{write:!0}})],b.prototype,"displayFieldName",void 0),(0,o._)([(0,c.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"exceededTransferLimit",void 0),(0,o._)([(0,c.Cb)({type:[s.Z],json:{write:!0}})],b.prototype,"features",void 0),(0,o._)([(0,u.r)("features")],b.prototype,"readFeatures",null),(0,o._)([(0,c.Cb)({type:[y.Z],json:{write:!0}})],b.prototype,"fields",void 0),(0,o._)([(0,c.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:g.read}}})],b.prototype,"geometryType",void 0),(0,o._)([(0,h.c)("geometryType")],b.prototype,"writeGeometryType",null),(0,o._)([(0,c.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"hasM",void 0),(0,o._)([(0,c.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"hasZ",void 0),(0,o._)([(0,c.Cb)({types:m.qM,json:{write:!0}})],b.prototype,"queryGeometry",void 0),(0,o._)([(0,u.r)("queryGeometry")],b.prototype,"readQueryGeometry",null),(0,o._)([(0,c.Cb)({type:d.Z,json:{write:!0}})],b.prototype,"spatialReference",void 0),(0,o._)([(0,h.c)("spatialReference")],b.prototype,"writeSpatialReference",null),(0,o._)([(0,c.Cb)({json:{write:!0}})],b.prototype,"transform",void 0),b=r=(0,o._)([(0,f.j)("esri.rest.support.FeatureSet")],b),b.prototype.toJSON.isDefaultToJSON=!0},27737:function(e,t,n){n.d(t,{YV:function(){return s},ZB:function(){return d},iW:function(){return l}});var r=n(53147),o=n(61421);function s(e,t,n,r){if(e)if("CIMTextSymbol"!==e.type){if(n&&e.effects)for(const n of e.effects)a(n,t);if(e.symbolLayers)for(const n of e.symbolLayers){switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":i(n,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!r?.preserveOutlineWidth&&n.width&&(n.width*=t);break;case"CIMPictureFill":n.height&&(n.height*=t),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t);break;case"CIMHatchFill":s(n.lineSymbol,t,!0,{...r,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t),n.separation&&(n.separation*=t)}if(n.effects)for(const e of n.effects)a(e,t)}}else null!=e.height&&(e.height*=t)}function i(e,t,n){if(e&&(e.markerPlacement&&function(e,t){switch((0,o.gJ)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const r of e.markerGraphics)e.scaleSymbolsProportionally||s(r.symbol,t,!0,n)}function a(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const n=e.dashTemplate.map((e=>e*t));e.dashTemplate=n}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function l(e){const t=[];return c((0,o.be)(e),t),t.length?new r.Z((0,o.oY)(t[0])):null}function c(e,t){if(!e)return;let n;n="CIMTextSymbol"===e.type?e.symbol:e;const r="CIMPolygonSymbol"===e.type;if(n?.symbolLayers)for(const e of n.symbolLayers)if(!(e.colorLocked||r&&((0,o.yL)(e)||(0,o.zL)(e)&&e.markerPlacement&&(0,o.gJ)(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor&&u(t,e.tintColor);break;case"CIMVectorMarker":e.markerGraphics?.forEach((e=>{c(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":u(t,e.color);break;case"CIMGradientFill":f(t,e);break;case"CIMHatchFill":c(e.lineSymbol,t)}}function u(e,t){for(const n of e)if(n.join(".")===t.join("."))return;e.push(t)}function f(e,t){const n=t.colorRamp?.type;switch(n){case"CIMMultipartColorRamp":t.colorRamp.colorRamps?.forEach((t=>{"CIMLinearContinuousColorRamp"===t.type&&h(e,t)}));break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":h(e,t.colorRamp)}}function h(e,t){t&&(t.fromColor&&u(e,t.fromColor),t.toColor&&u(e,t.toColor))}function d(e,t,n){t instanceof r.Z||(t=new r.Z(t));const s=(0,o.be)(e);s&&p(s,t,n)}function p(e,t,n){if(!e)return;let r;r="CIMTextSymbol"===e.type?e.symbol:e;const s="CIMPolygonSymbol"===r?.type;if(r?.symbolLayers)for(const e of r.symbolLayers){if(e.colorLocked)continue;if(s)if(n){const{layersToColor:t}=n;if(((0,o.yL)(e)||(0,o.zL)(e)&&e.markerPlacement&&(0,o.gJ)(e.markerPlacement))&&"fill"===t||(0,o.k5)(e)&&"outline"===t)continue}else if((0,o.yL)(e)||(0,o.zL)(e)&&e.markerPlacement&&(0,o.gJ)(e.markerPlacement))continue;const r=t.toArray();switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor=r;break;case"CIMVectorMarker":e.markerGraphics?.forEach((e=>{p(e.symbol,t,n)}));break;case"CIMSolidStroke":case"CIMSolidFill":e.color=r;break;case"CIMGradientFill":m(e,t);break;case"CIMHatchFill":p(e.lineSymbol,t,n)}}}function m(e,t){const n=e.colorRamp?.type;switch(n){case"CIMMultipartColorRamp":e.colorRamp.colorRamps?.forEach((e=>{"CIMLinearContinuousColorRamp"===e.type&&y(e,t)}));break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":y(e.colorRamp,t)}}function y(e,t){if(e&&(e.fromColor&&(e.fromColor=t.toArray()),e.toColor)){const n=t.clone();n.a=0,e.toColor=n.toArray()}}},48922:function(e,t,n){n.d(t,{Ne:function(){return _},Od:function(){return m},Sp:function(){return b},_M:function(){return p},iI:function(){return g},mx:function(){return y}});var r=n(1800),o=n(53147),s=n(78619),i=n(12853),a=n(96094),l=n(27737);const c="picture-fill",u="simple-fill",f="simple-marker",h=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),d=new i.z(1e3);function p(e){const t=e.style;let n=null;if(e)switch(e.type){case f:"cross"!==t&&"x"!==t&&(n=e.color);break;case u:t&&"solid"!==t?"none"!==t&&(n={type:"pattern",x:0,y:0,src:(0,r.V)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):n=e.color;break;case c:n={type:"pattern",src:e.url,width:(0,a.F2)(e.width)*e.xscale,height:(0,a.F2)(e.height)*e.yscale,x:(0,a.F2)(e.xoffset),y:(0,a.F2)(e.yoffset)};break;case"text":n=e.color;break;case"cim":n=(0,l.iW)(e)}return n}function m(e,t){const n=e+"-"+t;return void 0!==d.get(n)?Promise.resolve(d.get(n)):(0,s.Z)(e,{responseType:"image"}).then((e=>{const r=e.data,o=r.naturalWidth,s=r.naturalHeight,i=document.createElement("canvas");i.width=o,i.height=s;const a=i.getContext("2d");a.fillStyle=t,a.fillRect(0,0,o,s),a.globalCompositeOperation="destination-in",a.drawImage(r,0,0);const l=i.toDataURL();return d.put(n,l),l}))}function y(e){if(!e)return null;let t=null;switch(e.type){case u:case c:case f:t=y(e.outline);break;case"simple-line":{const n=(0,a.F2)(e.width);null!=e.style&&"none"!==e.style&&0!==n&&(t={color:e.color,style:b(e.style),width:n,cap:e.cap,join:"miter"===e.join?(0,a.F2)(e.miterLimit):e.join},t.dashArray=g(t).join(",")||"none");break}default:t=null}return t}function g(e){if(!e?.style)return[];const{dashArray:t,style:n,width:r}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map((e=>Number(e)));const o=r??0,s=h.has(n)?h.get(n).map((e=>e*o)):[];if("butt"!==e.cap)for(const[e,t]of s.entries())s[e]=e%2==1?t+o:Math.max(t-o,1);return s}const b=(()=>{const e={};return t=>{if(e[t])return e[t];const n=t.replaceAll("-","");return e[t]=n,n}})(),_=new o.Z([128,128,128])},30903:function(e,t,n){n.d(t,{BR:function(){return M},QL:function(){return k},Y6:function(){return d},YW:function(){return p},_h:function(){return y},e3:function(){return v},nf:function(){return m},tb:function(){return b},wJ:function(){return x}});var r=n(53147),o=n(29292),s=(n(61432),n(96094)),i=n(82846),a=n(615),l=n(27737),c=n(48922),u=n(75485),f=n(68578);const h=new r.Z("white");function d(e){if(!e)return 0;if((0,f.dU)(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,s.Wz)((0,c.mx)(e)?.width)}function p(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function m(e){return e.resource?.href??""}function y(e,t){if(!e)return null;let n=null;return(0,f.dU)(e)?n=function(e){const t=e.symbolLayers;if(!t)return null;let n=null;return t.forEach((e=>{"object"===e.type&&e.resource?.href||(n="water"===e.type?e.color:e.material?e.material.color:null)})),n?new r.Z(n):null}(e):(0,f.cT)(e)&&(n="cim"===e.type?(0,l.iW)(e):e.color?new r.Z(e.color):null),n?g(n,t):null}function g(e,t){if(null==t||null==e)return e;const n=e.toRgba();return n[3]=n[3]*t,new r.Z(n)}function b(e,t,n){e&&(t||null!=n)&&(t&&(t=new r.Z(t)),(0,f.dU)(e)?function(e,t,n){const r=e.symbolLayers;if(!r)return;const o=e=>g(t??e??(null!=n?h:null),n);r.forEach((e=>{if("object"!==e.type||!e.resource?.href||t)if("water"===e.type)e.color=o(e.color);else{const t=null!=e.material?e.material.color:null,r=o(t);if(null==e.material?e.material=new u.b({color:r}):e.material.color=r,null!=n&&"outline"in e&&null!=e.outline?.color&&(e.outline.color=g(e.outline.color,n)),"marker"in e&&null!=e.marker){const t=o(e.marker.color);e.marker.color=t}}}))}(e,t,n):(0,f.cT)(e)&&function(e,t,n){(t=t??e.color)&&(e.color=g(t,n)),null!=n&&"outline"in e&&e.outline?.color&&(e.outline.color=g(e.outline.color,n))}(e,t,n))}async function _(e,t){const r=e.symbolLayers;r&&await(0,o.Ed)(r,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){const n=t[2];"number"==typeof n&&(e.size=n)}(e,t);break;case"icon":case"line":case"text":!function(e,t){const n=w(t);null!=n&&(e.size=n)}(e,t);break;case"path":!function(e,t){const n=C(t,i.hq,[e.width,void 0,e.height]);null!=n&&(e.width=I(t[0],e.width,1,n),e.height=I(t[2],e.height,1,n))}(e,t);break;case"object":await async function(e,t){const{resourceSize:r,symbolSize:o}=await async function(e){const{computeObjectLayerResourceSize:t}=await n.e(99795).then(n.bind(n,99795)),r=await t(e,10),{width:o,height:s,depth:i}=e,a=[o,i,s];let l=1;for(let e=0;e<3;e++){const t=a[e];if(null!=t){l=t/r[e];break}}for(let e=0;e<3;e++)null==a[e]&&(a[e]=r[e]*l);return{resourceSize:r,symbolSize:a}}(e),s=C(t,r,o);null!=s&&(e.width=I(t[0],o[0],r[0],s),e.depth=I(t[1],o[1],r[1],s),e.height=I(t[2],o[2],r[2],s))}(e,t)}}(e,t)))}function w(e){for(const t of e)if("number"==typeof t)return t;return null}function C(e,t,n){for(let r=0;r<3;r++){const o=e[r];switch(o){case"symbol-value":{const e=n[r];return null!=e?e/t[r]:1}case"proportional":break;default:if(o&&t[r])return o/t[r]}}return null}function I(e,t,n,r){switch(e){case"proportional":return n*r;case"symbol-value":return null!=t?t:n;default:return e}}async function v(e,t){if(e&&t)return(0,f.dU)(e)?_(e,t):void((0,f.cT)(e)&&function(e,t){const n=w(t);if(null!=n)switch(e.type){case"simple-marker":e.size=n;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=n,e.height=n*t):(e.width=n*t,e.height=n);break}case"simple-line":e.width=n;break;case"text":e.font.size=n}}(e,t))}function M(e,t,n){if(e&&null!=t)if((0,f.dU)(e)){const r=e.symbolLayers;r&&r.forEach((e=>{if("object"===e.type)switch(n){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}"icon"===e.type&&(e.angle+=t)}))}else(0,f.cT)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function x(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,a.rM)(t)}function k(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}},67494:function(e,t,n){n.r(t),n.d(t,{default:function(){return A}});var r=n(73440),o=n(88194),s=n(90403),i=n(17155),a=(n(61432),n(96711),n(83850),n(48023)),l=n(46451),c=n(70880),u=n(61100),f=n(76329),h=n(98842),d=n(48505),p=n(79474),m=n(45239);let y=class extends l.Z{constructor(e){super(e)}getObjectId(){return this.objectId}};(0,r._)([(0,i.Cb)({type:Number,json:{read:!0}})],y.prototype,"objectId",void 0),y=(0,r._)([(0,a.j)("esri.layers.graphics.controllers.StreamController.StreamGraphic")],y);class g{constructor(e){this.onUpdate=e,this._idToGraphic=new Map}destroy(){this._idToGraphic.clear()}add(e){this._idToGraphic.set(e.objectId,e)}get(e){return this._idToGraphic.get(e)}forEach(e){this._idToGraphic.forEach(e)}removeById(e){const t=this._idToGraphic.get(e);return t?(t.sourceLayer=t.layer=null,this._idToGraphic.delete(e),t):null}update(e,t){this.onUpdate(e,t)}get size(){return this._idToGraphic.size}}let b=class extends(f.Z.EsriPromiseMixin(c.Z)){constructor(){super(...arguments),this.isPaused=!1,this.graphics=new m.g,this._updateInfo={websocket:0,client:0},this._updateIntervalId=null,this._outSpatialReference=null}initialize(){this.addResolvingPromise(this.layer.when((()=>this._startup())))}destroy(){this.clear()}_clearInterval(){null!==this._updateIntervalId&&(clearInterval(this._updateIntervalId),this._updateIntervalId=null)}clear(){this._shutdown(),this.graphics.clear()}get updating(){return!this.connection||"connected"===this.connection.connectionStatus}_shutdown(){this._clearInterval(),this.connection=(0,u.SC)(this.connection),this.store=(0,u.SC)(this.store),this.removeAllHandles()}_startup(){const{layer:e,layerView:t}=this,{spatialReference:n,definitionExpression:r,geometryDefinition:o,timeInfo:i,purgeOptions:a,maxReconnectionAttempts:l,maxReconnectionInterval:c,customParameters:u}=e,f=e.geometryType?h.Mk.toJSON(e.geometryType):null,m=n,y=t.view.spatialReference,b={type:"object-id",fieldName:e.objectIdField};this.clear(),this._set("connection",(0,p.createConnection)(e.parsedUrl,m,y,f,r,o,l,c,u??void 0)),this._outSpatialReference=y.toJSON(),this.store=new g(this._onUpdate.bind(this)),this.featuresManager=new d.Q(this.store,b,i.toJSON(),a);const _="startup-watches";this.removeHandles(_),this.addHandles([e.on("send-message-to-socket",(e=>this.connection.sendMessageToSocket(e))),e.on("send-message-to-client",(e=>this.connection.sendMessageToClient(e))),this.connection.on("data-received",(e=>this._onFeature(e))),this.connection.on("message-received",(e=>this._onWebSocketMessage(e))),(0,s.YP)((()=>[e.definitionExpression,e.geometryDefinition,e.purgeOptions]),(()=>this._startup()))],_),this.isPaused||this._initUpdateInterval()}_onWebSocketMessage(e){if(this.layerView.emit("message-received",e),"type"in e)switch(e.type){case"delete":if(e.objectIds)for(const t of e.objectIds)this.featuresManager.removeById(t);if(e.trackIds)for(const t of e.trackIds)this.featuresManager.removeByTrackId(t);break;case"clear":this.store.forEach((e=>this.featuresManager.removeById(e.objectId)))}}_onFeature(e){this._updateInfo.websocket++,this.layerView.hasEventListener("data-received")&&this.layerView.emit("data-received",{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry});try{null==e.geometry||e.geometry.spatialReference||(e.geometry.spatialReference=this._outSpatialReference);const t=y.fromJSON(e);t.sourceLayer=t.layer=this.layer,this.featuresManager.add(t)}catch{}}_onUpdate(e,t){null!=t&&this.graphics.removeMany(t),null!=e&&(this._updateInfo.client+=e.length,this.graphics.addMany(e))}_initUpdateInterval(){this._clearInterval();const{updateInterval:e}=this.layer;let t=performance.now();this._updateIntervalId=setInterval((()=>{const e=performance.now(),n=e-t;if(n>2500){t=e;const r=Math.round(this._updateInfo.client/(n/1e3)),o=Math.round(this._updateInfo.websocket/(n/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.layerView.emit("update-rate",{client:r,websocket:o})}this.featuresManager.checkForUpdates()}),e)}pauseStream(){this.isPaused=!0,this._clearInterval()}resumeStream(){this.isPaused=!1,this._initUpdateInterval()}disconnect(){this._shutdown()}connect(){null==this.connection&&this._startup()}clearGraphics(){this.graphics.clear()}};(0,r._)([(0,i.Cb)()],b.prototype,"isPaused",void 0),(0,r._)([(0,i.Cb)({constructOnly:!0})],b.prototype,"layer",void 0),(0,r._)([(0,i.Cb)({constructOnly:!0})],b.prototype,"layerView",void 0),(0,r._)([(0,i.Cb)()],b.prototype,"connection",void 0),(0,r._)([(0,i.Cb)({readOnly:!0})],b.prototype,"updating",null),b=(0,r._)([(0,a.j)("esri.layers.graphics.controllers.StreamController")],b);var _=n(29191),w=n(43462),C=n(70979),I=n(24381),v=n(47971);let M=class extends v.Q{constructor(e){super(e),this.suspendResumeExtentMode="computed"}get connection(){return this.controller?.connection}createController(){return new b({layer:this.layer,layerView:this.layerView})}beforeSetController(){}pause(){this.controller?.pauseStream()}resume(){this.controller?.resumeStream()}disconnect(){this.controller?.disconnect()}connect(){this.controller?.connect()}clear(){this.controller?.clearGraphics()}};(0,r._)([(0,i.Cb)()],M.prototype,"controller",void 0),(0,r._)([(0,i.Cb)()],M.prototype,"connection",null),(0,r._)([(0,i.Cb)()],M.prototype,"suspendResumeExtentMode",void 0),M=(0,r._)([(0,a.j)("esri.views.3d.layers.graphics.StreamGraphics3DGraphicsPipeline")],M);var x=n(94125),k=n(5527),S=n(58174);const P=e=>{let t=class extends e{resume(){this._isUserPaused=!1,this.suspended||this._doResume()}pause(){this._isUserPaused=!0,this.suspended||this._doPause()}disconnect(){this._doDisconnect()}connect(){this._doConnect()}clear(){this._doClear()}constructor(...e){super(...e),this._isUserPaused=!1,this.filter=null}get connectionStatus(){return(this._isUserPaused||this.suspended)&&"connected"===this._streamConnectionStatus?"paused":this._streamConnectionStatus}_onSuspendedChange(e){e?this._doPause():this._isUserPaused||this._doResume()}};return(0,r._)([(0,i.Cb)()],t.prototype,"_isUserPaused",void 0),(0,r._)([(0,i.Cb)({readOnly:!0})],t.prototype,"connectionStatus",null),(0,r._)([(0,i.Cb)({type:S.Z})],t.prototype,"filter",void 0),t=(0,r._)([(0,a.j)("esri.views.layers.StreamLayerView")],t),t};let R=class extends(P((0,C.R)((0,I.A)(k.Z)))){constructor(){super(...arguments),this.type="stream-3d",this.updatePolicy=x.j.ASYNC,this.hasZ=!0,this.hasM=!1,this.featureEffect=null}initialize(){this.addHandles((0,s.YP)((()=>this.suspended),(e=>{this.graphicsPipeline&&this._onSuspendedChange(e)})))}get connectionError(){const e=this.graphicsPipeline?.connection?.errorString;return e?new o.Z("stream-controller",e):null}createQuery(){return new _.Z({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryLatestObservations(e,t){return this.graphicsPipeline.graphicsQuery.executeQueryForLatestObservations(this._ensureQuery(e),t?.signal)}async queryObjectIds(e,t){return(await super.queryObjectIds(e,t)).filter(w.hj)}get _streamConnectionStatus(){return this.graphicsPipeline?.connection?.connectionStatus??"disconnected"}async createGraphicsPipeline(){return new M({layerView:this})}createController(){return new b({layer:this.layer,layerView:this})}beforeSetController(){}_doPause(){this.graphicsPipeline?.pause()}_doResume(){this.graphicsPipeline?.resume()}_doDisconnect(){this.graphicsPipeline?.disconnect(),this._doPause()}_doConnect(){this.graphicsPipeline?.connect(),this.resume()}_doClear(){this.graphicsPipeline?.clear()}};(0,r._)([(0,i.Cb)({readOnly:!0})],R.prototype,"updatePolicy",void 0),(0,r._)([(0,i.Cb)({readOnly:!0})],R.prototype,"connectionError",null),(0,r._)([(0,i.Cb)()],R.prototype,"graphicsPipeline",void 0),(0,r._)([(0,i.Cb)({readOnly:!0})],R.prototype,"hasZ",void 0),(0,r._)([(0,i.Cb)({readOnly:!0})],R.prototype,"hasM",void 0),(0,r._)([(0,i.Cb)()],R.prototype,"featureEffect",void 0),(0,r._)([(0,i.Cb)({readOnly:!0})],R.prototype,"_streamConnectionStatus",null),R=(0,r._)([(0,a.j)("esri.views.3d.layers.StreamLayerView3D")],R);const A=R}}]);