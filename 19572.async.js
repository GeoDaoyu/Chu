"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[19572],{93191:function(e,t,r){r.d(t,{I:function(){return T},a:function(){return m},b:function(){return w}});var i=r(41044),n=r(27349),o=r(2679),s=r(68647),a=r(7086),c=r(13743),u=r(96541),l=r(85119),h=r(48857),f=r(34709),d=r(52061),p=r(75047),v=r(74826),_=r(15150);class m extends v.K{}function w(e){const t=new _.kG,{vertex:r,fragment:v,varyings:m}=t,{output:w,perspectiveInterpolation:T}=e;return(0,u.Sv)(r,e),t.include(o.w,e),t.include(a.H,e),t.fragment.include(n.f5,e),t.include(s.R,e),t.include(p.j,e),t.attributes.add(d.T.POSITION,"vec3"),t.attributes.add(d.T.UV0,"vec2"),T&&t.attributes.add(d.T.PERSPECTIVEDIVIDE,"float"),r.main.add(h.H`
    vpos = position;
    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    vTexCoord = uv0;
    gl_Position = transformPosition(proj, view, vpos);
    ${(0,h.If)(T,"gl_Position *= perspectiveDivide;")}`),m.add("vpos","vec3",{invariant:!0}),m.add("vTexCoord","vec2"),v.include(c.Y),v.uniforms.add(new l.p("opacity",(e=>e.opacity)),new f.A("tex",(e=>e.glTexture))).main.add(h.H`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${(0,h.If)(w===i.H_.ObjectAndLayerIdColor,"fragColor = vec4(0, 0, 0, 1); return;")}
    vec4 finalColor = texture(tex, vTexCoord) * opacity;
    outputColorHighlightOID(finalColor, vpos, finalColor.rgb);`),t}const T=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:m,build:w},Symbol.toStringTag,{value:"Module"}))},64497:function(e,t,r){r.d(t,{I:function(){return n},v:function(){return o}});var i=r(99574);function n(e,t,r=0){const n=(0,i.uZ)(e,0,c);for(let e=0;e<4;e++)t[r+e]=Math.floor(256*u(n*s[e]))}function o(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*a[i];return r}const s=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],c=o(new Uint8ClampedArray([255,255,255,255]));function u(e){return e-Math.floor(e)}},83695:function(e,t,r){function i(){return[1,0,0,1,0,0]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}r.d(t,{Ue:function(){return i},Wd:function(){return o},d9:function(){return n}});const o=[1,0,0,1,0,0];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:n,create:i,fromValues:function(e,t,r,i,n,o){return[e,t,r,i,n,o]}},Symbol.toStringTag,{value:"Module"}))},50639:function(e,t,r){r.d(t,{Iu:function(){return u},Jp:function(){return s},U1:function(){return a},U_:function(){return o},Us:function(){return l},bA:function(){return c},vc:function(){return f},xJ:function(){return h},yR:function(){return n}});var i=r(66130);function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function o(e,t){const r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5];let c=r*o-i*n;return c?(c=1/c,e[0]=o*c,e[1]=-i*c,e[2]=-n*c,e[3]=r*c,e[4]=(n*a-o*s)*c,e[5]=(i*s-r*a)*c,e):null}function s(e,t,r){const i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],c=t[5],u=r[0],l=r[1],h=r[2],f=r[3],d=r[4],p=r[5];return e[0]=i*u+o*l,e[1]=n*u+s*l,e[2]=i*h+o*f,e[3]=n*h+s*f,e[4]=i*d+o*p+a,e[5]=n*d+s*p+c,e}function a(e,t,r){const i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],c=t[5],u=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*u,e[1]=n*l+s*u,e[2]=i*-u+o*l,e[3]=n*-u+s*l,e[4]=a,e[5]=c,e}function c(e,t,r){const i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],c=t[5],u=r[0],l=r[1];return e[0]=i*u,e[1]=n*u,e[2]=o*l,e[3]=s*l,e[4]=a,e[5]=c,e}function u(e,t,r){const i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],c=t[5],u=r[0],l=r[1];return e[0]=i,e[1]=n,e[2]=o,e[3]=s,e[4]=i*u+o*l+a,e[5]=n*u+s*l+c,e}function l(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function h(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function f(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function d(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}const p=s,v=d;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},equals:function(e,t){const r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],c=e[5],u=t[0],l=t[1],h=t[2],f=t[3],d=t[4],p=t[5],v=(0,i.bn)();return Math.abs(r-u)<=v*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-l)<=v*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-h)<=v*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-f)<=v*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-d)<=v*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(c-p)<=v*Math.max(1,Math.abs(c),Math.abs(p))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},fromRotation:l,fromScaling:h,fromTranslation:f,identity:n,invert:o,mul:p,multiply:s,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},rotate:a,scale:c,set:function(e,t,r,i,n,o,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=s,e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},sub:v,subtract:d,translate:u},Symbol.toStringTag,{value:"Module"}))},85881:function(e,t,r){r.d(t,{F$:function(){return s},G7:function(){return u},HG:function(){return f},Mm:function(){return h},Qi:function(){return d},YL:function(){return n},YN:function(){return l},du:function(){return o},kk:function(){return a}});var i=r(59384);function n(e){return 32+e.length}const o=16;function s(e){if(!e)return 0;let t=h;for(const r in e)e.hasOwnProperty(r)&&(t+=c(e[r],!1));return t}function a(e){if(!e)return 0;if("number"==typeof e[0])return u(e);if(Array.isArray(e))return function(e){const t=e.length;if(0===t||"number"==typeof e[0])return l(e,8);let r=f;for(let i=0;i<t;i++)r+=c(e[i]);return r}(e);let t=h;for(const r in e)e.hasOwnProperty(r)&&(t+=c(e[r]));return t}function c(e,t=!0){switch(typeof e){case"object":return t?a(e):h;case"string":return n(e);case"number":return o;case"boolean":return 4;default:return 8}}function u(...e){return e.reduce(((e,t)=>e+(t?(0,i.fU)(t)?t.byteLength+d:Array.isArray(t)?l(t,o):0:0)),0)}function l(e,t){return f+e.length*t}const h=32,f=16,d=145},41207:function(e,t,r){r.d(t,{S$:function(){return l},Ue:function(){return s},Ws:function(){return u},_k:function(){return c},iL:function(){return a}});var i=r(38949),n=r(24910),o=r(12659);function s(e){return e?{ray:(0,o.Ue)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,o.Ue)(),c0:0,c1:Number.MAX_VALUE}}function a(e,t=s()){return(0,o.JG)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function c(e,t,r=s()){const i=(0,n.l)(e.vector);return(0,o.al)(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function u(e,t){return h(e,e.c0,t)}function l(e,t){return h(e,e.c1,t)}function h(e,t,r){return(0,n.f)(r,e.ray.origin,(0,n.g)(r,e.ray.direction,t))}new i.x((()=>s()))},33869:function(e,t,r){r.d(t,{Hf:function(){return _},JG:function(){return m},Jp:function(){return T},N9:function(){return b},NQ:function(){return n},Nu:function(){return i},Ue:function(){return v},Zr:function(){return y},g8:function(){return M},hr:function(){return g},q_:function(){return w},rN:function(){return x},xu:function(){return P},zq:function(){return O}});var i,n,o,s=r(38949),a=r(31865),c=r(24910),u=r(82846),l=r(73749),h=r(27583),f=r(41207),d=r(77773),p=r(69811);function v(e){return e?[(0,d.Ue)(e[0]),(0,d.Ue)(e[1]),(0,d.Ue)(e[2]),(0,d.Ue)(e[3]),(0,d.Ue)(e[4]),(0,d.Ue)(e[5])]:[(0,d.Ue)(),(0,d.Ue)(),(0,d.Ue)(),(0,d.Ue)(),(0,d.Ue)(),(0,d.Ue)()]}function _(){return[(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)()]}function m(e,t){for(let r=0;r<b;r++)(0,d.JG)(e[r],t[r]);return e}function w(e,t,r,i=S){const n=(0,a.Jp)(p.MP.get(),t,e);(0,a.U_)(n,n);for(let e=0;e<F;++e){const t=(0,l.t)(p.o6.get(),A[e],n);(0,c.i)(i[e],t[0]/t[3],t[1]/t[3],t[2]/t[3])}T(r,i)}function T(e,t){(0,d.zk)(t[n.FAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_TOP_LEFT],e[i.LEFT]),(0,d.zk)(t[n.NEAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_RIGHT],t[n.FAR_TOP_RIGHT],e[i.RIGHT]),(0,d.zk)(t[n.FAR_BOTTOM_LEFT],t[n.FAR_BOTTOM_RIGHT],t[n.NEAR_BOTTOM_RIGHT],e[i.BOTTOM]),(0,d.zk)(t[n.NEAR_TOP_LEFT],t[n.NEAR_TOP_RIGHT],t[n.FAR_TOP_RIGHT],e[i.TOP]),(0,d.zk)(t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_RIGHT],t[n.NEAR_TOP_RIGHT],e[i.NEAR]),(0,d.zk)(t[n.FAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_LEFT],t[n.FAR_TOP_LEFT],e[i.FAR])}function g(e,t){for(let r=0;r<b;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function y(e,t){return R(e,(0,f.iL)(t,C.get()))}function O(e,t){for(let r=0;r<b;r++){const i=e[r];if(!(0,d.Er)(i,t))return!1}return!0}function x(e,t,r){return R(e,(0,f._k)(t,r,C.get()))}function M(e,t){for(let r=0;r<b;r++)if((0,d.jH)(e[r],t)>0)return!1;return!0}function R(e,t){for(let r=0;r<b;r++)if(!(0,d.oq)(e[r],t))return!1;return!0}(o=i||(i={}))[o.LEFT=0]="LEFT",o[o.RIGHT=1]="RIGHT",o[o.BOTTOM=2]="BOTTOM",o[o.TOP=3]="TOP",o[o.NEAR=4]="NEAR",o[o.FAR=5]="FAR",function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(n||(n={}));const P={bottom:[n.FAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_LEFT,n.FAR_BOTTOM_LEFT],near:[n.NEAR_BOTTOM_LEFT,n.NEAR_BOTTOM_RIGHT,n.NEAR_TOP_RIGHT,n.NEAR_TOP_LEFT],far:[n.FAR_BOTTOM_RIGHT,n.FAR_BOTTOM_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_RIGHT],right:[n.NEAR_BOTTOM_RIGHT,n.FAR_BOTTOM_RIGHT,n.FAR_TOP_RIGHT,n.NEAR_TOP_RIGHT],left:[n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_TOP_LEFT,n.FAR_TOP_LEFT],top:[n.FAR_TOP_LEFT,n.NEAR_TOP_LEFT,n.NEAR_TOP_RIGHT,n.FAR_TOP_RIGHT]},b=6,F=8,A=[(0,h.al)(-1,-1,-1,1),(0,h.al)(1,-1,-1,1),(0,h.al)(1,1,-1,1),(0,h.al)(-1,1,-1,1),(0,h.al)(-1,-1,1,1),(0,h.al)(1,-1,1,1),(0,h.al)(1,1,1,1),(0,h.al)(-1,1,1,1)],C=new s.x(f.Ue),S=_()},27936:function(e,t,r){function i(e){return"point"===e.type}r.d(t,{f:function(){return i}})},36027:function(e,t,r){r.d(t,{$o:function(){return x},Go:function(){return y},Si:function(){return F},Uu:function(){return O},WR:function(){return g},ZL:function(){return P},_Z:function(){return b},bD:function(){return M},bh:function(){return R},zE:function(){return m}});var i=r(26636),n=r(31865),o=r(10934),s=r(82846),a=r(73749),c=r(27583),u=r(13132),l=r(16447),h=r(47566),f=r(69372),d=r(28931),p=r(52861),v=r(60856),_=r(74774);function m(e,t){if("point"===e.type)return T(e,t,!1);if((0,_.Ou)(e))switch(e.type){case"extent":return T(e.center,t,!1);case"polygon":return T(e.centroid,t,!1);case"polyline":return T(w(e),t,!0);case"mesh":return T((0,p.rU)(e.vertexSpace,e.spatialReference)??e.extent.center,t,!1);case"multipoint":return}else switch(e.type){case"extent":return T(function(e){return(0,v.T)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return T(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const r=(0,f.a)(e.rings,!!e.hasZ);return(0,v.T)(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return T(w(e),t,!0);case"multipoint":return}}function w(e){const t=e.paths[0];if(!t||0===t.length)return null;const r=(0,d.n8)(t,(0,d.ok)(t)/2);return(0,v.T)(r[0],r[1],r[2],e.spatialReference)}function T(e,t,r){const i=r?e:(0,_.WG)(e);return t&&e?(0,u.projectPoint)(e,i,t)?i:null:i}function g(e){if(!e)return 0;switch(e.type){case"point":return e.z;case"extent":return e.zmax;case"polygon":return e.hasZ?e.rings.reduce(((e,t)=>t.reduce(((e,t)=>Math.max(e,t[2])),e)),-1/0):void 0;case"polyline":return e.hasZ?e.paths.reduce(((e,t)=>t.reduce(((e,t)=>Math.max(e,t[2])),e)),-1/0):void 0;case"mesh":return e.extent.zmax;case"multipoint":return}}function y(e,t,r,i=0){if(e){t||(t=(0,h.Ue)());const n=e;let o=.5*n.width*(r-1),s=.5*n.height*(r-1);return n.width<1e-7*n.height?o+=s/20:n.height<1e-7*n.width&&(s+=o/20),(0,a.s)(t,n.xmin-o-i,n.ymin-s-i,n.xmax+o+i,n.ymax+s+i),t}return null}function O(e,t,r=null){const i=(0,c.d9)(c.hq);return null!=e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),null!=t?i[3]=t:null!=e&&e.length>3&&(i[3]=e[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function x(e,t,r,i,n,o){for(let t=0;t<3;++t)o[t]=null!=e?.[t]?e[t]:null!=r?.[t]?r[t]:n[t];return o[3]=null!=t?t:null!=i?i:n[3],o}function M(e=s.hq,t,r,i=1){const n=new Array(3);if(null==t||null==r)n[0]=1,n[1]=1,n[2]=1;else{let i,o=0;for(let s=2;s>=0;s--){const a=e[s],c=null!=a,u=0===s&&!i&&!c,l=r[s];let h;"symbol-value"===a||u?h=0!==l?t[s]/l:1:c&&"proportional"!==a&&isFinite(a)&&(h=0!==l?a/l:1),null!=h&&(n[s]=h,i=h,o=Math.max(o,Math.abs(h)))}for(let e=2;e>=0;e--)null==n[e]?n[e]=i:0===n[e]&&(n[e]=.001*o)}for(let e=2;e>=0;e--)n[e]/=i;return(0,s.nI)(n)}function R(e){return P(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function P(e){const t=e=>null==e||e>=0;return Array.isArray(e)?e.every(t):t(e)}function b(e,t,r,i=(0,o.Ue)()){return e&&(0,n.jI)(i,i,-e/180*Math.PI),t&&(0,n.lM)(i,i,t/180*Math.PI),r&&(0,n.uD)(i,i,r/180*Math.PI),i}function F(e,t,r){if(null!=r.minDemResolution)return r.minDemResolution;const n=(0,i.c9)(t),o=(0,l.bf)(e)*n,s=(0,l.Ye)(e)*n,a=(0,l.Cb)(e)*(t.isGeographic?1:n);return 0===o&&0===s&&0===a?r.minDemResolutionForPoints:.01*Math.max(o,s,a)}},90494:function(e,t,r){r.d(t,{Fb:function(){return o},KO:function(){return s},sb:function(){return n}});var i=r(27936);class n{constructor(e,t=null,r=0){this.array=e,this.spatialReference=t,this.offset=r}}function o(e){return"array"in e}function s(e,t,r="ground"){if((0,i.f)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(o(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,t.spatialReference??e.spatialReference,r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},70662:function(e,t,r){r.d(t,{Lm:function(){return a},Zu:function(){return c},bA:function(){return u},qj:function(){return l}});var i=r(41044),n=r(92684),o=r(37124),s=r(48857);function a(e){e.varyings.add("linearDepth","float",{invariant:!0})}function c(e){e.vertex.uniforms.add(new o.$("nearFar",(e=>e.camera.nearFar)))}function u(e){e.vertex.code.add(s.H`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function l(e,t){const{vertex:r}=e;switch(t.output){case i.H_.Color:case i.H_.ColorEmission:if(t.receiveShadows)return a(e),void r.code.add(s.H`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case i.H_.Shadow:case i.H_.ShadowHighlight:case i.H_.ShadowExcludeHighlight:case i.H_.ViewshedShadow:return e.include(n.up,t),a(e),c(e),u(e),void r.code.add(s.H`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(s.H`void forwardLinearDepth() {}`)}},2679:function(e,t,r){r.d(t,{w:function(){return o}});var i=r(70662),n=r(48857);function o(e){(0,i.bA)(e),e.vertex.code.add(n.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(n.H`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},56335:function(e,t,r){r.d(t,{c:function(){return o}});var i=r(48857),n=r(52061);function o(e,t){t.hasVertexColors?(e.attributes.add(n.T.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(i.H`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(i.H`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(i.H`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},92684:function(e,t,r){r.d(t,{OU:function(){return m},su:function(){return _},up:function(){return v}});var i=r(30748),n=r(10934),o=r(82846),s=r(28984),a=r(80357),c=r(9535),u=r(48857),l=r(15727),h=r(57798),f=r(95334),d=r(52061),p=r(74826);function v(e,t){const{attributes:r,vertex:i,varyings:n,fragment:o}=e;i.include(s.$,t),r.add(d.T.POSITION,"vec3"),n.add("vPositionWorldCameraRelative","vec3"),n.add("vPosition_view","vec3",{invariant:!0}),i.uniforms.add(new c.J("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH)),new c.J("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new h.c("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new f.g("transformProjFromView",(e=>e.transformProjFromView)),new l.j("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new a.B("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new a.B("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL))),i.code.add(u.H`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * position;
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(u.H`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?u.H`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:u.H`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),o.uniforms.add(new c.J("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL))),i.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),o.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class _ extends p.K{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,o.Ue)(),this.transformWorldFromViewTL=(0,o.Ue)(),this.transformViewFromCameraRelativeRS=(0,i.Ue)(),this.transformProjFromView=(0,n.Ue)()}}class m extends p.K{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,i.Ue)(),this.transformWorldFromModelTH=(0,o.Ue)(),this.transformWorldFromModelTL=(0,o.Ue)()}}},27897:function(e,t,r){r.d(t,{L:function(){return u},V:function(){return h}});var i=r(73749),n=r(27583),o=r(39863),s=r(96541),a=r(2013),c=r(48857);function u(e,t){const r=e.vertex;t.hasVerticalOffset?(h(r),t.hasScreenSizePerspective&&(e.include(o.cK),(0,o.m8)(r),(0,s.hY)(e.vertex,t)),r.code.add(c.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?c.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:c.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?c.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:c.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(c.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const l=(0,n.Ue)();function h(e){e.uniforms.add(new a.N("verticalOffset",((e,t)=>{const{minWorldLength:r,maxWorldLength:n,screenLength:o}=e.verticalOffset,s=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),a=t.camera.pixelRatio||1;return(0,i.s)(l,o*a,s,r,n)})))}},89755:function(e,t,r){r.d(t,{H:function(){return o}});var i=r(79729),n=r(48857);function o(e){e.uniforms.add(new i.U("alignPixelEnabled",(e=>e.alignPixelEnabled))),e.code.add(n.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(n.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}},19615:function(e,t,r){r.d(t,{R:function(){return f},c:function(){return h}});var i=r(27897),n=r(39863),o=r(96541),s=r(23027),a=r(13663),c=r(85119),u=r(48857),l=r(52061);const h=.5;function f(e,t){e.include(n.cK),e.attributes.add(l.T.POSITION,"vec3"),e.attributes.add(l.T.NORMAL,"vec3"),e.attributes.add(l.T.CENTEROFFSETANDDISTANCE,"vec4");const r=e.vertex;(0,o.Sv)(r,t),(0,o.hY)(r,t),r.uniforms.add(new s.$("viewport",(e=>e.camera.fullViewport)),new c.p("polygonOffset",(e=>e.shaderPolygonOffset)),new a.z("cameraGroundRelative",(e=>e.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,i.V)(r),r.code.add(u.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(u.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.terrainDepthTest?u.H.float(0):u.H`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,o._8)(r),t.draped||(r.uniforms.add(new a.z("perDistancePixelRatio",(e=>Math.tan(e.camera.fovY/2)/(e.camera.fullViewport[2]/2)))),r.code.add(u.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${u.H.float(h)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,o.ZI)(r),t.hasScreenSizePerspective&&(0,n.m8)(r),r.code.add(u.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?u.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":u.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}},42609:function(e,t,r){r.d(t,{P:function(){return u}});var i=r(89755),n=r(29158),o=r(23027),s=r(13663),a=r(48857),c=r(71063);function u(e){e.vertex.uniforms.add(new s.z("renderTransparentlyOccludedHUD",(e=>e.hudRenderStyle===n.U.Occluded?1:e.hudRenderStyle===n.U.NotOccluded?0:.75)),new o.$("viewport",(e=>e.camera.fullViewport)),new c.e("hudVisibilityTexture",(e=>e.hudVisibility?.getTexture()))),e.vertex.include(i.H),e.vertex.code.add(a.H`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}},45701:function(e,t,r){r.d(t,{n:function(){return n}});var i=r(48857);function n(e){e.code.add(i.H`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),e.code.add(i.H`const vec4 RGBA_TO_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgbaTofloat(vec4 rgba) {
return dot(rgba, RGBA_TO_FLOAT_FACTORS);
}`),e.code.add(i.H`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`)}},39863:function(e,t,r){r.d(t,{cK:function(){return a},m8:function(){return u},ww:function(){return c}});var i=r(24910),n=r(82846),o=r(9535),s=r(48857);function a(e){e.vertex.code.add(s.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(s.H`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),e.vertex.code.add(s.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(s.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(s.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(s.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function c(e){e.uniforms.add(new o.J("screenSizePerspective",(e=>l(e.screenSizePerspective))))}function u(e){e.uniforms.add(new o.J("screenSizePerspectiveAlignment",(e=>l(e.screenSizePerspectiveAlignment||e.screenSizePerspective))))}function l(e){return(0,i.i)(h,e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const h=(0,n.Ue)()},90285:function(e,t,r){r.d(t,{$:function(){return o}});var i=r(5998),n=r(92217);class o extends n.x{constructor(e,t){super(e,"vec4",i.P.Draw,((r,i,n)=>r.setUniform4fv(e,t(i,n))))}}},82915:function(e,t,r){r.d(t,{as:function(){return n},t9:function(){return s}});var i=r(63974);class n{constructor(){this.adds=new i.Z,this.removes=new i.Z,this.updates=new i.Z({allocator:e=>e||new o,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class o{}class s{constructor(e){this.pending=e,this.adds=new Array,this.removes=new Array,this.updates=new Array}clearAddsAndRemoves(){this.adds.forEach((e=>this.pending.adds.removeUnordered(e))),this.removes.forEach((e=>this.pending.removes.removeUnordered(e))),this.adds.length=0,this.removes.length=0}clearUpdates(){this.updates.forEach((e=>this.pending.updates.removeUnordered(e))),this.updates.length=0}clear(){this.clearUpdates(),this.clearAddsAndRemoves()}}},92181:function(e,t,r){r.d(t,{i_:function(){return a},w0:function(){return c},Wd:function(){return u}});var i=r(82846),n=r(32033),o=r(19821);class s{constructor(e,t,r){this.object=e,this.geometryId=t,this.primitiveIndex=r}}class a extends n.x{constructor(){super(...arguments),this.intersector=o.q.HUD}}class c extends s{constructor(e,t){super(e.object,e.geometryId,e.primitiveIndex),this.center=(0,i.d9)(t)}}function u(e){return(0,n.n)(e)&&e.intersector===o.q.HUD&&!!e.target&&"center"in e.target}},92490:function(e,t,r){r.d(t,{j:function(){return d},r:function(){return p}});var i=r(24910),n=r(82846),o=r(12659),s=r(56172),a=r(48636),c=r(92181),u=r(61442),l=r(32033),h=r(19821),f=r(43925);const d=1e-5;class p{constructor(e){this.options=new u.o,this._results=new _,this.transform=new f.yn,this.camera=new a.Z,this.tolerance=d,this.verticalOffset=null,this._ray=(0,o.Ue)(),this._rayEnd=(0,n.Ue)(),this._rayBeginTransformed=(0,n.Ue)(),this._rayEndTransformed=(0,n.Ue)(),this.viewingMode=e??s.JY.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,r){this.resetWithRay((0,o.zk)(e,t,this._ray),r)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,o.JG)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===s.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,i.f)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,r,i,n){this.point=t,this.filterPredicate=i,this.tolerance=r??d;const o=(0,f.W9)(this.verticalOffset);if(e&&e.length>0){const t=n?e=>{n(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const r of e){const e=r.getSpatialQueryAccelerator?.();null!=e?(null!=o?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,o):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):r.objects.forEach((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const r=e.effectiveTransformation,n=(0,f.W9)(this.verticalOffset);for(const o of t){if(!o.visible)continue;const{material:t,id:s}=o;if(!t.visible)continue;this.transform.setAndInvalidateLazyTransforms(r,o.transformation),(0,i.t)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,i.t)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const a=this.transform.transform;null!=n&&(n.objectTransform=this.transform),t.intersect(o,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,r,i,n)=>this.handleObjectIntersection({object:e,geometryId:s,primitiveIndex:i},t,r,a,n)))}}handleObjectIntersection(e,t,r,i,n){if(t<0||null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const o=n?this._results.hud:this._results;e=n?new c.w0(e,n):e;const s=n?i=>i.set(h.q.HUD,e,t,r):n=>n.set(h.q.OBJECT,e,t,r,i);if((null==o.min.distance||t<o.min.distance)&&s(o.min),this.options.store!==u.e.MIN&&(null==o.max.distance||t>o.max.distance)&&s(o.max),this.options.store===u.e.ALL)if(n){const e=new c.i_(this._ray);s(e),this._results.hud.all.push(e)}else{const e=new l.x(this._ray);s(e),this._results.all.push(e)}}sortResults(e=this._results.all){e.sort(((e,t)=>e.distance!==t.distance?(e.distance??0)-(t.distance??0):e.drapedLayerOrder!==t.drapedLayerOrder?v(e.drapedLayerOrder,t.drapedLayerOrder):v(e.renderPriority,t.renderPriority)))}}function v(e,t){return(t??-Number.MAX_VALUE)-(e??-Number.MAX_VALUE)}class _{constructor(){this.min=new l.x((0,o.Ue)()),this.max=new l.x((0,o.Ue)()),this.hud={min:new c.i_((0,o.Ue)()),max:new c.i_((0,o.Ue)()),all:new Array},this.ground=new l.x((0,o.Ue)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}},61442:function(e,t,r){r.d(t,{e:function(){return n},o:function(){return i}});class i{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerViewUids=[],this.store=n.ALL,this.normalRequired=!0,this.excludeLabels=!1}}var n;!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(n||(n={}))},32033:function(e,t,r){r.d(t,{n:function(){return f},x:function(){return h}});var i=r(31865),n=r(10934),o=r(24910),s=r(82846),a=r(73749),c=r(27583),u=r(12659),l=r(19821);class h{get ray(){return this._ray}get distanceInRenderSpace(){return null==this.distance?null:((0,o.g)(d,this.ray.direction,this.distance),(0,o.l)(d))}withinDistance(e){return!!f(this)&&this.distanceInRenderSpace<=e}getIntersectionPoint(e){return!!f(this)&&((0,o.g)(d,this.ray.direction,this.distance),(0,o.f)(e,this.ray.origin,d),!0)}getTransformedNormal(e){return(0,o.c)(p,this.normal),p[3]=0,(0,a.t)(p,p,this.transformation),(0,o.c)(e,p),(0,o.n)(e,e)}constructor(e){this.intersector=l.q.OBJECT,this.normal=(0,s.Ue)(),this.transformation=(0,n.Ue)(),this._ray=(0,u.Ue)(),this.init(e)}init(e){this.distance=this.target=this.drapedLayerOrder=this.renderPriority=null,this.intersector=l.q.OBJECT,(0,u.JG)(e,this._ray)}set(e,t,r,a,c,u,l){this.intersector=e,this.distance=r,(0,o.c)(this.normal,a??s.eG),(0,i.JG)(this.transformation,c??n.Wd),this.target=t,this.drapedLayerOrder=u,this.renderPriority=l}copy(e){(0,u.JG)(e.ray,this._ray),this.intersector=e.intersector,this.distance=e.distance,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.renderPriority=e.renderPriority,(0,o.c)(this.normal,e.normal),(0,i.JG)(this.transformation,e.transformation)}}function f(e){return null!=e?.distance}const d=(0,s.Ue)(),p=(0,c.Ue)()},19821:function(e,t,r){var i;r.d(t,{q:function(){return i}}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL",e[e.TILES3D=8]="TILES3D"}(i||(i={}))},87807:function(e,t,r){r.d(t,{Bw:function(){return h},CN:function(){return v},ET:function(){return _},Fw:function(){return A},IG:function(){return m},Tw:function(){return F},Ue:function(){return b},ko:function(){return w},sT:function(){return u}});var i=r(24910),n=r(82846),o=r(16447),s=r(52964),a=r(61719),c=r(52061);class u{constructor(e=!1,t=!0){this.isVerticalRay=e,this.normalRequired=t}}const l=(0,o.Ue)();function h(e,t,r,n,o,l){if(!e.visible)return;const h=(0,i.a)(D,n,r),f=(e,t,r)=>{l(e,r,t)},p=new u(!1,t.options.normalRequired);if(e.boundingInfo){(0,a.hu)(e.type===s.V.Mesh);const i=t.tolerance;d(e.boundingInfo,r,h,i,o,p,f)}else{const t=e.attributes.get(c.T.POSITION),i=t.indices;T(r,h,0,i.length/3,i,t.data,t.stride,o,p,f)}}const f=(0,n.Ue)();function d(e,t,r,n,s,a,c){if(null==e)return;const u=function(e,t){return(0,i.i)(t,1/e[0],1/e[1],1/e[2])}(r,f);if((0,o.op)(l,e.bbMin),(0,o.Tn)(l,e.bbMax),null!=s&&s.applyToAabb(l),F(l,t,u,n)){const{primitiveIndices:i,position:o}=e,u=i?i.length:o.indices.length/3;if(u>C){const i=e.getChildren();if(void 0!==i){for(const e of i)d(e,t,r,n,s,a,c);return}}!function(e,t,r,i,n,o,s,a,c,u,l){const h=e[0],f=e[1],d=e[2],v=t[0],_=t[1],m=t[2],{normalRequired:w}=u;for(let e=r;e<i;++e){const t=a[e],r=3*t,i=s*n[r];let u=o[i],T=o[i+1],g=o[i+2];const y=s*n[r+1];let O=o[y],M=o[y+1],R=o[y+2];const P=s*n[r+2];let b=o[P],F=o[P+1],A=o[P+2];null!=c&&([u,T,g]=c.applyToVertex(u,T,g,e),[O,M,R]=c.applyToVertex(O,M,R,e),[b,F,A]=c.applyToVertex(b,F,A,e));const C=O-u,D=M-T,E=R-g,I=b-u,U=F-T,V=A-g,H=_*V-U*m,L=m*I-V*v,N=v*U-I*_,z=C*H+D*L+E*N;if(Math.abs(z)<=S)continue;const j=h-u,G=f-T,B=d-g,W=j*H+G*L+B*N;if(z>0){if(W<0||W>z)continue}else if(W>0||W<z)continue;const q=G*E-D*B,J=B*C-E*j,$=j*D-C*G,k=v*q+_*J+m*$;if(z>0){if(k<0||W+k>z)continue}else if(k>0||W+k<z)continue;const Y=(I*q+U*J+V*$)/z;Y>=0&&l(Y,t,w?x(C,D,E,I,U,V,p):null)}}(t,r,0,u,o.indices,o.data,o.stride,i,s,a,c)}}const p=(0,n.Ue)();function v(e,t,r,n,o,s,a,c,u){const{data:l,stride:h}=s;T(e,(0,i.a)(D,t,e),r,n,o,l,h,a,c,u)}function _(e,t,r,i,n,o,s,a,c,u=null,l=0){const h=e[0],f=e[1],d=e[2],v=t[0],_=t[1],m=t[2];for(let e=r;e<i;++e){const t=l+(u?u[e]:e),r=3*t,i=s*n[r],w=o[i],T=o[i+1],g=o[i+2],y=s*n[r+1],O=o[y],M=o[y+1],R=o[y+2],P=s*n[r+2],b=O-w,F=M-T,A=R-g,C=o[P]-w,D=o[P+1]-T,E=o[P+2]-g,I=_*E-D*m,U=m*C-E*v,V=v*D-C*_,H=b*I+F*U+A*V;if(Math.abs(H)<=S)continue;const L=h-w,N=f-T,z=d-g,j=L*I+N*U+z*V;if(H>0){if(j<0||j>H)continue}else if(j>0||j<H)continue;const G=N*A-F*z,B=z*b-A*L,W=L*F-b*N,q=v*G+_*B+m*W;if(H>0){if(q<0||j+q>H)continue}else if(q>0||j+q<H)continue;const J=(C*G+D*B+E*W)/H;J>=0&&c(J,t,a?x(b,F,A,C,D,E,p):null)}}function m(e,t,r,i,n,o,s,a){const c=e[0],u=e[1],l=e[2],h=t[0],f=t[1],d=t[2];for(let e=r;e<i;++e){const t=3*e,r=t+1,i=t+2,v=o*t,_=n[v],m=n[v+1],w=n[v+2],T=o*r,g=o*i,y=n[T]-_,O=n[T+1]-m,M=n[T+2]-w,R=n[g]-_,P=n[g+1]-m,b=n[g+2]-w,F=f*b-P*d,A=d*R-b*h,C=h*P-R*f,D=y*F+O*A+M*C;if(Math.abs(D)<=S)continue;const E=c-_,I=u-m,U=l-w,V=E*F+I*A+U*C;if(D>0){if(V<0||V>D)continue}else if(V>0||V<D)continue;const H=I*M-O*U,L=U*y-M*E,N=E*O-y*I,z=h*H+f*L+d*N;if(D>0){if(z<0||V+z>D)continue}else if(z>0||V+z<D)continue;const j=(R*H+P*L+b*N)/D;j>=0&&a(j,e,s?x(y,O,M,R,P,b,p):null)}}function w(e,t,r,i,n,o,s,a,c,u,l,h=null,f=0){const d=e[0],v=e[1],_=e[2],m=t[0],w=t[1],T=t[2];for(let e=r;e<i;++e){const t=f+(h?h[e]:e),r=3*t,i=s*n[r],g=o[i],y=o[i+1],O=o[i+2],M=s*n[r+1],R=o[M],P=o[M+1],b=o[M+2],F=s*n[r+2],A=o[F],C=o[F+1],D=o[F+2],E=O-c,I=a/Math.sqrt(g*g+y*y+E*E),U=g+g*I,V=y+y*I,H=O+E*I,L=b-c,N=a/Math.sqrt(R*R+P*P+L*L),z=R+R*N,j=P+P*N,G=b+L*N,B=D-c,W=a/Math.sqrt(A*A+C*C+B*B),q=z-U,J=j-V,$=G-H,k=A+A*W-U,Y=C+C*W-V,Z=D+B*W-H,X=w*Z-Y*T,K=T*k-Z*m,Q=m*Y-k*w,ee=q*X+J*K+$*Q;if(Math.abs(ee)<=S)continue;const te=d-U,re=v-V,ie=_-H,ne=te*X+re*K+ie*Q;if(ee>0){if(ne<0||ne>ee)continue}else if(ne>0||ne<ee)continue;const oe=re*$-J*ie,se=ie*q-$*te,ae=te*J-q*re,ce=m*oe+w*se+T*ae;if(ee>0){if(ce<0||ne+ce>ee)continue}else if(ce>0||ne+ce<ee)continue;const ue=(k*oe+Y*se+Z*ae)/ee;ue>=0&&l(ue,t,u?x(q,J,$,k,Y,Z,p):null)}}function T(e,t,r,n,o,s,a,c,u,l){const h=t,f=E,d=Math.abs(h[0]),p=Math.abs(h[1]),v=Math.abs(h[2]),_=d>=p?d>=v?0:2:p>=v?1:2,m=_,w=h[m]<0?2:1,T=(_+w)%3,x=(_+(3-w))%3,R=h[T]/h[m],P=h[x]/h[m],b=1/h[m],F=g,A=y,C=O,{normalRequired:S}=u;for(let t=r;t<n;++t){const r=3*t,n=a*o[r];(0,i.i)(f[0],s[n+0],s[n+1],s[n+2]);const u=a*o[r+1];(0,i.i)(f[1],s[u+0],s[u+1],s[u+2]);const h=a*o[r+2];(0,i.i)(f[2],s[h+0],s[h+1],s[h+2]),c&&((0,i.c)(f[0],c.applyToVertex(f[0][0],f[0][1],f[0][2],t)),(0,i.c)(f[1],c.applyToVertex(f[1][0],f[1][1],f[1][2],t)),(0,i.c)(f[2],c.applyToVertex(f[2][0],f[2][1],f[2][2],t))),(0,i.a)(F,f[0],e),(0,i.a)(A,f[1],e),(0,i.a)(C,f[2],e);const d=F[T]-R*F[m],p=F[x]-P*F[m],v=A[T]-R*A[m],_=A[x]-P*A[m],w=C[T]-R*C[m],g=C[x]-P*C[m],y=w*_-g*v,O=d*g-p*w,D=v*p-_*d;if((y<0||O<0||D<0)&&(y>0||O>0||D>0))continue;const E=y+O+D;if(0===E)continue;const I=y*(b*F[m])+O*(b*A[m])+D*(b*C[m]);if(I*Math.sign(E)<0)continue;const U=I/E;U>=0&&l(U,t,S?M(f):null)}}const g=(0,n.Ue)(),y=(0,n.Ue)(),O=(0,n.Ue)();function x(e,t,r,n,o,s,a){return(0,i.i)(R,e,t,r),(0,i.i)(P,n,o,s),(0,i.h)(a,R,P),(0,i.n)(a,a),a}function M(e){return(0,i.a)(R,e[1],e[0]),(0,i.a)(P,e[2],e[0]),(0,i.h)(p,R,P),(0,i.n)(p,p),p}const R=(0,n.Ue)(),P=(0,n.Ue)();function b(e,t,r){return(0,i.i)(r,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function F(e,t,r,i){return A(e,t,r,i,1/0)}function A(e,t,r,i,n){const o=(e[0]-i-t[0])*r[0],s=(e[3]+i-t[0])*r[0];let a=Math.min(o,s),c=Math.max(o,s);const u=(e[1]-i-t[1])*r[1],l=(e[4]+i-t[1])*r[1];if(c=Math.min(c,Math.max(u,l)),c<0)return!1;if(a=Math.max(a,Math.min(u,l)),a>c)return!1;const h=(e[2]-i-t[2])*r[2],f=(e[5]+i-t[2])*r[2];return c=Math.min(c,Math.max(h,f)),!(c<0)&&(a=Math.max(a,Math.min(h,f)),!(a>c)&&a<n)}const C=1e3,S=1e-7,D=(0,n.Ue)(),E=[(0,n.Ue)(),(0,n.Ue)(),(0,n.Ue)()]},10517:function(e,t,r){r.d(t,{Np:function(){return n},YE:function(){return i},q9:function(){return a}});var i,n,o,s=r(82915);function a(e){const t=new Map,r=r=>{let i=t.get(r);return i||(i=new s.t9(e),t.set(r,i)),i};return e.removes.forAll((e=>{c(e)&&r(e.material).removes.push(e)})),e.adds.forAll((e=>{c(e)&&r(e.material).adds.push(e)})),e.updates.forAll((e=>{c(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)})),t}function c(e){return e.geometry.indexCount>=1}(o=i||(i={}))[o.Default=0]="Default",o[o.Screenshot=1]="Screenshot",o[o.ObjectAndLayerID=2]="ObjectAndLayerID",function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(n||(n={}))},29296:function(e,t,r){r.d(t,{G:function(){return u}});var i=r(24910),n=r(82846),o=r(81342),s=r(87807),a=r(52061),c=r(92991);class u{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.get(a.T.POSITION).indices.length}write(e,t,r,i,n,o){return(0,c.NK)(r,i,this.vertexBufferLayout,e,t,n,o)}intersect(e,t,r,n,c,u,h){const f=this.vertexBufferLayout.createView(e).getField(a.T.POSITION,o.ct);if(null==f)return;const d=(0,i.a)(l,u,c),p=f.count/3,v=n.options.normalRequired;(0,s.IG)(c,d,0,p,f.typedBuffer,f.typedBufferStride,v,((e,t,r)=>{h(e,r,t)}))}}const l=(0,n.Ue)()},36121:function(e,t,r){r.d(t,{IM:function(){return a},VD:function(){return u},qj:function(){return s},tl:function(){return c},wp:function(){return o}});var i=r(52890),n=r(52061);const o=(0,i.U$)().vec3f(n.T.POSITION),s=(0,i.U$)().vec3f(n.T.POSITION).vec2f16(n.T.UV0),a=(0,i.U$)().vec3f(n.T.POSITION).vec4u8(n.T.COLOR),c=((0,i.U$)().vec3f(n.T.POSITION).vec2f16(n.T.UV0).vec4u8(n.T.OLIDCOLOR),(0,i.U$)().vec3f(n.T.POSITION).vec2f(n.T.UV0)),u=(0,i.U$)().vec3f(n.T.POSITION).vec2f(n.T.UV0).vec4u8(n.T.OLIDCOLOR)},3113:function(e,t,r){r.d(t,{j:function(){return S}});var i=r(81342),n=r(41044),o=r(32420),s=r(59797),a=r(71356),c=r(19596),u=r(61536),l=r(948),h=r(61719),f=r(52061),d=r(29296),p=r(36121),v=r(42266),_=r(92991),m=r(58257),w=r(29107),T=r(33610),g=r(26041),y=r(93191),O=r(51135);class x extends w.A{constructor(e,t){super(e,t,new m.J(y.I,(()=>r.e(67160).then(r.bind(r,67160)))),M)}_getPipelineState(e,t){const{oitPass:r,output:i,hasOccludees:o,cullFace:s}=e,a=r===T.M.NONE;return(0,O.sm)({blending:(0,n.c1)(i)?a?O.Zo:(0,u.j7)(r):null,culling:(0,O.zp)(s),depthTest:{func:(0,u.Bh)(r)},depthWrite:(0,u.W$)(e),drawBuffers:(0,u.u_)(r,i),colorWrite:O.gf,stencilWrite:o?g.s3:null,stencilTest:o?t?g.eD:g.RY:null,polygonOffset:(0,u.eZ)(e)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}}const M=new Map([[f.T.POSITION,0],[f.T.UV0,2],[f.T.PERSPECTIVEDIVIDE,3]]);var R=r(73440),P=r(31839),b=r(34479),F=r(83046),A=r(91041);class C extends A.W{constructor(e){super(),this.draped=e,this.cullFace=o.Vr.None,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=P.I.None,this.emissionSource=b.jo.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1,this.snowCover=!1}}(0,R._)([(0,F.o)({count:o.Vr.COUNT})],C.prototype,"cullFace",void 0),(0,R._)([(0,F.o)()],C.prototype,"enableOffset",void 0),(0,R._)([(0,F.o)()],C.prototype,"writeDepth",void 0),(0,R._)([(0,F.o)()],C.prototype,"hasOccludees",void 0),(0,R._)([(0,F.o)()],C.prototype,"terrainDepthTest",void 0),(0,R._)([(0,F.o)()],C.prototype,"cullAboveTerrain",void 0),(0,R._)([(0,F.o)()],C.prototype,"perspectiveInterpolation",void 0);class S extends v.c{constructor(e){super(e,I),this.vertexAttributeLocations=M,this.supportsEdges=!0,this.produces=new Map([[l.r.OPAQUE_MATERIAL,e=>(0,n.Gy)(e)],[l.r.TRANSPARENT_MATERIAL,e=>(0,n.D5)(e)&&this.parameters.writeDepth],[l.r.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,n.D5)(e)&&!this.parameters.writeDepth],[l.r.DRAPED_MATERIAL,e=>(0,n.D5)(e)||(0,n.Gy)(e)]]),this._configuration=new C(e.draped)}dispose(){this.setParameters({texture:void 0})}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<u.ve,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new D(e)}createBufferWriter(){let e=p.qj;return this.parameters.perspectiveInterpolation&&(e=e.clone().f32(f.T.PERSPECTIVEDIVIDE)),new E(e)}}class D extends s.Z{constructor(e){super({...e,...e.material.parameters}),this.parameters=e;const t=this._material.parameters.texture;(0,a.f)(t)&&e.textures.updater.add(t)}dispose(){this.parameters.textures.updater.remove(this._material.parameters.texture)}beginSlot(e){return this.getTechnique(x,e)}}class E extends d.G{write(e,t,r,n,o,s){for(const n of this.vertexBufferLayout.fields.keys()){const a=r.get(n);if(a)if(n===f.T.PERSPECTIVEDIVIDE){(0,h.hu)(1===a.size);const e=o.getField(n,i.ly);e&&(0,_.XW)(a,e,s)}else(0,_.i9)(n,a,e,t,o,s)}return null}}class I extends c.Mt{constructor(e,t){super(),this.texture=e,this.draped=t,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=o.Vr.None,this.opacity=1,this.perspectiveInterpolation=!1}get glTexture(){return this.texture.glTexture}}},42266:function(e,t,r){r.d(t,{c:function(){return s}});var i=r(82846),n=r(19596),o=r(87807);class s extends n.F5{constructor(){super(...arguments),this._pp0=(0,i.al)(0,0,1),this._pp1=(0,i.al)(0,0,0)}intersect(e,t,r,i,n,s){return(0,o.Bw)(e,r,i,n,void 0,s)}intersectDraped(e,t,r,i){return this._pp0[0]=this._pp1[0]=r[0],this._pp0[1]=this._pp1[1]=r[1],(0,o.Bw)(e,t,this._pp0,this._pp1,void 0,i)}}},48636:function(e,t,r){r.d(t,{Z:function(){return R}});var i=r(73440),n=r(70880),o=r(96711),s=r(99574),a=r(96094),c=r(17155),u=(r(61432),r(83850),r(48023)),l=r(31865),h=r(10934),f=r(26821),d=r(41788),p=r(24910),v=r(82846),_=r(73749),m=r(27583),w=r(33869),T=r(12659),g=r(63271),y=r(56172);var O,x=r(10517);let M=O=class extends n.Z{constructor(e){super(e),this._ray=(0,T.Ue)(),this._viewport=(0,m.al)(0,0,1,1),this._padding=(0,m.al)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,d.al)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,h.Ue)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,h.Ue)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,h.Ue)(),this._frustumDirty=!0,this._frustum=(0,w.Ue)(),this._fullViewport=(0,m.Ue)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,v.Ue)(),this._up=(0,v.Ue)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,p.d)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,l.JG)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,p.i)((0,v.Ue)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,p.i)((0,v.Ue)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,p.i)((0,v.Ue)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,_.d)((0,m.Ue)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,_.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,_.d)((0,m.Ue)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,_.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[x.Np.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[x.Np.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[x.Np.RIGHT]+this._padding[x.Np.LEFT]}set fullWidth(e){this.width=e-(this._padding[x.Np.RIGHT]+this._padding[x.Np.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[x.Np.TOP]+this._padding[x.Np.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[x.Np.TOP]+this._padding[x.Np.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[x.Np.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[x.Np.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,_.a)(this._padding,e)||(this._viewport[0]+=e[x.Np.LEFT]-this._padding[x.Np.LEFT],this._viewport[1]+=e[x.Np.BOTTOM]-this._padding[x.Np.BOTTOM],this._viewport[2]-=e[x.Np.RIGHT]+e[x.Np.LEFT]-(this._padding[x.Np.RIGHT]+this._padding[x.Np.LEFT]),this._viewport[3]-=e[x.Np.TOP]+e[x.Np.BOTTOM]-(this._padding[x.Np.TOP]+this._padding[x.Np.BOTTOM]),(0,_.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,l.Jp)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,l.U_)((0,h.Ue)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,h.Ue)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovX(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovY(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,p.j)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,l.U_)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,l.p4)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const{near:t,far:r}=this;return 2*t*r/(r+t-e*(r-t))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2)*2,i=r*this._aspect,n=r/this.rows,o=i/this.columns,s=-i/2+this.column*o,a=s+o,c=-r/2+this.row*n,u=c+n,f=(0,l.oy)((0,h.Ue)(),s*(1+2*this._padding[x.Np.LEFT]/e),a*(1+2*this._padding[x.Np.RIGHT]/e),c*(1+2*this._padding[x.Np.BOTTOM]/t),u*(1+2*this._padding[x.Np.TOP]/t),this.near,this.far),d=this._get("projectionMatrix");return d&&(0,l.fS)(d,f)?d:f}copyFrom(e){(0,p.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,_.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,_.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,f.JG)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,l.JG)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,w.JG)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,l.JG)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,_.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up,this.fov=e.fov}clone(){return(new O).copyFrom(this)}equals(e){return(0,p.q)(this.eye,e.eye)&&(0,p.q)(this.center,e.center)&&(0,p.q)(this.up,e.up)&&(0,_.a)(this._viewport,e.viewport)&&(0,_.a)(this._padding,e.padding)&&(0,f.I6)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,_.f)(e.screenPadding,this.screenPadding)>=t||(0,_.f)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,p.a)(F,e.eye,e.center),(0,p.a)(A,this.eye,this.center);const r=(0,p.e)(F,A),i=(0,p.y)(F),n=(0,p.y)(A),o=5e-4;return r*r>=(1-1e-10)*i*n&&(0,p.x)(e.eye,this.eye)<Math.max(i,n)*o*o}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,g.SR)(this.viewForward,(0,p.d)(F,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=(0,a.s1)()){return e[0]=(this.padding[x.Np.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[x.Np.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,r=.5){return e[0]=this.padding[x.Np.LEFT]+this.width*t,e[1]=this.padding[x.Np.BOTTOM]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==P&&(0,p.c)(P,e),P[3]=1,(0,_.t)(P,P,this.projectionMatrix);const r=Math.abs(P[3]);(0,p.g)(P,P,1/r);const i=this.fullViewport;t[0]=(0,s.t7)(0,i[0]+i[2],.5+.5*P[0]),t[1]=(0,s.t7)(0,i[1]+i[3],.5+.5*P[1]),t[2]=.5*(P[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;P[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],P[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],P[2]=(2*e[2]-1)*e[3],P[3]=e[3],null!=this.inverseProjectionMatrix&&((0,_.t)(P,P,this.inverseProjectionMatrix),t[0]=P[0],t[1]=P[1],t[2]=P[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,C),this.renderToScreen(C,t),t}projectToRenderScreen(e,t){if(P[0]=e[0],P[1]=e[1],P[2]=e[2],P[3]=1,(0,_.t)(P,P,this.viewProjectionMatrix),0===P[3])return null;const r=P;(0,p.g)(r,r,1/Math.abs(P[3]));const i=this.fullViewport,n=(0,s.t7)(0,i[0]+i[2],.5+.5*r[0]),o=(0,s.t7)(0,i[1]+i[3],.5+.5*r[1]);return"x"in t?(t.x=n,t.y=o):(t[0]=n,t[1]=o,t.length>2&&(t[2]=.5*(r[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,C),t)}unprojectFromRenderScreen(e,t){if((0,l.Jp)(b,this.projectionMatrix,this.viewMatrix),!(0,l.U_)(b,b))return null;const r=this.fullViewport;return P[0]=2*(e[0]-r[0])/r[2]-1,P[1]=2*(e[1]-r[1])/r[3]-1,P[2]=2*e[2]-1,P[3]=1,(0,_.t)(P,P,b),0===P[3]?null:(t[0]=P[0]/P[3],t[1]=P[1]/P[3],t[2]=P[2]/P[3],t)}constrainWindowSize(e,t,r,i){const n=e*this.pixelRatio,o=t*this.pixelRatio,s=Math.max(n-r/2,0),a=Math.max(this.fullHeight-o-i/2,0),c=-Math.min(n-r/2,0),u=-Math.min(this.fullHeight-o-i/2,0),l=r-c- -Math.min(this.fullWidth-n-r/2,0),h=i-u- -Math.min(o-i/2,0);return[Math.round(s),Math.round(a),Math.round(l),Math.round(h)]}computeUp(e){e===y.JY.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}_computeUpGlobal(){(0,p.d)(F,this.center,this.eye);const e=(0,p.l)(this.center);e<1?((0,p.i)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,p.e)(F,this.center))>.9999*(0,p.l)(F)*e||((0,p.h)(this._up,F,this.center),(0,p.h)(this._up,this._up,F),(0,p.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,p.E)(F,this.eye,this.center),Math.abs(F[2])<=.9999&&((0,p.g)(F,F,F[2]),(0,p.i)(this._up,-F[0],-F[1],1-F[2]),(0,p.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,r=""){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,p.q)(e,t)||((0,p.c)(t,e),this._markViewDirty(),r.length&&this.notifyChange(r)):o.Z.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,w.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,l.zB)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,i._)([(0,c.Cb)()],M.prototype,"_viewport",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"_padding",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"_fov",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"_nearFar",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"_viewDirty",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"_viewMatrix",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"_pixelRatio",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"pixelRatio",null),(0,i._)([(0,c.Cb)()],M.prototype,"row",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"column",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"_rows",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"rows",null),(0,i._)([(0,c.Cb)()],M.prototype,"_columns",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"columns",null),(0,i._)([(0,c.Cb)()],M.prototype,"eye",null),(0,i._)([(0,c.Cb)()],M.prototype,"center",null),(0,i._)([(0,c.Cb)()],M.prototype,"_center",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"up",null),(0,i._)([(0,c.Cb)()],M.prototype,"_up",void 0),(0,i._)([(0,c.Cb)()],M.prototype,"viewMatrix",null),(0,i._)([(0,c.Cb)({readOnly:!0})],M.prototype,"viewForward",null),(0,i._)([(0,c.Cb)({readOnly:!0})],M.prototype,"viewUp",null),(0,i._)([(0,c.Cb)({readOnly:!0})],M.prototype,"viewRight",null),(0,i._)([(0,c.Cb)({readOnly:!0})],M.prototype,"nearFar",null),(0,i._)([(0,c.Cb)()],M.prototype,"near",null),(0,i._)([(0,c.Cb)()],M.prototype,"far",null),(0,i._)([(0,c.Cb)()],M.prototype,"viewport",null),(0,i._)([(0,c.Cb)({readOnly:!0})],M.prototype,"screenViewport",null),(0,i._)([(0,c.Cb)({readOnly:!0})],M.prototype,"screenPadding",null),(0,i._)([(0,c.Cb)()],M.prototype,"x",null),(0,i._)([(0,c.Cb)()],M.prototype,"y",null),(0,i._)([(0,c.Cb)()],M.prototype,"width",null),(0,i._)([(0,c.Cb)()],M.prototype,"height",null),(0,i._)([(0,c.Cb)()],M.prototype,"fullWidth",null),(0,i._)([(0,c.Cb)()],M.prototype,"fullHeight",null),(0,i._)([(0,c.Cb)({readOnly:!0})],M.prototype,"_aspect",null),(0,i._)([(0,c.Cb)()],M.prototype,"padding",null),(0,i._)([(0,c.Cb)({readOnly:!0})],M.prototype,"projectionMatrix",null),(0,i._)([(0,c.Cb)({readOnly:!0})],M.prototype,"inverseProjectionMatrix",null),(0,i._)([(0,c.Cb)()],M.prototype,"fov",null),(0,i._)([(0,c.Cb)()],M.prototype,"fovX",null),(0,i._)([(0,c.Cb)()],M.prototype,"fovY",null),(0,i._)([(0,c.Cb)()],M.prototype,"viewInverseTransposeMatrix",null),(0,i._)([(0,c.Cb)({readOnly:!0})],M.prototype,"_projectionMatrixInternal",null),(0,i._)([(0,c.Cb)()],M.prototype,"relativeElevation",void 0),M=O=(0,i._)([(0,u.j)("esri.views.3d.webgl.RenderCamera")],M);const R=M,P=(0,m.Ue)(),b=(0,h.Ue)(),F=(0,v.Ue)(),A=(0,v.Ue)(),C=(0,a.J$)()}}]);