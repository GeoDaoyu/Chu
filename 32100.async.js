"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[32100],{89420:function(t,e,n){n.d(e,{B:function(){return v},a:function(){return b},b:function(){return Q},c:function(){return x},d:function(){return y},e:function(){return O},f:function(){return M},g:function(){return L},h:function(){return w},i:function(){return T},j:function(){return A},n:function(){return I},r:function(){return Z},t:function(){return H},u:function(){return S}});n(61432);var i=n(96711),a=n(99574),o=n(38949),r=n(31865),s=n(10934),l=n(24910),c=n(82846),h=n(47566),u=n(93070),p=n(88970),d=n(77773),_=n(12659),f=n(63271),g=n(69811);const m=()=>i.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");const v=class{constructor(){this.plane=(0,d.Ue)(),this.origin=(0,c.Ue)(),this.basis1=(0,c.Ue)(),this.basis2=(0,c.Ue)()}};function y(t=j){return{plane:(0,d.Ue)(t.plane),origin:(0,c.d9)(t.origin),basis1:(0,c.d9)(t.basis1),basis2:(0,c.d9)(t.basis2)}}function b(t,e=y()){return M(t.origin,t.basis1,t.basis2,e)}function M(t,e,n,i=y()){return(0,l.c)(i.origin,t),(0,l.c)(i.basis1,e),(0,l.c)(i.basis2,n),S(i),function(t,e){Math.abs((0,l.e)(t.basis1,t.basis2)/((0,l.l)(t.basis1)*(0,l.l)(t.basis2)))>1e-6&&m().warn(e,"Provided basis vectors are not perpendicular"),Math.abs((0,l.e)(t.basis1,I(t)))>1e-6&&m().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.e)(I(t),t.origin)-t.plane[3])>1e-6&&m().warn(e,"Plane offset is not consistent with plane origin")}(i,"fromValues()"),i}function S(t){(0,d.my)(t.basis2,t.basis1,t.origin,t.plane)}function E(t,e,n){t!==n&&b(t,n);const i=(0,l.g)(g.WM.get(),I(t),e);return(0,l.f)(n.origin,n.origin,i),n.plane[3]-=e,n}function w(t,e=y()){const n=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return(0,l.i)(e.origin,t[0]+n,t[1]+i,0),(0,l.i)(e.basis1,n,0,0),(0,l.i)(e.basis2,0,i,0),(0,d.al)(0,0,1,0,e.plane),e}function T(t,e,n){return!!(0,d.BR)(t.plane,e,n)&&D(t,n)}function P(t,e,n){const i=N.get();W(t,e,i,N.get());let o=Number.POSITIVE_INFINITY;for(const r of q){const s=z(t,r,F.get()),c=g.WM.get();if((0,d.rx)(i,s,c)){const t=(0,l.E)(g.WM.get(),e.origin,c),i=Math.abs((0,a.ZF)((0,l.e)(e.direction,t)));i<o&&(o=i,(0,l.c)(n,c))}}return o===Number.POSITIVE_INFINITY?C(t,e,n):n}function x(t,e){return(e-t)/e}function C(t,e,n){if(T(t,e,n))return n;const i=N.get(),a=N.get();W(t,e,i,a);let o=Number.POSITIVE_INFINITY;for(const r of q){const s=z(t,r,F.get()),c=g.WM.get();if((0,d.dZ)(i,s,c)){const t=(0,_.Jk)(e,c);if(!(0,d.Ac)(a,c))continue;t<o&&(o=t,(0,l.c)(n,c))}}return k(t,e.origin)<o&&G(t,e.origin,n),n}function G(t,e,n){const i=(0,d.nF)(t.plane,e,g.WM.get()),a=(0,p.ct)(V(t,t.basis1),i,-1,1,g.WM.get()),o=(0,p.ct)(V(t,t.basis2),i,-1,1,g.WM.get());return(0,l.d)(n,(0,l.f)(g.WM.get(),a,o),t.origin),n}function R(t,e,n){const{origin:i,basis1:a,basis2:o}=t,r=(0,l.d)(g.WM.get(),e,i),s=(0,f.SR)(a,r),c=(0,f.SR)(o,r),h=(0,f.SR)(I(t),r);return(0,l.i)(n,s,c,h)}function k(t,e){const n=R(t,e,g.WM.get()),{basis1:i,basis2:a}=t,o=(0,l.l)(i),r=(0,l.l)(a),s=Math.max(Math.abs(n[0])-o,0),c=Math.max(Math.abs(n[1])-r,0),h=n[2];return s*s+c*c+h*h}function A(t,e){return Math.sqrt(k(t,e))}function O(t,e){return(0,d.Ac)(t.plane,e)&&D(t,e)}function U(t,e){const n=-t.plane[3];return(0,f.SR)(I(t),e)-n}function L(t,e){return(0,l.q)(t.basis1,e.basis1)&&(0,l.q)(t.basis2,e.basis2)&&(0,l.q)(t.origin,e.origin)}function H(t,e,n){return t!==n&&b(t,n),(0,r.U_)(X,e),(0,r.p4)(X,X),(0,l.t)(n.basis1,t.basis1,X),(0,l.t)(n.basis2,t.basis2,X),(0,l.t)((0,d.st)(n.plane),(0,d.st)(t.plane),X),(0,l.t)(n.origin,t.origin,e),(0,d.T5)(n.plane,n.plane,n.origin),n}function Z(t,e,n,i){return t!==i&&b(t,i),(0,r.Us)(J,e,n),(0,l.t)(i.basis1,t.basis1,J),(0,l.t)(i.basis2,t.basis2,J),S(i),i}function I(t){return(0,d.st)(t.plane)}function D(t,e){const n=(0,l.d)(g.WM.get(),e,t.origin),i=(0,l.k)(t.basis1),a=(0,l.k)(t.basis2),o=(0,l.e)(t.basis1,n),r=(0,l.e)(t.basis2,n);return-o-i<0&&o-i<0&&-r-a<0&&r-a<0}function V(t,e){const n=F.get();return(0,l.c)(n.origin,t.origin),(0,l.c)(n.vector,e),n}function z(t,e,n){const{basis1:i,basis2:a,origin:o}=t,r=(0,l.g)(g.WM.get(),i,e.origin[0]),s=(0,l.g)(g.WM.get(),a,e.origin[1]);(0,l.f)(n.origin,r,s),(0,l.f)(n.origin,n.origin,o);const c=(0,l.g)(g.WM.get(),i,e.direction[0]),h=(0,l.g)(g.WM.get(),a,e.direction[1]);return(0,l.g)(n.vector,(0,l.f)(c,c,h),2),n}function W(t,e,n,i){const a=I(t);(0,d.my)(a,e.direction,e.origin,n),(0,d.my)((0,d.st)(n),a,e.origin,i)}const j={plane:(0,d.Ue)(),origin:(0,c.al)(0,0,0),basis1:(0,c.al)(1,0,0),basis2:(0,c.al)(0,1,0)},N=new o.x(d.Ue),F=new o.x(p.Ue),B=(0,c.Ue)(),Y=new o.x((()=>y())),q=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],X=(0,s.Ue)(),J=(0,s.Ue)(),Q=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:v,altitudeAt:U,axisAt:function(t,e,n,i){return function(t,e,n){switch(e){case u.R.X:(0,l.c)(n,t.basis1),(0,l.n)(n,n);break;case u.R.Y:(0,l.c)(n,t.basis2),(0,l.n)(n,n);break;case u.R.Z:(0,l.c)(n,I(t))}return n}(t,n,i)},cameraFrustumCoverage:x,closestPoint:C,closestPointOnSilhouette:P,copy:b,copyWithoutVerify:function(t,e){(0,l.c)(e.origin,t.origin),(0,l.c)(e.basis1,t.basis1),(0,l.c)(e.basis2,t.basis2),(0,d.JG)(e.plane,t.plane)},create:y,distance:A,distance2:k,distanceToSilhouette:function(t,e){let n=Number.NEGATIVE_INFINITY;for(const i of q){const a=z(t,i,F.get()),o=(0,p.Jk)(a,e);o>n&&(n=o)}return Math.sqrt(n)},elevate:E,equals:L,extrusionContainsPoint:O,fromAABoundingRect:w,fromValues:M,getExtent:function(t,e){const n=t.basis1[0],i=t.basis2[1],[a,o]=t.origin;return(0,h.al)(a-n,o-i,a+n,o+i,e)},intersectRay:T,intersectRayClosestSilhouette:function(t,e,n){if(T(t,e,n))return n;const i=P(t,e,g.WM.get());return(0,l.f)(n,e.origin,(0,l.g)(g.WM.get(),e.direction,(0,l.j)(e.origin,i)/(0,l.l)(e.direction))),n},normal:I,projectPoint:G,projectPointLocal:R,rotate:Z,setAltitudeAt:function(t,e,n,i){const a=U(t,e),o=(0,l.g)(B,I(t),n-a);return(0,l.f)(i,e,o),i},setExtent:function(t,e,n){return w(e,n),E(n,U(t,t.origin),n),n},transform:H,up:j,updateUnboundedPlane:S,wrap:function(t,e,n){const i=Y.get();return i.origin=t,i.basis1=e,i.basis2=n,i.plane=(0,d.re)(0,0,0,0),S(i),i}},Symbol.toStringTag,{value:"Module"}))},92643:function(t,e,n){n.d(e,{Ch:function(){return V},EX:function(){return x},G:function(){return A},H0:function(){return z},Ht:function(){return H},K6:function(){return C},O:function(){return U},WC:function(){return L},Y3:function(){return w},_Y:function(){return E},_j:function(){return k},c9:function(){return I},gp:function(){return Z},jQ:function(){return c},mj:function(){return R},nR:function(){return D},sJ:function(){return T},vG:function(){return O},xr:function(){return S}});var i=n(53147),a=n(3480),o=n(28947),r=n(99574),s=n(73749),l=n(27583);function c(t){return"r"in t&&"g"in t&&"b"in t}function h(t){return"h"in t&&"s"in t&&"v"in t}function u(t){return"l"in t&&"a"in t&&"b"in t}function p(t){return"l"in t&&"c"in t&&"h"in t}const d=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],_=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function f(t,e){const n=[];let i,a;if(t[0].length!==e.length)throw new Error("dimensions do not match");const o=t.length,r=t[0].length;let s=0;for(i=0;i<o;i++){for(s=0,a=0;a<r;a++)s+=t[i][a]*e[a];n.push(s)}return n}function g(t){const e=[t.r/255,t.g/255,t.b/255].map((t=>t<=.04045?t/12.92:((t+.055)/1.055)**2.4)),n=f(d,e);return{x:100*n[0],y:100*n[1],z:100*n[2]}}function m(t){const e=f(_,[t.x/100,t.y/100,t.z/100]).map((t=>{const e=t<=.0031308?12.92*t:1.055*t**(1/2.4)-.055;return Math.min(1,Math.max(e,0))}));return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function v(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map((t=>t>(6/29)**3?t**(1/3):1/3*(29/6)**2*t+4/29));return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function y(t){const e=t.l,n=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map((t=>t>6/29?t**3:3*(6/29)**2*(t-4/29)));return{x:95.047*n[0],y:100*n[1],z:108.883*n[2]}}function b(t){return function(t){const e=t.l,n=t.a,i=t.b,a=Math.sqrt(n*n+i*i);let o=Math.atan2(i,n);return o=o>0?o:o+2*Math.PI,{l:e,c:a,h:o}}(v(g(t)))}function M(t){return m(y(function(t){const e=t.l,n=t.c,i=t.h;return{l:e,a:n*Math.cos(i),b:n*Math.sin(i)}}(t)))}function S(t){return c(t)?t:p(t)?M(t):u(t)?function(t){return m(y(t))}(t):function(t){return"x"in t&&"y"in t&&"z"in t}(t)?m(t):h(t)?function(t){const e=(t.h+360)%360/60,n=t.s/100,i=t.v/100*255,a=i*n,o=a*(1-Math.abs(e%2-1));let r;switch(Math.floor(e)){case 0:r={r:a,g:o,b:0};break;case 1:r={r:o,g:a,b:0};break;case 2:r={r:0,g:a,b:o};break;case 3:r={r:0,g:o,b:a};break;case 4:r={r:o,g:0,b:a};break;case 5:case 6:r={r:a,g:0,b:o};break;default:r={r:0,g:0,b:0}}return r.r=Math.round(r.r+i-a),r.g=Math.round(r.g+i-a),r.b=Math.round(r.b+i-a),r}(t):t}function E(t){return h(t)?t:function(t){const e=t.r,n=t.g,i=t.b,a=Math.max(e,n,i),o=a-Math.min(e,n,i);let r=a,s=0===o?0:a===e?(n-i)/o%6:a===n?(i-e)/o+2:(e-n)/o+4,l=0===o?0:o/r;return s<0&&(s+=6),s*=60,l*=100,r*=100/255,{h:s,s:l,v:r}}(S(t))}function w(t){return u(t)?t:function(t){return v(g(t))}(S(t))}function T(t){return p(t)?t:b(S(t))}function P(t){let{r:e,g:n,b:a,a:o}=t;return o<1&&(e=Math.round(o*e+255*(1-o)),n=Math.round(o*n+255*(1-o)),a=Math.round(o*a+255*(1-o))),new i.Z({r:e,g:n,b:a})}function x(t,e){const{r:n,g:i,b:a}=e?.ignoreAlpha?t:P(t);return.2126*n+.7152*i+.0722*a}var C,G;function R(t,e=C.High){return x(t,{ignoreAlpha:!0})>e?new i.Z([0,0,0,t.a]):new i.Z([255,255,255,t.a])}function k(t,e){const n=w(t);n.l*=1-e;const i=S(n),a=t.clone();return a.setColor(i),a.a=t.a,a}function A(t,e){const n=t.clone();return n.a*=e,n}function O(t,e){const n=E(t);n.s*=e;const i=S(n),a=t.clone();return a.setColor(i),a.a=t.a,a}function U(t){return i.Z.toUnitRGBA(t)}function L(t,e){return t===e||null!=t&&t.equals(e)}function H(t,e){return t===e||null!=t&&null!=e&&(0,s.e)(t,e)}function Z(t){return(0,l.al)(t[0],t[1],t[2],t.length>3?t[3]:1)}function I(t){return t[0]??=0,t[1]??=0,t[2]??=0,t}function D(t){return t.length=4,I(t),t[3]??=1,(0,r.uZ)(t[3],0,1),t}function V(t,e){const n=i.Z.toUnitRGBA(t);return n[3]*=e,n}function z(t,e,n={}){if(0===t.length||e<=0)return[];if(1===(t=t.map((t=>"string"==typeof t?new i.Z(t):t))).length||1===e){const n=[],i=t[0];for(let t=0;t<e;t++)n.push(i.clone());return n}if(n.shuffle&&(t=(0,a.TV)((0,o.d9)(t),n.seed)),t.length>=e){const n=[],i=(t.length-1)/(e-1);for(let a=0;a<e;a++){const e=Math.round(a*i);n.push(t[e].clone())}return n}return function(t,e,n={}){const i=[],o=t.length-1,r=Math.ceil((e-t.length)/o);t:for(let a=0;a<o;a++){const o=t[a],s=t[a+1];for(let a=1;a<=r;a++){const l=a/(r+1);if(i.push(j(o,s,l,n)),i.length+t.length===e)break t}}return[...t.map((t=>t.clone())),...(0,a.TV)(i,n.seed??1)]}(t,e,n)}(G=C||(C={}))[G.Low=160]="Low",G[G.High=225]="High";const W=(t,e)=>{const n=Math.floor(10*e())-5;return Math.min(255,Math.max(0,t+n))};function j(t,e,n,o={}){const r=t.r,s=t.g,l=t.b,c=e.r,h=e.g,u=e.b,p=Math.round(r+(c-r)*n),d=Math.round(s+(h-s)*n),_=Math.round(l+(u-l)*n);if(!o.offset)return new i.Z([p,d,_]);const f=(0,a.FS)(o.seed);return new i.Z([W(p,f),W(d,f),W(_,f)])}},83695:function(t,e,n){function i(){return[1,0,0,1,0,0]}function a(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}n.d(e,{Ue:function(){return i},Wd:function(){return o},d9:function(){return a}});const o=[1,0,0,1,0,0];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:a,create:i,fromValues:function(t,e,n,i,a,o){return[t,e,n,i,a,o]}},Symbol.toStringTag,{value:"Module"}))},50639:function(t,e,n){n.d(e,{Iu:function(){return c},Jp:function(){return r},U1:function(){return s},U_:function(){return o},Us:function(){return h},bA:function(){return l},vc:function(){return p},xJ:function(){return u},yR:function(){return a}});var i=n(66130);function a(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function o(t,e){const n=e[0],i=e[1],a=e[2],o=e[3],r=e[4],s=e[5];let l=n*o-i*a;return l?(l=1/l,t[0]=o*l,t[1]=-i*l,t[2]=-a*l,t[3]=n*l,t[4]=(a*s-o*r)*l,t[5]=(i*r-n*s)*l,t):null}function r(t,e,n){const i=e[0],a=e[1],o=e[2],r=e[3],s=e[4],l=e[5],c=n[0],h=n[1],u=n[2],p=n[3],d=n[4],_=n[5];return t[0]=i*c+o*h,t[1]=a*c+r*h,t[2]=i*u+o*p,t[3]=a*u+r*p,t[4]=i*d+o*_+s,t[5]=a*d+r*_+l,t}function s(t,e,n){const i=e[0],a=e[1],o=e[2],r=e[3],s=e[4],l=e[5],c=Math.sin(n),h=Math.cos(n);return t[0]=i*h+o*c,t[1]=a*h+r*c,t[2]=i*-c+o*h,t[3]=a*-c+r*h,t[4]=s,t[5]=l,t}function l(t,e,n){const i=e[0],a=e[1],o=e[2],r=e[3],s=e[4],l=e[5],c=n[0],h=n[1];return t[0]=i*c,t[1]=a*c,t[2]=o*h,t[3]=r*h,t[4]=s,t[5]=l,t}function c(t,e,n){const i=e[0],a=e[1],o=e[2],r=e[3],s=e[4],l=e[5],c=n[0],h=n[1];return t[0]=i,t[1]=a,t[2]=o,t[3]=r,t[4]=i*c+o*h+s,t[5]=a*c+r*h+l,t}function h(t,e){const n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t[4]=0,t[5]=0,t}function u(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function p(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function d(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}const _=r,f=d;Object.freeze(Object.defineProperty({__proto__:null,add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},equals:function(t,e){const n=t[0],a=t[1],o=t[2],r=t[3],s=t[4],l=t[5],c=e[0],h=e[1],u=e[2],p=e[3],d=e[4],_=e[5],f=(0,i.bn)();return Math.abs(n-c)<=f*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-h)<=f*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-u)<=f*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(r-p)<=f*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(s-d)<=f*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(l-_)<=f*Math.max(1,Math.abs(l),Math.abs(_))},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},frob:function(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)},fromRotation:h,fromScaling:u,fromTranslation:p,identity:a,invert:o,mul:_,multiply:r,multiplyScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},multiplyScalarAndAdd:function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t},rotate:s,scale:l,set:function(t,e,n,i,a,o,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t[4]=o,t[5]=r,t},str:function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},sub:f,subtract:d,translate:c},Symbol.toStringTag,{value:"Module"}))},34605:function(t,e,n){n.d(e,{W:function(){return G}});var i=n(73440),a=n(53147),o=n(46451),r=n(61100),s=n(90403),l=n(17155),c=(n(61432),n(96711),n(83850),n(48023)),h=n(13132),u=n(8554),p=n(53447),d=n(44783),_=n(27737),f=n(56172),g=n(50031),m=n(42458),v=n(56128),y=n(18208),b=n(90017);const M="ArrowUp",S="ArrowDown",E="ArrowLeft",w="ArrowRight",T="t",P="Shift",x=m.C,C=new a.Z("#009af2");let G=class extends v.m{constructor(t){super(t),this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this._initialControlPoints=null,this._graphicsLayer=new p.Z({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),this._undoStack=[],this._redoStack=[],this._sharedUndoStack=[],this._sharedRedoStack=[],this._highlightHandle=null,this.activeHandle=0,this.type="reshape"}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._controlPointManipulations.forEach((t=>t.destroy())),this._controlPointEditGeometryOperations.forEach((t=>t.destroy())),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,r.SC)(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _hasValidSpatialReference(){return(0,u.JY)(this.view.spatialReference)}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){const t=this._undoStack[this._undoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canUndo}canRedo(){const t=this._redoStack[this._redoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canRedo}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();this._controlPointEditGeometryOperations[t].undo(),this.updateGraphics(),this._redoStack.push(t)}}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();this._controlPointEditGeometryOperations[t].redo(),this.updateGraphics(),this._undoStack.push(t)}}refresh(){const{mediaElement:t}=this;if(null==t.georeference)return;const e=t.georeference;"control-points"===e.type&&null!=e.coords&&(this._georeference=e,this._georeference.controlPoints.forEach((({mapPoint:t},e)=>{const n=this._controlPointEditGeometryOperations[e],i=n.data.components[0].vertices[0];n.setVertexPosition(i,n.data.coordinateHelper.pointToVector(t))})),this.updateGraphics())}reset(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._georeference,e=t.controlPoints,n=e[0].mapPoint.spatialReference,i=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map(((a,o)=>{const r=a.data.geometry;return this._controlPointGraphics[o].geometry=r,{mapPoint:(0,h.project)(r,n),sourcePoint:i?e[o].sourcePoint:t.toSource(r)}}))}updateActiveHandle(t){if(this.activeHandle===t)return;const e=this._controlPointGraphics[this.activeHandle].symbol.clone();(0,_.ZB)(e,this.view.effectiveTheme.accentColor),this._controlPointGraphics[this.activeHandle].symbol=e;const n=this._controlPointGraphics[t].symbol.clone();(0,_.ZB)(n,C),this._controlPointGraphics[t].symbol=n,this.activeHandle=t,this.view.surface===document.activeElement&&this.highlightActiveHandle()}async highlightActiveHandle(){this.removeHighlightActiveHandle();const t=await this.view.whenLayerView(this._graphicsLayer);this._highlightHandle=t.highlight(this._controlPointGraphics[this.activeHandle])}removeHighlightActiveHandle(){this._highlightHandle&&this._highlightHandle.remove()}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}async _initialize(){const{view:t,mediaElement:e}=this;if(null==e.georeference)return;const n=e.georeference;"control-points"===n.type&&null!=n.coords&&(this._georeference=n,this._initialControlPoints=this._georeference.controlPoints,t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._controlPointEditGeometryOperations=this._georeference.controlPoints.map((({mapPoint:e})=>y.c.fromGeometry((0,h.project)(e,t.spatialReference),f.JY.Local))),this._controlPointGraphics=this._controlPointEditGeometryOperations.map(((t,e)=>new o.Z({symbol:new d.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:e===this.activeHandle?C.toArray():this.view.effectiveTheme.accentColor.toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:t.data.geometry}))),this._graphicsLayer.graphics.addMany([...this._controlPointGraphics]),this._controlPointManipulations=this._controlPointGraphics.map((e=>new g.d({tool:this,view:t,graphic:e}))),this.addHandles([...this._controlPointManipulations.map(((t,e)=>t.createDragPipeline(this._getInfo.bind(this,e),((t,n)=>{"start"===t.action&&(this._undoStack.push(e),this._redoStack=[],this._sharedUndoStack.push({tool:this,operation:n}),this._sharedRedoStack.length=0),this.updateGraphics()})))),(0,s.YP)((()=>this.view.scale),(()=>this.active?this.updateGraphics():null))]),this._controlPointManipulations.forEach(((t,e)=>{t.forEachManipulator((t=>{this.addHandles([t.events.on(["click","grab-changed"],(t=>this.updateActiveHandle(e)))])}))})),this.addHandles([t.on("key-down",(n=>{t.activeTool===this&&(n.key!==P||n.repeat||(this._isModifierActive=!0,n.stopPropagation()),n.key!==T||n.repeat||(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled,n.stopPropagation()),n.key!==x||n.repeat||(this._factor=10,n.stopPropagation()),this._isModifierActive&&(n.key===M&&(this._move(0,this._factor),n.stopPropagation()),n.key===S&&(this._move(0,-this._factor),n.stopPropagation()),n.key===E&&(this._move(-this._factor,0),n.stopPropagation()),n.key===w&&(this._move(this._factor,0),n.stopPropagation())))})),t.on("key-up",(e=>{t.activeTool===this&&(e.key===P&&(this._isModifierActive=!1,e.stopPropagation()),e.key===x&&(this._factor=1,e.stopPropagation()))}))]))}async _loadProjectionEngine(){const t=this._georeference.controlPoints[0].mapPoint;return(0,h.initializeProjection)(t.spatialReference,this.view.spatialReference)}_getInfo(t){return{editGeometryOperations:this._controlPointEditGeometryOperations[t],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}_move(t,e){const n=this._controlPointEditGeometryOperations[this.activeHandle].move(t*this.view.resolution,e*this.view.resolution,0,b.b.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:n}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,i._)([(0,l.Cb)()],G.prototype,"_hasValidSpatialReference",null),(0,i._)([(0,l.Cb)()],G.prototype,"activeHandle",void 0),(0,i._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],G.prototype,"mediaElement",void 0),(0,i._)([(0,l.Cb)({readOnly:!0})],G.prototype,"type",void 0),(0,i._)([(0,l.Cb)({constructOnly:!0})],G.prototype,"view",void 0),G=(0,i._)([(0,c.j)("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],G)},56156:function(t,e,n){n.d(e,{r:function(){return p}});var i=n(73440),a=n(70880),o=n(90403),r=n(17155),s=(n(61432),n(96711),n(83850),n(48023)),l=n(34605),c=n(13154);const h="r",u="z";let p=class extends a.Z{constructor(t){super(t),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=[],this._sharedRedoStack=[],this._originalOpacity=null,this.activeHandle=0}initialize(){const{view:t,mediaElement:e,preserveAspectRatio:n,snapRotation:i,advancedMode:a}=this;this._originalOpacity=e.opacity,this._transformTool=new c.s({target:e,view:t,preserveAspectRatio:n,snapRotation:i}),this._controlPointsTransformTool=new l.W({mediaElement:e,view:t}),this._advancedModeTransformTool=new l.W({mediaElement:a.mediaElement,view:a.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const r=e.georeference,s=a.mediaElement.georeference;a.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in s&&"controlPoints"in r&&this.addHandles([a.view.on("key-down",(t=>{t.key===u&&this.canUndo()&&(this.undo(),t.stopPropagation()),t.key===h&&this.canRedo()&&(this.redo(),t.stopPropagation())})),a.view.on("focus",(async t=>{this._controlPointsTransformTool.removeHighlightActiveHandle(),this._advancedModeTransformTool.highlightActiveHandle()})),(0,o.YP)((()=>s.controlPoints),(t=>{r.controlPoints=t.map((({sourcePoint:t},e)=>({sourcePoint:t,mapPoint:r.controlPoints[e].mapPoint}))),this._activeTool?.refresh()})),(0,o.YP)((()=>this._controlPointsTransformTool.activeHandle),(t=>{this._advancedModeTransformTool.updateActiveHandle(t),this.activeHandle=t})),(0,o.YP)((()=>this._advancedModeTransformTool.activeHandle),(t=>{this._controlPointsTransformTool.updateActiveHandle(t),this.activeHandle=t}))]),this.addHandles([t.on("key-down",(t=>{t.key===u&&this.canUndo()&&(this.undo(),t.stopPropagation()),t.key===h&&this.canRedo()&&(this.redo(),t.stopPropagation())})),t.on("focus",(async t=>{this._advancedModeTransformTool.removeHighlightActiveHandle(),this._controlPointsTransformTool.highlightActiveHandle()}))]),t.tools.addMany([this._transformTool,this._controlPointsTransformTool]),t.activeTool=this._transformTool,this._activeTool=this._transformTool,t.focus()}destroy(){this._transformTool?.destroy(),this._controlPointsTransformTool?.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}canUndo(){return this._sharedUndoStack.length>0}canRedo(){return this._sharedRedoStack.length>0}undo(){if(this._sharedUndoStack.length>0){const{tool:t,operation:e}=this._sharedUndoStack.pop();t!==this._activeTool&&t.refresh(),e.undo(),t.updateGraphics(),this._sharedRedoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}redo(){if(this._sharedRedoStack.length>0){const{tool:t,operation:e}=this._sharedRedoStack.pop();t!==this._activeTool&&t.refresh(),e.apply(),t.updateGraphics(),this._sharedUndoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}async enableAdvancedMode(){this.view.activeTool=this._controlPointsTransformTool,this._activeTool=this._controlPointsTransformTool,this._activeTool.refresh(),await this.advancedMode.view.when(),this.advancedMode.view.activeTool=this._advancedModeTransformTool,this._originalOpacity=this._controlPointsTransformTool.mediaElement.opacity,this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity}disableAdvancedMode(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};(0,i._)([(0,r.Cb)()],p.prototype,"activeHandle",void 0),(0,i._)([(0,r.Cb)({constructOnly:!0})],p.prototype,"advancedMode",void 0),(0,i._)([(0,r.Cb)()],p.prototype,"preserveAspectRatio",void 0),(0,i._)([(0,r.Cb)()],p.prototype,"snapRotation",void 0),(0,i._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],p.prototype,"mediaElement",void 0),(0,i._)([(0,r.Cb)({constructOnly:!0})],p.prototype,"view",void 0),p=(0,i._)([(0,s.j)("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],p)},13154:function(t,e,n){n.d(e,{s:function(){return q}});var i=n(73440),a=n(46451),o=n(92643),r=n(61100),s=n(90403),l=n(26636),c=n(17155),h=(n(61432),n(96711),n(83850),n(48023)),u=n(26821),p=n(41788),d=n(24910),_=n(82846),f=n(60508),g=n(67764),m=n(13132),v=n(89420),y=n(8554),b=n(53447),M=n(89636),S=n(19886),E=n(56172),w=n(50031),T=n(12818),P=n(4875),x=n(99574),C=n(69880);function G(t,e){"start"===t.action?e.cursor="grabbing":e.cursor="grab"}class R{constructor(){this._lastDragEvent=null,this.next=new C.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent){const e={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t)}_adjustScaleFactors(t){const e=0!==t.direction[0]&&0!==t.direction[1]?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e}}class k{constructor(){this._lastDragEvent=null,this.next=new C.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent){const e={...this._lastDragEvent,action:"update"};t&&this._adjustRotateAngle(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustRotateAngle(t),t)}_adjustRotateAngle(t){const e=(0,x.BV)(t.rotateAngle);t.rotateAngle=(0,x.Vl)(5*Math.round(e/5))}}var A=n(89200),O=n(64515),U=n(90017),L=n(33566),H=n(77112);class Z extends P.b{constructor(t){super(),this._handles=new T.Z,this._originCache=(0,_.Ue)(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._snapRotation=t.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(t=>G(t,this._manipulator)))]),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(t){t(this._manipulator,P.d.ROTATE)}createDragPipeline(t,e){let n=null,i=null;return(0,C.Xd)(this._manipulator,((a,o)=>{o.next((e=>{if("start"===e.action){a.cursor="grabbing";const e=t();n=e.plane,i=e.editGeometryOperations}return e})).next((0,C.Cf)(this._view)).next((t=>({...t,rotateAngle:(0,A.cM)(t.mapStart,t.mapEnd,{x:n.origin[0],y:n.origin[1]},!0)}))).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next((t=>{const a=(0,d.c)(this._originCache,n.origin),o="start"===t.action?U.b.NEW_STEP:U.b.ACCUMULATE_STEPS,r=i.rotate(a,t.rotateAngle,o,L.w.REPLACE);return(0,H.nn)(r,n),e(t,r),t})).next((t=>("end"===t.action&&(a.cursor="grab"),t)))}))}_createManipulator(){const t=this._view,e=this._graphic;return new O.L({view:t,graphic:e,selectable:!0,cursor:"grab"})}}const I=1e-6;function D(t){const e=(0,d.l)(t.basis1),n=(0,d.l)(t.basis2);return.3*Math.min(e,n)}class V extends P.b{constructor(t){super(),this._handles=new T.Z,this._planeStart=(0,v.d)(),this._displayPlaneStart=(0,v.d)(),this._originCache=(0,_.Ue)(),this._axisCache=(0,p.Ue)(),this._renderStartCache=(0,_.Ue)(),this._renderEndCache=(0,_.Ue)(),this._resizeOriginCache=(0,_.Ue)(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._direction=t.direction,this._preserveAspectRatio=t.preserveAspectRatio,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(t=>G(t,this._manipulator)))]),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}forEachManipulator(t){t(this._manipulator,P.d.SCALE)}createDragPipeline(t,e){let n=null,i=null,a=null,o=0,r=null,s=null;const l=this._planeStart,c=this._displayPlaneStart,h=this._direction;return(0,C.Xd)(this._manipulator,((p,_)=>{_.next((e=>{if("start"===e.action){p.cursor="grabbing";const e=t();n=e.plane,i=e.displayPlane,a=e.editGeometryOperations,o=10*this._view.resolution,(0,v.a)(n,l),(0,v.a)(i,c);const s=(0,y.C5)(a.data.spatialReference);r=s?s.valid[1]-s.valid[0]-30*this._view.resolution:null}return e})).next((0,C.Cf)(this._view)).next((t=>{const e=(0,d.c)(this._renderStartCache,[t.mapStart.x,t.mapStart.y,0]),n=(0,d.c)(this._renderEndCache,[t.mapEnd.x,t.mapEnd.y,0]),a=(0,d.c)(this._resizeOriginCache,c.origin);(0,d.b)(a,a,c.basis1,-h[0]),(0,d.b)(a,a,c.basis2,-h[1]),(0,d.d)(n,n,a),(0,d.d)(e,e,a);const r=0!==h[0]&&0!==h[1],s=D(c),l=D(i)/s,u=(t,i)=>{if(0===t)return 1;let a=(0,d.l)(i),s=.5*t*(0,d.e)(i,n)/a;const c=s<0?-1:1;r&&(s+=(a-.5*t*(0,d.e)(i,e)/a)*c*l);const h=a<1.5*o?1:I;return a=Math.max(a-o,I),c>0&&(s-=10*this._view.resolution),c*Math.max(c*(s/a),h)},p=u(h[0],c.basis1),_=u(h[1],c.basis2);return{...t,direction:h,factor1:p,factor2:_}})).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next((t=>{const i=(0,d.c)(this._originCache,l.origin);(0,d.b)(i,i,l.basis1,-h[0]),(0,d.b)(i,i,l.basis2,-h[1]);const o=(0,u.t8)(this._axisCache,l.basis1[0],l.basis1[1]);(0,u.Fv)(o,o);const c=a.data.allVertices,p="start"===t.action?U.b.NEW_STEP:U.b.ACCUMULATE_STEPS,_=a.scaleVertices(c,i,o,t.factor1,t.factor2,p,L.w.REPLACE);return r&&r<a.data.geometry.extent.width&&s?a.updateVertices(c,s):((0,v.a)(l,n),(0,H.nn)(_,n),s=_.operation,e(t,_)),t})).next((t=>("end"===t.action&&(p.cursor="grab"),t)))}))}_createManipulator(){return new O.L({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}var z=n(56128),W=n(18753),j=n(61722),N=n(18208),F=n(22455),B=n(70134);const Y=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]];let q=class extends z.m{constructor(t){super(t),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._planeCache=(0,v.d)(),this._displayPlaneCache=(0,v.d)(),this._mainAxisCache=(0,p.Ue)(),this._rotationHandleCache=(0,_.Ue)(),this._cornerA=(0,_.Ue)(),this._cornerB=(0,_.Ue)(),this._cornerC=(0,_.Ue)(),this._cornerD=(0,_.Ue)(),this._avgAB=(0,_.Ue)(),this._avgBC=(0,_.Ue)(),this._avgCD=(0,_.Ue)(),this._avgDA=(0,_.Ue)(),this._preserveAspectRatio=new R,this._snapRotation=new k,this._graphicsLayer=new b.Z({internal:!0,listMode:"hide",visible:!1}),this._sharedUndoStack=[],this._sharedRedoStack=[],this._isOpacityToggled=!1,this._factor=1,this.preserveAspectRatio=null,this.snapRotation=null,this.type="transform"}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach((t=>t.destroy())),this._editGeometryOperations.destroy(),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,r.SC)(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _plane(){const t=this._graphic.geometry;if(null==t)return null;const e=this._editGeometryOperations.data,n=e.components[0].edges[0],i=(0,u.$X)(this._mainAxisCache,n.leftVertex.pos,n.rightVertex.pos);(0,u.Fv)(i,i);let a=80*this.view.resolution;const o=this.view.spatialReference;return(0,y.fS)(o,t.spatialReference)&&(a*=(0,l.c9)(o)/(0,l.c9)(t.spatialReference)),(0,H.lv)(i,e,a,this._planeCache)}get _displayPlane(){const t=this._plane;if(!t)return null;const e=this._displayPlaneCache;(0,v.a)(t,e);const n=10*this.view.resolution;return(0,d.g)(e.basis1,e.basis1,1+n/(0,d.l)(e.basis1)),(0,d.g)(e.basis2,e.basis2,1+n/(0,d.l)(e.basis2)),e}get _backgroundGraphicGeometry(){const t=this._displayPlane;if(!t)return null;const e=this.view.spatialReference;return this._updateDisplayPlaneConrers(t),new g.Z({spatialReference:e,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}get _rotateGraphicGeometry(){const t=this._plane;if(!t)return null;const e=this._rotationHandleCache;return(0,d.n)(e,t.basis1),(0,d.g)(e,e,30*this.view.resolution),(0,d.f)(e,e,t.origin),(0,d.f)(e,e,t.basis1),new f.Z({x:e[0],y:e[1],spatialReference:this.view.spatialReference})}get _scaleGraphicGeometries(){const t=this._displayPlane;if(!t)return[];const e=this.view.spatialReference;this._updateDisplayPlaneConrers(t);const{_cornerA:n,_cornerB:i,_cornerC:a,_cornerD:o}=this,r=(0,d.m)(this._avgAB,n,i,.5),s=(0,d.m)(this._avgBC,i,a,.5),l=(0,d.m)(this._avgCD,a,o,.5),c=(0,d.m)(this._avgDA,o,n,.5);return[new f.Z({x:n[0],y:n[1],spatialReference:e}),new f.Z({x:i[0],y:i[1],spatialReference:e}),new f.Z({x:a[0],y:a[1],spatialReference:e}),new f.Z({x:o[0],y:o[1],spatialReference:e}),new f.Z({x:r[0],y:r[1],spatialReference:e}),new f.Z({x:s[0],y:s[1],spatialReference:e}),new f.Z({x:l[0],y:l[1],spatialReference:e}),new f.Z({x:c[0],y:c[1],spatialReference:e})]}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this._editGeometryOperations.undo(),this.updateGraphics()}redo(){this._editGeometryOperations.redo(),this.updateGraphics()}refresh(){const{view:t,target:e}=this,n="georeference"in e?e.georeference.coords:e.geometry,i=this._editGeometryOperations,a=i.data.components[0].vertices,o=j.XE.fromGeometry((0,m.project)(n,t.spatialReference),E.JY.Local).components[0].vertices;a.forEach(((t,e)=>{i.setVertexPosition(t,o[e].pos)})),this.updateGraphics()}reset(){const{target:t}=this;if("georeference"in t){const e=t.georeference;"control-points"===e.type&&(e.controlPoints=this._initialControlPoints)}else t.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._editGeometryOperations.data.geometry;"georeference"in this.target&&(this.target.georeference.coords=t),this._graphic.geometry=t,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach(((t,e)=>{this._scaleGraphics[e].geometry=t}))}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}async _initialize(){const{view:t,target:e}=this;if("georeference"in e){const t=e.georeference;this._graphic=new a.Z({geometry:t.coords}),this._initialControlPoints="control-points"===t.type?t.controlPoints:null}else this._graphic=e,this._initialGeometry=e.geometry;t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._editGeometryOperations=N.c.fromGeometry((0,m.project)(this._graphic.geometry,t.spatialReference),E.JY.Local),this._backgroundGraphic=new a.Z({symbol:new M.Z({color:"transparent",outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:2}}),geometry:this._backgroundGraphicGeometry}),this._rotateGraphic=new a.Z({symbol:new S.Z({color:(0,o.mj)(t.effectiveTheme.accentColor),outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:1}}),geometry:this._rotateGraphicGeometry}),this._scaleGraphics=this._scaleGraphicGeometries.map((e=>new a.Z({symbol:new S.Z({size:6,style:"square",color:(0,o.mj)(t.effectiveTheme.accentColor),outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:1}}),geometry:e}))),this._graphicsLayer.graphics.addMany([this._backgroundGraphic,this._rotateGraphic,...this._scaleGraphics]),this._dragManipulation=new w.d({tool:this,view:t,graphic:this._graphic}),this._rotateManipulation=new Z({tool:this,view:t,graphic:this._rotateGraphic,snapRotation:this._snapRotation}),this._scaleManipulations=this._scaleGraphics.map(((e,n)=>new V({tool:this,view:t,graphic:e,direction:Y[n],preserveAspectRatio:this._preserveAspectRatio}))),this.addHandles([this._dragManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),this._rotateManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),...this._scaleManipulations.map((t=>t.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)))),(0,s.YP)((()=>this.view.scale),(()=>this.active?this.updateGraphics():null)),t.on("click",(async n=>{if(null!=t.activeTool&&t.activeTool!==this)return;const i=(0,B.vT)(n),a=[];t.map.allLayers.forEach((t=>{"vector-tile"!==t.type&&"imagery"!==t.type||a.push(t)}));const o=await this.view.hitTest(i,{exclude:a}),r=o.results;if(0===r.length)t.activeTool=null;else{const n=(0,F.qm)(o.results),i="georeference"in e,a=r.map((t=>"media"===t.type?t.element:null)).filter(Boolean),s=new Set([...this._graphicsLayer.graphics,i?null:e].filter(Boolean));i&&a.includes(e)||null!=n&&s.has(n.graphic)?null==t.activeTool&&(t.activeTool=this):t.activeTool=null}}))]);const n=t=>{this.addHandles(t.events.on("grab-changed",(t=>{"georeference"in e&&("start"===t.action?e.opacity*=.5:"end"===t.action&&(e.opacity*=2))})))};this._dragManipulation.forEachManipulator(n),this._rotateManipulation.forEachManipulator(n),this._scaleManipulations.forEach((t=>t.forEachManipulator(n)));const i=new W.G7;i.addToggle(W.Lk.preserveAspectRatio,(()=>{null==this.preserveAspectRatio&&(this._preserveAspectRatio.enabled=!this._preserveAspectRatio.enabled)})),i.addToggle(W.Lk.rotateIncrements,(()=>{null==this.snapRotation&&(this._snapRotation.enabled=!this._snapRotation.enabled)})),i.add(W.Lk.toggleOpacity,(()=>{"georeference"in e&&(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)})),i.addToggle(W.Lk.factorModifier,(t=>this._factor="key-down"===t.type?10:1)),i.add(W.Lk.scaleUp,(()=>this._scale(this._factor))),i.add(W.Lk.scaleDown,(()=>this._scale(-this._factor))),i.add(W.Lk.moveUp,(()=>this._move(0,this._factor))),i.add(W.Lk.moveDown,(()=>this._move(0,-this._factor))),i.add(W.Lk.moveLeft,(()=>this._move(-this._factor,0))),i.add(W.Lk.moveRight,(()=>this._move(this._factor,0))),this.addHandles([t.on("key-down",(e=>{t.activeTool===this&&i.dispatch(t.inputManager,e)})),t.on("key-up",(e=>{t.activeTool===this&&i.dispatch(t.inputManager,e)}))])}async _loadProjectionEngine(){const t=this._graphic.geometry;return(0,m.initializeProjection)(t.spatialReference,this.view.spatialReference)}_updateDisplayPlaneConrers(t){const{basis1:e,basis2:n,origin:i}=t,a=this._cornerA;(0,d.f)(a,i,e),(0,d.f)(a,a,n);const o=this._cornerB;(0,d.f)(o,i,e),(0,d.d)(o,o,n);const r=this._cornerC;(0,d.d)(r,i,e),(0,d.d)(r,r,n);const s=this._cornerD;(0,d.d)(s,i,e),(0,d.f)(s,s,n)}_getInfo(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}_updateGraphics(t,e){"start"===t.action&&(this._sharedUndoStack.push({tool:this,operation:e}),this._sharedRedoStack.length=0),this.updateGraphics()}_scale(t){const e=this._editGeometryOperations,n=e.data.geometry.extent?.width,i=(n+t*this.view.resolution)/n,a=e.scale(this._plane.origin,p.E9,i,i,U.b.NEW_STEP,L.w.REPLACE);this._sharedUndoStack.push({tool:this,operation:a}),this._sharedRedoStack.length=0,this.updateGraphics()}_move(t,e){const n=this._editGeometryOperations.move(t*this.view.resolution,e*this.view.resolution,0,U.b.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:n}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,i._)([(0,c.Cb)()],q.prototype,"_plane",null),(0,i._)([(0,c.Cb)()],q.prototype,"_backgroundGraphicGeometry",null),(0,i._)([(0,c.Cb)()],q.prototype,"_rotateGraphicGeometry",null),(0,i._)([(0,c.Cb)()],q.prototype,"_scaleGraphicGeometries",null),(0,i._)([(0,c.Cb)()],q.prototype,"preserveAspectRatio",void 0),(0,i._)([(0,c.Cb)()],q.prototype,"snapRotation",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],q.prototype,"target",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],q.prototype,"type",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0})],q.prototype,"view",void 0),q=(0,i._)([(0,h.j)("esri.views.2d.interactive.editingTools.TransformTool")],q)},84982:function(t,e,n){n.d(e,{m:function(){return M}});var i=n(73440),a=n(46451),o=n(50702),r=n(61100),s=n(90403),l=n(17155),c=(n(61432),n(96711),n(83850),n(48023)),h=n(82868),u=n(60508),p=n(85634),d=n(44783),_=n(19886);const f=new d.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),g=new _.Z({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),m=new _.Z({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var v=n(14072),y=n(43166),b=n(77655);let M=class extends v.T{constructor(t){super(t),this._visualElementGraphics={regularVertices:null,activeVertex:null,activeEdge:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:t.activeLineSymbol??f,regularVertices:t.regularVerticesSymbol??g,activeVertex:t.activeVertexSymbol??m,fill:t.activeFillSymbol},t.activeVertexSymbol||this.addHandles((0,s.YP)((()=>this.view?.effectiveTheme?.accentColor),(t=>{if(!t)return;const e=this._visualElementSymbols.activeVertex.clone().set({color:t});this._visualElementGraphics.activeVertex?.set("symbol",e),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:e}}),s.nn))}normalizeCtorArgs(t){const e={...t};return delete e.activeFillSymbol,delete e.activeVertexSymbol,delete e.regularVerticesSymbol,delete e.activeLineSymbol,e}initializeGraphic(t){return null!=this._visualElementSymbols.fill&&(t.symbol=this._visualElementSymbols.fill),this.internalGraphicsLayer.graphics.sort(S),(0,o.kB)()}makeDrawOperation(){const{defaultZ:t,hasZ:e,view:n}=this;return this._createOrUpdateGraphic(null),new y.wW({view:n,manipulators:this.manipulators,geometryType:(0,v.I)(this.geometryType),drawingMode:this.mode,hasZ:e,defaultZ:t,snapToSceneEnabled:this.snapToScene,drawSurface:new b.hP(n,e,t),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new p.r(this.internalGraphicsLayer),graphic:this.graphic,cursor:this.cursor,constraintsEnabled:!0,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils})}onActiveVertexChanged(t){if("point"===this.geometryType)return(0,o.kB)();const[e,n]=t,i=new u.Z({x:e,y:n,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.activeVertex?(this._visualElementGraphics.activeVertex.geometry=i,(0,o.kB)()):(this._visualElementGraphics.activeVertex=new a.Z({geometry:i,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(S),(0,o.kB)((()=>{null!=this._visualElementGraphics.activeVertex&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=(0,r.SC)(this._visualElementGraphics.activeVertex))})))}onCursorEdgeChanged(t){return null!=this._visualElementGraphics.activeEdge?(this._visualElementGraphics.activeEdge.geometry=t,(0,o.kB)()):(this._visualElementGraphics.activeEdge=new a.Z({geometry:t,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeEdge),this.internalGraphicsLayer.graphics.sort(S),(0,o.kB)((()=>{null!=this._visualElementGraphics.activeEdge&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeEdge),this._visualElementGraphics.activeEdge=(0,r.SC)(this._visualElementGraphics.activeEdge))})))}onRegularVerticesChanged(t){const e=new h.Z({points:t,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.regularVertices?(this._visualElementGraphics.regularVertices.geometry=e,(0,o.kB)()):(this._visualElementGraphics.regularVertices=new a.Z({geometry:e,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(S),(0,o.kB)((()=>{null!=this._visualElementGraphics.regularVertices&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=(0,r.SC)(this._visualElementGraphics.regularVertices))})))}};function S(t,e){return(t.attributes?.displayOrder??-1/0)-(e.attributes?.displayOrder??-1/0)}(0,i._)([(0,l.Cb)()],M.prototype,"activeFillSymbol",void 0),(0,i._)([(0,l.Cb)({readOnly:!0})],M.prototype,"type",void 0),(0,i._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],M.prototype,"view",void 0),M=(0,i._)([(0,c.j)("esri.views.2d.interactive.editingTools.draw.DrawGraphicTool2D")],M)},50031:function(t,e,n){n.d(e,{d:function(){return l}});var i=n(4875),a=n(69880),o=n(64515),r=n(90017),s=n(34155);class l extends i.b{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(t){t(this._manipulator,i.d.TRANSLATE_XY)}createDragPipeline(t,e){let n=null,i=null,o=0,l=0,c=0;const{offsetX:h,offsetY:u,size:p}=(0,s.i)(this._graphic.symbol);return(0,a.Xd)(this._manipulator,((s,d)=>{d.next((e=>{if("start"===e.action){const e=t();n=e.editGeometryOperations,i=e.constraints}return e})).next((0,a.Cf)(this._view)).next((t=>{const{x:a,y:s,z:d}=t.mapEnd;if(i&&(a+h<i.xmin||s+u-p<i.ymin||a+h>i.xmax||s+u-p>i.ymax))return t;("start"===t.action||0===o&&0===l&&0===c)&&(o=t.mapStart.x,l=t.mapStart.y,c=t.mapStart.z);const _=a-o,f=s-l,g=d-c;o=a,l=s,c=d;const m="start"===t.action?r.b.NEW_STEP:r.b.ACCUMULATE_STEPS,v=n.move(_,f,g,m);return e(t,v),t}))}))}_createManipulator(){const t=this._view,e=this._graphic;return new o.L({view:t,graphic:e,selectable:!0,cursor:"move"})}}},4875:function(t,e,n){n.d(e,{b:function(){return i},d:function(){return a}});class i{get hovering(){return this.someManipulator((t=>t.hovering))}get grabbing(){return this.someManipulator((t=>t.grabbing))}get dragging(){return this.someManipulator((t=>t.dragging))}hasManipulator(t){return this.someManipulator((e=>e===t))}someManipulator(t){let e=!1;return this.forEachManipulator((n=>{!e&&t(n)&&(e=!0)})),e}}var a;!function(t){t[t.TRANSLATE_XY=0]="TRANSLATE_XY",t[t.SCALE=1]="SCALE",t[t.ROTATE=2]="ROTATE"}(a||(a={}))},56128:function(t,e,n){n.d(e,{m:function(){return h}});var i=n(73440),a=n(87833),o=(n(61432),n(96711),n(93568)),r=n(17155),s=(n(83850),n(48023)),l=n(55541),c=n(17188);let h=class extends a.Z.EventedAccessor{constructor(t){super(t),this.manipulators=new c.D,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[l.bH.MANAGER,!0],[l.bH.USER,!0]]),this._creationFinishedResolver=(0,o.hh)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}get editable(){return this.getEditableFlag(l.bH.USER)}set editable(t){this.setEditableFlag(l.bH.USER,t)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}cancel(){this.emit("cancel")}handleInputEvent(t){this.onInputEvent(t)}handleInputEventAfter(t){this.onInputEventAfter(t)}setEditableFlag(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===l.bH.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(t){return this._editableFlags.get(t)??!1}endDrag(){const t=this.view.inputManager.latestPointerLocation;if(!t)return;let e=!1;this.manipulators.forEach((({manipulator:n})=>{n.dragging&&(e=!0,n.events.emit("drag",{action:"end",start:t,screenPoint:t}))})),e&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(l.bH.USER)&&this.getEditableFlag(l.bH.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,i._)([(0,r.Cb)({constructOnly:!0})],h.prototype,"view",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],h.prototype,"active",null),(0,i._)([(0,r.Cb)({value:!0})],h.prototype,"visible",null),(0,i._)([(0,r.Cb)({value:!0})],h.prototype,"editable",null),(0,i._)([(0,r.Cb)({readOnly:!0})],h.prototype,"manipulators",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],h.prototype,"updating",null),(0,i._)([(0,r.Cb)()],h.prototype,"cursor",null),(0,i._)([(0,r.Cb)({readOnly:!0})],h.prototype,"automaticManipulatorSelection",void 0),(0,i._)([(0,r.Cb)()],h.prototype,"hasFocusedManipulators",null),(0,i._)([(0,r.Cb)()],h.prototype,"hasGrabbedManipulators",void 0),(0,i._)([(0,r.Cb)()],h.prototype,"hasHoveredManipulators",void 0),(0,i._)([(0,r.Cb)()],h.prototype,"firstGrabbedManipulator",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],h.prototype,"created",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],h.prototype,"removeIncompleteOnCancel",void 0),h=(0,i._)([(0,s.j)("esri.views.interactive.InteractiveToolBase")],h)},17188:function(t,e,n){n.d(e,{D:function(){return r}});var i,a,o=n(43254);(a=i||(i={}))[a.WhenToolEditable=0]="WhenToolEditable",a[a.WhenToolNotEditable=1]="WhenToolNotEditable",a[a.Always=2]="Always";class r{constructor(){this._isToolEditable=!0,this._manipulators=new o.Z,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t,e=i.WhenToolEditable){this.addMany([t],e)}addMany(t,e=i.WhenToolEditable){for(const n of t){const t={manipulator:n,visibilityPredicate:e,attached:!1};this._manipulators.add(t),this._attached&&this._updateManipulatorAttachment(t)}}remove(t){for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.at(e).manipulator===t){const t=this._manipulators.splice(e,1)[0];this._detachManipulator(t);break}}removeAll(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((t=>{this._updateManipulatorAttachment(t)})),this._attached=!0}detach(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((({manipulator:t})=>t.destroy())),this._manipulators.destroy(),this._resourceContexts=null}on(t,e){return this._manipulators.on(t,(t=>{e(t)}))}forEach(t){for(const e of this._manipulators.items)t(e)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach((e=>t.push(e.manipulator))),t}intersect(t,e){let n=null,i=Number.MAX_VALUE;return this._manipulators.forEach((({manipulator:a,attached:o})=>{if(!o||!a.interactive)return;const r=a.intersectionDistance(t,e);null!=r&&r<i&&(i=r,n=a)})),n}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const e=t.manipulator;e.grabbing=!1,e.dragging=!1,e.hovering=!1,e.selected=!1,e.detach&&e.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===i.Always||(this._isToolEditable?t.visibilityPredicate===i.WhenToolEditable:t.visibilityPredicate===i.WhenToolNotEditable)}}},69880:function(t,e,n){n.d(e,{$Q:function(){return _},AN:function(){return S},BS:function(){return x},Cf:function(){return m},M2:function(){return d},Mz:function(){return G},Xd:function(){return p},dJ:function(){return M},di:function(){return y},fW:function(){return v},hM:function(){return P},kY:function(){return w},uI:function(){return b},zh:function(){return E}});var i=n(3480),a=(n(61432),n(28947)),o=n(99574),r=n(96094),s=n(13132),l=n(52861),c=n(74774),h=n(51870),u=n(18208);function p(t,e){return t.events.on("drag",function(t,e){let n=null,i=null;return a=>{if("cancel"===a.action)return void(null!=i&&(i.execute({action:"cancel"}),n=null,i=null));const o={action:a.action,screenStart:a.start,screenEnd:a.screenPoint};"start"===a.action&&null==n&&(n=new P,i=new P,e(t,n,i,a.pointerType,o)),null!=n&&n.execute(o),"end"===a.action&&null!=n&&(n=null,i=null)}}(t,e))}function d(t,e){const n=[t.x,t.y,t.z??0],i=e,a=[Math.cos(i),Math.sin(i)],o=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(0===o)return null;a[0]/=o,a[1]/=o;const r=t=>{const e=(t.x-n[0])*a[0]+(t.y-n[1])*a[1];t.x=n[0]+e*a[0],t.y=n[1]+e*a[1]};return t=>(r(t.mapStart),r(t.mapEnd),{...t,axis:a})}function _(t){let e=null;return n=>{if("start"===n.action&&(e=function(t,e){const n=t.operations;if(!n)return null;const i=n.data.geometry,a=(0,c.D)(e);if(i.spatialReference.equals(a))return g(t,n,(()=>{}));if("mesh"!==i.type){const e=f(i,a);if(null==e)return null;const o=i.spatialReference;return g(t,u.c.fromGeometry(e,n.viewingMode),(()=>{const t=(0,s.project)(i,o);n.trySetGeometry(t)}))}if((0,l.QK)(i)){const e=f(i.origin,a);if(!e)return null;const o=i.spatialReference,r=u.c.fromGeometry(e,n.viewingMode);return g(t,n,(()=>{const t=(0,s.project)(r.data.geometry,o),e=t.x-i.origin.x,a=t.y-i.origin.y,l=(t.z??0)-(i.origin.z??0);n.move(e,a,l)}))}return null}(t,n.mapStart.spatialReference)),null==e)return null;const i=n.mapEnd.x-n.mapStart.x,a=n.mapEnd.y-n.mapStart.y,o=(n.mapEnd.z??0)-(n.mapStart.z??0);return e.move(i,a,o,n.action),{...n,translationX:i,translationY:a,translationZ:o}}}function f(t,e){return null==t?null:t.spatialReference.equals(e)?t.clone():(0,s.project)(t,e)}function g(t,e,n){let i=0,a=0,o=0;return{move:(r,s,l,c)=>{"start"===c&&(i=0,a=0,o=0);const h=r-i,u=s-a,p=l-o;e.move(h,u,p),i+=h,a+=u,o+=p,n(),"end"===c&&t.endInteraction?.()}}}function m(t,e=null,n){let i=null;const a=null==e||t.spatialReference?.equals(e)?t=>t:t=>null!=t?(0,s.project)(t,e):t,o={exclude:[],...n};return e=>{if("start"===e.action&&(i=a(t.toMap(e.screenStart,o))),null==i)return null;const n=a(t.toMap(e.screenEnd,o));return null!=n?{...e,mapStart:i,mapEnd:n}:null}}function v(t){const e=t.map((t=>_(t))).filter(i.pC);return t=>{const n=t.mapEnd.x-t.mapStart.x,i=t.mapEnd.y-t.mapStart.y,a=t.mapEnd.z-t.mapStart.z;return e.forEach((e=>e(t))),{...t,translationX:n,translationY:i,translationZ:a}}}function y(t,e){const n=new Map;for(const i of e)n.set(i,(0,a.d9)(t[i]));return e=>(n.forEach(((e,n)=>{t[n]=e})),e)}function b(t){const e=t.operations?.createResetState();return t=>(e?.remove(),t)}function M(t){const e=t.map((t=>b(t))).filter((t=>null!=t));return t=>(e.forEach((e=>e(t))),t)}function S(){let t=0,e=0,n=0;return i=>{"start"===i.action&&(t=i.mapStart.x,e=i.mapStart.y,n=i.mapStart.z);const a=i.mapEnd.x-t,o=i.mapEnd.y-e,r=i.mapEnd.z-n;return t=i.mapEnd.x,e=i.mapEnd.y,n=i.mapEnd.z,{...i,mapDeltaX:a,mapDeltaY:o,mapDeltaZ:r,mapDeltaSpatialReference:i.mapStart.spatialReference}}}function E(){let t=0,e=0;return n=>{"start"===n.action&&(t=n.screenStart.x,e=n.screenStart.y);const i=n.screenEnd.x-t,a=n.screenEnd.y-e;return t=n.screenEnd.x,e=n.screenEnd.y,{...n,screenDeltaX:i,screenDeltaY:a}}}function w(t,e){let n=null,i=0,a=0;return s=>{if("start"===s.action&&(n=t.toScreen?.(e),null!=n&&(n.x<0||n.x>t.width||n.y<0||n.y>t.height?n=null:(i=s.screenStart.x-n.x,a=s.screenStart.y-n.y))),null==n)return null;const l=(0,o.uZ)(s.screenEnd.x-i,0,t.width),c=(0,o.uZ)(s.screenEnd.y-a,0,t.height),h=(0,r.vW)(l,c);return s.screenStart=n,s.screenEnd=h,s}}const T=()=>{};class P{constructor(){this.execute=T}next(t,e=new P){return null!=t&&(this.execute=n=>{const i=t(n);null!=i&&e.execute(i)}),e}}function x(t,e,n=[]){if("2d"===t.type)return t=>t;let i=null;return a=>{"start"===a.action&&(i=t.toMap(a.screenStart,{exclude:n}),null!=i&&(i.z=(0,h.Ou)(i,t,e)));const o=t.toMap(a.screenEnd,{exclude:n});null!=o&&(o.z=(0,h.Ou)(o,t,e));const r=null!=i&&null!=o?{sceneStart:i,sceneEnd:o}:null;return{...a,scenePoints:r}}}function C(t,e,n){const i=e.elevationProvider.getElevation(t.x,t.y,t.z??0,t.spatialReference,"scene")??0,a=(0,c.WG)(t);return a.z=i,a.hasZ=!0,a.z=(0,h.Ou)(a,e,n),a}function G(t,e){if("2d"===t.type)return t=>t;let n=null;return i=>{"start"===i.action&&(n=C(i.mapStart,t,e));const a=C(i.mapEnd,t,e),o=null!=n&&null!=a?{sceneStart:n,sceneEnd:a}:null;return{...i,scenePoints:o}}}},23111:function(t,e,n){n.d(e,{W:function(){return p}});var i=n(61100),a=n(93568),o=n(90403),r=n(61418),s=n(74774),l=n(51870),c=n(69880),h=n(39018),u=n(50399);function p({predicate:t=(()=>!0),snappingManager:e,snappingContext:n,updatingHandles:s,useZ:p=!0}){const m=new c.hM;if(null==e)return{snappingStep:[g,m],cancelSnapping:g};let v,y=null,b=null,M=null;const S=()=>{y=(0,i.IM)(y),e.doneSnapping(),b?.frameTask.remove(),b=null,v=(0,i.hw)(v),M=null},E=(w=e,T=p,P=m,(0,a.Ds)((async({frameTask:t,point:e,scenePoint:n,context:i,event:a,delta:o,getLastState:s},l)=>{const c=await t.schedule((()=>w.snap({point:e,scenePoint:n,context:i,signal:l})),l);if(c.valid){let n=await t.schedule((()=>c.apply()),l);const h=s();null!=h.point&&e!==h.point&&(n=w.update({point:h.point,scenePoint:h.scenePoint,context:i})),null!=h.updatePoint&&(0,r.kg)(n,h.updatePoint)||(f(a.mapEnd,n,o,T),P.execute(a))}})));var w,T,P;let x=null,C=null,G=null;return{snappingStep:[i=>{if(!t(i))return i;const{action:r}=i;if("start"===r){const{info:t}=i,a=function(t){return"3d"===t.type?t.resourceController.scheduler.registerTask(u.T8.SNAPPING):u.sq}(e.view);if(b=function(t,e,n){return{context:new h.N({editGeometryOperations:t.editGeometryOperations,elevationInfo:t.elevationInfo,pointer:t.pointer,vertexHandle:null!=e.info?e.info.handle:null,excludeFeature:t.excludeFeature,feature:t.feature,visualizer:t.visualizer}),originalPos:null!=e.snapOrigin?t.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,originalScenePos:null!=e.scenePoints?e.scenePoints.sceneStart:null,frameTask:n}}(n,i,a),b.context.selfSnappingZ=null,!p&&null!=t){const e=function(t,e){if(!t.hasZ())return null;const n=e.vertices;let i=null;for(const e of n){const n=t.getZ(e.pos);if(null!=i&&null!=n&&Math.abs(n-i)>1e-6)return null;null==i&&(i=n)}return i}(n.coordinateHelper,t.handle.component);null!=e&&(b.context.selfSnappingZ={value:e,elevationInfo:n.elevationInfo??l.jG})}}if(null!=b){const{context:t,originalScenePos:n,originalPos:l}=b,{mapEnd:c,mapStart:h,scenePoints:u}=i,g=d(l,_(c,h)),m=_(h,l),S={...i,action:"update"},w=b.context,T=function(t,e){return null==t||null==e?null:d(t,_(e.sceneEnd,e.sceneStart))}(n,u),P=e.update({point:g,scenePoint:T,context:t});if(G=P,f(c,P,m,p),x=g,C=T,"end"!==r){const{frameTask:t}=b;null==y&&(y=new AbortController),M=e=>{s.addPromise((0,a.R8)(E({frameTask:t,event:S,context:w,point:g,scenePoint:T,delta:m,getLastState:()=>({point:x,scenePoint:C,updatePoint:e.forceUpdate?null:G})},y.signal)))},M({forceUpdate:!1}),null==v&&(v=(0,o.YP)((()=>e.options.effectiveEnabled),(()=>M?.({forceUpdate:!0}))))}}return"end"===r&&S(),i},m],cancelSnapping:t=>(S(),t)}}function d(t,[e,n,i]){const a=(0,s.WG)(t);return a.x+=e,a.y+=n,a.hasZ&&(a.z+=i),a}function _(t,e){const n=t.hasZ&&e.hasZ?t.z-e.z:0;return[t.x-e.x,t.y-e.y,n]}function f(t,e,[n,i,a],o){t.x=e.x+n,t.y=e.y+i,o&&t.hasZ&&e.hasZ&&(t.z=e.z+a)}function g(t){return t}}}]);