"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[91147],{58426:function(e,t,n){n.d(t,{$c:function(){return p},Hg:function(){return y},jW:function(){return f},xb:function(){return h}});var r=n(70880),i=n(43254),o=n(22018);const s=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function l(e){return e instanceof r.Z}function u(e){return e instanceof i.Z?Object.keys(e.items):l(e)?(0,o.vw)(e).keys():e?Object.keys(e):[]}function a(e,t){return e instanceof i.Z?e.items[t]:e[t]}function c(e){return e?e.declaredClass:null}function d(e,t){const n=e.diff;if(n&&"function"==typeof n)return n(e,t);const r=u(e),i=u(t);if(0===r.length&&0===i.length)return;if(!r.length||!i.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const o=i.filter((e=>!r.includes(e))),f=r.filter((e=>!i.includes(e))),p=r.filter((n=>i.includes(n)&&a(e,n)!==a(t,n))).concat(o,f).sort(),y=c(e);if(y&&s.has(y)&&p.length)return{type:"complete",oldValue:e,newValue:t};let h;const g=l(e)&&l(t);for(const r of p){const i=a(e,r),o=a(t,r);let s;if((g||"function"!=typeof i&&"function"!=typeof o)&&i!==o&&(null!=i||null!=o)){if(n&&n[r]&&"function"==typeof n[r])s=n[r]?.(i,o);else if(i instanceof Date&&o instanceof Date){if(i.getTime()===o.getTime())continue;s={type:"complete",oldValue:i,newValue:o}}else s="object"==typeof i&&"object"==typeof o&&c(i)===c(o)?d(i,o):{type:"complete",oldValue:i,newValue:o};null!=s&&(null!=h?h.diff[r]=s:h={type:"partial",diff:{[r]:s}})}}return h}function f(e,t){return function(e,t){if(null==e)return!1;const n=t.split(".");let r=e;for(const e of n){if("complete"===r.type)return!0;if("partial"!==r.type)return!1;{const t=r.diff[e];if(!t)return!1;r=t}}return!0}(e,t)}function p(e,t){if(!e)return!1;if("partial"===e.type){const n=Object.keys(e.diff);return 1===n.length&&n[0]===t}return!1}function y(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&c(e)!==c(t)?{type:"complete",oldValue:e,newValue:t}:d(e,t)}function h(e){if(null==e)return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!h(e))return!1;for(const e of t.removed)if(!h(e))return!1;for(const e of t.changed)if(!h(e))return!1;return!0}case"partial":for(const t in e.diff)if(!h(e.diff[t]))return!1;return!0}}},88058:function(e,t,n){n.d(t,{cn:function(){return r},j:function(){return o},lK:function(){return i}});const r="updating";function i(e){return"updating"===e?null:e}function o(e){return"updating"===e}},87802:function(e,t,n){n.d(t,{UK:function(){return i},qo:function(){return o}});var r=n(29191);async function i(e,t,n){t=t.clone(),e.capabilities.query.supportsMaxRecordCountFactor&&(t.maxRecordCountFactor=s(e));const r=o(e),i=e.capabilities.query.supportsPagination;t.start=0,t.num=r;let l=null;for(;;){const o=await e.source.queryFeaturesJSON(t,n);if(null==l?l=o:l.features=l.features.concat(o.features),l.exceededTransferLimit=o.exceededTransferLimit,!i||!o.exceededTransferLimit)break;t.start+=r}return l}function o(e){return s(e)*function(e){return e.capabilities.query.maxRecordCount||2e3}(e)}function s(e){return e.capabilities.query.supportsMaxRecordCountFactor?r.Z.MAX_MAX_RECORD_COUNT_FACTOR:1}},13878:function(e,t,n){n.d(t,{Z:function(){return b}});var r,i=n(73440),o=n(46451),s=n(41773),l=n(63255),u=n(28947),a=n(17155),c=(n(61432),n(96711),n(1194)),d=n(48023),f=n(29884),p=n(45213),y=n(90756),h=n(98842),g=n(49651);const m=new s.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let b=r=class extends l.Z{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){return this.readFeaturesWithClass(e,t,o.Z)}writeGeometryType(e,t,n,r){if(e)return void m.write(e,t,n,r);const{features:i}=this;if(i)for(const e of i)if(null!=e?.geometry)return void m.write(e.geometry.type,t,n,r)}readQueryGeometry(e,t){if(!e)return null;const n=!!e.spatialReference,r=(0,y.im)(e);return r&&!n&&t.spatialReference&&(r.spatialReference=p.Z.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:n}=this;if(n)for(const e of n)if(e&&null!=e.geometry&&e.geometry.spatialReference)return void(t.spatialReference=e.geometry.spatialReference.toJSON())}clone(){return new r(this.cloneProperties())}cloneProperties(){return(0,u.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let n=0;n<t.features.length;n++){const r=t.features[n];if(r.geometry){const t=e?.[n];r.geometry=t?.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,n],translate:[r,i]}=e,o=this.features,s=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-r)/t)),(e=>Math.round((i-e)/n)));for(let e=0,t=o.length;e<t;e++)s?.(o[e].geometry)||(o.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:n}=this;if(!n)return this;const{translate:[r,i],scale:[o,s]}=n;let l=null,u=null;if(this.hasZ&&null!=n?.scale?.[2]){const{translate:[,,e],scale:[,,t]}=n;l=n=>n*t+e}if(this.hasM&&null!=n?.scale?.[3]){const{translate:[,,,e],scale:[,,,t]}=n;u=n=>null==n?n:n*t+e}const a=this._getHydrationFunction(e,(e=>e*o+r),(e=>i-e*s),l,u);for(const{geometry:e}of t)null!=e&&a&&a(e);return this.transform=null,this}readFeaturesWithClass(e,t,n){const r=p.Z.fromJSON(t.spatialReference),i=[];for(let t=0;t<e.length;t++){const o=e[t],s=n.fromJSON(o),l=o.geometry?.spatialReference;null==s.geometry||l||(s.geometry.spatialReference=r);const u=o.aggregateGeometries,a=s.aggregateGeometries;if(u&&null!=a)for(const e in a){const t=a[e],n=u[e]?.spatialReference;null==t||n||(t.spatialReference=r)}i.push(s)}return i}_quantizePoints(e,t,n){let r,i;const o=[];for(let s=0,l=e.length;s<l;s++){const l=e[s];if(s>0){const e=t(l[0]),s=n(l[1]);e===r&&s===i||(o.push([e-r,s-i]),r=e,i=s)}else r=t(l[0]),i=n(l[1]),o.push([r,i])}return o.length>0?o:null}_getQuantizationFunction(e,t,n){return"point"===e?e=>(e.x=t(e.x),e.y=n(e.y),e):"polyline"===e||"polygon"===e?e=>{const r=(0,y.oU)(e)?e.rings:e.paths,i=[];for(let e=0,o=r.length;e<o;e++){const o=r[e],s=this._quantizePoints(o,t,n);s&&i.push(s)}return i.length>0?((0,y.oU)(e)?e.rings=i:e.paths=i,e):null}:"multipoint"===e?e=>{const r=this._quantizePoints(e.points,t,n);return r&&r.length>0?(e.points=r,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,n,r,i){return"point"===e?e=>{e.x=t(e.x),e.y=n(e.y),r&&(e.z=r(e.z))}:"polyline"===e||"polygon"===e?e=>{const o=(0,y.oU)(e)?e.rings:e.paths;let s,l;for(let e=0,r=o.length;e<r;e++){const r=o[e];for(let e=0,i=r.length;e<i;e++){const i=r[e];e>0?(s+=i[0],l+=i[1]):(s=i[0],l=i[1]),i[0]=t(s),i[1]=n(l)}}if(r&&i)for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0,n=t.length;e<n;e++){const n=t[e];n[2]=r(n[2]),n[3]=i(n[3])}}else if(r)for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0,n=t.length;e<n;e++){const n=t[e];n[2]=r(n[2])}}else if(i)for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0,n=t.length;e<n;e++){const n=t[e];n[2]=i(n[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=n(e.ymin),e.xmax=t(e.xmax),e.ymax=n(e.ymax),r&&null!=e.zmax&&null!=e.zmin&&(e.zmax=r(e.zmax),e.zmin=r(e.zmin)),i&&null!=e.mmax&&null!=e.mmin&&(e.mmax=i(e.mmax),e.mmin=i(e.mmin))}:"multipoint"===e?e=>{const o=e.points;let s,l;for(let e=0,r=o.length;e<r;e++){const r=o[e];e>0?(s+=r[0],l+=r[1]):(s=r[0],l=r[1]),r[0]=t(s),r[1]=n(l)}if(r&&i)for(let e=0,t=o.length;e<t;e++){const t=o[e];t[2]=r(t[2]),t[3]=i(t[3])}else if(r)for(let e=0,t=o.length;e<t;e++){const t=o[e];t[2]=r(t[2])}else if(i)for(let e=0,t=o.length;e<t;e++){const t=o[e];t[2]=i(t[2])}}:null}};(0,i._)([(0,a.Cb)({type:String,json:{write:!0}})],b.prototype,"displayFieldName",void 0),(0,i._)([(0,a.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"exceededTransferLimit",void 0),(0,i._)([(0,a.Cb)({type:[o.Z],json:{write:!0}})],b.prototype,"features",void 0),(0,i._)([(0,c.r)("features")],b.prototype,"readFeatures",null),(0,i._)([(0,a.Cb)({type:[g.Z],json:{write:!0}})],b.prototype,"fields",void 0),(0,i._)([(0,a.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:m.read}}})],b.prototype,"geometryType",void 0),(0,i._)([(0,f.c)("geometryType")],b.prototype,"writeGeometryType",null),(0,i._)([(0,a.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"hasM",void 0),(0,i._)([(0,a.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"hasZ",void 0),(0,i._)([(0,a.Cb)({types:h.qM,json:{write:!0}})],b.prototype,"queryGeometry",void 0),(0,i._)([(0,c.r)("queryGeometry")],b.prototype,"readQueryGeometry",null),(0,i._)([(0,a.Cb)({type:p.Z,json:{write:!0}})],b.prototype,"spatialReference",void 0),(0,i._)([(0,f.c)("spatialReference")],b.prototype,"writeSpatialReference",null),(0,i._)([(0,a.Cb)({json:{write:!0}})],b.prototype,"transform",void 0),b=r=(0,i._)([(0,d.j)("esri.rest.support.FeatureSet")],b),b.prototype.toJSON.isDefaultToJSON=!0},9350:function(e,t,n){n.d(t,{CJ:function(){return a},Rz:function(){return d},js:function(){return f},xA:function(){return u},z3:function(){return c}});n(61432);var r=n(89636),i=n(38096),o=n(19886),s=n(45433),l=n(54914);const u=o.Z.fromJSON(l.I4),a=i.Z.fromJSON(l.ET),c=r.Z.fromJSON(l.lF),d=s.Z.fromJSON(l.qP);function f(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return u;case"polyline":return a;case"polygon":case"extent":return c}return null}o.Z.fromJSON(l.eG),i.Z.fromJSON(l.wW),r.Z.fromJSON(l.lj)},54914:function(e,t,n){n.d(t,{ET:function(){return s},I4:function(){return o},SQ:function(){return r},X1:function(){return i},eG:function(){return a},lF:function(){return l},lj:function(){return d},qP:function(){return u},wW:function(){return c}});const r=[252,146,31,255],i=[153,153,153,255],o={type:"esriSMS",style:"esriSMSCircle",size:6,color:r,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},s={type:"esriSLS",style:"esriSLSSolid",width:.75,color:r},l={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},u={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},a={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},c={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},d={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},25925:function(e,t,n){n.d(t,{Qw:function(){return p},Z6:function(){return h},ZS:function(){return y},sw:function(){return c}});var r=n(29292),i=n(28947),o=n(18764),s=n(87802);const l={setAttribute(){},rollback(){},commit(){}};var u,a;function c(e,t){const n=t.attributes[e.objectIdField];if(null==n)return l;const r=e.sessions.get(n);if(r)return r;const o=(0,i.d9)(t.attributes),s=new Set,a=e.i3sOverrides.createInteractiveEditSession(n),c=new Map,d=(e,t)=>{const r=c.get(e);if(null==r){const r=t.indexOf(n);return c.set(e,r),r}return r};let f=u.EDITING;const p={setAttribute(n,r){if(f!==u.EDITING)return;const i=e.fieldsIndex.get(n);if(!i)return;const l=e.attributeStorageInfo.findIndex((e=>e.name===i.name));if(l<0)return;if(!(n in o))throw new Error(`Attribute "${n}" is not an attribute of the edited feature.`);a.setAttribute(l,r);const c=e.attributeStorageInfo[l];let p=!1;s.add(n),e.forEachNode(((n,i)=>{const o=d(n,i);if(-1===o)return;const s=e.getAttributeData(n.index);if(s){const i=s[c.name];i&&(i[o]=r,e.setAttributeData(n.index,s,t),p=!0)}})),p&&e.clearMemCache()},rollback(){if(f===u.EDITING){for(const e of s)this.setAttribute(e,o[e]);a.remove(),f=u.ROLLED_BACK,e.sessions.delete(n)}},commit(){f===u.EDITING&&(a.remove(),f=u.COMMITTED,e.sessions.delete(n))}};return e.sessions.set(n,p),p}function d(e,t,n){const{gidToFeatureInfo:r,oidToFeatureInfo:i,fieldsIndex:o,objectIdField:s,globalIdField:l,featureOrIdentifierList:u}=n;if(!n.featuresResolved&&null!=u){for(const e of u){const t={feature:null,oid:-1,gid:null};if("attributes"in e){t.feature=e;const n=e.attributes;if(null!=n)for(const e in n){if(-1!==t.oid&&null!=t.gid)break;const r=o.normalizeFieldName(e);r===s&&(t.oid=n[e]??-1),r===l&&(t.gid=n[e])}}else t.oid=e.objectId??-1,t.gid=e.globalId;null!=t.gid&&r.set(t.gid,t),-1!==t.oid&&i.set(t.oid,t)}n.featuresResolved=!0}return(-1!==e?i.get(e):null)??(null!=t?r.get(t):null)}function f(e,t,n,r,i=null,s=!0){const l=[],u={gidToFeatureInfo:new Map,oidToFeatureInfo:new Map,featuresResolved:null==n,fieldsIndex:e.fieldsIndex,objectIdField:e.objectIdField,globalIdField:e.globalIdField,featureOrIdentifierList:n};for(const e of t){if(null!=e.error)continue;const t=e.objectId??-1,n=e.globalId,a=(-1===t||s?d(t,n,u):null)??{feature:null,oid:t,gid:n},c={oid:-1===t?a.oid:t,gid:n??a.gid,feature:a.feature,result:e};l.push(c);const f=c.gid?(0,o.L3)(c.gid):null;if(-1===c.oid&&null!=f&&null!=i&&(c.oid=i.get(f)??-1),-1===c.oid&&null!=f){let e=r.get(f);null==e&&(e={gid:c.gid,edits:[]},r.set(f,e)),e.edits.push(c)}}return l}async function p(e,t){const n=new Map,i=f(e,t.addedFeatures,t.edits?.addFeatures,n),l=f(e,t.updatedFeatures,t.edits?.updateFeatures,n),u=f(e,t.deletedFeatures,t.edits?.deleteFeatures,n,t.globalIdToObjectId,!1);return n.size>0&&await async function(e,t){const n=e.i3sOverrides.layer.associatedLayer;if(null==n?.globalIdField)return;const i=n.createQuery(),{objectIdField:l,globalIdField:u}=n;i.where=Array.from(t.values()).map((({gid:e})=>`${u}='${e}'`)).join(" OR "),i.returnGeometry=!1,i.outFields=[l,u],i.cacheHint=!1;const a=await(0,r.mt)((0,s.UK)(n,i));if(!a.ok)return;const c=a.value.features;for(const e of c){const n=e.attributes[u],r=e.attributes[l];if(null==n||null==r||-1===r)continue;const i=t.get((0,o.L3)(n));if(null!=i)for(const e of i.edits)e.oid=r}}(e,n),{adds:i.filter((e=>-1!==e.oid)),updates:l.filter((e=>-1!==e.oid)),deletes:u.filter((e=>-1!==e.oid))}}function y(e,t){const n=new Map,r=e=>{for(const{oid:t,feature:r}of e){const e=r?.geometry;"mesh"===e?.type&&n.set(t,e)}};r(t.adds),r(t.updates);for(const e of t.deletes)n.set(e.oid,null);for(const[t,r]of n)e.i3sOverrides.updateGeometry(t,r)}function h(e,t){const n=function(e,t){const n=t.updates;if(!n||0===n.length)return new b;const r=new b,i=new Map;for(let t=0;t<e.attributeStorageInfo.length;t++)i.set(e.attributeStorageInfo[t].name,t);return e.forEachNode(((t,i)=>{for(const o of n){if(null==o.feature)continue;const n=o.feature,s=o.oid,l=i.indexOf(s);for(const i in n.attributes){const o=e.fieldsIndex.normalizeFieldName(i),u=g(r,t.index,o),a=n.attributes[i];u.push({featureIndex:l,featureId:s,value:a})}}})),r}(e,t),r=function(e,t){const n=new Map,r=t.adds;if(!r||0===r.length||null==e.globalIdField)return n;for(const e of r){const t=e.oid,r=e.feature;"mesh"===r?.geometry?.type&&n.set(t,r)}return n}(e,t);if(0===n.size&&0===r.size)return;const i=new Map;for(let t=0;t<e.attributeStorageInfo.length;t++)i.set(e.attributeStorageInfo[t].name,t);let o=!1;n.forEach(((t,n)=>{const r=e.getAttributeData(n);let s=!1;t.forEach(((t,n)=>{const l=null!=r?r[n]:null,u=i.get(n);for(const{featureIndex:n,value:r,featureId:i}of t)l&&(l[n]=r,s=!0,o=!0),e.i3sOverrides.updateAttributeValue(i,u,r)})),s&&e.setAttributeData(n,r,null)})),o&&e.clearMemCache();const{fieldsIndex:s,i3sOverrides:l,objectIdField:u,globalIdField:a}=e,c=l.layer.associatedLayer?.infoFor3D,d=new Set(c?[...Object.values(c.assetMapFieldRoles),...Object.values(c.transformFieldRoles)]:[]);for(const[e,t]of r){l.featureAdded(e);const{attributes:n}=t;for(const t in n){if(t!==u&&t!==a&&d.has(t))continue;const r=s.normalizeFieldName(t),o=null!=r?i.get(r):null;if(null==o)continue;const c=n[t];l.updateAttributeValue(e,o,c)}}}function g(e,t,n){const r=function(e,t){const n=e.get(t);if(n)return n;const r=new m;return e.set(t,r),r}(e,t),i=null!=n&&r.get(n);if(i)return i;const o=new Array;return r.set(n,o),o}(a=u||(u={}))[a.EDITING=0]="EDITING",a[a.ROLLED_BACK=1]="ROLLED_BACK",a[a.COMMITTED=2]="COMMITTED";const m=Map,b=Map},91826:function(e,t,n){n.d(t,{l:function(){return a}});var r=n(73440),i=n(96711),o=n(17155),s=(n(61432),n(83850),n(48023)),l=n(50718),u=n(52695);const a=e=>{let t=class extends e{constructor(){super(...arguments),this._definitionExpressionErrors=0,this._maxDefinitionExpressionErrors=20,this.logError=e=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&i.Z.getLogger(this).error("Error while evaluating definitionExpression: "+e),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&i.Z.getLogger(this).error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer?.definitionExpression)return null;try{const e=l.default.create(this.i3slayer.definitionExpression,{fieldsIndex:this.i3slayer.fieldsIndex});if(!e.isStandardized)return i.Z.getLogger(this).error("definitionExpression is using non standard function"),null;const t=[],n=e.fieldNames;return(0,u.e8)(n,this.i3slayer.fieldsIndex,{missingFields:t}),t.length>0?(i.Z.getLogger(this).error(`definitionExpression references unknown fields: ${t.join(", ")}`),null):(this._definitionExpressionErrors=0,e)}catch(e){return i.Z.getLogger(this).error("Failed to parse definitionExpression: "+e),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}_evaluateClause(e,t){if(null==e)return!0;try{return e.testFeature(t)}catch(e){return this.logError(e),!1}}_addDefinitionExpressionToQuery(e){if(!this.parsedDefinitionExpression)return e;const t=this.i3slayer.definitionExpression,n=e.clone();return n.where?n.where=`(${t}) AND (${n.where})`:n.where=t,n}};return(0,r._)([(0,o.Cb)({readOnly:!0})],t.prototype,"parsedDefinitionExpression",null),(0,r._)([(0,o.Cb)({readOnly:!0})],t.prototype,"definitionExpressionFields",null),t=(0,r._)([(0,s.j)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t),t}},76945:function(e,t,n){n.d(t,{i:function(){return u}});var r=n(73440),i=n(88194),o=(n(96711),n(61432),n(83850),n(48023)),s=n(76554),l=n(85754);const u=e=>{let t=class extends e{_validateFetchPopupFeatures(e){const{layer:t}=this,{popupEnabled:n}=t;if(!n)throw new i.Z("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t});if(!(0,l.V5)(t,e))throw new i.Z("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t})}async prepareFetchPopupFeatures(e){}async fetchPopupFeaturesFromGraphics(e,t){if(this._validateFetchPopupFeatures(t),0===e.length)return[];const n="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;let r=[];"fieldsIndex"in this.layer&&(r=(0,s.Lk)(this.layer.fieldsIndex,await(0,l.e7)(n,(0,l.V5)(this.layer,t)))),await this.prepareFetchPopupFeatures(r);const i=new Set,o=[],u=[];for(const t of e)(0,s.Gm)(t,r,i)?u.push(t):o.push(t);if(0===u.length)return o;const a=new Map;for(let t=0;t<e.length;t++)a.set(e[t].getObjectId()??0,t);const c=await this.whenGraphicAttributes(u,[...i]).catch((()=>u)).then((e=>o.concat(e)));return c.sort(((e,t)=>{const n=e.getObjectId()??0,r=a.get(n)??0,i=t.getObjectId()??0;return r-(a.get(i)??0)})),c}};return t=(0,r._)([(0,o.j)("esri.views.3d.layers.support.PopupSceneLayerView")],t),t}},65073:function(e,t,n){n.d(t,{K:function(){return p}});var r=n(73440),i=n(70880),o=n(96711),s=n(93568),l=n(90403),u=n(17155),a=n(48023);const c=e=>{let t=class extends e{constructor(){super(...arguments),this._numUpdating=0}get updating(){return this._numUpdating>0}autoUpdateAsync(e,t){const n=(0,s.Ds)((async t=>{++this._numUpdating;try{const n=await t;this.destroyed||this._set(e,n)}catch(t){o.Z.getLogger(this).warn(`Async update of "${String(e)}" failed. Async update functions should not throw exceptions.`)}--this._numUpdating}));return(0,l.YP)(t,n,l.nn)}};return(0,r._)([(0,u.Cb)({readOnly:!0})],t.prototype,"updating",null),(0,r._)([(0,u.Cb)()],t.prototype,"_numUpdating",void 0),t=(0,r._)([(0,a.j)("esri.core.AsyncUpdate")],t),t};let d=class extends(c(i.Z)){};d=(0,r._)([(0,a.j)("esri.core.AsyncUpdate")],d);n(61432),n(83850);var f=n(76554);let p=class extends(c(i.Z)){get layer(){return this.layerView.layer}get requiredFields(){const{layerView:{layer:{fieldsIndex:e},definitionExpressionFields:t},rendererFields:n,labelingFields:r,viewFilterFields:i}=this;return(0,f.Q0)(e,[...t??[],...n??[],...r??[],...i??[]])}constructor(e){super(e)}initialize(){this.addHandles([this.autoUpdateAsync("rendererFields",(async()=>{const{fieldsIndex:e,renderer:t}=this.layer;return t?this._getFieldsAsync((n=>t.collectRequiredFields(n,e))):null})),this.autoUpdateAsync("labelingFields",(async()=>{const{layer:e}=this;return e.labelsVisible?this._getFieldsAsync((t=>(0,f.Mu)(t,e))):null})),this.autoUpdateAsync("viewFilterFields",(()=>{const{layer:e,mergedFilter:t}=this.layerView;return this._getFieldsAsync((n=>(0,f.Ll)(n,e,t)))}))])}async _getFieldsAsync(e){const t=new Set;try{return await e(t),Array.from(t).sort()}catch(e){return o.Z.getLogger(this).error(e),null}}};(0,r._)([(0,u.Cb)()],p.prototype,"layerView",void 0),(0,r._)([(0,u.Cb)()],p.prototype,"layer",null),(0,r._)([(0,u.Cb)()],p.prototype,"requiredFields",null),(0,r._)([(0,u.Cb)()],p.prototype,"rendererFields",void 0),(0,r._)([(0,u.Cb)()],p.prototype,"labelingFields",void 0),(0,r._)([(0,u.Cb)()],p.prototype,"viewFilterFields",void 0),p=(0,r._)([(0,a.j)("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],p)},50506:function(e,t,n){n.d(t,{q:function(){return d}});var r=n(73440),i=n(17155),o=(n(61432),n(96711),n(83850),n(48023)),s=n(21286),l=n(58174),u=n(28371),a=n(68901),c=n(52695);const d=e=>{let t=class extends e{get timeExtent(){return(0,u.h)(this.i3slayer,this.view?.timeExtent,this._get("timeExtent"))}get mergedFilter(){const{filter:e,timeExtent:t}=this;if(null==t)return e;const n=e?.clone()??new l.Z;return null!=t&&(n.timeExtent=n.timeExtent?.intersection(t)??t),n}getTimeFilterDependencies(){const{timeInfo:e}=this.i3slayer;if(null==e)return[];const{startField:t,endField:n}=e;return[t,n]}addTimeFilter(e,t){if(null==t)return;const{timeInfo:n}=this.i3slayer;if(null==n)return;const{startField:r,endField:i,useTime:o}=n;if(!o||null==r&&null==i)return;const l=n.toJSON(),u=t.toJSON();e.push(((e,t)=>function(e,t,n,r){const i=t.attributeInfo?.attributeData;if(null==i)return;const{startTimeField:o,endTimeField:l}=n;if(null!=o&&null==i[o]||null!=l&&null==i[l])return;const u=(0,s.y)(n,r,new f(i));if(null==u)return;const{featureIds:a}=t;(0,c.hv)(e,a,u)}(e,t,l,u)))}};return(0,r._)([(0,i.Cb)({readOnly:!0})],t.prototype,"timeExtent",null),(0,r._)([(0,i.Cb)()],t.prototype,"mergedFilter",null),t=(0,r._)([(0,o.j)("esri.views.3d.layers.support.TemporalSceneLayerView")],t),t};class f{constructor(e){this.attributeData=e}getAttribute(e,t){return(0,a.Jx)(this.attributeData[t],e)}getAttributeAsTimestamp(e,t){const n=this.getAttribute(e,t);return"string"==typeof n?new Date(n).getTime():"number"==typeof n||null==n?n:null}}},20132:function(e,t,n){n.d(t,{v:function(){return i}});var r=n(76554);function i(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const{layer:e,layer:{fieldsIndex:t},requiredFields:n}=this;return e.outFields?(0,r.Q0)(t,[...(0,r.Lk)(t,e.outFields),...n]):(0,r.Q0)(t,n)}}}}},40329:function(e,t,n){n.d(t,{Z:function(){return y}});var r=n(73440),i=n(3480),o=n(96711),s=n(61100),l=n(88058),u=n(93568),a=n(90403),c=n(17155),d=(n(61432),n(48023)),f=n(13132),p=n(5527);let y=class extends p.Z{constructor(){super(...arguments),this.layer=null,this.filter=null,this._geometryEngine=null,this._projectionEngineLoaded=!1,this._abortController=new AbortController}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){throw new Error("Not implemented")}get maximumNumberOfFeaturesExceeded(){return!1}get layerFilter(){return(0,l.lK)(this._layerFilter)}get _layerFilter(){const e=this.layer?.filter;if(null==e||e.geometries.length<1)return null;const t=this._geometryEngine;if(null==t||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return l.cn;const n=e.geometries.at(0).spatialReference,r=e.geometries.toArray().map((e=>{try{e=t.simplify(e)}catch(e){return o.Z.getLogger(this).warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==e)return null;if(e.spatialReference.equals(n))return e;try{return(0,f.project)(e,n)}catch(e){return o.Z.getLogger(this).warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),null}})).filter(i.pC).sort(((e,t)=>e.extent.xmin-t.extent.xmin)),s=new Set,u=new Array,a=new Array;for(let e of r){const n=e.extent.xmin;if(u.length=0,s.forEach((r=>{if(n>=r.extent.xmax)return a.push(r),void s.delete(r);e.extent.ymin<=r.extent.ymax&&e.extent.ymax>=r.extent.ymin&&t.intersects(e,r)&&u.push(r)})),u.length>0){u.push(e);try{e=t.union(u)}catch(e){o.Z.getLogger(this).warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}u.pop(),u.forEach((e=>s.delete(e)))}s.add(e)}return s.forEach((e=>a.push(e))),a.length>0?{spatialRelationship:e.spatialRelationship,geometries:a}:null}get _filterNeedsProjectionEngine(){const e=this.layer.filter;if(null==e||e.geometries.length<=1)return!1;const t=e.geometries.at(0).spatialReference;return e.geometries.some((({spatialReference:e})=>!e.equals(t)&&!(0,f.canProjectWithoutEngine)(e,t)))}get layerFilterUpdating(){return(0,l.j)(this._layerFilter)}initialize(){const{signal:e}=this._abortController;(0,a.N1)((()=>this.destroyed||!this._geometryEngine&&this.layer?.filter?.geometries?.length),e).then((async()=>{(0,u.r9)(e),this._geometryEngine=await Promise.all([n.e(27093),n.e(13746)]).then(n.bind(n,13746))})).catch(u.H9),this._projectionEngineLoaded=(0,f.isLoaded)(),(0,a.N1)((()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine),e).then((async()=>{(0,u.r9)(e),await(0,f.load)(),this._projectionEngineLoaded=!0})).catch(u.H9)}destroy(){this._abortController=(0,s.IM)(this._abortController)}highlight(e){throw new Error("Not implemented")}queryFeatures(e,t){throw new Error("Not implemented")}queryObjectIds(e,t){throw new Error("Not implemented")}queryFeatureCount(e,t){throw new Error("Not implemented")}createQuery(){throw new Error("Not implemented")}queryExtent(e,t){throw new Error("Not implemented")}};(0,r._)([(0,c.Cb)()],y.prototype,"layer",void 0),(0,r._)([(0,c.Cb)()],y.prototype,"availableFields",null),(0,r._)([(0,c.Cb)()],y.prototype,"maximumNumberOfFeatures",null),(0,r._)([(0,c.Cb)({readOnly:!0})],y.prototype,"maximumNumberOfFeaturesExceeded",null),(0,r._)([(0,c.Cb)()],y.prototype,"filter",void 0),(0,r._)([(0,c.Cb)({readOnly:!0})],y.prototype,"layerFilter",null),(0,r._)([(0,c.Cb)({readOnly:!0})],y.prototype,"_layerFilter",null),(0,r._)([(0,c.Cb)()],y.prototype,"_geometryEngine",void 0),(0,r._)([(0,c.Cb)()],y.prototype,"_projectionEngineLoaded",void 0),(0,r._)([(0,c.Cb)()],y.prototype,"_filterNeedsProjectionEngine",null),(0,r._)([(0,c.Cb)()],y.prototype,"layerFilterUpdating",null),y=(0,r._)([(0,d.j)("esri.views.layers.SceneLayerView")],y)}}]);