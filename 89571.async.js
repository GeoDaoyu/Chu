"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[89571],{45415:function(e,t,n){function r(e,t,n,r,s){i(e,t,n||0,r||e.length-1,s||a)}function i(e,t,n,r,a){for(;r>n;){if(r-n>600){var o=r-n+1,u=t-n+1,l=Math.log(o),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(o-c)/o)*(u-o/2<0?-1:1);i(e,t,Math.max(n,Math.floor(t-u*c/o+h)),Math.min(r,Math.floor(t+(o-u)*c/o+h)),a)}var f=e[t],d=n,p=r;for(s(e,n,t),a(e[r],f)>0&&s(e,n,r);d<p;){for(s(e,d,p),d++,p--;a(e[d],f)<0;)d++;for(;a(e[p],f)>0;)p--}0===a(e[n],f)?s(e,n,p):s(e,++p,r),p<=t&&(n=p+1),t<=p&&(r=p-1)}}function s(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function a(e,t){return e<t?-1:e>t?1:0}n.d(t,{q:function(){return r}})},35236:function(e,t,n){n.d(t,{Jl:function(){return h},n$:function(){return d},r7:function(){return c}});var r=n(78619),i=n(88194),s=n(93568),a=n(95490),o=n(90230);let u=null,l=!0;function c(e,t,n){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(e,t)}catch(e){l=!1}return f(e,t,n)}function h(e,t,n,r){if(!t||!n)throw new Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(e,t,n)}catch(e){l=!1}const i=f(t,n,r);return i.data.set(e,0),i}function f(e,t,n){return n||(u||(u=document.createElement("canvas"),u.width=1,u.height=1),n=u),n.getContext("2d").createImageData(e,t)}async function d(e,t){const{arrayBuffer:u,mediaType:l}=await async function(e,t){const n=(0,a.sJ)(e);if(n?.isBase64)return{arrayBuffer:(0,o.R)(n.data),mediaType:n.mediaType};const i=await(0,r.Z)(e,{responseType:"array-buffer",...t});return{arrayBuffer:i.data,mediaType:i.getHeader?.("Content-Type")??""}}(e,t),c="image/png"===l;if("image/gif"===l){const{isAnimatedGIF:e,parseGif:r}=await n.e(20256).then(n.bind(n,20256));if(e(u))return r(u,t)}if(c){const{isAnimatedPNG:e,parseApng:r}=await n.e(98333).then(n.bind(n,98333));if(e(u))return r(u,t)}return async function(e,t){const n=window.URL.createObjectURL(e);try{const{data:e}=await(0,r.Z)(n,{...t,responseType:"image"});return e}catch(e){if(!(0,s.D_)(e))throw new i.Z("invalid-image",`Could not fetch requested image at ${n}`);throw e}finally{window.URL.revokeObjectURL(n)}}(new Blob([u],{type:l}),t)}},30748:function(e,t,n){function r(){return[1,0,0,0,1,0,0,0,1]}function i(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function s(e,t,n,r,i,s,a,o,u){return[e,t,n,r,i,s,a,o,u]}n.d(t,{Ue:function(){return r},Wd:function(){return a},al:function(){return s},d9:function(){return i}});const a=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:a,clone:i,create:r,fromValues:s},Symbol.toStringTag,{value:"Module"}))},41788:function(e,t,n){function r(){return[0,0]}function i(e){return[e[0],e[1]]}function s(e,t){return[e,t]}function a(e,t=[0,0]){const n=Math.min(2,e.length);for(let r=0;r<n;++r)t[r]=e[r];return t}function o(){return[0,0]}function u(){return s(1,1)}function l(){return s(1,0)}function c(){return s(0,1)}n.d(t,{AG:function(){return h},E9:function(){return d},IO:function(){return p},Ue:function(){return r},al:function(){return s},d9:function(){return i},hq:function(){return f},ll:function(){return o},nI:function(){return a}});const h=[0,0],f=u(),d=l(),p=c();Object.freeze(Object.defineProperty({__proto__:null,ONES:f,UNIT_X:d,UNIT_Y:p,ZEROS:h,clone:i,create:r,freeze:function(e,t){return[e,t]},fromArray:a,fromValues:s,ones:u,unitX:l,unitY:c,zeros:o},Symbol.toStringTag,{value:"Module"}))},96373:function(e,t,n){n.d(t,{Iu:function(){return h},Jp:function(){return c},U1:function(){return f},U_:function(){return u},XL:function(){return g},bA:function(){return d},en:function(){return p},f6:function(){return m},p4:function(){return o},t8:function(){return s},uj:function(){return l},xO:function(){return i},yR:function(){return a}});var r=n(66130);function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function s(e,t,n,r,i,s,a,o,u,l){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=s,e[5]=a,e[6]=o,e[7]=u,e[8]=l,e}function a(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function o(e,t){if(e===t){const n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function u(e,t){const n=t[0],r=t[1],i=t[2],s=t[3],a=t[4],o=t[5],u=t[6],l=t[7],c=t[8],h=c*a-o*l,f=-c*s+o*u,d=l*s-a*u;let p=n*h+r*f+i*d;return p?(p=1/p,e[0]=h*p,e[1]=(-c*r+i*l)*p,e[2]=(o*r-i*a)*p,e[3]=f*p,e[4]=(c*n-i*u)*p,e[5]=(-o*n+i*s)*p,e[6]=d*p,e[7]=(-l*n+r*u)*p,e[8]=(a*n-r*s)*p,e):null}function l(e,t){const n=t[0],r=t[1],i=t[2],s=t[3],a=t[4],o=t[5],u=t[6],l=t[7],c=t[8];return e[0]=a*c-o*l,e[1]=i*l-r*c,e[2]=r*o-i*a,e[3]=o*u-s*c,e[4]=n*c-i*u,e[5]=i*s-n*o,e[6]=s*l-a*u,e[7]=r*u-n*l,e[8]=n*a-r*s,e}function c(e,t,n){const r=t[0],i=t[1],s=t[2],a=t[3],o=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=n[0],d=n[1],p=n[2],m=n[3],g=n[4],_=n[5],x=n[6],y=n[7],v=n[8];return e[0]=f*r+d*a+p*l,e[1]=f*i+d*o+p*c,e[2]=f*s+d*u+p*h,e[3]=m*r+g*a+_*l,e[4]=m*i+g*o+_*c,e[5]=m*s+g*u+_*h,e[6]=x*r+y*a+v*l,e[7]=x*i+y*o+v*c,e[8]=x*s+y*u+v*h,e}function h(e,t,n){const r=t[0],i=t[1],s=t[2],a=t[3],o=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=n[0],d=n[1];return e[0]=r,e[1]=i,e[2]=s,e[3]=a,e[4]=o,e[5]=u,e[6]=f*r+d*a+l,e[7]=f*i+d*o+c,e[8]=f*s+d*u+h,e}function f(e,t,n){const r=t[0],i=t[1],s=t[2],a=t[3],o=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=Math.sin(n),d=Math.cos(n);return e[0]=d*r+f*a,e[1]=d*i+f*o,e[2]=d*s+f*u,e[3]=d*a-f*r,e[4]=d*o-f*i,e[5]=d*u-f*s,e[6]=l,e[7]=c,e[8]=h,e}function d(e,t,n){const r=n[0],i=n[1],s=n[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=s*t[6],e[7]=s*t[7],e[8]=s*t[8],e}function p(e,t){const n=t[0],r=t[1],i=t[2],s=t[3],a=n+n,o=r+r,u=i+i,l=n*a,c=r*a,h=r*o,f=i*a,d=i*o,p=i*u,m=s*a,g=s*o,_=s*u;return e[0]=1-h-p,e[3]=c-_,e[6]=f+g,e[1]=c+_,e[4]=1-l-p,e[7]=d-m,e[2]=f-g,e[5]=d+m,e[8]=1-l-h,e}function m(e,t){const n=t[0],r=t[1],i=t[2],s=t[4],a=t[5],o=t[6],u=t[8],l=t[9],c=t[10],h=c*a-o*l,f=-c*s+o*u,d=l*s-a*u,p=n*h+r*f+i*d;if(!p)return null;const m=1/p;return e[0]=h*m,e[1]=(-c*r+i*l)*m,e[2]=(o*r-i*a)*m,e[3]=f*m,e[4]=(c*n-i*u)*m,e[5]=(-o*n+i*s)*m,e[6]=d*m,e[7]=(-l*n+r*u)*m,e[8]=(a*n-r*s)*m,e}function g(e,t){const n=t[0],r=t[1],i=t[2],s=t[3],a=t[4],o=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],g=t[14],_=t[15],x=n*o-r*a,y=n*u-i*a,v=n*l-s*a,b=r*u-i*o,w=r*l-s*o,M=i*l-s*u,I=c*m-h*p,S=c*g-f*p,C=c*_-d*p,E=h*g-f*m,B=h*_-d*m,A=f*_-d*g;let Z=x*A-y*B+v*E+b*C-w*S+M*I;return Z?(Z=1/Z,e[0]=(o*A-u*B+l*E)*Z,e[1]=(u*C-a*A-l*S)*Z,e[2]=(a*B-o*C+l*I)*Z,e[3]=(i*B-r*A-s*E)*Z,e[4]=(n*A-i*C+s*S)*Z,e[5]=(r*C-n*B-s*I)*Z,e[6]=(m*M-g*w+_*b)*Z,e[7]=(g*v-p*M-_*y)*Z,e[8]=(p*w-m*v+_*x)*Z,e):null}function _(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}const x=c,y=_;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},adjoint:l,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},determinant:function(e){const t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],u=e[7],l=e[8];return t*(l*s-a*u)+n*(-l*i+a*o)+r*(u*i-s*o)},equals:function(e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=t[0],d=t[1],p=t[2],m=t[3],g=t[4],_=t[5],x=t[6],y=t[7],v=t[8],b=(0,r.bn)();return Math.abs(n-f)<=b*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-d)<=b*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(s-p)<=b*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-m)<=b*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-g)<=b*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(u-_)<=b*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(l-x)<=b*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(c-y)<=b*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-v)<=b*Math.max(1,Math.abs(h),Math.abs(v))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromMat4:i,fromQuat:p,fromRotation:function(e,t){const n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},identity:a,invert:u,isOrthoNormal:function(e){const t=(0,r.bn)(),n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],u=e[5],l=e[6],c=e[7],h=e[8];return Math.abs(1-(n*n+a*a+l*l))<=t&&Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(s*s+u*u+h*h))<=t},mul:x,multiply:c,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},multiplyScalarAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e},normalFromMat4:g,normalFromMat4Legacy:m,projection:function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},rotate:f,scale:d,scaleByVec2:function(e,t,n){const r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e},set:s,str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},sub:y,subtract:_,translate:h,transpose:o},Symbol.toStringTag,{value:"Module"}))},96946:function(e,t,n){n.d(t,{Q:function(){return o},b:function(){return S}});var r=n(3480),i=n(79487),s=(n(61432),n(63974)),a=n(45415);class o{constructor(e=9,t){this._compareMinX=f,this._compareMinY=d,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),b.prune(),w.prune(),M.prune(),I.prune()}all(e){u(this._data,e)}search(e,t){let n=this._data;const r=this._toBBox;if(y(e,n))for(b.clear();n;){for(let i=0,s=n.children.length;i<s;i++){const s=n.children[i],a=n.leaf?r(s):s;y(e,a)&&(n.leaf?t(s):x(e,a)?u(s,t):b.push(s))}n=b.pop()}}collides(e){let t=this._data;const n=this._toBBox;if(!y(e,t))return!1;for(b.clear();t;){for(let r=0,i=t.children.length;r<i;r++){const i=t.children[r],s=t.leaf?n(i):i;if(y(e,s)){if(t.leaf||x(e,s))return!0;b.push(i)}}t=b.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,n=e.length;t<n;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new E([]),this}remove(e){if(!e)return this;let t,n=this._data,s=null,a=0,o=!1;const u=this._toBBox(e);for(M.clear(),I.clear();n||M.length>0;){if(n||(n=M.pop(),s=M.data[M.length-1],a=I.pop()??0,o=!0),n.leaf&&(t=(0,r.cq)(n.children,(0,i.CY)(e),n.children.length,n.indexHint),-1!==t))return n.children.splice(t,1),M.push(n),this._condense(M),this;o||n.leaf||!x(n,u)?s?(a++,n=s.children[a],o=!1):n=null:(M.push(n),I.push(a),a=0,s=n,n=n.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,n,r){const i=n-t+1;let s=this._maxEntries;if(i<=s){const r=new E(e.slice(t,n+1));return l(r,this._toBBox),r}r||(r=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/s**(r-1)));const a=new B([]);a.height=r;const o=Math.ceil(i/s),u=o*Math.ceil(Math.sqrt(s));v(e,t,n,u,this._compareMinX);for(let i=t;i<=n;i+=u){const t=Math.min(i+u-1,n);v(e,i,t,o,this._compareMinY);for(let n=i;n<=t;n+=o){const i=Math.min(n+o-1,t);a.children.push(this._build(e,n,i,r-1))}}return l(a,this._toBBox),a}_insert(e,t,n){const r=this._toBBox,i=n?e:r(e);M.clear();const s=function(e,t,n,r){for(;r.push(t),!0!==t.leaf&&r.length-1!==n;){let n,r=1/0,i=1/0;for(let s=0,a=t.children.length;s<a;s++){const a=t.children[s],o=p(a),u=g(e,a)-o;u<i?(i=u,r=o<r?o:r,n=a):u===i&&o<r&&(r=o,n=a)}t=n||t.children[0]}return t}(i,this._data,t,M);for(s.children.push(e),h(s,i);t>=0&&M.data[t].children.length>this._maxEntries;)this._split(M,t),t--;!function(e,t,n){for(let r=n;r>=0;r--)h(t.data[r],e)}(i,M,t)}_split(e,t){const n=e.data[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);const s=this._chooseSplitIndex(n,i,r);if(!s)return;const a=n.children.splice(s,n.children.length-s),o=n.leaf?new E(a):new B(a);o.height=n.height,l(n,this._toBBox),l(o,this._toBBox),t?e.data[t-1].children.push(o):this._splitRoot(n,o)}_splitRoot(e,t){this._data=new B([e,t]),this._data.height=e.height+1,l(this._data,this._toBBox)}_chooseSplitIndex(e,t,n){let r,i,s;r=i=1/0;for(let a=t;a<=n-t;a++){const t=c(e,0,a,this._toBBox),o=c(e,a,n,this._toBBox),u=_(t,o),l=p(t)+p(o);u<r?(r=u,s=a,i=l<i?l:i):u===r&&l<i&&(i=l,s=a)}return s}_chooseSplitAxis(e,t,n){const r=e.leaf?this._compareMinX:f,i=e.leaf?this._compareMinY:d;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)}_allDistMargin(e,t,n,r){e.children.sort(r);const i=this._toBBox,s=c(e,0,t,i),a=c(e,n-t,n,i);let o=m(s)+m(a);for(let r=t;r<n-t;r++){const t=e.children[r];h(s,e.leaf?i(t):t),o+=m(s)}for(let r=n-t-1;r>=t;r--){const t=e.children[r];h(a,e.leaf?i(t):t),o+=m(a)}return o}_condense(e){for(let t=e.length-1;t>=0;t--){const n=e.data[t];if(0===n.children.length)if(t>0){const i=e.data[t-1],s=i.children;s.splice((0,r.cq)(s,n,s.length,i.indexHint),1)}else this.clear();else l(n,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function u(e,t){let n=e;for(w.clear();n;){if(!0===n.leaf)for(const e of n.children)t((0,i.CY)(e));else w.pushArray(n.children);n=w.pop()??null}}function l(e,t){c(e,0,e.children.length,t,e)}function c(e,t,n,r,i){i||(i=new E([])),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s,a=t;a<n;a++)s=e.children[a],h(i,e.leaf?r(s):s);return i}function h(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function f(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function m(e){return e.maxX-e.minX+(e.maxY-e.minY)}function g(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function _(e,t){const n=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,i-n)*Math.max(0,s-r)}function x(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function y(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function v(e,t,n,r,i){const s=[t,n];for(;s.length;){const t=s.pop(),n=s.pop();if(t-n<=r)continue;const o=n+Math.ceil((t-n)/r/2)*r;(0,a.q)(e,o,n,t,i),s.push(n,o,o,t)}}const b=new s.Z,w=new s.Z,M=new s.Z,I=new s.Z({deallocator:void 0});class S{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class C extends S{constructor(){super(...arguments),this.height=1,this.indexHint=new r.SO}}class E extends C{constructor(e){super(),this.children=e,this.leaf=!0}}class B extends C{constructor(e){super(),this.children=e,this.leaf=!1}}},26191:function(e,t,n){n.d(t,{E:function(){return f},H:function(){return h}});var r=n(96373),i=n(30748),s=n(26821),a=n(24910);const o=(0,n(82846).Ue)(),u=(0,i.Ue)(),l=(0,i.Ue)(),c=(0,i.Ue)();function h(e,t,n){return(0,a.i)(o,t[0],t[1],1),(0,a.o)(o,o,(0,r.p4)(u,n)),0===o[2]?(0,s.t8)(e,o[0],o[1]):(0,s.t8)(e,o[0]/o[2],o[1]/o[2])}function f(e,t,n){return d(l,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]),d(c,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]),(0,r.Jp)(e,(0,r.uj)(l,l),c),0!==e[8]&&(e[0]/=e[8],e[1]/=e[8],e[2]/=e[8],e[3]/=e[8],e[4]/=e[8],e[5]/=e[8],e[6]/=e[8],e[7]/=e[8],e[8]/=e[8]),e}function d(e,t,n,i,s,l,c,h,f){(0,r.t8)(e,t,i,l,n,s,c,1,1,1),(0,a.i)(o,h,f,1),(0,r.uj)(u,e);const[d,p,m]=(0,a.o)(o,o,(0,r.p4)(u,u));return(0,r.t8)(u,d,0,0,0,p,0,0,0,m),(0,r.Jp)(e,u,e)}},76264:function(e,t,n){n.d(t,{Sy:function(){return u},UZ:function(){return a},XZ:function(){return o},x3:function(){return l}});var r=n(62197),i=n(45213),s=n(90756);const a={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new r.Z({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:i.Z.WebMercator}),minus180Line:new r.Z({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:i.Z.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new r.Z({paths:[[[180,-180],[180,180]]],spatialReference:i.Z.WGS84}),minus180Line:new r.Z({paths:[[[-180,-180],[-180,180]]],spatialReference:i.Z.WGS84})}};function o(e,t){return Math.ceil((e-t)/(2*t))}function u(e,t){const n=l(e);for(const e of n)for(const n of e)n[0]+=t;return e}function l(e){return(0,s.oU)(e)?e.rings:e.paths}},37204:function(e,t,n){n.d(t,{SR:function(){return h},Ui:function(){return c}});var r=n(69306),i=n(47566),s=n(62951),a=n(28931),o=n(90756),u=n(76264),l=n(8554);function c(e){return f(e,!0)}function h(e){return f(e,!1)}function f(e,t){if(null==e)return null;const n=e.spatialReference,i=(0,l.C5)(n),a=(0,r.A)(e)?e.toJSON():e;if(!i)return a;const c=(0,l.sS)(n)?102100:4326,h=u.UZ[c].maxX,f=u.UZ[c].minX;if((0,o.wp)(a))return p(a,h,f);if((0,o.aW)(a))return a.points=a.points.map((e=>p(e,h,f))),a;if((0,o.YX)(a))return d(a,i);if((0,o.oU)(a)||(0,o.l9)(a)){const e=(0,s.$P)(v,a),n={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},r=(0,u.XZ)(n.xmin,f)*(2*h),i=0===r?a:(0,u.Sy)(a,r);return n.xmin+=r,n.xmax+=r,n.xmax>h?x(i,h,t):n.xmin<f?x(i,f,t):i}return a}function d(e,t){if(!t)return e;const n=function(e,t){const n=[],{ymin:r,ymax:i,xmin:s,xmax:a}=e,o=e.xmax-e.xmin,[u,l]=t.valid,{x:c,frameId:h}=m(e.xmin,t),{x:f,frameId:d}=m(e.xmax,t),p=c===f&&o>0;if(o>2*l){const e={xmin:s<a?c:f,ymin:r,xmax:l,ymax:i},t={xmin:u,ymin:r,xmax:s<a?f:c,ymax:i},o={xmin:0,ymin:r,xmax:l,ymax:i},p={xmin:u,ymin:r,xmax:0,ymax:i},m=[],_=[];g(e,o)&&m.push(h),g(e,p)&&_.push(h),g(t,o)&&m.push(d),g(t,p)&&_.push(d);for(let e=h+1;e<d;e++)m.push(e),_.push(e);n.push(new y(e,[h]),new y(t,[d]),new y(o,m),new y(p,_))}else c>f||p?n.push(new y({xmin:c,ymin:r,xmax:l,ymax:i},[h]),new y({xmin:u,ymin:r,xmax:f,ymax:i},[d])):n.push(new y({xmin:c,ymin:r,xmax:f,ymax:i},[h]));return n}(e,t).map((e=>e.extent));return n.length<2?n[0]||e:n.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:n.map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}}function p(e,t,n){if(Array.isArray(e)){const r=e[0];if(r>t){const n=(0,u.XZ)(r,t);e[0]=r+n*(-2*t)}else if(r<n){const t=(0,u.XZ)(r,n);e[0]=r+t*(-2*n)}}else{const r=e.x;if(r>t){const n=(0,u.XZ)(r,t);e.x+=n*(-2*t)}else if(r<n){const t=(0,u.XZ)(r,n);e.x+=t*(-2*n)}}return e}function m(e,t){const[n,r]=t.valid,i=2*r;let s,a=0;return e>r?(s=Math.ceil(Math.abs(e-r)/i),e-=s*i,a=s):e<n&&(s=Math.ceil(Math.abs(e-n)/i),e+=s*i,a=-s),{x:e,frameId:a}}function g(e,t){const{xmin:n,ymin:r,xmax:i,ymax:s}=t;return _(e,n,r)&&_(e,n,s)&&_(e,i,s)&&_(e,i,r)}function _(e,t,n){return t>=e.xmin&&t<=e.xmax&&n>=e.ymin&&n<=e.ymax}function x(e,t,n=!0){const r=!(0,o.l9)(e);if(r&&(0,a.Zy)(e),n)return(new b).cut(e,t);const i=r?e.rings:e.paths,s=r?4:2,u=i.length,l=-2*t;for(let e=0;e<u;e++){const t=i[e];if(t&&t.length>=s){const e=[];for(const n of t)e.push([n[0]+l,n[1]]);i.push(e)}}return r?e.rings=i:e.paths=i,e}class y{constructor(e,t){this.extent=e,this.frameIds=t}}const v=(0,i.Ue)();class b{constructor(){this._linesIn=[],this._linesOut=[]}cut(e,t){let n;if(this._xCut=t,e.rings)this._closed=!0,n=e.rings,this._minPts=4;else{if(!e.paths)return null;this._closed=!1,n=e.paths,this._minPts=2}for(const e of n){if(!e||e.length<this._minPts)continue;let t=!0;for(const n of e)t?(this.moveTo(n),t=!1):this.lineTo(n);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),n=[];for(const e of this._linesIn)e&&e.length>=this._minPts&&n.push(e);const r=-2*this._xCut;for(const e of this._linesOut)if(e&&e.length>=this._minPts){for(const t of e)t[0]+=r;n.push(e)}return this._closed?e.rings=n:e.paths=n,e}moveTo(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}lineTo(e){const t=this._side(e[0]);if(t*this._prevSide==-1){const n=this._intersect(this._prevPt,e);this._lineTo(this._xCut,n,0),this._prevSide=0,this._lineTo(e[0],e[1],t)}else this._lineTo(e[0],e[1],t);this._prevSide=t,this._prevPt=e}close(){const e=this._firstPt,t=this._prevPt;e[0]===t[0]&&e[1]===t[1]||this.lineTo(e),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(e,t,n){this._closed?(this._lineIn.push([n<=0?e:this._xCut,t]),this._lineOut.push([n>=0?e:this._xCut,t])):(n<=0&&this._lineIn.push([e,t]),n>=0&&this._lineOut.push([e,t]))}_lineTo(e,t,n){this._closed?(w(this._lineIn,n<=0?e:this._xCut,t),w(this._lineOut,n>=0?e:this._xCut,t)):n<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([e,t])):n>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([e,t])):this._prevSide<0?(this._lineIn.push([e,t]),this._lineOut.push([e,t])):this._prevSide>0&&(this._lineOut.push([e,t]),this._lineIn.push([e,t]))}_checkClosingPt(e){const t=e.length;t>3&&e[0][0]===this._xCut&&e[t-2][0]===this._xCut&&e[1][0]===this._xCut&&(e[0][1]=e[t-2][1],e.pop())}_side(e){return e<this._xCut?-1:e>this._xCut?1:0}_intersect(e,t){const n=(this._xCut-e[0])/(t[0]-e[0]);return e[1]+n*(t[1]-e[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function w(e,t,n){const r=e.length;r>1&&e[r-1][0]===t&&e[r-2][0]===t?e[r-1][1]=n:e.push([t,n])}},59958:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var r=n(73440),i=n(43254),s=n(88194),a=n(96711),o=n(84060),u=n(93568),l=n(17155),c=n(90775),h=(n(61432),n(83850),n(1194)),f=n(48023),d=n(29884),p=n(66951),m=n(38209),g=n(83263),_=n(85330),x=n(27202),y=n(3752),v=n(41615),b=n(96928),w=n(41145),M=n(87833),I=n(97006),S=n(76329),C=n(90403),E=n(71354),B=n(13132),A=n(45213),Z=n(47566),O=n(60680),P=n(8554),R=n(70677),T=n(38937),X=n(77271),L=n(67118);const Y={key:"type",defaultKeyValue:"image",base:T.Z,typeMap:{image:b.Z,video:L.Z}},U=i.Z.ofType(Y);let $=class extends(I.Z.LoadableMixin(S.Z.EsriPromiseMixin(M.Z.EventedAccessor))){constructor(e){super(e),this._index=new R.H,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=e=>{for(const t of e.removed){const e=this._elementViewsMap.get(t);this._elementViewsMap.delete(t),this._index.delete(e),this.removeHandles(e),e.destroy(),this.notifyChange("fullExtent")}const{spatialReference:t}=this;for(const n of e.added){if(this._elementViewsMap.get(n))continue;const e=new X.L({spatialReference:t,element:n});this._elementViewsMap.set(n,e);const r=(0,C.YP)((()=>e.coords),(()=>this._updateIndexForElement(e,!1)));this._updateIndexForElement(e,!0),this.addHandles(r,e)}this._elementsIndexes.clear(),this.elements.forEach(((e,t)=>this._elementsIndexes.set(e,t))),this.emit("refresh")},this.elements=new U}async load(e){if((0,u.k_)(e),!this.spatialReference){const e=this.elements.find((e=>null!=e.georeference?.coords));this._set("spatialReference",e?e.georeference.coords.spatialReference:A.Z.WGS84)}return this._elementsChangedHandler({added:this.elements.items,removed:[]}),this.addHandles(this.elements.on("change",this._elementsChangedHandler)),this}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear()}set elements(e){this._set("elements",(0,w.Z)(e,this._get("elements"),U))}get fullExtent(){if("not-loaded"===this.loadStatus)return null;const e=this._index.fullBounds;return null==e?null:new E.Z({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:this.spatialReference})}set spatialReference(e){"not-loaded"===this.loadStatus?this._set("spatialReference",e):a.Z.getLogger(this).error("#spatialReference","spatialReference cannot be changed after the source is loaded.")}async queryElements(e,t){await this.load(),await(0,B.initializeProjection)(e.spatialReference,this.spatialReference,null,t);const n=(0,P.fS)(e.spatialReference,this.spatialReference)?e:(0,B.project)(e,this.spatialReference);if(!n)return[];const r=n.normalize(),i=[];for(const e of r)this._index.forEachInBounds((0,Z.oJ)(e),(({normalizedCoords:t,element:n})=>{null!=t&&(0,O.Nl)(e,t)&&i.push(n)}));return i.sort(((e,t)=>this._elementsIndexes.get(e)-this._elementsIndexes.get(t))),i}hasElement(e){return this.elements.includes(e)}_updateIndexForElement(e,t){const n=e.normalizedBounds,r=this._index.has(e),i=null!=n;this._index.delete(e),i&&this._index.set(e,n),this.notifyChange("fullExtent"),t||(r!==i?this.emit("refresh"):this.emit("change",{element:e.element}))}};(0,r._)([(0,l.Cb)()],$.prototype,"elements",null),(0,r._)([(0,l.Cb)({readOnly:!0})],$.prototype,"fullExtent",null),(0,r._)([(0,l.Cb)()],$.prototype,"spatialReference",null),$=(0,r._)([(0,f.j)("esri.layers.support.LocalMediaElementSource")],$);var F=n(70924),j=n(27353),H=n(3651);let N=class extends((0,g.h7)((0,y.M)((0,_.q)((0,x.I)((0,o.R)(m.Z)))))){constructor(e){super(e),this.effectiveSource=null,this.georeference=null,this.copyright=null,this.operationalLayerType="MediaLayer",this.spatialReference=null,this.type="media",this._debouncedSaveOperations=(0,u.Ds)((async(e,t,r)=>{const{save:i,saveAs:s}=await n.e(83558).then(n.bind(n,83558));switch(e){case H.x.SAVE:return i(this,t);case H.x.SAVE_AS:return s(this,r,t)}})),this.source=new $}load(e){return this.addResolvingPromise(this._doLoad(e)),Promise.resolve(this)}async _doLoad(e){await this.loadFromPortal({supportedTypes:["Media Layer"]},e);let t=this.source;if(!t)throw new s.Z("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer.");const n=this._getSourceOverride(t,this.georeference);n&&(this.setAtOrigin("source",n,"web-map"),this.setAtOrigin("source",n,"web-scene"),t=n);const r=(0,j.OG)(t)?new $({elements:new i.Z([t])}):t;this._set("effectiveSource",r),this.spatialReference&&(r.spatialReference=this.spatialReference),await r.load(e),this.spatialReference=r.spatialReference}destroy(){this.effectiveSource?.destroy(),this.effectiveSource!==this.source&&this.source?.destroy()}readGeoreference(e,t){return e&&"itemId"in t&&t.itemId?e:void 0}get fullExtent(){return this.loaded?this.effectiveSource.fullExtent:null}get source(){return this._get("source")}set source(e){"loaded"!==this.loadStatus&&"failed"!==this.loadStatus?this._set("source",e):a.Z.getLogger(this).error("#source","source cannot be changed after the layer is loaded.")}castSource(e){return e?Array.isArray(e)?new $({elements:new i.Z(e)}):e instanceof i.Z?new $({elements:e}):e:null}readSource(e,t,n){if("itemId"in t&&t.itemId)return;const r=this._createSource(t);return r?.read(t,n),r}writeSource(e,t,n,r){if(e&&e instanceof $){const t=e.elements.length;if(1!==t)return void(r?.messages&&r.messages.push(new s.Z("media-layer:unsupported-source",`local media element source can only be persisted if it contains exactly one ImageElement, but it has ${t}.`)));e=e.elements.at(0)}(0,j.OG)(e)?e.write(t,r):r?.messages&&(e?r.messages.push(new s.Z("media-layer:unsupported-source","only media elements of type 'ImageElement' or 'VideoElement' can be persisted")):r.messages.push(new s.Z("media-layer:unsupported-source","the media layer is missing a source")))}async save(e){return this._debouncedSaveOperations(H.x.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(H.x.SAVE_AS,t,e)}_createSource(e){if("mediaType"in e)switch(e.mediaType){case"image":return new b.Z;case"video":return new L.Z}return null}_getSourceOverride(e,t){if((0,j.OG)(e)&&this.originIdOf("source")===p.s3.PORTAL_ITEM&&t&&(this.originIdOf("georeference")===p.s3.WEB_MAP||this.originIdOf("georeference")===p.s3.WEB_SCENE)){const n=e.toJSON(),r=this._createSource(n);return r.read({...n},{origin:"portal-item"}),r.read({georeference:t},{origin:"web-map"}),r.read({georeference:t},{origin:"web-scene"}),r}return null}};(0,r._)([(0,l.Cb)({readOnly:!0})],N.prototype,"effectiveSource",void 0),(0,r._)([(0,l.Cb)({readOnly:!0,json:{read:!1,write:!1,origins:{"web-document":{read:!0}}}})],N.prototype,"georeference",void 0),(0,r._)([(0,h.r)("web-document","georeference")],N.prototype,"readGeoreference",null),(0,r._)([(0,l.Cb)({type:String})],N.prototype,"copyright",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],N.prototype,"fullExtent",null),(0,r._)([(0,l.Cb)({type:["MediaLayer"]})],N.prototype,"operationalLayerType",void 0),(0,r._)([(0,l.Cb)({type:["show","hide"]})],N.prototype,"listMode",void 0),(0,r._)([(0,l.Cb)({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1,target:{url:{type:String},mediaType:{type:["image","video"]},georeference:{type:v.Z}},overridePolicy(e,t,n){return{enabled:!0,allowNull:!1,ignoreOrigin:(0,F.fN)(this,n?.origin)&&(0,j.OG)(e)&&!!e.georeference&&e.originIdOf("georeference")>p.s3.PORTAL_ITEM}}}}})],N.prototype,"source",null),(0,r._)([(0,c.p)("source")],N.prototype,"castSource",null),(0,r._)([(0,h.r)("source",["url"])],N.prototype,"readSource",null),(0,r._)([(0,d.c)("source")],N.prototype,"writeSource",null),(0,r._)([(0,l.Cb)()],N.prototype,"spatialReference",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],N.prototype,"type",void 0),N=(0,r._)([(0,f.j)("esri.layers.MediaLayer")],N);const k=N},615:function(e,t,n){n.d(t,{cW:function(){return u},ij:function(){return o},rM:function(){return l}});var r=n(88194),i=n(60123),s=n(13928),a=n(8971);function o(e,t,n){try{return function(e){if(!e||0===e.length)return null;if(function(e){const t=e[0];return!!t&&"scale"in t}(e)){const t=[];for(const n of e)t.push({scale:n.scale,value:l(n.value)});return t}return l(e)}(e)}catch(e){n?.messages?.push(e)}return null}function u(e,t,n,r){try{const r=function(e){const t=(0,s.Q)(e);return t?(0,a.Cb)(t)?t.map((e=>e.toJSON())):t.map((({scale:e,effects:t})=>({scale:e,value:t.map((e=>e.toJSON()))}))):null}(e);(0,i.RB)(n,r,t)}catch(e){r.messages&&r.messages.push(e)}}function l(e){if(!e?.length)return"";const t=[];for(const n of e){let e=[];switch(n.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":e=[c(n,"amount")];break;case"blur":e=[c(n,"radius","pt")];break;case"hue-rotate":e=[c(n,"angle","deg")];break;case"drop-shadow":e=[c(n,"xoffset","pt"),c(n,"yoffset","pt"),c(n,"blurRadius","pt"),h(n,"color")];break;case"bloom":e=[c(n,"strength"),c(n,"radius","pt"),c(n,"threshold")]}const r=`${n.type}(${e.filter(Boolean).join(" ")})`;(0,s.Q)(r),t.push(r)}return t.join(" ")}function c(e,t,n){if(null==e[t])throw new r.Z("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return n?e[t]+n:""+e[t]}function h(e,t){if(null==e[t])throw new r.Z("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const n=e[t];return`rgba(${n[0]||0}, ${n[1]||0}, ${n[2]||0}, ${n[3]/255||0})`}},13928:function(e,t,n){n.d(t,{Q:function(){return l}});var r=n(38461),i=n(88194),s=n(71480),a=n(8971);class o extends SyntaxError{constructor(e,t,n,r){super(e),this.expected=t,this.found=n,this.location=r,this.name="SyntaxError"}format(e){let t="Error: "+this.message;if(this.location){let n=null;const r=e.find((e=>e.source===this.location.source));r&&(n=r.text.split(/\r\n|\n|\r/g));const i=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(i):i,a=this.location.source+":"+s.line+":"+s.column;if(n){const e=this.location.end,r="".padEnd(s.line.toString().length," "),o=n[i.line-1],u=(i.line===e.line?e.column:o.length+1)-i.column||1;t+="\n --\x3e "+a+"\n"+r+" |\n"+s.line+" | "+o+"\n"+r+" | "+"".padEnd(i.column-1," ")+"".padEnd(u,"^")}else t+="\n at "+a}return t}static buildMessage(e,t){function n(e){return e.codePointAt(0).toString(16).toUpperCase()}const r=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function i(e){return r?e.replace(r,(e=>"\\u{"+n(e)+"}")):e}function s(e){return i(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+n(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+n(e))))}function a(e){return i(e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+n(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+n(e))))}const o={literal:e=>'"'+s(e.text)+'"',class(e){const t=e.parts.map((e=>Array.isArray(e)?a(e[0])+"-"+a(e[1]):a(e)));return"["+(e.inverted?"^":"")+t.join("")+"]"+(e.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:e=>e.description};function u(e){return o[e.type](e)}return"Expected "+function(e){const t=e.map(u);if(t.sort(),t.length>0){let e=1;for(let n=1;n<t.length;n++)t[n-1]!==t[n]&&(t[e]=t[n],e++);t.length=e}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(e)+" but "+function(e){return e?'"'+s(e)+'"':"end of input"}(t)+" found."}}function u(e,t){const n={},r=(t=void 0!==t?t:{}).grammarSource,i={start:ue};let s=ue;const a="none",u=",",l="grad",c="turn",h=/^[ \t\n\r]/,f=/^[a-z\-]/,d=/^[0-9a-fA-F]/,p=/^[+\-]/,m=/^[0-9]/,g=ie("none"),_=ne("none",!1),x=ne(")",!1),y=ne(",",!1),v=re([" ","\t","\n","\r"],!1,!1,!1),b=ie("function"),w=ne("(",!1),M=ie("identifier"),I=re([["a","z"],"-"],!1,!1,!1),S=ie("percentage"),C=ne("%",!1),E=ie("length"),B=ne("px",!1),A=ne("cm",!1),Z=ne("mm",!1),O=ne("in",!1),P=ne("pt",!1),R=ne("pc",!1),T=ie("angle"),X=ne("deg",!1),L=ne("rad",!1),Y=ne("grad",!1),U=ne("turn",!1),$=ie("number"),F=ie("color"),j=ne("#",!1),H=re([["0","9"],["a","f"],["A","F"]],!1,!1,!1),N=re(["+","-"],!1,!1,!1),k=re([["0","9"]],!1,!1,!1),q=ne(".",!1),z=ne("e",!1);function V(e,t){return t.length>0?function(e,t,n){return[e].concat(function(e,t){return e.map((function(e){return e[t]}))}(t,n))}(e,t,3):[e]}let D=0|t.peg$currPos,G=D;const J=[{line:1,column:1}];let W,Q=D,K=t.peg$maxFailExpected||[],ee=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in i))throw new Error("Can't start parsing from rule \""+t.startRule+'".');s=i[t.startRule]}function te(){return e.substring(G,D)}function ne(e,t){return{type:"literal",text:e,ignoreCase:t}}function re(e,t,n,r){return{type:"class",parts:e,inverted:t,ignoreCase:n,unicode:r}}function ie(e){return{type:"other",description:e}}function se(t){let n,r=J[t];if(r)return r;if(t>=J.length)n=J.length-1;else for(n=t;!J[--n];);for(r=J[n],r={line:r.line,column:r.column};n<t;)10===e.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return J[t]=r,r}function ae(e,t,n){const i=se(e),s=se(t);return{source:r,start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:s.line,column:s.column}}}function oe(e){D<Q||(D>Q&&(Q=D,K=[]),K.push(e))}function ue(){let e;return e=le(),e===n&&(e=function(){let e,t;if(e=[],t=ce(),t!==n)for(;t!==n;)e.push(t),t=ce();else e=n;return e}()),e}function le(){let t,r;return ee++,t=D,fe(),e.substr(D,4)===a?(r=a,D+=4):(r=n,0===ee&&oe(_)),r!==n?(fe(),G=t,t=[]):(D=t,t=n),ee--,t===n&&0===ee&&oe(g),t}function ce(){let t,r,i,s;return t=D,fe(),r=function(){let t,r,i;return ee++,t=D,r=de(),r!==n?(40===e.charCodeAt(D)?(i="(",D++):(i=n,0===ee&&oe(w)),i!==n?(G=t,t=r):(D=t,t=n)):(D=t,t=n),ee--,t===n&&(r=n,0===ee&&oe(b)),t}(),r!==n?(fe(),i=function(){let t,r,i,s,a,o,l,c;if(t=D,r=he(),r!==n){for(i=[],s=D,a=fe(),44===e.charCodeAt(D)?(o=u,D++):(o=n,0===ee&&oe(y)),o===n&&(o=null),l=fe(),c=he(),c!==n?(a=[a,o,l,c],s=a):(D=s,s=n);s!==n;)i.push(s),s=D,a=fe(),44===e.charCodeAt(D)?(o=u,D++):(o=n,0===ee&&oe(y)),o===n&&(o=null),l=fe(),c=he(),c!==n?(a=[a,o,l,c],s=a):(D=s,s=n);G=t,t=V(r,i)}else D=t,t=n;return t}(),i===n&&(i=null),fe(),41===e.charCodeAt(D)?(s=")",D++):(s=n,0===ee&&oe(x)),s!==n?(fe(),G=t,t=function(e,t){return{type:"function",name:e,parameters:t||[]}}(r,i)):(D=t,t=n)):(D=t,t=n),t}function he(){let e,t;return e=D,t=pe(),t===n&&(t=me(),t===n&&(t=ge(),t===n&&(t=function(){let e,t;return ee++,e=D,fe(),t=xe(),t!==n?(G=e,e=function(e){return{value:e,unit:null}}(t)):(D=e,e=n),ee--,e===n&&0===ee&&oe($),e}()))),t!==n&&(G=e,t=function(e){return{type:"quantity",value:e.value,unit:e.unit}}(t)),e=t,e===n&&(e=D,t=_e(),t!==n&&(G=e,t=function(e){return{type:"color",colorType:e.type,value:e.value}}(t)),e=t),e}function fe(){let t,r;for(ee++,t=[],r=e.charAt(D),h.test(r)?D++:(r=n,0===ee&&oe(v));r!==n;)t.push(r),r=e.charAt(D),h.test(r)?D++:(r=n,0===ee&&oe(v));return ee--,t}function de(){let t,r,i;if(ee++,t=D,r=[],i=e.charAt(D),f.test(i)?D++:(i=n,0===ee&&oe(I)),i!==n)for(;i!==n;)r.push(i),i=e.charAt(D),f.test(i)?D++:(i=n,0===ee&&oe(I));else r=n;return r!==n&&(G=t,r=te()),t=r,ee--,t===n&&(r=n,0===ee&&oe(M)),t}function pe(){let t,r,i;return ee++,t=D,fe(),r=xe(),r!==n?(37===e.charCodeAt(D)?(i="%",D++):(i=n,0===ee&&oe(C)),i!==n?(G=t,t=function(e){return{value:e,unit:"%"}}(r)):(D=t,t=n)):(D=t,t=n),ee--,t===n&&0===ee&&oe(S),t}function me(){let t,r,i;return ee++,t=D,fe(),r=xe(),r!==n?("px"===e.substr(D,2)?(i="px",D+=2):(i=n,0===ee&&oe(B)),i!==n?(G=t,t=function(e){return{value:e,unit:"px"}}(r)):(D=t,t=n)):(D=t,t=n),t===n&&(t=D,fe(),r=xe(),r!==n?("cm"===e.substr(D,2)?(i="cm",D+=2):(i=n,0===ee&&oe(A)),i!==n?(G=t,t=function(e){return{value:e,unit:"cm"}}(r)):(D=t,t=n)):(D=t,t=n),t===n&&(t=D,fe(),r=xe(),r!==n?("mm"===e.substr(D,2)?(i="mm",D+=2):(i=n,0===ee&&oe(Z)),i!==n?(G=t,t=function(e){return{value:e,unit:"mm"}}(r)):(D=t,t=n)):(D=t,t=n),t===n&&(t=D,fe(),r=xe(),r!==n?("in"===e.substr(D,2)?(i="in",D+=2):(i=n,0===ee&&oe(O)),i!==n?(G=t,t=function(e){return{value:e,unit:"in"}}(r)):(D=t,t=n)):(D=t,t=n),t===n&&(t=D,fe(),r=xe(),r!==n?("pt"===e.substr(D,2)?(i="pt",D+=2):(i=n,0===ee&&oe(P)),i!==n?(G=t,t=function(e){return{value:e,unit:"pt"}}(r)):(D=t,t=n)):(D=t,t=n),t===n&&(t=D,fe(),r=xe(),r!==n?("pc"===e.substr(D,2)?(i="pc",D+=2):(i=n,0===ee&&oe(R)),i!==n?(G=t,t=function(e){return{value:e,unit:"pc"}}(r)):(D=t,t=n)):(D=t,t=n)))))),ee--,t===n&&0===ee&&oe(E),t}function ge(){let t,r,i;return ee++,t=D,r=xe(),r!==n?("deg"===e.substr(D,3)?(i="deg",D+=3):(i=n,0===ee&&oe(X)),i!==n?(G=t,t=function(e){return{value:e,unit:"deg"}}(r)):(D=t,t=n)):(D=t,t=n),t===n&&(t=D,r=xe(),r!==n?("rad"===e.substr(D,3)?(i="rad",D+=3):(i=n,0===ee&&oe(L)),i!==n?(G=t,t=function(e){return{value:e,unit:"rad"}}(r)):(D=t,t=n)):(D=t,t=n),t===n&&(t=D,r=xe(),r!==n?(e.substr(D,4)===l?(i=l,D+=4):(i=n,0===ee&&oe(Y)),i!==n?(G=t,t=function(e){return{value:e,unit:"grad"}}(r)):(D=t,t=n)):(D=t,t=n),t===n&&(t=D,r=xe(),r!==n?(e.substr(D,4)===c?(i=c,D+=4):(i=n,0===ee&&oe(U)),i!==n?(G=t,t=function(e){return{value:e,unit:"turn"}}(r)):(D=t,t=n)):(D=t,t=n)))),ee--,t===n&&(r=n,0===ee&&oe(T)),t}function _e(){let t,r,i,s;if(ee++,t=D,35===e.charCodeAt(D)?(r="#",D++):(r=n,0===ee&&oe(j)),r!==n){if(i=[],s=e.charAt(D),d.test(s)?D++:(s=n,0===ee&&oe(H)),s!==n)for(;s!==n;)i.push(s),s=e.charAt(D),d.test(s)?D++:(s=n,0===ee&&oe(H));else i=n;i!==n?(G=t,t={type:"hex",value:te()}):(D=t,t=n)}else D=t,t=n;return t===n&&(t=D,r=ce(),r!==n&&(G=t,r=function(e){return{type:"function",value:e}}(r)),t=r,t===n&&(t=D,r=de(),r!==n&&(G=t,r={type:"named",value:te()}),t=r)),ee--,t===n&&(r=n,0===ee&&oe(F)),t}function xe(){let t,r,i,s,a,o,u,l;for(t=D,r=e.charAt(D),p.test(r)?D++:(r=n,0===ee&&oe(N)),r===n&&(r=null),i=D,s=[],a=e.charAt(D),m.test(a)?D++:(a=n,0===ee&&oe(k));a!==n;)s.push(a),a=e.charAt(D),m.test(a)?D++:(a=n,0===ee&&oe(k));if(46===e.charCodeAt(D)?(a=".",D++):(a=n,0===ee&&oe(q)),a!==n){if(o=[],u=e.charAt(D),m.test(u)?D++:(u=n,0===ee&&oe(k)),u!==n)for(;u!==n;)o.push(u),u=e.charAt(D),m.test(u)?D++:(u=n,0===ee&&oe(k));else o=n;o!==n?(s=[s,a,o],i=s):(D=i,i=n)}else D=i,i=n;if(i===n)if(i=[],s=e.charAt(D),m.test(s)?D++:(s=n,0===ee&&oe(k)),s!==n)for(;s!==n;)i.push(s),s=e.charAt(D),m.test(s)?D++:(s=n,0===ee&&oe(k));else i=n;if(i!==n){if(s=D,101===e.charCodeAt(D)?(a="e",D++):(a=n,0===ee&&oe(z)),a!==n){if(o=e.charAt(D),p.test(o)?D++:(o=n,0===ee&&oe(N)),o===n&&(o=null),u=[],l=e.charAt(D),m.test(l)?D++:(l=n,0===ee&&oe(k)),l!==n)for(;l!==n;)u.push(l),l=e.charAt(D),m.test(l)?D++:(l=n,0===ee&&oe(k));else u=n;u!==n?(a=[a,o,u],s=a):(D=s,s=n)}else D=s,s=n;s===n&&(s=null),G=t,t=parseFloat(te())}else D=t,t=n;return t}W=s();const ye=W!==n&&D===e.length;function ve(){throw W!==n&&D<e.length&&oe({type:"end"}),function(e,t,n){return new o(o.buildMessage(e,t),e,t,n)}(K,Q<e.length?function(t=D){const n=e.codePointAt(t);return void 0===n?"":String.fromCodePoint(n)}(Q):null,Q<e.length?ae(Q,Q+1):ae(Q,Q))}return t.peg$library?{peg$result:W,peg$currPos:D,peg$FAILED:n,peg$maxFailExpected:K,peg$maxFailPos:Q,peg$success:ye,peg$throw:ye?void 0:ve}:ye?W:void ve()}function l(e){if(!e||0===e.length)return null;if("string"==typeof e){const t=c(e);return t&&0!==t.length?t:null}const t=e.map((e=>{if(!Number.isFinite(e.scale)||e.scale<=0)throw new i.Z("effect:invalid-scale","scale must be finite and greater than 0",{stop:e});return{scale:e.scale,effects:c(e.value)}}));t.sort(((e,t)=>t.effects.length-e.effects.length));for(let e=0;e<t.length-1;e++){if(!(0,a.AS)(t[e].effects,t[e+1].effects))throw new i.Z("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[e].effects,b:t[e+1].effects});(0,a.uF)(t[e].effects,t[e+1].effects)}return t.sort(((e,t)=>t.scale-e.scale)),t}function c(e){let t;if(!e)return[];try{t=u(e)}catch(t){throw new i.Z("effect:invalid-syntax","Invalid effect syntax",{value:e,error:t})}return t.map((e=>function(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(e){let t=1;return h(e.parameters,1),1===e.parameters.length&&(t=g(e.parameters[0])),new s.GI(e.name,t)}(e);case"opacity":return function(e){let t=1;return h(e.parameters,1),1===e.parameters.length&&(t=g(e.parameters[0])),new s.Zx(t)}(e);case"hue-rotate":return function(e){let t=0;return h(e.parameters,1),1===e.parameters.length&&(t=function(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=p[e.unit]))throw new i.Z("effect:type-error",`Expected <angle>, Actual: ${f(e)}`,{term:e})}(e),e.value*p[e.unit]||0}(e.parameters[0])),new s.Tq(t)}(e);case"blur":return function(e){let t=0;return h(e.parameters,1),1===e.parameters.length&&(t=x(e.parameters[0]),d(t,e.parameters[0])),new s.Tj(t)}(e);case"drop-shadow":return function(e){const t=[];let n=null;for(const r of e.parameters)if("color"===r.type){if(t.length&&Object.freeze(t),n)throw new i.Z("effect:type-error","Accepts only one color",{});n=y(r)}else{const e=x(r);if(Object.isFrozen(t))throw new i.Z("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(e),3===t.length&&d(e,r)}if(t.length<2||t.length>3)throw new i.Z("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new s.CE(t[0],t[1],t[2]||0,n||v("black"))}(e);case"bloom":return function(e){let t=1,n=0,r=0;return h(e.parameters,3),e.parameters[0]&&(t=g(e.parameters[0])),e.parameters[1]&&(n=x(e.parameters[1]),d(n,e.parameters[1])),e.parameters[2]&&(r=g(e.parameters[2])),new s.rk(t,n,r)}(e)}}catch(t){throw t.details.filter=e,t}throw new i.Z("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}(e)))}function h(e,t){if(e.length>t)throw new i.Z("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function f(e){if("color"===e.type)return"<color>";if(e.unit){if(e.unit in m)return"<length>";if(e.unit in p)return"<angle>";if("%"===e.unit)return"<percentage>"}return"<double>"}function d(e,t){if(e<0)throw new i.Z("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}const p={deg:1,grad:.9,rad:180/Math.PI,turn:360};const m={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function g(e){!function(e){if("quantity"!==e.type||null!==e.unit&&"%"!==e.unit)throw new i.Z("effect:type-error",`Expected <double> or <percentage>, Actual: ${f(e)}`,{term:e})}(e);const t=e.value;return d(t,e),"%"===e.unit?.01*t:t}function _(e){return function(e){if("quantity"!==e.type||null!==e.unit)throw new i.Z("effect:type-error",`Expected <double>, Actual: ${f(e)}`,{term:e})}(e),d(e.value,e),e.value}function x(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=m[e.unit]))throw new i.Z("effect:type-error",`Expected <length>, Actual: ${f(e)}`,{term:e})}(e),e.value*m[e.unit]||0}function y(e){switch(e.colorType){case"hex":return(0,r.a7)(e.value);case"named":return v(e.value);case"function":return function(e){if(h(e.parameters,4),b.test(e.name))return[g(e.parameters[0]),g(e.parameters[1]),g(e.parameters[2]),e.parameters[3]?g(e.parameters[3]):1];if(w.test(e.name))return(0,r.Y6)(_(e.parameters[0]),g(e.parameters[1]),g(e.parameters[2]),e.parameters[3]?g(e.parameters[3]):1);throw new i.Z("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}(e.value)}}function v(e){if(!(0,r.St)(e))throw new i.Z("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return(0,r.VL)(e)}const b=/^rgba?/i,w=/^hsla?/i},70677:function(e,t,n){n.d(t,{H:function(){return u}});var r=n(61432),i=n(96946),s=n(47566);const a={minX:0,minY:0,maxX:0,maxY:0};function o(e,t,n){(function(e){a.minX=e[0],a.minY=e[1],a.maxX=e[2],a.maxY=e[3]})(t),e.search(a,n)}class u{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new i.Q(9,(0,r.Z)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach(((n,r)=>{e[t++]=r})),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((e=>this._idByBounds.has(e)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=(0,s.cS)();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),o(this._index,e,(e=>t(this._idByBounds.get(e))))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},83263:function(e,t,n){n.d(t,{h7:function(){return h},nE:function(){return u},qu:function(){return c}});var r=n(73440),i=n(17155),s=(n(61432),n(96711),n(83850),n(48023)),a=n(71840),o=n(615);const u={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:{layerContainerTypes:a.C}},"portal-item":{read:!0,write:{layerContainerTypes:a.C}}}}},l={read:{reader:o.ij},write:{allowNull:!0,writer:o.cW,layerContainerTypes:a.C}},c={json:{read:!1,write:!1,origins:{"web-map":l,"portal-item":l}}},h=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return(0,r._)([(0,i.Cb)(u)],t.prototype,"blendMode",void 0),(0,r._)([(0,i.Cb)(c)],t.prototype,"effect",void 0),t=(0,r._)([(0,s.j)("esri.layers.mixins.BlendLayer")],t),t}},27202:function(e,t,n){n.d(t,{I:function(){return w}});var r=n(73440),i=n(81001),s=n(10218),a=n(78619),o=n(29292),u=n(88194),l=n(96711),c=n(61100),h=n(93568),f=n(95490),d=n(17155),p=(n(61432),n(83850),n(1194)),m=n(48023),g=n(29884),_=n(75428),x=n(77601),y=n(96193),v=n(91525),b=n(47626);const w=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,c.SC)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,n){if(t.itemId)return new y.default({id:t.itemId,portal:n?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem?.id)try{const{load:r}=await n.e(64975).then(n.bind(n,64975));return(0,h.k_)(t),await r({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData,layerModuleTypeMap:e.layerModuleTypeMap,populateGroupLayer:e.populateGroupLayer},t)}catch(e){throw(0,h.D_)(e)||l.Z.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${e}`),e}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(e).catch((e=>((0,h.r9)(e),!0))))}async setUserPrivileges(e,t){if(!i.default.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(t);if(this.url)try{const{features:{edit:n,fullEdit:r},content:{updateItem:i}}=await this._fetchUserPrivileges(e,t);this._set("userHasEditingPrivileges",n),this._set("userHasFullEditingPrivileges",r),this._set("userHasUpdateItemPrivileges",i)}catch(e){(0,h.r9)(e)}}async _fetchUserPrivileges(e,t){let n=this.portalItem;if(!e||!n||!n.loaded||n.sourceUrl)return this._fetchFallbackUserPrivileges(t);const r=!s.id?.findCredential(this.url),i=e===n.id;if(i&&n.portal.user)return this._getUserPrivileges(n,r);let a,o;if(i)a=n.portal.url;else try{a=await(0,_.oP)(this.url,t)}catch(e){(0,h.r9)(e)}if(!a||!(0,f.Zo)(a,n.portal.url))return this._fetchFallbackUserPrivileges(t);try{const e=null!=t?t.signal:null;o=await(s.id?.getCredential(`${a}/sharing`,{prompt:!1,signal:e}))}catch(e){(0,h.r9)(e)}if(!o)return{features:{edit:true,fullEdit:false},content:{updateItem:false}};try{if(i?await n.reload():(n=new y.default({id:e,portal:{url:a}}),await n.load(t)),n.portal.user)return this._getUserPrivileges(n,r)}catch(e){(0,h.r9)(e)}return{features:{edit:true,fullEdit:false},content:{updateItem:false}}}_getUserPrivileges(e,t){const n=(0,b.Ss)(e);return t&&(n.features.edit=!0),n}async _fetchFallbackUserPrivileges(e){let t=!0;try{t=await this._fetchUserHasEditingPrivileges(e)}catch(e){(0,h.r9)(e)}return{features:{edit:t,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(e){const t=this.url?s.id?.findCredential(this.url):null;if(!t)return!0;const n=M.credential===t?M.user:await this._fetchEditingUser(e);return M.credential=t,M.user=n,null==n?.privileges||n.privileges.includes("features:user:edit")}async _fetchEditingUser(e){const t=this.portalItem?.portal?.user;if(t)return t;const n=s.id?.findServerInfo(this.url??"");if(!n?.owningSystemUrl)return null;const r=`${n.owningSystemUrl}/sharing/rest`,i=x.Z.getDefault();if(i&&i.loaded&&(0,f.Fv)(i.restUrl)===(0,f.Fv)(r))return i.user;const u=`${r}/community/self`,l=null!=e?e.signal:null,c=await(0,o.q6)((0,a.Z)(u,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?v.Z.fromJSON(c.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const n=t?.portal,r=this.portalItem?.id&&(this.portalItem.portal||x.Z.getDefault());return n&&r&&!(0,f.tm)(r.restUrl,n.restUrl)?(t.messages&&t.messages.push(new u.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return(0,r._)([(0,d.Cb)({type:y.default})],t.prototype,"portalItem",null),(0,r._)([(0,p.r)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),(0,r._)([(0,g.c)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),(0,r._)([(0,d.Cb)({clonable:!1})],t.prototype,"resourceReferences",void 0),(0,r._)([(0,d.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),(0,r._)([(0,d.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasFullEditingPrivileges",void 0),(0,r._)([(0,d.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasUpdateItemPrivileges",void 0),t=(0,r._)([(0,m.j)("esri.layers.mixins.PortalLayer")],t),t},M={credential:null,user:null}},3752:function(e,t,n){n.d(t,{M:function(){return a}});var r=n(73440),i=n(17155),s=(n(61432),n(96711),n(83850),n(48023));const a=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const e={minScale:this.minScale,maxScale:this.maxScale},t=this.parent;t&&"effectiveScaleRange"in t&&function(e,t){e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale}(e,t.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===e.minScale&&n.maxScale===e.maxScale?n:e}};return(0,r._)([(0,i.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),(0,r._)([(0,i.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),(0,r._)([(0,i.Cb)({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=(0,r._)([(0,s.j)("esri.layers.mixins.ScaleRangeLayer")],t),t}},77271:function(e,t,n){n.d(t,{L:function(){return h}});var r=n(73440),i=n(70880),s=n(17155),a=(n(61432),n(96711),n(83850),n(48023)),o=n(67764),u=n(13132),l=n(47566),c=n(37204);let h=class extends i.Z{constructor(e){super(e)}get bounds(){const e=this.coords;return null==e?.extent?null:(0,l.oJ)(e.extent)}get coords(){const e=this.element.georeference?.coords;return(0,u.projectOrLoad)(e,this.spatialReference).geometry}get normalizedCoords(){return o.Z.fromJSON((0,c.Ui)(this.coords))}get normalizedBounds(){const e=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=e?(0,l.oJ)(e):null}};(0,r._)([(0,s.Cb)()],h.prototype,"spatialReference",void 0),(0,r._)([(0,s.Cb)()],h.prototype,"element",void 0),(0,r._)([(0,s.Cb)()],h.prototype,"bounds",null),(0,r._)([(0,s.Cb)()],h.prototype,"coords",null),(0,r._)([(0,s.Cb)()],h.prototype,"normalizedCoords",null),(0,r._)([(0,s.Cb)()],h.prototype,"normalizedBounds",null),h=(0,r._)([(0,a.j)("esri.layers.support.MediaElementView")],h)},91013:function(e,t,n){n.d(t,{j:function(){return i}});var r=n(10729);function i(e,t){return new Promise(((n,i)=>{e.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?n():(t((0,r.IH)(e,"canplay",n)),t((0,r.IH)(e,"error",i)))}))}}}]);