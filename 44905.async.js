"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[44905],{56216:function(e,t,i){i.d(t,{Kb:function(){return a},o2:function(){return h},sV:function(){return l},xn:function(){return o}});var s=i(53147),n=i(47747),r=i(71618);function a(e,t){const i=function(e,t){if(null!=e.symbol)return e.symbol;const i=t?.renderer;return null!=i&&"dot-density"!==i.type?i.getSymbol(e,t):null}(e,t);if(null==i)return null;const s=t?.renderer,a=new n.E(s,i);if(null==s||!("visualVariables"in s)||!s.visualVariables)return a;const o=(0,r.getVisualVariableValues)(s,e,t)??[],l=["proportional","proportional","proportional"];for(const{variable:e,value:t}of o)if(null!=t||"size"===e.type&&e.useSymbolValue)switch(e.type){case"color":a.color=t?.toRgba();break;case"size":if("outline"===e.target)a.outlineSize=t;else{const i=e.axis,s=e.useSymbolValue?"symbol-value":t??"proportional";switch(i){case"width":l[0]=s;break;case"depth":l[1]=s;break;case"height":l[2]=s;break;case"width-and-depth":l[0]=l[1]=s;break;default:l[0]=l[1]=l[2]=s}}break;case"opacity":a.opacity=t;break;case"rotation":switch(e.axis){case"tilt":a.tilt=t;break;case"roll":a.roll=t;break;default:a.heading=t}}return"proportional"===l[0]&&"proportional"===l[1]&&"proportional"===l[2]||(a.size=l),a}async function o(e,t){const i=await async function(e,t){return null!=e.symbol?e.symbol:t?.renderer?.getSymbolAsync(e,t)??null}(e,t);if(!i)return null;const a=t?.renderer,o=new n.E(a,i);if(!a||!("visualVariables"in a)||!a.visualVariables)return o;const l=(0,r.getVisualVariableValues)(a,e,t)??[],h=["proportional","proportional","proportional"];for(const{variable:e,value:t}of l)if("color"===e.type)o.color=s.Z.toUnitRGBA(t);else if("size"===e.type)if("outline"===e.target)o.outlineSize=t;else{const i=e.axis,s=e.useSymbolValue?"symbol-value":t;"width"===i?h[0]=s:"depth"===i?h[1]=s:"height"===i?h[2]=s:h[0]=h[1]="width-and-depth"===i?s:h[2]=s}else"opacity"===e.type?o.opacity=t:"rotation"===e.type&&"tilt"===e.axis?o.tilt=t:"rotation"===e.type&&"roll"===e.axis?o.roll=t:"rotation"===e.type&&(o.heading=t);return(isFinite(h[0])||isFinite(h[1])||isFinite(h[2]))&&(o.size=h),o}function l(e,t=0){const i=e[t];return"number"==typeof i&&isFinite(i)?i:null}function h(e){for(let t=0;t<3;t++){const i=e[t];if("number"==typeof i)return isFinite(i)?i:0}return 0}},24381:function(e,t,i){i.d(t,{A:function(){return c}});var s=i(73440),n=i(50702),r=i(93568),a=i(90403),o=i(17155),l=(i(61432),i(96711),i(83850),i(48023)),h=i(73584);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,h.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,n.kB)((()=>e.abort()))),await(0,a.N1)((()=>this.view.defaultsFromMap?.heightModelInfoReady),t),(0,r.k_)(t);const i=(0,h.Wt)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}};return(0,s._)([(0,o.Cb)()],t.prototype,"view",void 0),(0,s._)([(0,o.Cb)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,s._)([(0,l.j)("esri.views.3d.layers.LayerView3D")],t),t}},5473:function(e,t,i){i.d(t,{_:function(){return p}});var s=i(73440),n=i(70880),r=i(87833),a=i(90403),o=i(17155),l=(i(61432),i(96711),i(83850),i(48023)),h=i(70395),c=i(94125),d=i(50399);let p=class extends n.Z{constructor(e){super(e),this._dirtyExtents=new h.D,this._globalDirty=!1,this._averageExtentUpdateSize=0,this._dirtyGraphicsSet=new Set,this._updateElevation=!1,this.graphicsCoreOwner=null,this.graphicsCore=null,this.events=new r.Z}initialize(){const e=this.elevationProvider,t=this.graphicsCoreOwner.view.resourceController.scheduler;this._task=t.registerTask(u(this.graphicsCore.layer.elevationInfo?.mode),this),this.addHandles([e.on("elevation-change",(e=>this._elevationChanged(e))),(0,a.YP)((()=>this.graphicsCoreOwner.suspended),(()=>this._suspendedChange())),this._task,(0,a.YP)((()=>u(this.graphicsCore.layer.elevationInfo?.mode)),(e=>this._task.priority=e))])}destroy(){this._dirtyGraphicsSet.clear(),this.graphicsCoreOwner=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null,this.elevationProvider=null}clear(){this._dirtyGraphicsSet.clear(),this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this._globalDirty=!0,this.notifyChange("updating")}get updating(){return this.running}get running(){return this._dirtyGraphicsSet.size>0||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}get updatingRemaining(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}runTask(e){for(this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,e.madeProgress()),e.run((()=>this._dirtyExtents.merge(e)));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.notifyChange("updating")}_updateDirtyGraphics(e){const t=this.graphicsCoreOwner.view.renderCoordsHelper,i=this.graphicsCore.effectiveUpdatePolicy===c.j.ASYNC;for(const s of this._dirtyGraphicsSet.keys()){const n=this.graphicsCore.getGraphics3DGraphicById(s);if(this._dirtyGraphicsSet.delete(s),null!=n&&(n.alignWithElevation(this.elevationProvider,t,i),this.graphicsCore.deconflictor?.setDirty(),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this._dirtyExtents.empty&&!e.done;){const t=this._dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:t,spatialReference:i});const s=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,i,(e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);null!=t&&t.needsElevationUpdates()&&this._dirtyGraphicsSet.add(e)})),this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-s)+.9*this._averageExtentUpdateSize,e.madeProgress()}}_markAllGraphicsElevationDirty(){this._dirtyExtents.clear(),this._dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach(((e,t)=>this._dirtyGraphicsSet.add(t)))}_elevationChanged(e){if("scene"===e.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const t=e.extent;if(this.graphicsCoreOwner.suspended){if(!this._updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this._updateElevation=!0)}this.events.emit("invalidate-elevation",e)}else t[0]===-1/0?this._globalDirty=!0:this._dirtyExtents.add(t),this.notifyChange("updating")}};function u(e){return null==e?d.T8.ELEVATION_ALIGNMENT:"relative-to-scene"===e?d.T8.ELEVATION_ALIGNMENT_SCENE:d.T8.ELEVATION_ALIGNMENT}(0,s._)([(0,o.Cb)()],p.prototype,"graphicsCoreOwner",void 0),(0,s._)([(0,o.Cb)()],p.prototype,"graphicsCore",void 0),(0,s._)([(0,o.Cb)()],p.prototype,"queryGraphicUIDsInExtent",void 0),(0,s._)([(0,o.Cb)()],p.prototype,"elevationProvider",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],p.prototype,"updating",null),(0,s._)([(0,o.Cb)({readOnly:!0})],p.prototype,"updatingRemaining",null),p=(0,s._)([(0,l.j)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],p)},18234:function(e,t,i){i.d(t,{L:function(){return H}});var s=i(73440),n=i(70880),r=i(90403),a=i(17155),o=(i(61432),i(96711),i(83850),i(48023)),l=i(47925),h=i(79487),c=i(99574),d=i(31865),p=i(10934),u=i(24910),g=i(82846),_=i(74238),y=i(774),f=i(2051),b=i(16447),v=i(47566),S=i(33869),x=i(88970),m=i(77773),C=i(12659),w=i(56172),I=i(316);const E=.5*Math.PI,R=E/Math.PI*180;class G{constructor(e){this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:(0,g.Ue)(),direction:(0,g.Ue)()},this._renderCoordsHelper=e.renderCoordsHelper;for(let e=0;e<4;e++)this._extent[e]={origin:(0,g.Ue)(),direction:(0,g.Ue)(),cap:{next:null,direction:(0,g.Ue)()}},this._planes[e]=(0,m.Ue)();this._planes[S.Nu.NEAR]=(0,m.Ue)(),this._planes[S.Nu.FAR]=(0,m.Ue)(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,t,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,t,i),(0,u.f)(this._center.origin,n[0].origin,n[2].origin),(0,u.g)(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||(0,u.g)(this._center.direction,this._center.direction,-1);for(let e=0;e<4;e++){const t=n[e];this._renderCoordsHelper.worldUpAtPosition(t.origin,t.direction);const i=n[3===e?0:e+1];t.cap.next=i.origin,(0,u.E)(t.cap.direction,t.origin,i.origin),(0,m.my)(t.direction,t.cap.direction,t.origin,this._planes[e]),s||(0,u.g)(t.direction,t.direction,-1)}(0,m.my)(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[S.Nu.NEAR]),s?(0,m.tk)(this._planes[S.Nu.NEAR],this._planes[S.Nu.FAR]):((0,m.JG)(this._planes[S.Nu.FAR],this._planes[S.Nu.NEAR]),(0,m.tk)(this._planes[S.Nu.NEAR],this._planes[S.Nu.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=t,this._minGlobalAltitude=.9*(0,l.Iu)(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,t,i=!1){if(null==e)return!1;if(this._renderCoordsHelper.viewingMode===w.JY.Global){const i=this._maxSpanSpatialReference.isGeographic?R:E*t;if(this._maxSpan>i)return!0;if(null!=e.altitude&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(0===this._maxSpan){const t=this._extent[0];return!(i||!e.intersectsRay((0,C.re)(t.origin,t.direction)))}for(let t=0;t<this._extent.length;t++){const s=this._extent[t];if(!i&&e.intersectsRay((0,C.re)(s.origin,s.direction)))return!0;if(e.intersectsLineSegment((0,x.zk)(s.origin,s.cap.next,U),s.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let t=0;t<e.lines.length;t++){const i=e.lines[t];if((0,I.kD)(s,i.origin,i.endpoint,i.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,t,i){(0,v.be)(e,j),j[2]=i,(0,_.B)(t,j,D,this._renderCoordsHelper.spatialReference),(0,d.U_)(A,D),(0,b.cS)(k);for(const{x0:s,x1:n,y0:r,y1:a}of O)for(let o=0;o<5;o++){const l=o/4;j[0]=(0,c.t7)(e[s],e[n],l),j[1]=(0,c.t7)(e[r],e[a],l),j[2]=i,(0,f.S)(j,t,j,this._renderCoordsHelper.spatialReference),(0,u.t)(j,j,A),(0,b.pp)(k,j)}(0,u.i)(this._extent[0].origin,k[0],k[1],k[2]),(0,u.i)(this._extent[1].origin,k[3],k[1],k[2]),(0,u.i)(this._extent[2].origin,k[3],k[4],k[2]),(0,u.i)(this._extent[3].origin,k[0],k[4],k[2]);for(let e=0;e<4;++e)(0,u.t)(this._extent[e].origin,this._extent[e].origin,D)}_toRenderBoundingExtentLocal(e,t,i){(0,y.d)(e,t,V,this._renderCoordsHelper.spatialReference),(0,u.i)(this._extent[0].origin,V[0],V[1],i),(0,u.i)(this._extent[1].origin,V[2],V[1],i),(0,u.i)(this._extent[2].origin,V[2],V[3],i),(0,u.i)(this._extent[3].origin,V[0],V[3],i)}_toRenderBoundingExtent(e,t,i){switch(this._renderCoordsHelper.viewingMode){case w.JY.Global:this._toRenderBoundingExtentGlobal(e,t,i);break;case w.JY.Local:this._toRenderBoundingExtentLocal(e,t,i);break;default:(0,h.Bg)(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(e){if((0,m.jH)(e.planes[S.Nu.NEAR],this._center.origin)<0&&(0,u.e)(this._center.direction,e.direction)<0)return!0;for(let t=0;t<4;t++){const i=this._extent[t];if((0,m.jH)(e.planes[S.Nu.NEAR],i.origin)<0&&(0,u.e)(i.direction,e.direction)<0)return!0}return!1}}const O=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],j=(0,g.Ue)(),D=(0,p.Ue)(),A=(0,p.Ue)(),k=(0,b.Ue)(),V=(0,v.Ue)(),U=(0,x.Ue)();var T=i(50399),N=i(78891);let H=class extends n.Z{constructor(e){super(e),this.suspended=!1,this._extent=null,this._extentIntersectionDirty=!0,this._isVisibleBelowSurfaceInternal=!1,this.graphicsCoreOwner=null,this.updating=!0}initialize(){const{graphicsCoreOwner:e}=this;this._extentIntersection=new G({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,i=t.basemapTerrain,s=t.resourceController.scheduler;this.addHandles([t.on("resize",(()=>this._viewChange())),(0,r.YP)((()=>t.state.camera),(()=>this._viewChange()),r.Z_),s.registerTask(T.T8.FRUSTUM_VISIBILITY,this),(0,r.YP)((()=>i.visibleElevationBounds),(()=>this._elevationBoundsChange()))]),"local"===t.viewingMode?this._isVisibleBelowSurface=!0:this.addHandles([(0,r.YP)((()=>[i.baseOpacity,i.wireframe,t.map?.ground?.navigationConstraint?.type]),(()=>this._updateIsVisibleBelowSurface()),r.nn)])}destroy(){this._set("graphicsCoreOwner",null),this._extent=null,this._extentIntersection=null}_setDirty(){this.updating||this._set("updating",!0)}setExtent(e){this._extent=e,this._extentIntersectionDirty=!0,this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty(),this._extentIntersectionDirty=!0}set _isVisibleBelowSurface(e){this._isVisibleBelowSurfaceInternal=e,this._setDirty(),this._extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){const e=this.graphicsCoreOwner.view,t=e.basemapTerrain,i="local"===e.viewingMode,s="none"===e.map.ground?.navigationConstraint?.type;this._isVisibleBelowSurface=i||!t.opaque||s}_updateExtentIntersection(){if(!this._extentIntersectionDirty)return;this._extentIntersectionDirty=!1;const e=this.graphicsCoreOwner.view;let t;if(this._isVisibleBelowSurfaceInternal)t=-.3*(0,l.Iu)(e.spatialReference).radius;else{const{min:i,max:s}=e.basemapTerrain.visibleElevationBounds;t=i-Math.max(1,(s-i)*(1.2-1))}this._extentIntersection.update(this._extent,e.spatialReference,t)}get running(){return this.updating}runTask(e){if(this._set("updating",!1),!this._extent)return this._set("suspended",!1),N.J;this._updateExtentIntersection();const t=this.graphicsCoreOwner.view.frustum,i=(0,l.Iu)(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(t,i)),e.madeProgress()}};(0,s._)([(0,a.Cb)({readOnly:!0})],H.prototype,"suspended",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],H.prototype,"graphicsCoreOwner",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],H.prototype,"updating",void 0),H=(0,s._)([(0,o.j)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],H)},62564:function(e,t,i){i.d(t,{d:function(){return _}});var s=i(50702),n=(i(61432),i(32420));class r{}class a extends r{constructor(e,t){super(),this.objectStateId=e,this.object=t}remove(){this.object.removeStateID(this.objectStateId)}}class o extends r{constructor(e,t,i){super(),this.objectStateId=e,this.object=t,this.owner=i}remove(){this.owner.removeRenderGeometryObjectState(this.object,this.objectStateId)}}class l extends r{constructor(e,t){super(),this.objectStateId=e,this._removeCallback=t,this.object=null}remove(){this._removeCallback(this.objectStateId)}}class h{constructor(){this._items=[]}addObject(e,t){this._items.push(new a(t,e))}addRenderGeometry(e,t,i){this._items.push(new o(t,e,i))}addExternal(e,t){this._items.push(new l(t,e))}remove(e){this._remove((t=>t.objectStateId===e))}removeByObject(e){this._remove((t=>t.object===e))}removeAll(){this._items.forEach((e=>e.remove())),this._items=[]}_remove(e){const{_items:t}=this;for(let i=t.length-1;i>=0;--i){const s=t[i];e(s)&&(s.remove(),t.splice(i,1))}}}class c extends h{constructor(){super(...arguments),this.stateType=n.V_.MaskOccludee}}class d extends h{constructor(e){super(),this.highlightName=e,this.stateType=n.V_.Highlight}}class p{constructor(e){this.objectIdField=e,this.ids=new Set,this.paused=!1}hasGraphic(e){const t=this.objectIdField?e.graphic.attributes[this.objectIdField]:e.graphic.uid;return this.ids.has(t)}}class u extends p{constructor(e){super(e),this.stateType=n.V_.MaskOccludee,this.objectStateSet=new c}}class g extends p{constructor(e,t){super(t),this.highlightName=e,this.stateType=n.V_.Highlight,this.objectStateSet=new d(e)}}class _{constructor(e){this._graphicsCore=e,this._stateSets=new Array}destroy(){this.reset(),this._stateSets=null}reset(){this._stateSets&&(this._stateSets.forEach((e=>e.objectStateSet.removeAll())),this._stateSets.length=0)}acquireOccludeeSet(e){const t=new u(e);this._stateSets.push(t);const i=(0,s.kB)((()=>this.releaseSet(t)));return{set:t,handle:i}}acquireHighlightSet(e,t){const i=new g(e,t);this._stateSets.push(i);const n=(0,s.kB)((()=>this.releaseSet(i)));return{set:i,handle:n}}releaseSet(e){e.objectStateSet.removeAll();const t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}setUid(e,t){e.ids.add(t);const i=this._graphicsCore.graphics3DGraphics.get(t);i&&i.addObjectStateSet(e.objectStateSet)}setUids(e,t){t.forEach((t=>this.setUid(e,t)))}setObjectIds(e,t){t.forEach((t=>e.ids.add(t))),this._initializeSet(e)}addGraphic(e){this._stateSets.forEach((t=>{!t.paused&&t.hasGraphic(e)&&e.addObjectStateSet(t.objectStateSet)}))}removeGraphic(e){this._stateSets.forEach((t=>{t.hasGraphic(e)&&e.removeObjectState(t.objectStateSet)}))}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach((e=>e.objectStateSet.removeAll()))}_initializeSet(e){const t=this._graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach((t=>{t&&e.hasGraphic(t)&&t.addObjectStateSet(e.objectStateSet)})):e.ids.forEach((i=>{const s=t.get(i);s&&s.addObjectStateSet(e.objectStateSet)}))}get test(){}}},21143:function(e,t,i){i.d(t,{W:function(){return p}});var s=i(93568),n=i(82846),r=i(45213),a=i(6961),o=i(60856),l=i(51870),h=i(90210),c=i(94290),d=i(15592);async function p(e,t,i,p,u){const{elevationProvider:g,renderCoordsHelper:_}=e,{elevationInfo:y}=t,{pointsInFeatures:f,spatialReference:b}=p,v=r.Z.fromJSON(b),S=(0,d.WI)(y,!0),x=await(0,d.kr)(S,v,u);(0,s.k_)(u);const m=[],C=new Set,w=new Set,I=new c.o,E=(0,o.T)(0,0,0,r.Z.WGS84),R=new h.Lm,G=(0,n.Ue)();E.spatialReference=v;const O=e.elevationProvider.spatialReference??e.spatialReference;for(const{objectId:e,points:s}of f){const n=i(e);if(null==n){for(const e of s)m.push(e.z??0);C.add(e);continue}n.isDraped&&w.add(e);const r=n.graphic.geometry;I.setFromElevationInfo((0,l.Jn)(r,y)),I.updateFeatureExpressionInfoContext(x,n.graphic,t);for(const{x:e,y:t,z:i}of s)E.x=e,E.y=t,E.z=i??0,await(0,a.U)(E,G,O,0,{signal:u}),(0,h.qZ)(G,g,I,_,R),m.push(R.z)}return{elevations:m,drapedObjectIds:w,failedObjectIds:C}}},51335:function(e,t,i){i.d(t,{c:function(){return r}});var s=i(93568),n=i(3411);async function r(e,t,i){if(null==e||0===t.candidates.length)return a;const r=e.graphics3DGraphicsByObjectID??e.graphics3DGraphics,o=[],l=[],{renderer:h}=e,c=null!=h&&"arcadeRequired"in h&&h.arcadeRequired?(0,n.L)():null,d=async(t,{graphic:s,graphics3DSymbol:n})=>{const r=await c,a=await e.getRenderingInfoAsync(s,h,r,{signal:i});return null==a?[]:n.queryForSnapping(t,u,a,i)},{candidates:p,spatialReference:u}=t;for(let e=0;e<p.length;++e){const t=p[e],{objectId:i}=t,s="number"==typeof i?r?.get(i):void 0;if(null==s)continue;const{graphics3DSymbol:n}=s;n.symbologySnappingSupported&&(o.push(d(t,s)),l.push(e))}if(0===o.length)return a;const g=await Promise.all(o);(0,s.k_)(i);const _=[],y=[];for(let e=0;e<g.length;++e){const t=g[e],i=l[e];for(const e of t)_.push(e),y.push(i)}return{candidates:_,sourceCandidateIndices:y}}const a={candidates:[],sourceCandidateIndices:[]}},5527:function(e,t,i){i.d(t,{Z:function(){return g}});var s=i(73440),n=i(70880),r=i(87833),a=i(15894),o=i(96711),l=i(61100),h=i(76329),c=i(17155),d=(i(61432),i(83850),i(48023)),p=i(60147),u=i(27546);let g=class extends(a.Z.IdentifiableMixin(h.Z.EsriPromiseMixin(r.Z.EventedMixin(n.Z)))){get spatialReferenceSupported(){return!0}constructor(e){super(e),this._updatingHandles=new p.R,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer?.title||"no title";o.Z.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e)}}))}destroy(){this._updatingHandles=(0,l.SC)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const e=this.view.timeExtent,t=this.layer?.visibilityTimeExtent;return!e||!t||!e.intersection(t).isEmpty}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&this.parent&&!this.parent.suspended&&this.view?.ready&&(0,u.Cy)(e)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const e=this.parent?.suspended?this.parent.suspendInfo:{};this.view?.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0);const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,u.Cy)(t)&&this.visibleAtCurrentScale||(e.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(e.outsideVisibilityTimeExtent=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"spatialReferenceSupported",null),(0,s._)([(0,c.Cb)()],g.prototype,"view",void 0),(0,s._)([(0,c.Cb)()],g.prototype,"fullOpacity",null),(0,s._)([(0,c.Cb)()],g.prototype,"layer",void 0),(0,s._)([(0,c.Cb)()],g.prototype,"parent",void 0),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"suspended",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"suspendInfo",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"legendEnabled",null),(0,s._)([(0,c.Cb)({type:Boolean,readOnly:!0})],g.prototype,"updating",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"updatingProgress",null),(0,s._)([(0,c.Cb)()],g.prototype,"updateSuspended",null),(0,s._)([(0,c.Cb)()],g.prototype,"visible",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"visibleAtCurrentScale",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"visibleAtCurrentTimeExtent",null),g=(0,s._)([(0,d.j)("esri.views.layers.LayerView")],g)},85754:function(e,t,i){i.d(t,{V5:function(){return r},e7:function(){return n},zc:function(){return a}});var s=i(76554);async function n(e,t=e.popupTemplate){if(null==t)return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:n}=t,{objectIdField:r,typeIdField:a,globalIdField:o,relationships:l}=e;if(i.includes("*"))return["*"];const h=n?(0,s.CH)(e):[],c=(0,s.Q0)(e.fieldsIndex,[...i,...h]);return a&&c.push(a),c&&r&&e.fieldsIndex?.has(r)&&!c.includes(r)&&c.push(r),c&&o&&e.fieldsIndex?.has(o)&&!c.includes(o)&&c.push(o),l&&l.forEach((t=>{const{keyField:i}=t;c&&i&&e.fieldsIndex?.has(i)&&!c.includes(i)&&c.push(i)})),c}function r(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function a(e,t){return null!=r(e,{defaultPopupTemplateEnabled:t})}}}]);