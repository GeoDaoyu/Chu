"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[32502],{41207:function(t,e,i){i.d(e,{S$:function(){return _},Ue:function(){return o},Ws:function(){return u},_k:function(){return a},iL:function(){return h}});var r=i(38949),n=i(24910),s=i(12659);function o(t){return t?{ray:(0,s.Ue)(t.ray),c0:t.c0,c1:t.c1}:{ray:(0,s.Ue)(),c0:0,c1:Number.MAX_VALUE}}function h(t,e=o()){return(0,s.JG)(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function a(t,e,i=o()){const r=(0,n.l)(t.vector);return(0,s.al)(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function u(t,e){return p(t,t.c0,e)}function _(t,e){return p(t,t.c1,e)}function p(t,e,i){return(0,n.f)(i,t.ray.origin,(0,n.g)(i,t.ray.direction,e))}new r.x((()=>o()))},33869:function(t,e,i){i.d(e,{Hf:function(){return v},JG:function(){return T},Jp:function(){return w},N9:function(){return F},NQ:function(){return n},Nu:function(){return r},Ue:function(){return f},Zr:function(){return m},g8:function(){return M},hr:function(){return g},q_:function(){return y},rN:function(){return O},xu:function(){return E},zq:function(){return R}});var r,n,s,o=i(38949),h=i(31865),a=i(24910),u=i(82846),_=i(73749),p=i(27583),c=i(41207),l=i(77773),d=i(69811);function f(t){return t?[(0,l.Ue)(t[0]),(0,l.Ue)(t[1]),(0,l.Ue)(t[2]),(0,l.Ue)(t[3]),(0,l.Ue)(t[4]),(0,l.Ue)(t[5])]:[(0,l.Ue)(),(0,l.Ue)(),(0,l.Ue)(),(0,l.Ue)(),(0,l.Ue)(),(0,l.Ue)()]}function v(){return[(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)()]}function T(t,e){for(let i=0;i<F;i++)(0,l.JG)(t[i],e[i]);return t}function y(t,e,i,r=C){const n=(0,h.Jp)(d.MP.get(),e,t);(0,h.U_)(n,n);for(let t=0;t<A;++t){const e=(0,_.t)(d.o6.get(),P[t],n);(0,a.i)(r[t],e[0]/e[3],e[1]/e[3],e[2]/e[3])}w(i,r)}function w(t,e){(0,l.zk)(e[n.FAR_BOTTOM_LEFT],e[n.NEAR_BOTTOM_LEFT],e[n.NEAR_TOP_LEFT],t[r.LEFT]),(0,l.zk)(e[n.NEAR_BOTTOM_RIGHT],e[n.FAR_BOTTOM_RIGHT],e[n.FAR_TOP_RIGHT],t[r.RIGHT]),(0,l.zk)(e[n.FAR_BOTTOM_LEFT],e[n.FAR_BOTTOM_RIGHT],e[n.NEAR_BOTTOM_RIGHT],t[r.BOTTOM]),(0,l.zk)(e[n.NEAR_TOP_LEFT],e[n.NEAR_TOP_RIGHT],e[n.FAR_TOP_RIGHT],t[r.TOP]),(0,l.zk)(e[n.NEAR_BOTTOM_LEFT],e[n.NEAR_BOTTOM_RIGHT],e[n.NEAR_TOP_RIGHT],t[r.NEAR]),(0,l.zk)(e[n.FAR_BOTTOM_RIGHT],e[n.FAR_BOTTOM_LEFT],e[n.FAR_TOP_LEFT],t[r.FAR])}function g(t,e){for(let i=0;i<F;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function m(t,e){return x(t,(0,c.iL)(e,b.get()))}function R(t,e){for(let i=0;i<F;i++){const r=t[i];if(!(0,l.Er)(r,e))return!1}return!0}function O(t,e,i){return x(t,(0,c._k)(e,i,b.get()))}function M(t,e){for(let i=0;i<F;i++)if((0,l.jH)(t[i],e)>0)return!1;return!0}function x(t,e){for(let i=0;i<F;i++)if(!(0,l.oq)(t[i],e))return!1;return!0}(s=r||(r={}))[s.LEFT=0]="LEFT",s[s.RIGHT=1]="RIGHT",s[s.BOTTOM=2]="BOTTOM",s[s.TOP=3]="TOP",s[s.NEAR=4]="NEAR",s[s.FAR=5]="FAR",function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(n||(n={}));const E={bottom:[n.FAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_LEFT,n.FAR_BOTTOM_LEFT],near:[n.NEAR_BOTTOM_LEFT,n.NEAR_BOTTOM_RIGHT,n.NEAR_TOP_RIGHT,n.NEAR_TOP_LEFT],far:[n.FAR_BOTTOM_RIGHT,n.FAR_BOTTOM_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_RIGHT],right:[n.NEAR_BOTTOM_RIGHT,n.FAR_BOTTOM_RIGHT,n.FAR_TOP_RIGHT,n.NEAR_TOP_RIGHT],left:[n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_TOP_LEFT,n.FAR_TOP_LEFT],top:[n.FAR_TOP_LEFT,n.NEAR_TOP_LEFT,n.NEAR_TOP_RIGHT,n.FAR_TOP_RIGHT]},F=6,A=8,P=[(0,p.al)(-1,-1,-1,1),(0,p.al)(1,-1,-1,1),(0,p.al)(1,1,-1,1),(0,p.al)(-1,1,-1,1),(0,p.al)(-1,-1,1,1),(0,p.al)(1,-1,1,1),(0,p.al)(1,1,1,1),(0,p.al)(-1,1,1,1)],b=new o.x(c.Ue),C=v()},90494:function(t,e,i){i.d(e,{Fb:function(){return s},KO:function(){return o},sb:function(){return n}});var r=i(27936);class n{constructor(t,e=null,i=0){this.array=t,this.spatialReference=e,this.offset=i}}function s(t){return"array"in t}function o(t,e,i="ground"){if((0,r.f)(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(s(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}},82915:function(t,e,i){i.d(e,{as:function(){return n},t9:function(){return o}});var r=i(63974);class n{constructor(){this.adds=new r.Z,this.removes=new r.Z,this.updates=new r.Z({allocator:t=>t||new s,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class s{}class o{constructor(t){this.pending=t,this.adds=new Array,this.removes=new Array,this.updates=new Array}clearAddsAndRemoves(){this.adds.forEach((t=>this.pending.adds.removeUnordered(t))),this.removes.forEach((t=>this.pending.removes.removeUnordered(t))),this.adds.length=0,this.removes.length=0}clearUpdates(){this.updates.forEach((t=>this.pending.updates.removeUnordered(t))),this.updates.length=0}clear(){this.clearUpdates(),this.clearAddsAndRemoves()}}},92181:function(t,e,i){i.d(e,{i_:function(){return h},w0:function(){return a},Wd:function(){return u}});var r=i(82846),n=i(32033),s=i(19821);class o{constructor(t,e,i){this.object=t,this.geometryId=e,this.primitiveIndex=i}}class h extends n.x{constructor(){super(...arguments),this.intersector=s.q.HUD}}class a extends o{constructor(t,e){super(t.object,t.geometryId,t.primitiveIndex),this.center=(0,r.d9)(e)}}function u(t){return(0,n.n)(t)&&t.intersector===s.q.HUD&&!!t.target&&"center"in t.target}},92490:function(t,e,i){i.d(e,{j:function(){return l},r:function(){return d}});var r=i(24910),n=i(82846),s=i(12659),o=i(56172),h=i(48636),a=i(92181),u=i(61442),_=i(32033),p=i(19821),c=i(43925);const l=1e-5;class d{constructor(t){this.options=new u.o,this._results=new v,this.transform=new c.yn,this.camera=new h.Z,this.tolerance=l,this.verticalOffset=null,this._ray=(0,s.Ue)(),this._rayEnd=(0,n.Ue)(),this._rayBeginTransformed=(0,n.Ue)(),this._rayEndTransformed=(0,n.Ue)(),this.viewingMode=t??o.JY.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,e,i){this.resetWithRay((0,s.zk)(t,e,this._ray),i)}resetWithRay(t,e){this.camera=e,t!==this._ray&&(0,s.JG)(t,this._ray),0!==this.options.verticalOffset?this.viewingMode===o.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,r.f)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,e,i,r,n){this.point=e,this.filterPredicate=r,this.tolerance=i??l;const s=(0,c.W9)(this.verticalOffset);if(t&&t.length>0){const e=n?t=>{n(t)&&this.intersectObject(t)}:t=>{this.intersectObject(t)};for(const i of t){const t=i.getSpatialQueryAccelerator?.();null!=t?(null!=s?t.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,e,s):t.forEachAlongRay(this._ray.origin,this._ray.direction,e),this.options.selectionMode&&this.options.hud&&t.forEachDegenerateObject(e)):i.objects.forEach((t=>e(t)))}}this.sortResults()}intersectObject(t){const e=t.geometries;if(!e)return;const i=t.effectiveTransformation,n=(0,c.W9)(this.verticalOffset);for(const s of e){if(!s.visible)continue;const{material:e,id:o}=s;if(!e.visible)continue;this.transform.setAndInvalidateLazyTransforms(i,s.transformation),(0,r.t)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,r.t)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;null!=n&&(n.objectTransform=this.transform),e.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((e,i,r,n)=>this.handleObjectIntersection({object:t,geometryId:o,primitiveIndex:r},e,i,h,n)))}}handleObjectIntersection(t,e,i,r,n){if(e<0||null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,e))return;const s=n?this._results.hud:this._results;t=n?new a.w0(t,n):t;const o=n?r=>r.set(p.q.HUD,t,e,i):n=>n.set(p.q.OBJECT,t,e,i,r);if((null==s.min.distance||e<s.min.distance)&&o(s.min),this.options.store!==u.e.MIN&&(null==s.max.distance||e>s.max.distance)&&o(s.max),this.options.store===u.e.ALL)if(n){const t=new a.i_(this._ray);o(t),this._results.hud.all.push(t)}else{const t=new _.x(this._ray);o(t),this._results.all.push(t)}}sortResults(t=this._results.all){t.sort(((t,e)=>t.distance!==e.distance?(t.distance??0)-(e.distance??0):t.drapedLayerOrder!==e.drapedLayerOrder?f(t.drapedLayerOrder,e.drapedLayerOrder):f(t.renderPriority,e.renderPriority)))}}function f(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}class v{constructor(){this.min=new _.x((0,s.Ue)()),this.max=new _.x((0,s.Ue)()),this.hud={min:new a.i_((0,s.Ue)()),max:new a.i_((0,s.Ue)()),all:new Array},this.ground=new _.x((0,s.Ue)()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}},10517:function(t,e,i){i.d(e,{Np:function(){return n},YE:function(){return r},q9:function(){return h}});var r,n,s,o=i(82915);function h(t){const e=new Map,i=i=>{let r=e.get(i);return r||(r=new o.t9(t),e.set(i,r)),r};return t.removes.forAll((t=>{a(t)&&i(t.material).removes.push(t)})),t.adds.forAll((t=>{a(t)&&i(t.material).adds.push(t)})),t.updates.forAll((t=>{a(t.renderGeometry)&&i(t.renderGeometry.material).updates.push(t)})),e}function a(t){return t.geometry.indexCount>=1}(s=r||(r={}))[s.Default=0]="Default",s[s.Screenshot=1]="Screenshot",s[s.ObjectAndLayerID=2]="ObjectAndLayerID",function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(n||(n={}))},48636:function(t,e,i){i.d(e,{Z:function(){return x}});var r=i(73440),n=i(70880),s=i(96711),o=i(99574),h=i(96094),a=i(17155),u=(i(61432),i(83850),i(48023)),_=i(31865),p=i(10934),c=i(26821),l=i(41788),d=i(24910),f=i(82846),v=i(73749),T=i(27583),y=i(33869),w=i(12659),g=i(63271),m=i(56172);var R,O=i(10517);let M=R=class extends n.Z{constructor(t){super(t),this._ray=(0,w.Ue)(),this._viewport=(0,T.al)(0,0,1,1),this._padding=(0,T.al)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,l.al)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,p.Ue)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,p.Ue)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,p.Ue)(),this._frustumDirty=!0,this._frustum=(0,y.Ue)(),this._fullViewport=(0,T.Ue)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,f.Ue)(),this._up=(0,f.Ue)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return(0,d.d)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){(0,_.JG)(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,d.i)((0,f.Ue)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,d.i)((0,f.Ue)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,d.i)((0,f.Ue)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const t=(0,v.d)((0,T.Ue)(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&(0,v.e)(t,e)?e:t}get screenPadding(){if(1===this.pixelRatio)return this._padding;const t=(0,v.d)((0,T.Ue)(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&(0,v.e)(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[O.Np.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[O.Np.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[O.Np.RIGHT]+this._padding[O.Np.LEFT]}set fullWidth(t){this.width=t-(this._padding[O.Np.RIGHT]+this._padding[O.Np.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[O.Np.TOP]+this._padding[O.Np.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[O.Np.TOP]+this._padding[O.Np.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[O.Np.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[O.Np.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){(0,v.a)(this._padding,t)||(this._viewport[0]+=t[O.Np.LEFT]-this._padding[O.Np.LEFT],this._viewport[1]+=t[O.Np.BOTTOM]-this._padding[O.Np.BOTTOM],this._viewport[2]-=t[O.Np.RIGHT]+t[O.Np.LEFT]-(this._padding[O.Np.RIGHT]+this._padding[O.Np.LEFT]),this._viewport[3]-=t[O.Np.TOP]+t[O.Np.BOTTOM]-(this._padding[O.Np.TOP]+this._padding[O.Np.BOTTOM]),(0,v.c)(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,_.Jp)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,_.U_)((0,p.Ue)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,p.Ue)()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}(this._fov,this.width,this.height)}set fovX(t){this._fov=function(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}(this._fov,this.width,this.height)}set fovY(t){this._fov=function(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,d.j)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,_.U_)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,_.p4)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const{near:e,far:i}=this;return 2*e*i/(i+e-t*(i-e))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,n=i/this.rows,s=r/this.columns,o=-r/2+this.column*s,h=o+s,a=-i/2+this.row*n,u=a+n,c=(0,_.oy)((0,p.Ue)(),o*(1+2*this._padding[O.Np.LEFT]/t),h*(1+2*this._padding[O.Np.RIGHT]/t),a*(1+2*this._padding[O.Np.BOTTOM]/e),u*(1+2*this._padding[O.Np.TOP]/e),this.near,this.far),l=this._get("projectionMatrix");return l&&(0,_.fS)(l,c)?l:c}copyFrom(t){(0,d.c)(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,(0,v.c)(this._viewport,t.viewport),this.notifyChange("_viewport"),(0,v.c)(this._padding,t.padding),this.notifyChange("_padding"),(0,c.JG)(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||((0,_.JG)(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||((0,y.JG)(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,_.JG)(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,v.c)(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up,this.fov=t.fov}clone(){return(new R).copyFrom(this)}equals(t){return(0,d.q)(this.eye,t.eye)&&(0,d.q)(this.center,t.center)&&(0,d.q)(this.up,t.up)&&(0,v.a)(this._viewport,t.viewport)&&(0,v.a)(this._padding,t.padding)&&(0,c.I6)(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||(0,v.f)(t.screenPadding,this.screenPadding)>=e||(0,v.f)(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;(0,d.a)(A,t.eye,t.center),(0,d.a)(P,this.eye,this.center);const i=(0,d.e)(A,P),r=(0,d.y)(A),n=(0,d.y)(P),s=5e-4;return i*i>=(1-1e-10)*r*n&&(0,d.x)(t.eye,this.eye)<Math.max(r,n)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs((0,g.SR)(this.viewForward,(0,d.d)(A,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=(0,h.s1)()){return t[0]=(this.padding[O.Np.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[O.Np.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[O.Np.LEFT]+this.width*e,t[1]=this.padding[O.Np.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==E&&(0,d.c)(E,t),E[3]=1,(0,v.t)(E,E,this.projectionMatrix);const i=Math.abs(E[3]);(0,d.g)(E,E,1/i);const r=this.fullViewport;e[0]=(0,o.t7)(0,r[0]+r[2],.5+.5*E[0]),e[1]=(0,o.t7)(0,r[1]+r[3],.5+.5*E[1]),e[2]=.5*(E[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;E[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],E[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],E[2]=(2*t[2]-1)*t[3],E[3]=t[3],null!=this.inverseProjectionMatrix&&((0,v.t)(E,E,this.inverseProjectionMatrix),e[0]=E[0],e[1]=E[1],e[2]=E[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,b),this.renderToScreen(b,e),e}projectToRenderScreen(t,e){if(E[0]=t[0],E[1]=t[1],E[2]=t[2],E[3]=1,(0,v.t)(E,E,this.viewProjectionMatrix),0===E[3])return null;const i=E;(0,d.g)(i,i,1/Math.abs(E[3]));const r=this.fullViewport,n=(0,o.t7)(0,r[0]+r[2],.5+.5*i[0]),s=(0,o.t7)(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=n,e.y=s):(e[0]=n,e[1]=s,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,b),e)}unprojectFromRenderScreen(t,e){if((0,_.Jp)(F,this.projectionMatrix,this.viewMatrix),!(0,_.U_)(F,F))return null;const i=this.fullViewport;return E[0]=2*(t[0]-i[0])/i[2]-1,E[1]=2*(t[1]-i[1])/i[3]-1,E[2]=2*t[2]-1,E[3]=1,(0,v.t)(E,E,F),0===E[3]?null:(e[0]=E[0]/E[3],e[1]=E[1]/E[3],e[2]=E[2]/E[3],e)}constrainWindowSize(t,e,i,r){const n=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(n-i/2,0),h=Math.max(this.fullHeight-s-r/2,0),a=-Math.min(n-i/2,0),u=-Math.min(this.fullHeight-s-r/2,0),_=i-a- -Math.min(this.fullWidth-n-i/2,0),p=r-u- -Math.min(s-r/2,0);return[Math.round(o),Math.round(h),Math.round(_),Math.round(p)]}computeUp(t){t===m.JY.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){(0,d.d)(A,this.center,this.eye);const t=(0,d.l)(this.center);t<1?((0,d.i)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,d.e)(A,this.center))>.9999*(0,d.l)(A)*t||((0,d.h)(this._up,A,this.center),(0,d.h)(this._up,this._up,A),(0,d.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,d.E)(A,this.eye,this.center),Math.abs(A[2])<=.9999&&((0,d.g)(A,A,A[2]),(0,d.i)(this._up,-A[0],-A[1],1-A[2]),(0,d.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){"number"==typeof t[0]&&isFinite(t[0])&&"number"==typeof t[1]&&isFinite(t[1])&&"number"==typeof t[2]&&isFinite(t[2])?(0,d.q)(t,e)||((0,d.c)(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):s.Z.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,y.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,_.zB)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,r._)([(0,a.Cb)()],M.prototype,"_viewport",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"_padding",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"_fov",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"_nearFar",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"_viewDirty",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"_viewMatrix",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"_pixelRatio",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"pixelRatio",null),(0,r._)([(0,a.Cb)()],M.prototype,"row",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"column",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"_rows",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"rows",null),(0,r._)([(0,a.Cb)()],M.prototype,"_columns",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"columns",null),(0,r._)([(0,a.Cb)()],M.prototype,"eye",null),(0,r._)([(0,a.Cb)()],M.prototype,"center",null),(0,r._)([(0,a.Cb)()],M.prototype,"_center",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"up",null),(0,r._)([(0,a.Cb)()],M.prototype,"_up",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"viewMatrix",null),(0,r._)([(0,a.Cb)({readOnly:!0})],M.prototype,"viewForward",null),(0,r._)([(0,a.Cb)({readOnly:!0})],M.prototype,"viewUp",null),(0,r._)([(0,a.Cb)({readOnly:!0})],M.prototype,"viewRight",null),(0,r._)([(0,a.Cb)({readOnly:!0})],M.prototype,"nearFar",null),(0,r._)([(0,a.Cb)()],M.prototype,"near",null),(0,r._)([(0,a.Cb)()],M.prototype,"far",null),(0,r._)([(0,a.Cb)()],M.prototype,"viewport",null),(0,r._)([(0,a.Cb)({readOnly:!0})],M.prototype,"screenViewport",null),(0,r._)([(0,a.Cb)({readOnly:!0})],M.prototype,"screenPadding",null),(0,r._)([(0,a.Cb)()],M.prototype,"x",null),(0,r._)([(0,a.Cb)()],M.prototype,"y",null),(0,r._)([(0,a.Cb)()],M.prototype,"width",null),(0,r._)([(0,a.Cb)()],M.prototype,"height",null),(0,r._)([(0,a.Cb)()],M.prototype,"fullWidth",null),(0,r._)([(0,a.Cb)()],M.prototype,"fullHeight",null),(0,r._)([(0,a.Cb)({readOnly:!0})],M.prototype,"_aspect",null),(0,r._)([(0,a.Cb)()],M.prototype,"padding",null),(0,r._)([(0,a.Cb)({readOnly:!0})],M.prototype,"projectionMatrix",null),(0,r._)([(0,a.Cb)({readOnly:!0})],M.prototype,"inverseProjectionMatrix",null),(0,r._)([(0,a.Cb)()],M.prototype,"fov",null),(0,r._)([(0,a.Cb)()],M.prototype,"fovX",null),(0,r._)([(0,a.Cb)()],M.prototype,"fovY",null),(0,r._)([(0,a.Cb)()],M.prototype,"viewInverseTransposeMatrix",null),(0,r._)([(0,a.Cb)({readOnly:!0})],M.prototype,"_projectionMatrixInternal",null),(0,r._)([(0,a.Cb)()],M.prototype,"relativeElevation",void 0),M=R=(0,r._)([(0,u.j)("esri.views.3d.webgl.RenderCamera")],M);const x=M,E=(0,T.Ue)(),F=(0,p.Ue)(),A=(0,f.Ue)(),P=(0,f.Ue)(),b=(0,h.J$)()}}]);