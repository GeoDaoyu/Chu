"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[12742],{12853:function(e,t,r){r.d(t,{z:function(){return n}});var i=r(69071);class n{constructor(e,t){this.removeFunc=t,this._storage=new i.WJ,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},58174:function(e,t,r){r.d(t,{Z:function(){return g}});var i,n=r(73440),s=r(41773),o=r(63255),l=r(28947),a=r(17155),u=(r(61432),r(96711),r(48023)),d=r(98842),c=r(29191),h=r(85913);const p=new s.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),f=new s.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let y=i=class extends o.Z{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:i,timeExtent:n,objectIds:s,units:o,distance:a}=this;return new c.Z({geometry:(0,l.d9)(r),objectIds:(0,l.d9)(s),spatialRelationship:i,timeExtent:(0,l.d9)(n),where:t,units:o,distance:a,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,timeExtent:n,objectIds:s,units:o,distance:a}=this;return new i({geometry:(0,l.d9)(t),objectIds:(0,l.d9)(s),spatialRelationship:r,timeExtent:(0,l.d9)(n),where:e,units:o,distance:a})}};(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],y.prototype,"where",void 0),(0,n._)([(0,a.Cb)({types:d.qM,json:{write:!0}})],y.prototype,"geometry",void 0),(0,n._)([(0,a.Cb)({type:p.apiValues,json:{name:"spatialRel",read:{reader:p.read},write:{allowNull:!1,writer:p.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],y.prototype,"spatialRelationship",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{write:{overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],y.prototype,"distance",void 0),(0,n._)([(0,a.Cb)({type:[Number],json:{write:!0}})],y.prototype,"objectIds",void 0),(0,n._)([(0,a.Cb)({type:f.apiValues,json:{read:f.read,write:{writer:f.write,overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],y.prototype,"units",void 0),(0,n._)([(0,a.Cb)({type:h.T,json:{write:!0}})],y.prototype,"timeExtent",void 0),y=i=(0,n._)([(0,u.j)("esri.layers.support.FeatureFilter")],y);const g=y},87802:function(e,t,r){r.d(t,{UK:function(){return n},qo:function(){return s}});var i=r(29191);async function n(e,t,r){t=t.clone(),e.capabilities.query.supportsMaxRecordCountFactor&&(t.maxRecordCountFactor=o(e));const i=s(e),n=e.capabilities.query.supportsPagination;t.start=0,t.num=i;let l=null;for(;;){const s=await e.source.queryFeaturesJSON(t,r);if(null==l?l=s:l.features=l.features.concat(s.features),l.exceededTransferLimit=s.exceededTransferLimit,!n||!s.exceededTransferLimit)break;t.start+=i}return l}function s(e){return o(e)*function(e){return e.capabilities.query.maxRecordCount||2e3}(e)}function o(e){return e.capabilities.query.supportsMaxRecordCountFactor?i.Z.MAX_MAX_RECORD_COUNT_FACTOR:1}},44695:function(e,t,r){function i(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?s(e.view.floors,t.floorInfo.floorField):null}function n(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(!e?.length)return null;const r=e.filter((e=>""!==e)).map((e=>`'${e}'`));return r.push("''"),`${t} IN (${r.join(",")}) OR ${t} IS NULL`}r.d(t,{c:function(){return i},f:function(){return n}})},13878:function(e,t,r){r.d(t,{Z:function(){return _}});var i,n=r(73440),s=r(46451),o=r(41773),l=r(63255),a=r(28947),u=r(17155),d=(r(61432),r(96711),r(1194)),c=r(48023),h=r(29884),p=r(45213),f=r(90756),y=r(98842),g=r(49651);const m=new o.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let _=i=class extends l.Z{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){return this.readFeaturesWithClass(e,t,s.Z)}writeGeometryType(e,t,r,i){if(e)return void m.write(e,t,r,i);const{features:n}=this;if(n)for(const e of n)if(null!=e?.geometry)return void m.write(e.geometry.type,t,r,i)}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,i=(0,f.im)(e);return i&&!r&&t.spatialReference&&(i.spatialReference=p.Z.fromJSON(t.spatialReference)),i}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r)for(const e of r)if(e&&null!=e.geometry&&e.geometry.spatialReference)return void(t.spatialReference=e.geometry.spatialReference.toJSON())}clone(){return new i(this.cloneProperties())}cloneProperties(){return(0,a.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const i=t.features[r];if(i.geometry){const t=e?.[r];i.geometry=t?.toJSON()||i.geometry}}return t}quantize(e){const{scale:[t,r],translate:[i,n]}=e,s=this.features,o=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-i)/t)),(e=>Math.round((n-e)/r)));for(let e=0,t=s.length;e<t;e++)o?.(s[e].geometry)||(s.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[i,n],scale:[s,o]}=r;let l=null,a=null;if(this.hasZ&&null!=r?.scale?.[2]){const{translate:[,,e],scale:[,,t]}=r;l=r=>r*t+e}if(this.hasM&&null!=r?.scale?.[3]){const{translate:[,,,e],scale:[,,,t]}=r;a=r=>null==r?r:r*t+e}const u=this._getHydrationFunction(e,(e=>e*s+i),(e=>n-e*o),l,a);for(const{geometry:e}of t)null!=e&&u&&u(e);return this.transform=null,this}readFeaturesWithClass(e,t,r){const i=p.Z.fromJSON(t.spatialReference),n=[];for(let t=0;t<e.length;t++){const s=e[t],o=r.fromJSON(s),l=s.geometry?.spatialReference;null==o.geometry||l||(o.geometry.spatialReference=i);const a=s.aggregateGeometries,u=o.aggregateGeometries;if(a&&null!=u)for(const e in u){const t=u[e],r=a[e]?.spatialReference;null==t||r||(t.spatialReference=i)}n.push(o)}return n}_quantizePoints(e,t,r){let i,n;const s=[];for(let o=0,l=e.length;o<l;o++){const l=e[o];if(o>0){const e=t(l[0]),o=r(l[1]);e===i&&o===n||(s.push([e-i,o-n]),i=e,n=o)}else i=t(l[0]),n=r(l[1]),s.push([i,n])}return s.length>0?s:null}_getQuantizationFunction(e,t,r){return"point"===e?e=>(e.x=t(e.x),e.y=r(e.y),e):"polyline"===e||"polygon"===e?e=>{const i=(0,f.oU)(e)?e.rings:e.paths,n=[];for(let e=0,s=i.length;e<s;e++){const s=i[e],o=this._quantizePoints(s,t,r);o&&n.push(o)}return n.length>0?((0,f.oU)(e)?e.rings=n:e.paths=n,e):null}:"multipoint"===e?e=>{const i=this._quantizePoints(e.points,t,r);return i&&i.length>0?(e.points=i,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,r,i,n){return"point"===e?e=>{e.x=t(e.x),e.y=r(e.y),i&&(e.z=i(e.z))}:"polyline"===e||"polygon"===e?e=>{const s=(0,f.oU)(e)?e.rings:e.paths;let o,l;for(let e=0,i=s.length;e<i;e++){const i=s[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];e>0?(o+=n[0],l+=n[1]):(o=n[0],l=n[1]),n[0]=t(o),n[1]=r(l)}}if(i&&n)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=i(r[2]),r[3]=n(r[3])}}else if(i)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=i(r[2])}}else if(n)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=n(r[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax),i&&null!=e.zmax&&null!=e.zmin&&(e.zmax=i(e.zmax),e.zmin=i(e.zmin)),n&&null!=e.mmax&&null!=e.mmin&&(e.mmax=n(e.mmax),e.mmin=n(e.mmin))}:"multipoint"===e?e=>{const s=e.points;let o,l;for(let e=0,i=s.length;e<i;e++){const i=s[e];e>0?(o+=i[0],l+=i[1]):(o=i[0],l=i[1]),i[0]=t(o),i[1]=r(l)}if(i&&n)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=i(t[2]),t[3]=n(t[3])}else if(i)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=i(t[2])}else if(n)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=n(t[2])}}:null}};(0,n._)([(0,u.Cb)({type:String,json:{write:!0}})],_.prototype,"displayFieldName",void 0),(0,n._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],_.prototype,"exceededTransferLimit",void 0),(0,n._)([(0,u.Cb)({type:[s.Z],json:{write:!0}})],_.prototype,"features",void 0),(0,n._)([(0,d.r)("features")],_.prototype,"readFeatures",null),(0,n._)([(0,u.Cb)({type:[g.Z],json:{write:!0}})],_.prototype,"fields",void 0),(0,n._)([(0,u.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:m.read}}})],_.prototype,"geometryType",void 0),(0,n._)([(0,h.c)("geometryType")],_.prototype,"writeGeometryType",null),(0,n._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],_.prototype,"hasM",void 0),(0,n._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],_.prototype,"hasZ",void 0),(0,n._)([(0,u.Cb)({types:y.qM,json:{write:!0}})],_.prototype,"queryGeometry",void 0),(0,n._)([(0,d.r)("queryGeometry")],_.prototype,"readQueryGeometry",null),(0,n._)([(0,u.Cb)({type:p.Z,json:{write:!0}})],_.prototype,"spatialReference",void 0),(0,n._)([(0,h.c)("spatialReference")],_.prototype,"writeSpatialReference",null),(0,n._)([(0,u.Cb)({json:{write:!0}})],_.prototype,"transform",void 0),_=i=(0,n._)([(0,c.j)("esri.rest.support.FeatureSet")],_),_.prototype.toJSON.isDefaultToJSON=!0},29834:function(e,t,r){r.r(t),r.d(t,{default:function(){return U}});var i=r(73440),n=r(46451),s=r(96711),o=r(61100),l=r(93568),a=r(44710),u=r(90403),d=r(17155),c=(r(61432),r(83850),r(48023)),h=r(50718),p=r(58174),f=r(44695),y=r(29191),g=r(43462),m=r(61197),_=r(52192),b=r(24381),F=r(25925),w=r(22241),v=r(28866),I=r(23996),x=r(48081),C=r(25624),E=r(417),S=r(71457),R=r(52695),j=r(91826),O=r(20132),A=r(76945),N=r(65073),q=r(50506),L=r(81808),T=r(40329),P=r(85754),M=r(43295),Z=r(27546),H=r(50399);const G=(0,O.v)();let Q=class extends((0,m.N)((0,q.q)((0,j.l)((0,A.i)((0,b.A)(T.Z)))))){constructor(){super(...arguments),this.type="scene-layer-3d",this.viewFilter=null,this._setVisibilityHiddenObjectIds=new a.Z,this.progressiveLoadFactor=1,this._elevationContext="scene",this._supportsLabeling=!0,this._pendingEditsQueue=Promise.resolve(),this._interactiveEditingSessions=new Map,this._queryEngine=null}get i3slayer(){return this.layer}tryRecycleWith(e,t){return e.url===this.layer.url&&this.i3sOverrides.isEmpty?e.load(t).then((()=>{(0,l.k_)(t),(0,R.tq)(this.layer,e,this.i3sOverrides),this.layer=e,this.i3sOverrides.destroy();const r=this.view.resourceController?.memoryController;this.i3sOverrides=new x.v({view:this.view,layer:e,memoryController:r}),this.resetHighlights()})):null}get layerPopupEnabledAndHasTemplate(){return this.layer.popupEnabled&&(0,P.zc)(this.layer,this.view.popup?.defaultPopupTemplateEnabled)}get filter(){return this._get("filter")}set filter(e){this._set("filter",v.z.checkSupport(e)?e:null)}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get _floorFilterClause(){const e=(0,f.c)(this);return null!=e?h.default.create(e,{fieldsIndex:this.layer.fieldsIndex}):null}get _excludeObjectIdsSorted(){const e=this.layer.excludeObjectIds.toArray();return e.length?e.sort(((e,t)=>e-t)):null}get _setVisibilityHiddenObjectIdsSorted(){return this._setVisibilityHiddenObjectIds.size?Array.from(this._setVisibilityHiddenObjectIds).sort(((e,t)=>e-t)):null}get lodFactor(){return this.view?.qualitySettings?.sceneService?.object?.lodFactor??1}get lodCrossfadeUncoveredDuration(){return this.view?.qualitySettings?.fadeDuration??0}get updatingProgressValue(){return this._controller?.updatingProgress??0}get visibleAtCurrentScale(){return(0,Z.GB)(this.i3slayer.effectiveScaleRange,this.view.scale)}initialize(){this._fieldsHelper=new N.K({layerView:this}),this._updatingHandles.add((()=>this.layer.rangeInfos),(e=>this._rangeInfosChanged(e)),u.nn),this._updatingHandles.add((()=>this.layer.renderer),(e=>this._updatingHandles.addPromise(this._rendererChange(e))),u.nn);const e=()=>this._filterChange();this._updatingHandles.add((()=>this.parsedDefinitionExpression),e),this._updatingHandles.add((()=>this.mergedFilter),e),this._updatingHandles.add((()=>this._floorFilterClause),e),this._updatingHandles.add((()=>this._excludeObjectIdsSorted),e),this._updatingHandles.add((()=>this._setVisibilityHiddenObjectIdsSorted),e),this._updatingHandles.add((()=>this.viewFilter?.sortedObjectIds),e),this._updatingHandles.add((()=>this.viewFilter?.parsedWhereClause),e),this._updatingHandles.add((()=>this.getTimeFilterDependencies()),e),this._updatingHandles.add((()=>[this.viewFilter?.parsedGeometry,this.mergedFilter?.spatialRelationship,this.layer.filter?.spatialRelationship]),(()=>this._geometryFilterChange())),this._updatingHandles.add((()=>({layerViewFilter:this.mergedFilter,layerFilter:this.layerFilter})),(({layerViewFilter:e,layerFilter:t})=>{if(null==e&&null==t)return void this._set("viewFilter",null);const r=this.viewFilter;if(r)return r.viewFilter=e,r.layerFilter=t,void this._filterChange();this._set("viewFilter",new v.z({layerFilter:t,viewFilter:e,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:e=>this._loadAsyncModule(e),addSqlFilter:(e,t)=>this.addSqlFilter(e,t,this.logError),addTimeFilter:(e,t)=>this.addTimeFilter(e,t)}))}),u.nn),this.i3sOverrides.is3DOFL&&this._updatingHandles.add((()=>this.i3sOverrides.sortedGeometryChangedObjectIds),e),this.addHandles(this.layer.on("apply-edits",(e=>this._updatingHandles.addPromise(e.result)))),this.addHandles(this.layer.on("edits",(e=>{const t=this._pendingEditsQueue.then((()=>this._handleEdits(e))).then();this._pendingEditsQueue=t,this._updatingHandles.addPromise(t)})))}destroy(){this._fieldsHelper=(0,o.SC)(this._fieldsHelper)}_rangeInfosChanged(e){null!=e&&e.length>0&&s.Z.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const e={outFields:["*"],returnGeometry:!0,returnZ:!0,outSpatialReference:this.view.spatialReference};return this.mergedFilter?.createQuery(e)??new y.Z(e)}queryExtent(e,t){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),t?.signal)}queryFeatureCount(e,t){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),t?.signal)}queryFeatures(e,t){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),t?.signal).then((e=>{if(!e?.features)return e;const t=this.layer;for(const r of e.features)r.layer=t,r.sourceLayer=t;return e}))}async queryObjectIds(e,t){return(await this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),t?.signal)).filter(g.hj)}_ensureQueryEngine(){return this._queryEngine??=this._createQueryEngine(),this._queryEngine}_createQueryEngine(){const e=(0,w.gz)(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new C.u({layerView:this,priority:H.T8.FEATURE_QUERY_ENGINE,spatialIndex:new S.I({featureAdapter:new E.u({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo??[],getFeatureExtent:e}),forAllFeatures:(e,t)=>this._forAllFeatures(((t,r,i)=>e(new E.w(t,r,i))),t,_.p1.QUERYABLE),getFeatureExtent:e,sourceSpatialReference:(0,R.tp)(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(e,t){const r=this._highlights,i=t?.name??M.b;if(e instanceof y.Z){const{set:t,handle:n}=r.acquireSet(i);return this.queryObjectIds(e).then((e=>r.setFeatureIds(t,e))),n}return super.highlight(e,t)}createInteractiveEditSession(e){return(0,F.sw)(this._attributeEditingContext,e)}_createLayerGraphic(e){return new n.Z({attributes:e,layer:this.layer,sourceLayer:this.layer})}getFilters(){const e=super.getFilters();this.i3sOverrides.is3DOFL&&this.i3sOverrides.sortedGeometryChangedObjectIds.length>0&&e.push(((e,t)=>{t.node.index>=0&&(0,R.Yb)(this.i3sOverrides.sortedGeometryChangedObjectIds,!1,e)}));const t=this._setVisibilityHiddenObjectIdsSorted;null!=t&&e.push((e=>(0,R.Yb)(t,!1,e)));const r=this._excludeObjectIdsSorted;return null!=r&&e.push((e=>(0,R.Yb)(r,!1,e))),this._floorFilterClause&&this.addSqlFilter(e,this._floorFilterClause,this.logError),this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),null!=this.viewFilter&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}setVisibility(e,t){t?this._setVisibilityHiddenObjectIds.delete(e):this._setVisibilityHiddenObjectIds.add(e)}isUpdating(){return super.isUpdating()||this.layerFilterUpdating||null!=this.viewFilter&&this.viewFilter.updating||null!=this.i3sOverrides&&this.i3sOverrides.updating}_ensureQuery(e){return this._validateQuery(this._addDefinitionExpressionToQuery(null==e?this.createQuery():y.Z.from(e)))}_validateQuery(e){return e.outSpatialReference&&!e.outSpatialReference.equals(this.view.spatialReference)&&(s.Z.getLogger(this).warn("query: outSpatialReference different from the view's spatial reference is not supported"),e.outSpatialReference=this.view.spatialReference),e.returnGeometry&&(e.returnZ=!0),e.returnCentroid=!1,e}get _attributeEditingContext(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),globalIdField:this._getGlobalIdField(),forEachNode:e=>this._forAllNodes((t=>null!=t?e(t.node,t.featureIds):null)),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this.i3sOverrides,getAttributeData:e=>this.getAttributeData(e),setAttributeData:(e,t)=>this.setAttributeData(e,t),clearMemCache:()=>this.clearMemCache()}}async _handleEdits(e){const t=this._attributeEditingContext,r=await(0,F.Qw)(t,e);(0,F.ZS)(t,r),(0,F.Z6)(t,r)}get hasGeometryFilter(){return null!=this.viewFilter?.parsedGeometry}computeNodeFiltering(e){const t=this.viewFilter;return null==t||!this.view.spatialReference||t.isMBSGeometryVisible(e,this.view.spatialReference,this._controller.crsIndex)?I.U_.Unmodified:I.U_.Culled}};(0,i._)([(0,d.Cb)()],Q.prototype,"i3slayer",null),(0,i._)([(0,d.Cb)(L.q)],Q.prototype,"updatingProgress",void 0),(0,i._)([(0,d.Cb)({type:p.Z})],Q.prototype,"filter",null),(0,i._)([(0,d.Cb)({readOnly:!0})],Q.prototype,"viewFilter",void 0),(0,i._)([(0,d.Cb)(G.requiredFields)],Q.prototype,"requiredFields",null),(0,i._)([(0,d.Cb)(G.availableFields)],Q.prototype,"availableFields",void 0),(0,i._)([(0,d.Cb)()],Q.prototype,"_fieldsHelper",void 0),(0,i._)([(0,d.Cb)()],Q.prototype,"_floorFilterClause",null),(0,i._)([(0,d.Cb)()],Q.prototype,"_excludeObjectIdsSorted",null),(0,i._)([(0,d.Cb)()],Q.prototype,"_setVisibilityHiddenObjectIds",void 0),(0,i._)([(0,d.Cb)()],Q.prototype,"_setVisibilityHiddenObjectIdsSorted",null),(0,i._)([(0,d.Cb)()],Q.prototype,"lodFactor",null),(0,i._)([(0,d.Cb)()],Q.prototype,"updatingProgressValue",null),(0,i._)([(0,d.Cb)({readOnly:!0})],Q.prototype,"visibleAtCurrentScale",null),Q=(0,i._)([(0,c.j)("esri.views.3d.layers.SceneLayerView3D")],Q);const U=Q},25925:function(e,t,r){r.d(t,{Qw:function(){return p},Z6:function(){return y},ZS:function(){return f},sw:function(){return d}});var i=r(29292),n=r(28947),s=r(18764),o=r(87802);const l={setAttribute(){},rollback(){},commit(){}};var a,u;function d(e,t){const r=t.attributes[e.objectIdField];if(null==r)return l;const i=e.sessions.get(r);if(i)return i;const s=(0,n.d9)(t.attributes),o=new Set,u=e.i3sOverrides.createInteractiveEditSession(r),d=new Map,c=(e,t)=>{const i=d.get(e);if(null==i){const i=t.indexOf(r);return d.set(e,i),i}return i};let h=a.EDITING;const p={setAttribute(r,i){if(h!==a.EDITING)return;const n=e.fieldsIndex.get(r);if(!n)return;const l=e.attributeStorageInfo.findIndex((e=>e.name===n.name));if(l<0)return;if(!(r in s))throw new Error(`Attribute "${r}" is not an attribute of the edited feature.`);u.setAttribute(l,i);const d=e.attributeStorageInfo[l];let p=!1;o.add(r),e.forEachNode(((r,n)=>{const s=c(r,n);if(-1===s)return;const o=e.getAttributeData(r.index);if(o){const n=o[d.name];n&&(n[s]=i,e.setAttributeData(r.index,o,t),p=!0)}})),p&&e.clearMemCache()},rollback(){if(h===a.EDITING){for(const e of o)this.setAttribute(e,s[e]);u.remove(),h=a.ROLLED_BACK,e.sessions.delete(r)}},commit(){h===a.EDITING&&(u.remove(),h=a.COMMITTED,e.sessions.delete(r))}};return e.sessions.set(r,p),p}function c(e,t,r){const{gidToFeatureInfo:i,oidToFeatureInfo:n,fieldsIndex:s,objectIdField:o,globalIdField:l,featureOrIdentifierList:a}=r;if(!r.featuresResolved&&null!=a){for(const e of a){const t={feature:null,oid:-1,gid:null};if("attributes"in e){t.feature=e;const r=e.attributes;if(null!=r)for(const e in r){if(-1!==t.oid&&null!=t.gid)break;const i=s.normalizeFieldName(e);i===o&&(t.oid=r[e]??-1),i===l&&(t.gid=r[e])}}else t.oid=e.objectId??-1,t.gid=e.globalId;null!=t.gid&&i.set(t.gid,t),-1!==t.oid&&n.set(t.oid,t)}r.featuresResolved=!0}return(-1!==e?n.get(e):null)??(null!=t?i.get(t):null)}function h(e,t,r,i,n=null,o=!0){const l=[],a={gidToFeatureInfo:new Map,oidToFeatureInfo:new Map,featuresResolved:null==r,fieldsIndex:e.fieldsIndex,objectIdField:e.objectIdField,globalIdField:e.globalIdField,featureOrIdentifierList:r};for(const e of t){if(null!=e.error)continue;const t=e.objectId??-1,r=e.globalId,u=(-1===t||o?c(t,r,a):null)??{feature:null,oid:t,gid:r},d={oid:-1===t?u.oid:t,gid:r??u.gid,feature:u.feature,result:e};l.push(d);const h=d.gid?(0,s.L3)(d.gid):null;if(-1===d.oid&&null!=h&&null!=n&&(d.oid=n.get(h)??-1),-1===d.oid&&null!=h){let e=i.get(h);null==e&&(e={gid:d.gid,edits:[]},i.set(h,e)),e.edits.push(d)}}return l}async function p(e,t){const r=new Map,n=h(e,t.addedFeatures,t.edits?.addFeatures,r),l=h(e,t.updatedFeatures,t.edits?.updateFeatures,r),a=h(e,t.deletedFeatures,t.edits?.deleteFeatures,r,t.globalIdToObjectId,!1);return r.size>0&&await async function(e,t){const r=e.i3sOverrides.layer.associatedLayer;if(null==r?.globalIdField)return;const n=r.createQuery(),{objectIdField:l,globalIdField:a}=r;n.where=Array.from(t.values()).map((({gid:e})=>`${a}='${e}'`)).join(" OR "),n.returnGeometry=!1,n.outFields=[l,a],n.cacheHint=!1;const u=await(0,i.mt)((0,o.UK)(r,n));if(!u.ok)return;const d=u.value.features;for(const e of d){const r=e.attributes[a],i=e.attributes[l];if(null==r||null==i||-1===i)continue;const n=t.get((0,s.L3)(r));if(null!=n)for(const e of n.edits)e.oid=i}}(e,r),{adds:n.filter((e=>-1!==e.oid)),updates:l.filter((e=>-1!==e.oid)),deletes:a.filter((e=>-1!==e.oid))}}function f(e,t){const r=new Map,i=e=>{for(const{oid:t,feature:i}of e){const e=i?.geometry;"mesh"===e?.type&&r.set(t,e)}};i(t.adds),i(t.updates);for(const e of t.deletes)r.set(e.oid,null);for(const[t,i]of r)e.i3sOverrides.updateGeometry(t,i)}function y(e,t){const r=function(e,t){const r=t.updates;if(!r||0===r.length)return new _;const i=new _,n=new Map;for(let t=0;t<e.attributeStorageInfo.length;t++)n.set(e.attributeStorageInfo[t].name,t);return e.forEachNode(((t,n)=>{for(const s of r){if(null==s.feature)continue;const r=s.feature,o=s.oid,l=n.indexOf(o);for(const n in r.attributes){const s=e.fieldsIndex.normalizeFieldName(n),a=g(i,t.index,s),u=r.attributes[n];a.push({featureIndex:l,featureId:o,value:u})}}})),i}(e,t),i=function(e,t){const r=new Map,i=t.adds;if(!i||0===i.length||null==e.globalIdField)return r;for(const e of i){const t=e.oid,i=e.feature;"mesh"===i?.geometry?.type&&r.set(t,i)}return r}(e,t);if(0===r.size&&0===i.size)return;const n=new Map;for(let t=0;t<e.attributeStorageInfo.length;t++)n.set(e.attributeStorageInfo[t].name,t);let s=!1;r.forEach(((t,r)=>{const i=e.getAttributeData(r);let o=!1;t.forEach(((t,r)=>{const l=null!=i?i[r]:null,a=n.get(r);for(const{featureIndex:r,value:i,featureId:n}of t)l&&(l[r]=i,o=!0,s=!0),e.i3sOverrides.updateAttributeValue(n,a,i)})),o&&e.setAttributeData(r,i,null)})),s&&e.clearMemCache();const{fieldsIndex:o,i3sOverrides:l,objectIdField:a,globalIdField:u}=e,d=l.layer.associatedLayer?.infoFor3D,c=new Set(d?[...Object.values(d.assetMapFieldRoles),...Object.values(d.transformFieldRoles)]:[]);for(const[e,t]of i){l.featureAdded(e);const{attributes:r}=t;for(const t in r){if(t!==a&&t!==u&&c.has(t))continue;const i=o.normalizeFieldName(t),s=null!=i?n.get(i):null;if(null==s)continue;const d=r[t];l.updateAttributeValue(e,s,d)}}}function g(e,t,r){const i=function(e,t){const r=e.get(t);if(r)return r;const i=new m;return e.set(t,i),i}(e,t),n=null!=r&&i.get(r);if(n)return n;const s=new Array;return i.set(r,s),s}(u=a||(a={}))[u.EDITING=0]="EDITING",u[u.ROLLED_BACK=1]="ROLLED_BACK",u[u.COMMITTED=2]="COMMITTED";const m=Map,_=Map},76945:function(e,t,r){r.d(t,{i:function(){return a}});var i=r(73440),n=r(88194),s=(r(96711),r(61432),r(83850),r(48023)),o=r(76554),l=r(85754);const a=e=>{let t=class extends e{_validateFetchPopupFeatures(e){const{layer:t}=this,{popupEnabled:r}=t;if(!r)throw new n.Z("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t});if(!(0,l.V5)(t,e))throw new n.Z("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t})}async prepareFetchPopupFeatures(e){}async fetchPopupFeaturesFromGraphics(e,t){if(this._validateFetchPopupFeatures(t),0===e.length)return[];const r="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;let i=[];"fieldsIndex"in this.layer&&(i=(0,o.Lk)(this.layer.fieldsIndex,await(0,l.e7)(r,(0,l.V5)(this.layer,t)))),await this.prepareFetchPopupFeatures(i);const n=new Set,s=[],a=[];for(const t of e)(0,o.Gm)(t,i,n)?a.push(t):s.push(t);if(0===a.length)return s;const u=new Map;for(let t=0;t<e.length;t++)u.set(e[t].getObjectId()??0,t);const d=await this.whenGraphicAttributes(a,[...n]).catch((()=>a)).then((e=>s.concat(e)));return d.sort(((e,t)=>{const r=e.getObjectId()??0,i=u.get(r)??0,n=t.getObjectId()??0;return i-(u.get(n)??0)})),d}};return t=(0,i._)([(0,s.j)("esri.views.3d.layers.support.PopupSceneLayerView")],t),t}},65073:function(e,t,r){r.d(t,{K:function(){return p}});var i=r(73440),n=r(70880),s=r(96711),o=r(93568),l=r(90403),a=r(17155),u=r(48023);const d=e=>{let t=class extends e{constructor(){super(...arguments),this._numUpdating=0}get updating(){return this._numUpdating>0}autoUpdateAsync(e,t){const r=(0,o.Ds)((async t=>{++this._numUpdating;try{const r=await t;this.destroyed||this._set(e,r)}catch(t){s.Z.getLogger(this).warn(`Async update of "${String(e)}" failed. Async update functions should not throw exceptions.`)}--this._numUpdating}));return(0,l.YP)(t,r,l.nn)}};return(0,i._)([(0,a.Cb)({readOnly:!0})],t.prototype,"updating",null),(0,i._)([(0,a.Cb)()],t.prototype,"_numUpdating",void 0),t=(0,i._)([(0,u.j)("esri.core.AsyncUpdate")],t),t};let c=class extends(d(n.Z)){};c=(0,i._)([(0,u.j)("esri.core.AsyncUpdate")],c);r(61432),r(83850);var h=r(76554);let p=class extends(d(n.Z)){get layer(){return this.layerView.layer}get requiredFields(){const{layerView:{layer:{fieldsIndex:e},definitionExpressionFields:t},rendererFields:r,labelingFields:i,viewFilterFields:n}=this;return(0,h.Q0)(e,[...t??[],...r??[],...i??[],...n??[]])}constructor(e){super(e)}initialize(){this.addHandles([this.autoUpdateAsync("rendererFields",(async()=>{const{fieldsIndex:e,renderer:t}=this.layer;return t?this._getFieldsAsync((r=>t.collectRequiredFields(r,e))):null})),this.autoUpdateAsync("labelingFields",(async()=>{const{layer:e}=this;return e.labelsVisible?this._getFieldsAsync((t=>(0,h.Mu)(t,e))):null})),this.autoUpdateAsync("viewFilterFields",(()=>{const{layer:e,mergedFilter:t}=this.layerView;return this._getFieldsAsync((r=>(0,h.Ll)(r,e,t)))}))])}async _getFieldsAsync(e){const t=new Set;try{return await e(t),Array.from(t).sort()}catch(e){return s.Z.getLogger(this).error(e),null}}};(0,i._)([(0,a.Cb)()],p.prototype,"layerView",void 0),(0,i._)([(0,a.Cb)()],p.prototype,"layer",null),(0,i._)([(0,a.Cb)()],p.prototype,"requiredFields",null),(0,i._)([(0,a.Cb)()],p.prototype,"rendererFields",void 0),(0,i._)([(0,a.Cb)()],p.prototype,"labelingFields",void 0),(0,i._)([(0,a.Cb)()],p.prototype,"viewFilterFields",void 0),p=(0,i._)([(0,u.j)("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],p)},20132:function(e,t,r){r.d(t,{v:function(){return n}});var i=r(76554);function n(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const{layer:e,layer:{fieldsIndex:t},requiredFields:r}=this;return e.outFields?(0,i.Q0)(t,[...(0,i.Lk)(t,e.outFields),...r]):(0,i.Q0)(t,r)}}}}},40329:function(e,t,r){r.d(t,{Z:function(){return f}});var i=r(73440),n=r(3480),s=r(96711),o=r(61100),l=r(88058),a=r(93568),u=r(90403),d=r(17155),c=(r(61432),r(48023)),h=r(13132),p=r(5527);let f=class extends p.Z{constructor(){super(...arguments),this.layer=null,this.filter=null,this._geometryEngine=null,this._projectionEngineLoaded=!1,this._abortController=new AbortController}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){throw new Error("Not implemented")}get maximumNumberOfFeaturesExceeded(){return!1}get layerFilter(){return(0,l.lK)(this._layerFilter)}get _layerFilter(){const e=this.layer?.filter;if(null==e||e.geometries.length<1)return null;const t=this._geometryEngine;if(null==t||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return l.cn;const r=e.geometries.at(0).spatialReference,i=e.geometries.toArray().map((e=>{try{e=t.simplify(e)}catch(e){return s.Z.getLogger(this).warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==e)return null;if(e.spatialReference.equals(r))return e;try{return(0,h.project)(e,r)}catch(e){return s.Z.getLogger(this).warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),null}})).filter(n.pC).sort(((e,t)=>e.extent.xmin-t.extent.xmin)),o=new Set,a=new Array,u=new Array;for(let e of i){const r=e.extent.xmin;if(a.length=0,o.forEach((i=>{if(r>=i.extent.xmax)return u.push(i),void o.delete(i);e.extent.ymin<=i.extent.ymax&&e.extent.ymax>=i.extent.ymin&&t.intersects(e,i)&&a.push(i)})),a.length>0){a.push(e);try{e=t.union(a)}catch(e){s.Z.getLogger(this).warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}a.pop(),a.forEach((e=>o.delete(e)))}o.add(e)}return o.forEach((e=>u.push(e))),u.length>0?{spatialRelationship:e.spatialRelationship,geometries:u}:null}get _filterNeedsProjectionEngine(){const e=this.layer.filter;if(null==e||e.geometries.length<=1)return!1;const t=e.geometries.at(0).spatialReference;return e.geometries.some((({spatialReference:e})=>!e.equals(t)&&!(0,h.canProjectWithoutEngine)(e,t)))}get layerFilterUpdating(){return(0,l.j)(this._layerFilter)}initialize(){const{signal:e}=this._abortController;(0,u.N1)((()=>this.destroyed||!this._geometryEngine&&this.layer?.filter?.geometries?.length),e).then((async()=>{(0,a.r9)(e),this._geometryEngine=await Promise.all([r.e(27093),r.e(13746)]).then(r.bind(r,13746))})).catch(a.H9),this._projectionEngineLoaded=(0,h.isLoaded)(),(0,u.N1)((()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine),e).then((async()=>{(0,a.r9)(e),await(0,h.load)(),this._projectionEngineLoaded=!0})).catch(a.H9)}destroy(){this._abortController=(0,o.IM)(this._abortController)}highlight(e){throw new Error("Not implemented")}queryFeatures(e,t){throw new Error("Not implemented")}queryObjectIds(e,t){throw new Error("Not implemented")}queryFeatureCount(e,t){throw new Error("Not implemented")}createQuery(){throw new Error("Not implemented")}queryExtent(e,t){throw new Error("Not implemented")}};(0,i._)([(0,d.Cb)()],f.prototype,"layer",void 0),(0,i._)([(0,d.Cb)()],f.prototype,"availableFields",null),(0,i._)([(0,d.Cb)()],f.prototype,"maximumNumberOfFeatures",null),(0,i._)([(0,d.Cb)({readOnly:!0})],f.prototype,"maximumNumberOfFeaturesExceeded",null),(0,i._)([(0,d.Cb)()],f.prototype,"filter",void 0),(0,i._)([(0,d.Cb)({readOnly:!0})],f.prototype,"layerFilter",null),(0,i._)([(0,d.Cb)({readOnly:!0})],f.prototype,"_layerFilter",null),(0,i._)([(0,d.Cb)()],f.prototype,"_geometryEngine",void 0),(0,i._)([(0,d.Cb)()],f.prototype,"_projectionEngineLoaded",void 0),(0,i._)([(0,d.Cb)()],f.prototype,"_filterNeedsProjectionEngine",null),(0,i._)([(0,d.Cb)()],f.prototype,"layerFilterUpdating",null),f=(0,i._)([(0,c.j)("esri.views.layers.SceneLayerView")],f)}}]);