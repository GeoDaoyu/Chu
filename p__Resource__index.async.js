"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[14296],{29915:function(e,n,t){t.r(n),t.d(n,{default:function(){return me}});var r=t(45332),i=t.n(r),c=t(14178),a=t(58019),s=t(76711),u=t.n(s),l=t(73193),o=t.n(l),f=t(84176),d=t.n(f),h=t(88753),y=t(26450),v=t(73917),p=t(51341),x=t(44194),Z="search___X2eTF",g=t(31549),k=["treeData","getLayerInfo"],j=["title","key","children","count"],m=y.Z.Search,w=v.Z.Text,_=function(e){return function(n){var t=n.treeData,r=n.getLayerInfo,c=d()(n,k),a=(0,x.useState)([]),s=i()(a,2),l=s[0],f=s[1],y=(0,x.useState)(""),v=i()(y,2),_=v[0],I=v[1],L=(0,x.useState)(!0),D=i()(L,2),C=D[0],K=D[1],E=(0,x.useMemo)((function(){return function e(n){return n.map((function(n){var t=n.title,r=n.key,i=n.children,c=n.count,a=d()(n,j),s=t.indexOf(_),u=t.substring(0,s),l=t.slice(s+_.length),f=s>-1?(0,g.jsxs)(p.Z,{children:[(0,g.jsxs)("span",{children:[u,(0,g.jsx)(w,{type:"danger",children:_}),l]}),c&&c>0?"(".concat(c,")"):null]}):(0,g.jsxs)(p.Z,{children:[(0,g.jsx)("span",{children:t}),c&&c>0?"(".concat(c,")"):null]});return i?o()(o()({},a),{},{title:f,key:r,children:e(i)}):o()(o()({},a),{},{title:f,key:r})}))}(t)}),[t,_]);return(0,g.jsxs)("div",{children:[(0,g.jsx)(m,{placeholder:"请输入关键词搜索",onChange:function(e){var n=e.target.value,r=[];if((0,h.Z)(n))return f(r),I(n),void K(!0);t.forEach((function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&(t.title.includes(n)&&r.push(i),t.children&&t.children.forEach((function(n){return e(n,t.key)})))})),f(r),I(n),K(!0)},className:Z}),(0,g.jsx)(e,o()(o()({},c),{},{treeData:E,getLayerInfo:r,onSelect:function(e,n){var t=n.node,r=l.includes(t.key)?l.filter((function(e){return e!==t.key})):[].concat(u()(l),[t.key]);f(r)},onExpand:function(e){f(e),K(!1)},expandedKeys:l,autoExpandParent:C}))]})}},I=t(98330),L=t(38209),D=t(59876),C=t(47635),K=t(53447),E=t(27998),S=t(91829),b=t(43141),N=t(57040),T=t(59259),U=t(80379);const M=new Map([["feature",D.default],["geojson",C.default],["graphics",K.Z],["imagery",E.default],["imagery-tile",S.default],["integrated-mesh-3d-tiles",b.default],["map-image",N.default],["tile",T.default],["vector-tile",U.default]]);var P=({type:e,...n})=>new(M.get(e))(n),B=t(43909),F=t(90602),q=t(47307);var z=t(64178),A=t(28833),G=t(39762),O=t(60711),H=t(88763),X=function(){var e=[{label:"收藏",icon:(0,g.jsx)(G.Z,{}),key:"favorite",onClick:function(){z.ZP.success("收藏成功")}},{label:"删除",icon:(0,g.jsx)(O.Z,{}),key:"delete",onClick:function(){z.ZP.success("删除")}}];return(0,g.jsx)(A.Z,{menu:{items:e},children:(0,g.jsx)(H.Z,{})})},J="container___Az_tF",Q=["treeData","getLayerInfo"],R=["children","key"],V=function(e){return function(n){var t=n.treeData,r=n.getLayerInfo,i=d()(n,Q),a=(0,c.Z)((function(e){return e.view})),s=(0,x.useMemo)((function(){return function e(n){return n.map((function(n){var t=n.children,r=n.key,i=d()(n,R),c=t&&t.length?null:(0,g.jsxs)(p.Z,{children:[(0,g.jsx)(I.Z,{onClick:function(e){e.stopPropagation(),((e,n)=>{const t=e.map.findLayerById(n);t&&e.goTo(t.fullExtent)})(a,r)}}),(0,g.jsx)(X,{})]});return c?o()(o()({},i),{},{key:r,isLeaf:!0,icon:c}):o()(o()({},i),{},{key:r,isLeaf:!1,children:e(t)})}))}(t)}),[t,a]);return(0,g.jsx)("div",{className:J,children:(0,g.jsx)(e,o()(o()({},i),{},{treeData:s,getLayerInfo:r,showIcon:!0,blockNode:!0}))})}},W=t(52362);const{view:Y}=c.Z.getState();var $=e=>n=>(t,r,i)=>n(((...n)=>{const[{checkedKeys:i}]=n;if(i){const{checkedKeys:n}=r(),t=(0,W.Z)(i,n),c=(0,W.Z)(n,i);t.forEach((n=>{if(!((e,n)=>!!e.map.findLayerById(n))(Y,n)){const t=e(n);(async(e,n)=>{if(!n)return;const{key:t,url:r,type:i,...c}=n,a=(0,B.Z)([[(0,F.Z)("type"),()=>P({id:t,...n})],[(0,F.Z)("url"),()=>L.Z.fromArcGISServerUrl({url:r,properties:{id:t,...c}})],[q.Z,()=>new L.Z({id:t,...c})]])(n);e.map.add(a)})(Y,t)}})),c.forEach((e=>((e,n)=>{const t=e.map.findLayerById(n);e.map.remove(t)})(Y,e)))}t(...n)}),r,i),ee=t(25480);const ne=e=>({checkedKeys:[],setCheckedKeys:n=>e({checkedKeys:n})});(0,ee.U)(ne);var te=t(70728);var re=(e,n)=>(0,ee.U)((0,te.Z)(...n)(e)),ie=t(99726),ce=["treeData","getLayerInfo"],ae=function(e){var n=e.treeData,t=e.getLayerInfo,r=d()(e,ce),i=(0,x.useMemo)((function(){return re(ne,[$(t)])}),[t])(),c=i.checkedKeys,a=i.setCheckedKeys;return(0,g.jsx)(ie.Z,o()(o()({},r),{},{checkable:!0,onCheck:function(e){a(e)},checkedKeys:c,treeData:n}))},se=(t(2814),function(){return(0,g.jsx)("arcgis-layer-list",{"reference-element":"view"})}),ue=(t(81714),function(){return(0,g.jsx)("arcgis-legend",{"reference-element":"view"})}),le=t(19960),oe={left:"left___hHqUC",right:"right___OFKsD"},fe=t(90819),de=t.n(fe),he=t(89933),ye=t.n(he),ve=t(54191);function pe(){return(pe=ye()(de()().mark((function e(){return de()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,ve.request)("/api/v1/layerTree",{method:"GET"}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var xe=t(86222),Ze=t.n(xe),ge=function e(n,t){if(n.key===t)return n;if(n.children){var r,i=Ze()(n.children);try{for(i.s();!(r=i.n()).done;){var c=e(r.value,t);if(c)return c}}catch(e){i.e(e)}finally{i.f()}}return null},ke=function(e){return function(n){return ge({children:e},n)}},je=(0,te.Z)(_,V)(ae),me=function(){var e=(0,c.Z)((function(e){return e.view})),n=(0,x.useState)([]),t=i()(n,2),r=t[0],s=t[1];return(0,x.useEffect)((function(){(function(){return pe.apply(this,arguments)})().then((function(e){var n=e.data;return s(n)}))}),[]),(0,g.jsxs)("div",{className:oe.container,children:[(0,g.jsx)("div",{className:oe.left,children:(0,g.jsx)(le.Z,{gap:"large",vertical:!0,children:(0,g.jsx)(a.Z,{title:"目录树",children:(0,g.jsx)(je,{treeData:r,getLayerInfo:ke(r)})})})}),(0,g.jsx)("div",{className:oe.right,children:(0,g.jsxs)(le.Z,{gap:"large",vertical:!0,children:[(0,g.jsx)(a.Z,{title:"图层列表",children:(0,g.jsx)(se,{view:e})}),(0,g.jsx)(a.Z,{title:"图例",children:(0,g.jsx)(ue,{view:e})})]})})]})}},58019:function(e,n,t){var r=t(86415),i=t(51282),c=t(31549);n.Z=function(e){var n=e.title,t=void 0===n?"":n,a=e.children;return(0,c.jsx)(r.Z,{title:t,children:a||(0,c.jsx)(i.Z,{description:!1})})}},14178:function(e,n,t){const r=(0,t(25480).U)((e=>({view:null,initialize:n=>e({view:n})})));n.Z=r}}]);