(self.webpackChunk=self.webpackChunk||[]).push([[14296],{26401:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return k}});var r=t(45332),i=t.n(r),c=t(48316),u=t(45323),o=t(43214),a=t(19960),s=t(44194),f={left:"left___hHqUC",right:"right___OFKsD"},l=t(90819),d=t.n(l),v=t(89933),h=t.n(v),y=t(70765);function p(){return(p=h()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,y.request)("/api/v1/layerTree",{method:"GET"}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=t(86222),m=t.n(x),j=function e(n,t){if(n.key===t)return n;if(n.children){var r,i=m()(n.children);try{for(i.s();!(r=i.n()).done;){var c=e(r.value,t);if(c)return c}}catch(e){i.e(e)}finally{i.f()}}return null},g=function(e){return function(n){return j({children:e},n)}},Z=t(31549),k=function(){var e=(0,c.No)((function(e){return e.view})),n=(0,s.useState)([]),t=i()(n,2),r=t[0],l=t[1];return(0,s.useEffect)((function(){(function(){return p.apply(this,arguments)})().then((function(e){var n=e.data;return l(n)}))}),[]),(0,Z.jsxs)("div",{className:f.container,children:[(0,Z.jsx)("div",{className:f.left,children:(0,Z.jsx)(a.Z,{gap:"large",vertical:!0,children:(0,Z.jsx)(u.s_,{title:"目录树",children:(0,Z.jsx)(o.PI,{view:e,treeData:r,getLayerInfo:g})})})}),(0,Z.jsx)("div",{className:f.right,children:(0,Z.jsxs)(a.Z,{gap:"large",vertical:!0,children:[(0,Z.jsx)(u.s_,{title:"图层列表",children:(0,Z.jsx)(o.VO,{view:e})}),(0,Z.jsx)(u.s_,{title:"图例",children:(0,Z.jsx)(o.De,{view:e})})]})})]})}},48316:function(e,n,t){"use strict";t.d(n,{bh:function(){return i},No:function(){return c},kZ:function(){return o}});var r=t(25480);const i=e=>({checkedKeys:[],setCheckedKeys:n=>e({checkedKeys:n})});(0,r.U)(i);var c=(0,r.U)((e=>({view:null,initialize:n=>e({view:n})}))),u=t(70728);var o=(e,n)=>(0,r.U)((0,u.Z)(...n)(e))},45323:function(e,n,t){"use strict";t.d(n,{Gv:function(){return h},s_:function(){return x},o8:function(){return Z}});var r=t(45332),i=t.n(r),c=t(44194),u=t(24462),o=t(67984),a=t(33273),s=t(31549),f=function(e){var n=e.dataSource,t=e.goTo;return(0,s.jsx)(o.Z,{itemLayout:"horizontal",dataSource:n,renderItem:function(e){var n=e.avatar,r=e.title,i=e.description,c=e.component;return(0,s.jsx)(o.Z.Item,{actions:[(0,s.jsx)(a.ZP,{type:"link",icon:(0,s.jsx)(u.Z,{}),iconPosition:"end",disabled:!c,onClick:function(){return t(c)},children:"立即使用"},"link")],children:(0,s.jsx)(o.Z.Item.Meta,{avatar:n,title:r,description:i})})}})},l=t(55447),d=function(e){var n=e.goBack,t=e.children;return(0,s.jsxs)("div",{children:[(0,s.jsx)(a.ZP,{type:"link",icon:(0,s.jsx)(l.Z,{}),onClick:n,children:"返回"}),t]})},v="container___PuJI4",h=function(e){var n=e.dataSource,t=(0,c.useState)(),r=i()(t,2),u=r[0],o=r[1];return(0,s.jsx)("div",{className:v,children:u?(0,s.jsx)(d,{goBack:function(){return o(null)},children:u}):(0,s.jsx)(f,{dataSource:n,goTo:o})})},y=t(86415),p=t(51282),x=function(e){var n=e.title,t=void 0===n?"":n,r=e.children;return(0,s.jsx)(y.Z,{title:t,children:r||(0,s.jsx)(p.Z,{description:!1})})},m=t(73193),j=t.n(m),g=t(53698),Z=function(e){var n=e.dataSource,t=e.insetInlineEnd,r=void 0===t?20:t;return(0,s.jsx)(g.Z.Group,{shape:"square",style:{insetInlineEnd:r},children:n.map((function(e){return(0,s.jsx)(g.Z,j()({},e),e.name)}))})}},43214:function(e,n,t){"use strict";t.d(n,{Kh:function(){return ne},hw:function(){return c},VO:function(){return u},PI:function(){return M},De:function(){return T},zI:function(){return O},AA:function(){return q},vi:function(){return V},yO:function(){return F},Dt:function(){return X}});t(97017);var r=t(44194),i=t(31549),c=function(e){var n=e.view;return(0,r.useEffect)((function(){var e=n.environment.lighting.clone();return function(){n.environment.lighting=e}}),[n]),(0,i.jsx)("arcgis-daylight",{"reference-element":"view"})},u=(t(2814),function(){return(0,i.jsx)("arcgis-layer-list",{"reference-element":"view"})}),o=t(76711),a=t.n(o),s=t(45332),f=t.n(s),l=t(52362),d=t(38209),v=t(59876),h=t(47635),y=t(53447),p=t(27998),x=t(91829),m=t(43141),j=t(57040),g=t(59259),Z=t(80379);const k=new Map([["feature",v.default],["geojson",h.default],["graphics",y.Z],["imagery",p.default],["imagery-tile",x.default],["integrated-mesh-3d-tiles",m.default],["map-image",j.default],["tile",g.default],["vector-tile",Z.default]]);var w=({type:e,...n})=>new(k.get(e))(n),b=t(43909),S=t(90602),E=t(47307);var I=t(48316);const{view:_}=I.No.getState();var C=e=>n=>(t,r,i)=>n(((...n)=>{const[{checkedKeys:i}]=n;if(i){const{checkedKeys:n}=r(),t=(0,l.Z)(i,n),c=(0,l.Z)(n,i);t.forEach((n=>{if(!((e,n)=>!!e.map.findLayerById(n))(_,n)){const t=e(n);(async(e,n)=>{if(!n)return;const{key:t,url:r,type:i,...c}=n,u=(0,b.Z)([[(0,S.Z)("type"),()=>w({id:t,...n})],[(0,S.Z)("url"),()=>d.Z.fromArcGISServerUrl({url:r,properties:{id:t,...c}})],[E.Z,()=>new d.Z({id:t,...c})]])(n);e.map.add(u)})(_,t)}})),c.forEach((e=>((e,n)=>{const t=e.map.findLayerById(n);e.map.remove(t)})(_,e)))}t(...n)}),r,i),P=t(88753),K=t(36066),A=t(73917),N=t(51341),z=t(82534),D=K.Z.Search,L=A.Z.Text,M=function(e){var n=e.treeData,t=e.getLayerInfo,c=(0,r.useMemo)((function(){return(0,I.kZ)(I.bh,[C(t(n))])}),[n,t])(),u=c.checkedKeys,o=c.setCheckedKeys,s=(0,r.useState)([]),l=f()(s,2),d=l[0],v=l[1],h=(0,r.useState)(""),y=f()(h,2),p=y[0],x=y[1],m=(0,r.useState)(!0),j=f()(m,2),g=j[0],Z=j[1],k=(0,r.useMemo)((function(){return function e(n){return n.map((function(n){var t=n.title,r=t.indexOf(p),c=t.substring(0,r),u=t.slice(r+p.length),o=r>-1?(0,i.jsx)(N.Z,{children:(0,i.jsxs)("span",{children:[c,(0,i.jsx)(L,{type:"danger",children:p}),u]})}):(0,i.jsx)(N.Z,{children:(0,i.jsx)("span",{children:t})});return n.children?{title:o,key:n.key,children:e(n.children)}:{title:o,key:n.key,isLeaf:!0}}))}(n)}),[n,p]);return(0,i.jsxs)("div",{children:[(0,i.jsx)(D,{placeholder:"请输入关键词搜索",onChange:function(e){var t=e.target.value,r=[];if((0,P.Z)(t))return v(r),x(t),void Z(!0);n.forEach((function e(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n&&(n.title.includes(t)&&r.push(i),n.children&&n.children.forEach((function(t){return e(t,n.key)})))})),v(r),x(t),Z(!0)}}),(0,i.jsx)(z.Z,{checkable:!0,showIcon:!0,blockNode:!0,onSelect:function(e,n){var t=n.node,r=d.includes(t.key)?d.filter((function(e){return e!==t.key})):[].concat(a()(d),[t.key]);v(r)},onCheck:function(e){o(e)},checkedKeys:u,onExpand:function(e){v(e),Z(!1)},expandedKeys:d,autoExpandParent:g,treeData:k})]})},T=(t(81714),function(){return(0,i.jsx)("arcgis-legend",{"reference-element":"view"})}),B=t(73577),O=function(e){var n=e.view,t=(0,r.useRef)(),c=(0,r.useRef)();return(0,r.useEffect)((function(){return t.current&&(c.current=new B.Z({view:n,container:t.current})),function(){c.current&&c.current.destroy()}}),[n]),(0,i.jsx)("div",{ref:t})},R=t(59958),U=t(19960),G=t(33273),q=function(e){var n=e.view,t=e.mediaLayerConfig,c=(0,r.useRef)(null);(0,r.useEffect)((function(){return c.current=new R.default(t),n.map.add(c.current),function(){n.map.remove(c.current)}}),[n,t]);return(0,i.jsxs)(U.Z,{vertical:!0,gap:"middle",children:[(0,i.jsx)(G.ZP,{type:"primary",block:!0,onClick:function(){c.current.visible=!0},children:"显示视频"}),(0,i.jsx)(G.ZP,{type:"primary",block:!0,onClick:function(){c.current.visible=!1},children:"隐藏视频"})]})},V=(t(53553),function(){return(0,i.jsx)("arcgis-sketch",{"reference-element":"view"})}),F=(t(47692),function(e){var n=e.view;return(0,r.useEffect)((function(){var e=n.environment.weather.clone();return function(){n.environment.weather=e}}),[n]),(0,i.jsx)("arcgis-weather",{"reference-element":"view"})}),H=t(8444),J=t(75259),Y=t(90403),Q=t(93427),W=A.Z.Text,X=function(e){var n=e.view,t=n.zoom,c=(0,r.useState)(Math.round(t)),u=f()(c,2),o=u[0],a=u[1],s=(0,r.useRef)(new Q.Z({view:n}));return(0,r.useEffect)((function(){(0,Y.YP)((function(){return n.zoom}),(function(e){a(Math.round(e))}))}),[n]),(0,i.jsxs)(U.Z,{justify:"space-between",align:"center",children:[(0,i.jsxs)(W,{children:["层级:",o]}),(0,i.jsxs)(N.Z,{children:[(0,i.jsx)(G.ZP,{type:"primary",icon:(0,i.jsx)(H.Z,{}),onClick:function(){var e;null===(e=s.current)||void 0===e||e.zoomIn()}}),(0,i.jsx)(G.ZP,{type:"primary",icon:(0,i.jsx)(J.Z,{}),onClick:function(){var e;null===(e=s.current)||void 0===e||e.zoomOut()}})]})]})},$=t(24858),ee=t(70765),ne=function(e){var n=e.view,t=(0,r.useRef)(),c=(0,r.useRef)(),u=(0,ee.useAccess)();return(0,r.useEffect)((function(){return t.current&&(c.current=new $.Z({view:n,container:t.current,visibleElements:{settingsButton:u.canSeeAdmin,captureButton:u.canSeeAdmin}})),function(){c.current&&c.current.destroy()}}),[n,u]),(0,i.jsx)("div",{ref:t})}},86222:function(e,n,t){var r=t(15274);e.exports=function(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=r(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var i=0,c=function(){};return{s:c,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,o=!0,a=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){a=!0,u=e},f:function(){try{o||null==t.return||t.return()}finally{if(a)throw u}}}},e.exports.__esModule=!0,e.exports.default=e.exports}}]);