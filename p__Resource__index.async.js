"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[14296],{29915:function(e,n,t){t.r(n),t.d(n,{default:function(){return me}});var r=t(45332),i=t.n(r),c=t(14178),a=t(58019),s=t(76711),u=t.n(s),o=t(73193),l=t.n(o),f=t(84176),d=t.n(f),h=t(88753),y=t(26450),v=t(73917),p=t(51341),x=t(44194),Z="search___X2eTF",g=t(31549),j=["treeData","getLayerInfo"],k=["title","key","children","count"],m=y.Z.Search,w=v.Z.Text,I=function(e){return function(n){var t=n.treeData,r=n.getLayerInfo,c=d()(n,j),a=(0,x.useState)([]),s=i()(a,2),o=s[0],f=s[1],y=(0,x.useState)(""),v=i()(y,2),I=v[0],_=v[1],L=(0,x.useState)(!0),D=i()(L,2),C=D[0],K=D[1],E=(0,x.useMemo)((function(){return function e(n){return n.map((function(n){var t=n.title,r=n.key,i=n.children,c=n.count,a=d()(n,k),s=t.indexOf(I),u=t.substring(0,s),o=t.slice(s+I.length),f=s>-1?(0,g.jsxs)(p.Z,{children:[(0,g.jsxs)("span",{children:[u,(0,g.jsx)(w,{type:"danger",children:I}),o]}),c&&c>0?"(".concat(c,")"):null]}):(0,g.jsxs)(p.Z,{children:[(0,g.jsx)("span",{children:t}),c&&c>0?"(".concat(c,")"):null]});return i?l()(l()({},a),{},{title:f,key:r,children:e(i)}):l()(l()({},a),{},{title:f,key:r})}))}(t)}),[t,I]);return(0,g.jsxs)("div",{children:[(0,g.jsx)(m,{placeholder:"请输入关键词搜索",onChange:function(e){var n=e.target.value,r=[];if((0,h.Z)(n))return f(r),_(n),void K(!0);t.forEach((function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&(t.title.includes(n)&&r.push(i),t.children&&t.children.forEach((function(n){return e(n,t.key)})))})),f(r),_(n),K(!0)},className:Z}),(0,g.jsx)(e,l()(l()({},c),{},{treeData:E,getLayerInfo:r,onSelect:function(e,n){var t=n.node,r=o.includes(t.key)?o.filter((function(e){return e!==t.key})):[].concat(u()(o),[t.key]);f(r)},onExpand:function(e){f(e),K(!1)},expandedKeys:o,autoExpandParent:C}))]})}},_=t(98330),L=t(38209),D=t(59876),C=t(47635),K=t(53447),E=t(27998),S=t(91829),b=t(43141),M=t(57040),N=t(59259),T=t(80379);const U=new Map([["feature",D.default],["geojson",C.default],["graphics",K.Z],["imagery",E.default],["imagery-tile",S.default],["integrated-mesh-3d-tiles",b.default],["map-image",M.default],["tile",N.default],["vector-tile",T.default]]);var P=({type:e,...n})=>new(U.get(e))(n),B=t(43909),F=t(90602),q=t(47307);var z=t(28833),A=t(88763),G=function(e){var n=e.items;return(0,g.jsx)(z.Z,{menu:{items:n},children:(0,g.jsx)(A.Z,{})})},O="container___Az_tF",H=["treeData","getLayerInfo","dropMenuItems"],X=["children","key"],J=function(e){return function(n){var t=n.treeData,r=n.getLayerInfo,i=n.dropMenuItems,a=void 0===i?[]:i,s=d()(n,H),u=(0,c.Z)((function(e){return e.view})),o=(0,x.useMemo)((function(){return function e(n){return n.map((function(n){var t=n.children,r=n.key,i=d()(n,X),c=t&&t.length?null:(0,g.jsxs)(p.Z,{children:[(0,g.jsx)(_.Z,{onClick:function(e){e.stopPropagation(),((e,n)=>{const t=e.map.findLayerById(n);t&&e.goTo(t.fullExtent)})(u,r)}}),(0,g.jsx)(G,{items:a})]});return c?l()(l()({},i),{},{key:r,isLeaf:!0,icon:c}):l()(l()({},i),{},{key:r,isLeaf:!1,children:e(t)})}))}(t)}),[t,a,u]);return(0,g.jsx)("div",{className:O,children:(0,g.jsx)(e,l()(l()({},s),{},{treeData:o,getLayerInfo:r,showIcon:!0,blockNode:!0}))})}},Q=t(52362);const{view:R}=c.Z.getState();var V=e=>n=>(t,r,i)=>n(((...n)=>{const[{checkedKeys:i}]=n;if(i){const{checkedKeys:n}=r(),t=(0,Q.Z)(i,n),c=(0,Q.Z)(n,i);t.forEach((n=>{if(!((e,n)=>!!e.map.findLayerById(n))(R,n)){const t=e(n);(async(e,n)=>{if(!n)return;const{key:t,url:r,type:i,...c}=n,a=(0,B.Z)([[(0,F.Z)("type"),()=>P({id:t,...n})],[(0,F.Z)("url"),()=>L.Z.fromArcGISServerUrl({url:r,properties:{id:t,...c}})],[q.Z,()=>new L.Z({id:t,...c})]])(n);e.map.add(a)})(R,t)}})),c.forEach((e=>((e,n)=>{const t=e.map.findLayerById(n);e.map.remove(t)})(R,e)))}t(...n)}),r,i),W=t(25480);const Y=e=>({checkedKeys:[],setCheckedKeys:n=>e({checkedKeys:n})});(0,W.U)(Y);var $=t(70728);var ee=(e,n)=>(0,W.U)((0,$.Z)(...n)(e)),ne=t(99726),te=["treeData","getLayerInfo"],re=function(e){var n=e.treeData,t=e.getLayerInfo,r=d()(e,te),i=(0,x.useMemo)((function(){return ee(Y,[V(t)])}),[t])(),c=i.checkedKeys,a=i.setCheckedKeys;return(0,g.jsx)(ne.Z,l()(l()({},r),{},{checkable:!0,onCheck:function(e){a(e)},checkedKeys:c,treeData:n}))},ie=(t(2814),function(){return(0,g.jsx)("arcgis-layer-list",{"reference-element":"view"})}),ce=(t(81714),function(){return(0,g.jsx)("arcgis-legend",{"reference-element":"view"})}),ae=t(64178),se=t(19960),ue={left:"left___hHqUC",right:"right___OFKsD"},oe=t(90819),le=t.n(oe),fe=t(89933),de=t.n(fe),he=t(54191);function ye(){return(ye=de()(le()().mark((function e(){return le()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,he.request)("/api/v1/layerTree.json",{method:"GET"}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ve=t(86222),pe=t.n(ve),xe=function e(n,t){if(n.key===t)return n;if(n.children){var r,i=pe()(n.children);try{for(i.s();!(r=i.n()).done;){var c=e(r.value,t);if(c)return c}}catch(e){i.e(e)}finally{i.f()}}return null},Ze=function(e){return function(n){return xe({children:e},n)}},ge=t(39762),je=t(60711),ke=(0,$.Z)(I,J)(re),me=function(){var e=(0,c.Z)((function(e){return e.view})),n=(0,x.useState)([]),t=i()(n,2),r=t[0],s=t[1],u=[{label:"收藏",icon:(0,g.jsx)(ge.Z,{}),key:"favorite",onClick:function(){ae.ZP.success("收藏成功")}},{label:"删除",icon:(0,g.jsx)(je.Z,{}),key:"delete",onClick:function(){ae.ZP.success("删除")}}];return(0,x.useEffect)((function(){(function(){return ye.apply(this,arguments)})().then((function(e){var n=e.data;return s(n)}))}),[]),(0,g.jsxs)("div",{className:ue.container,children:[(0,g.jsx)("div",{className:ue.left,children:(0,g.jsx)(se.Z,{gap:"large",vertical:!0,children:(0,g.jsx)(a.Z,{title:"目录树",children:(0,g.jsx)(ke,{treeData:r,getLayerInfo:Ze(r),dropMenuItems:u})})})}),(0,g.jsx)("div",{className:ue.right,children:(0,g.jsxs)(se.Z,{gap:"large",vertical:!0,children:[(0,g.jsx)(a.Z,{title:"图层列表",children:(0,g.jsx)(ie,{view:e})}),(0,g.jsx)(a.Z,{title:"图例",children:(0,g.jsx)(ce,{view:e})})]})})]})}},58019:function(e,n,t){var r=t(86415),i=t(51282),c=t(31549);n.Z=function(e){var n=e.title,t=void 0===n?"":n,a=e.children;return(0,c.jsx)(r.Z,{title:t,children:a||(0,c.jsx)(i.Z,{description:!1})})}},14178:function(e,n,t){const r=(0,t(25480).U)((e=>({view:null,initialize:n=>e({view:n})})));n.Z=r}}]);