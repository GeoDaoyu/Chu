"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[14296],{70822:function(e,n,t){t.r(n),t.d(n,{default:function(){return pe}});var r=t(45332),i=t.n(r),c=t(48316),a=t(58019),u=t(76711),s=t.n(u),o=t(73193),l=t.n(o),f=t(84176),d=t.n(f),h=t(88753),y=t(36066),v=t(73917),p=t(51341),x=t(44194),k=t(31549),Z=["title","key","children"],g=y.Z.Search,j=v.Z.Text,m=function(e){return function(n){var t=n.treeData,r=n.getLayerInfo,c=(0,x.useState)([]),a=i()(c,2),u=a[0],o=a[1],f=(0,x.useState)(""),y=i()(f,2),v=y[0],m=y[1],w=(0,x.useState)(!0),I=i()(w,2),L=I[0],_=I[1],b=(0,x.useMemo)((function(){return function e(n){return n.map((function(n){var t=n.title,r=n.key,i=n.children,c=d()(n,Z),a=t.indexOf(v),u=t.substring(0,a),s=t.slice(a+v.length),o=a>-1?(0,k.jsx)(p.Z,{children:(0,k.jsxs)("span",{children:[u,(0,k.jsx)(j,{type:"danger",children:v}),s]})}):(0,k.jsx)(p.Z,{children:(0,k.jsx)("span",{children:t})});return i?l()(l()({},c),{},{title:o,key:r,children:e(i)}):l()(l()({},c),{},{title:o,key:r})}))}(t)}),[t,v]);return(0,k.jsxs)("div",{children:[(0,k.jsx)(g,{placeholder:"请输入关键词搜索",onChange:function(e){var n=e.target.value,r=[];if((0,h.Z)(n))return o(r),m(n),void _(!0);t.forEach((function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&(t.title.includes(n)&&r.push(i),t.children&&t.children.forEach((function(n){return e(n,t.key)})))})),o(r),m(n),_(!0)}}),(0,k.jsx)(e,{treeData:b,getLayerInfo:r,onSelect:function(e,n){var t=n.node,r=u.includes(t.key)?u.filter((function(e){return e!==t.key})):[].concat(s()(u),[t.key]);o(r)},onExpand:function(e){o(e),_(!1)},expandedKeys:u,autoExpandParent:L})]})}},w=t(98330),I=t(32499),L=t(28833),_=t(39762),b=t(60711),C=t(88763),K=function(){var e=[{label:"收藏",icon:(0,k.jsx)(_.Z,{}),key:"favorite",onClick:function(){I.ZP.success("收藏成功")}},{label:"删除",icon:(0,k.jsx)(b.Z,{}),key:"delete",onClick:function(){I.ZP.success("删除")}}];return(0,k.jsx)(L.Z,{menu:{items:e},children:(0,k.jsx)(C.Z,{})})},D=t(38209),E=t(59876),N=t(47635),S=t(53447),U=t(27998),M=t(91829),P=t(43141),T=t(57040),B=t(59259),q=t(80379);const z=new Map([["feature",E.default],["geojson",N.default],["graphics",S.Z],["imagery",U.default],["imagery-tile",M.default],["integrated-mesh-3d-tiles",P.default],["map-image",T.default],["tile",B.default],["vector-tile",q.default]]);var A=({type:e,...n})=>new(z.get(e))(n),F=t(43909),G=t(90602),O=t(47307);var H="container___Az_tF",J=["children","key"],Q=function(e){return function(n){var t=n.treeData,r=n.getLayerInfo,i=(0,c.No)((function(e){return e.view})),a=(0,x.useMemo)((function(){return function e(n){return n.map((function(n){var t=n.children,r=n.key,c=d()(n,J),a=t&&t.length?null:(0,k.jsxs)(p.Z,{children:[(0,k.jsx)(w.Z,{onClick:function(e){e.stopPropagation(),((e,n)=>{const t=e.map.findLayerById(n);t&&e.goTo(t.fullExtent)})(i,r)}}),(0,k.jsx)(K,{})]});return a?l()(l()({},c),{},{key:r,isLeaf:!0,icon:a}):l()(l()({},c),{},{key:r,isLeaf:!1,children:e(t)})}))}(t)}),[t,i]);return(0,k.jsx)("div",{className:H,children:(0,k.jsx)(e,{treeData:a,getLayerInfo:r,showIcon:!0,blockNode:!0})})}},R=t(52362);const{view:V}=c.No.getState();var W=e=>n=>(t,r,i)=>n(((...n)=>{const[{checkedKeys:i}]=n;if(i){const{checkedKeys:n}=r(),t=(0,R.Z)(i,n),c=(0,R.Z)(n,i);t.forEach((n=>{if(!((e,n)=>!!e.map.findLayerById(n))(V,n)){const t=e(n);(async(e,n)=>{if(!n)return;const{key:t,url:r,type:i,...c}=n,a=(0,F.Z)([[(0,G.Z)("type"),()=>A({id:t,...n})],[(0,G.Z)("url"),()=>D.Z.fromArcGISServerUrl({url:r,properties:{id:t,...c}})],[O.Z,()=>new D.Z({id:t,...c})]])(n);e.map.add(a)})(V,t)}})),c.forEach((e=>((e,n)=>{const t=e.map.findLayerById(n);e.map.remove(t)})(V,e)))}t(...n)}),r,i),X=t(82534),Y=["treeData","getLayerInfo"],$=function(e){var n=e.treeData,t=e.getLayerInfo,r=d()(e,Y),i=(0,x.useMemo)((function(){return(0,c.kZ)(c.bh,[W(t)])}),[t])(),a=i.checkedKeys,u=i.setCheckedKeys;return(0,k.jsx)(X.Z,l()(l()({},r),{},{checkable:!0,onCheck:function(e){u(e)},checkedKeys:a,treeData:n}))},ee=(t(2814),function(){return(0,k.jsx)("arcgis-layer-list",{"reference-element":"view"})}),ne=(t(81714),function(){return(0,k.jsx)("arcgis-legend",{"reference-element":"view"})}),te=t(19960),re=t(70728),ie={left:"left___hHqUC",right:"right___OFKsD"},ce=t(90819),ae=t.n(ce),ue=t(89933),se=t.n(ue),oe=t(54191);function le(){return(le=se()(ae()().mark((function e(){return ae()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,oe.request)("/api/v1/layerTree",{method:"GET"}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fe=t(86222),de=t.n(fe),he=function e(n,t){if(n.key===t)return n;if(n.children){var r,i=de()(n.children);try{for(i.s();!(r=i.n()).done;){var c=e(r.value,t);if(c)return c}}catch(e){i.e(e)}finally{i.f()}}return null},ye=function(e){return function(n){return he({children:e},n)}},ve=(0,re.Z)(m,Q)($),pe=function(){var e=(0,c.No)((function(e){return e.view})),n=(0,x.useState)([]),t=i()(n,2),r=t[0],u=t[1];return(0,x.useEffect)((function(){(function(){return le.apply(this,arguments)})().then((function(e){var n=e.data;return u(n)}))}),[]),(0,k.jsxs)("div",{className:ie.container,children:[(0,k.jsx)("div",{className:ie.left,children:(0,k.jsx)(te.Z,{gap:"large",vertical:!0,children:(0,k.jsx)(a.Z,{title:"目录树",children:(0,k.jsx)(ve,{treeData:r,getLayerInfo:ye(r)})})})}),(0,k.jsx)("div",{className:ie.right,children:(0,k.jsxs)(te.Z,{gap:"large",vertical:!0,children:[(0,k.jsx)(a.Z,{title:"图层列表",children:(0,k.jsx)(ee,{view:e})}),(0,k.jsx)(a.Z,{title:"图例",children:(0,k.jsx)(ne,{view:e})})]})})]})}},58019:function(e,n,t){var r=t(86415),i=t(51282),c=t(31549);n.Z=function(e){var n=e.title,t=void 0===n?"":n,a=e.children;return(0,c.jsx)(r.Z,{title:t,children:a||(0,c.jsx)(i.Z,{description:!1})})}},48316:function(e,n,t){t.d(n,{bh:function(){return i},No:function(){return c},kZ:function(){return u}});var r=t(25480);const i=e=>({checkedKeys:[],setCheckedKeys:n=>e({checkedKeys:n})});(0,r.U)(i);var c=(0,r.U)((e=>({view:null,initialize:n=>e({view:n})}))),a=t(70728);var u=(e,n)=>(0,r.U)((0,a.Z)(...n)(e))}}]);