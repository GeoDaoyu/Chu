(self.webpackChunk=self.webpackChunk||[]).push([[14296],{26401:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return b}});var r=t(45332),i=t.n(r),c=t(48316),u=t(45323),o=t(8588),a=t(19960),s=t(44194),f=t(70728),l={left:"left___hHqUC",right:"right___OFKsD"},d=t(90819),v=t.n(d),h=t(89933),y=t.n(h),x=t(70765);function p(){return(p=y()(v()().mark((function e(){return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/layerTree",{method:"GET"}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=t(86222),j=t.n(m),Z=function e(n,t){if(n.key===t)return n;if(n.children){var r,i=j()(n.children);try{for(i.s();!(r=i.n()).done;){var c=e(r.value,t);if(c)return c}}catch(e){i.e(e)}finally{i.f()}}return null},g=function(e){return function(n){return Z({children:e},n)}},k=t(31549),w=(0,f.Z)(o.vm,o.R$)(o.PI),b=function(){var e=(0,c.No)((function(e){return e.view})),n=(0,s.useState)([]),t=i()(n,2),r=t[0],f=t[1];return(0,s.useEffect)((function(){(function(){return p.apply(this,arguments)})().then((function(e){var n=e.data;return f(n)}))}),[]),(0,k.jsxs)("div",{className:l.container,children:[(0,k.jsx)("div",{className:l.left,children:(0,k.jsx)(a.Z,{gap:"large",vertical:!0,children:(0,k.jsx)(u.s_,{title:"目录树",children:(0,k.jsx)(w,{treeData:r,getLayerInfo:g(r)})})})}),(0,k.jsx)("div",{className:l.right,children:(0,k.jsxs)(a.Z,{gap:"large",vertical:!0,children:[(0,k.jsx)(u.s_,{title:"图层列表",children:(0,k.jsx)(o.VO,{view:e})}),(0,k.jsx)(u.s_,{title:"图例",children:(0,k.jsx)(o.De,{view:e})})]})})]})}},48316:function(e,n,t){"use strict";t.d(n,{bh:function(){return i},No:function(){return c},kZ:function(){return o}});var r=t(25480);const i=e=>({checkedKeys:[],setCheckedKeys:n=>e({checkedKeys:n})});(0,r.U)(i);var c=(0,r.U)((e=>({view:null,initialize:n=>e({view:n})}))),u=t(70728);var o=(e,n)=>(0,r.U)((0,u.Z)(...n)(e))},45323:function(e,n,t){"use strict";t.d(n,{Gv:function(){return h},s_:function(){return p},o8:function(){return g}});var r=t(45332),i=t.n(r),c=t(44194),u=t(24462),o=t(67984),a=t(4925),s=t(31549),f=function(e){var n=e.dataSource,t=e.goTo;return(0,s.jsx)(o.Z,{itemLayout:"horizontal",dataSource:n,renderItem:function(e){var n=e.avatar,r=e.title,i=e.description,c=e.component;return(0,s.jsx)(o.Z.Item,{actions:[(0,s.jsx)(a.ZP,{type:"link",icon:(0,s.jsx)(u.Z,{}),iconPosition:"end",disabled:!c,onClick:function(){return t(c)},children:"立即使用"},"link")],children:(0,s.jsx)(o.Z.Item.Meta,{avatar:n,title:r,description:i})})}})},l=t(55447),d=function(e){var n=e.goBack,t=e.children;return(0,s.jsxs)("div",{children:[(0,s.jsx)(a.ZP,{type:"link",icon:(0,s.jsx)(l.Z,{}),onClick:n,children:"返回"}),t]})},v="container___PuJI4",h=function(e){var n=e.dataSource,t=(0,c.useState)(),r=i()(t,2),u=r[0],o=r[1];return(0,s.jsx)("div",{className:v,children:u?(0,s.jsx)(d,{goBack:function(){return o(null)},children:u}):(0,s.jsx)(f,{dataSource:n,goTo:o})})},y=t(86415),x=t(51282),p=function(e){var n=e.title,t=void 0===n?"":n,r=e.children;return(0,s.jsx)(y.Z,{title:t,children:r||(0,s.jsx)(x.Z,{description:!1})})},m=t(73193),j=t.n(m),Z=t(53698),g=function(e){var n=e.dataSource,t=e.insetInlineEnd,r=void 0===t?20:t;return(0,s.jsx)(Z.Z.Group,{shape:"square",style:{insetInlineEnd:r},children:n.map((function(e){return(0,s.jsx)(Z.Z,j()({},e),e.name)}))})}},8588:function(e,n,t){"use strict";t.d(n,{Kh:function(){return me},hw:function(){return c},VO:function(){return u},PI:function(){return ee},De:function(){return ne},zI:function(){return re},AA:function(){return oe},vi:function(){return ae},yO:function(){return se},Dt:function(){return ye},R$:function(){return H},vm:function(){return k}});t(97017);var r=t(44194),i=t(31549),c=function(e){var n=e.view;return(0,r.useEffect)((function(){var e=n.environment.lighting.clone();return function(){n.environment.lighting=e}}),[n]),(0,i.jsx)("arcgis-daylight",{"reference-element":"view"})},u=(t(2814),function(){return(0,i.jsx)("arcgis-layer-list",{"reference-element":"view"})}),o=t(76711),a=t.n(o),s=t(73193),f=t.n(s),l=t(84176),d=t.n(l),v=t(45332),h=t.n(v),y=t(88753),x=t(36066),p=t(73917),m=t(51341),j=["title","key","children"],Z=x.Z.Search,g=p.Z.Text,k=function(e){return function(n){var t=n.treeData,c=n.getLayerInfo,u=(0,r.useState)([]),o=h()(u,2),s=o[0],l=o[1],v=(0,r.useState)(""),x=h()(v,2),p=x[0],k=x[1],w=(0,r.useState)(!0),b=h()(w,2),I=b[0],S=b[1],E=(0,r.useMemo)((function(){return function e(n){return n.map((function(n){var t=n.title,r=n.key,c=n.children,u=d()(n,j),o=t.indexOf(p),a=t.substring(0,o),s=t.slice(o+p.length),l=o>-1?(0,i.jsx)(m.Z,{children:(0,i.jsxs)("span",{children:[a,(0,i.jsx)(g,{type:"danger",children:p}),s]})}):(0,i.jsx)(m.Z,{children:(0,i.jsx)("span",{children:t})});return c?f()(f()({},u),{},{title:l,key:r,children:e(c)}):f()(f()({},u),{},{title:l,key:r})}))}(t)}),[t,p]);return(0,i.jsxs)("div",{children:[(0,i.jsx)(Z,{placeholder:"请输入关键词搜索",onChange:function(e){var n=e.target.value,r=[];if((0,y.Z)(n))return l(r),k(n),void S(!0);t.forEach((function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&(t.title.includes(n)&&r.push(i),t.children&&t.children.forEach((function(n){return e(n,t.key)})))})),l(r),k(n),S(!0)}}),(0,i.jsx)(e,{treeData:E,getLayerInfo:c,onSelect:function(e,n){var t=n.node,r=s.includes(t.key)?s.filter((function(e){return e!==t.key})):[].concat(a()(s),[t.key]);l(r)},onExpand:function(e){l(e),S(!1)},expandedKeys:s,autoExpandParent:I})]})}},w=t(98330),b=t(32499),I=t(28833),S=t(39762),E=t(60711),_=t(88763),C=function(){var e=[{label:"收藏",icon:(0,i.jsx)(S.Z,{}),key:"favorite",onClick:function(){b.ZP.success("收藏成功")}},{label:"删除",icon:(0,i.jsx)(E.Z,{}),key:"delete",onClick:function(){b.ZP.success("删除")}}];return(0,i.jsx)(I.Z,{menu:{items:e},children:(0,i.jsx)(_.Z,{})})},P=t(38209),L=t(59876),D=t(47635),K=t(53447),N=t(27998),A=t(91829),z=t(43141),M=t(57040),R=t(59259),T=t(80379);const B=new Map([["feature",L.default],["geojson",D.default],["graphics",K.Z],["imagery",N.default],["imagery-tile",A.default],["integrated-mesh-3d-tiles",z.default],["map-image",M.default],["tile",R.default],["vector-tile",T.default]]);var O=({type:e,...n})=>new(B.get(e))(n),U=t(43909),G=t(90602),q=t(47307);var F=t(48316),V="container___Az_tF",$=["children","key"],H=function(e){return function(n){var t=n.treeData,c=n.getLayerInfo,u=(0,F.No)((function(e){return e.view})),o=(0,r.useMemo)((function(){return function e(n){return n.map((function(n){var t=n.children,r=n.key,c=d()(n,$),o=t&&t.length?null:(0,i.jsxs)(m.Z,{children:[(0,i.jsx)(w.Z,{onClick:function(e){e.stopPropagation(),((e,n)=>{const t=e.map.findLayerById(n);t&&e.goTo(t.fullExtent)})(u,r)}}),(0,i.jsx)(C,{})]});return o?f()(f()({},c),{},{key:r,isLeaf:!0,icon:o}):f()(f()({},c),{},{key:r,isLeaf:!1,children:e(t)})}))}(t)}),[t,u]);return(0,i.jsx)("div",{className:V,children:(0,i.jsx)(e,{treeData:o,getLayerInfo:c,showIcon:!0,blockNode:!0})})}},J=t(52362);const{view:Y}=F.No.getState();var Q=e=>n=>(t,r,i)=>n(((...n)=>{const[{checkedKeys:i}]=n;if(i){const{checkedKeys:n}=r(),t=(0,J.Z)(i,n),c=(0,J.Z)(n,i);t.forEach((n=>{if(!((e,n)=>!!e.map.findLayerById(n))(Y,n)){const t=e(n);(async(e,n)=>{if(!n)return;const{key:t,url:r,type:i,...c}=n,u=(0,U.Z)([[(0,G.Z)("type"),()=>O({id:t,...n})],[(0,G.Z)("url"),()=>P.Z.fromArcGISServerUrl({url:r,properties:{id:t,...c}})],[q.Z,()=>new P.Z({id:t,...c})]])(n);e.map.add(u)})(Y,t)}})),c.forEach((e=>((e,n)=>{const t=e.map.findLayerById(n);e.map.remove(t)})(Y,e)))}t(...n)}),r,i),W=t(82534),X=["treeData","getLayerInfo"],ee=function(e){var n=e.treeData,t=e.getLayerInfo,c=d()(e,X),u=(0,r.useMemo)((function(){return(0,F.kZ)(F.bh,[Q(t)])}),[t])(),o=u.checkedKeys,a=u.setCheckedKeys;return(0,i.jsx)(W.Z,f()(f()({},c),{},{checkable:!0,onCheck:function(e){a(e)},checkedKeys:o,treeData:n}))},ne=(t(81714),function(){return(0,i.jsx)("arcgis-legend",{"reference-element":"view"})}),te=t(73577),re=function(e){var n=e.view,t=(0,r.useRef)(),c=(0,r.useRef)();return(0,r.useEffect)((function(){return t.current&&(c.current=new te.Z({view:n,container:t.current})),function(){c.current&&c.current.destroy()}}),[n]),(0,i.jsx)("div",{ref:t})},ie=t(59958),ce=t(19960),ue=t(4925),oe=function(e){var n=e.view,t=e.mediaLayerConfig,c=(0,r.useRef)(null);(0,r.useEffect)((function(){return c.current=new ie.default(t),n.map.add(c.current),function(){n.map.remove(c.current)}}),[n,t]);return(0,i.jsxs)(ce.Z,{vertical:!0,gap:"middle",children:[(0,i.jsx)(ue.ZP,{type:"primary",block:!0,onClick:function(){c.current.visible=!0},children:"显示视频"}),(0,i.jsx)(ue.ZP,{type:"primary",block:!0,onClick:function(){c.current.visible=!1},children:"隐藏视频"})]})},ae=(t(53553),function(){return(0,i.jsx)("arcgis-sketch",{"reference-element":"view"})}),se=(t(47692),function(e){var n=e.view;return(0,r.useEffect)((function(){var e=n.environment.weather.clone();return function(){n.environment.weather=e}}),[n]),(0,i.jsx)("arcgis-weather",{"reference-element":"view"})}),fe=t(8444),le=t(75259),de=t(90403),ve=t(93427),he=p.Z.Text,ye=function(e){var n=e.view,t=n.zoom,c=(0,r.useState)(Math.round(t)),u=h()(c,2),o=u[0],a=u[1],s=(0,r.useRef)(new ve.Z({view:n}));return(0,r.useEffect)((function(){(0,de.YP)((function(){return n.zoom}),(function(e){a(Math.round(e))}))}),[n]),(0,i.jsxs)(ce.Z,{justify:"space-between",align:"center",children:[(0,i.jsxs)(he,{children:["层级:",o]}),(0,i.jsxs)(m.Z,{children:[(0,i.jsx)(ue.ZP,{type:"primary",icon:(0,i.jsx)(fe.Z,{}),onClick:function(){var e;null===(e=s.current)||void 0===e||e.zoomIn()}}),(0,i.jsx)(ue.ZP,{type:"primary",icon:(0,i.jsx)(le.Z,{}),onClick:function(){var e;null===(e=s.current)||void 0===e||e.zoomOut()}})]})]})},xe=t(24858),pe=t(70765),me=function(e){var n=e.view,t=(0,r.useRef)(),c=(0,r.useRef)(),u=(0,pe.useAccess)();return(0,r.useEffect)((function(){return t.current&&(c.current=new xe.Z({view:n,container:t.current,visibleElements:{settingsButton:u.canSeeAdmin,captureButton:u.canSeeAdmin}})),function(){c.current&&c.current.destroy()}}),[n,u]),(0,i.jsx)("div",{ref:t})}},86222:function(e,n,t){var r=t(15274);e.exports=function(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=r(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var i=0,c=function(){};return{s:c,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,o=!0,a=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){a=!0,u=e},f:function(){try{o||null==t.return||t.return()}finally{if(a)throw u}}}},e.exports.__esModule=!0,e.exports.default=e.exports}}]);