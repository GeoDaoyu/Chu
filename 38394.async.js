"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[38394],{28371:function(e,t,n){n.d(t,{h:function(){return s}});n(3480),n(28947);var i=n(92161),r=n(85913);n(62052),n(72728);function s(e,t,n){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:s=!1,timeOffset:o,useViewTime:l}=e;let a=e.timeExtent;s&&(a=function(e){if(!e)return e;const{start:t,end:n}=e;return new r.T({start:null!=t?(0,i.Nm)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=n?(0,i.Nm)(n,n.getTimezoneOffset(),"minutes"):n})}(a));let u=l?t&&a?t.intersection(a):t||a:a;return!u||u.isEmpty||u.isAllTime?u:(o&&(u=u.offset(-o.value,o.unit)),s&&(u=function(e){if(!e)return e;const{start:t,end:n}=e;return new r.T({start:null!=t?(0,i.Nm)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=n?(0,i.Nm)(n,-n.getTimezoneOffset(),"minutes"):n})}(u)),u.equals(n)?n:u)}},13689:function(e,t,n){n.d(t,{Z:function(){return w}});var i,r=n(73440),s=n(41773),o=n(63255),l=n(61100),a=n(17155),u=(n(61432),n(96711),n(83850),n(1194)),c=n(48023),d=n(29884),p=n(76554);let h=i=class extends o.Z{constructor(e){super(e)}async collectRequiredFields(e,t){return(0,p.io)(e,t,this.expression)}clone(){return new i({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};(0,r._)([(0,a.Cb)({type:String,json:{write:{isRequired:!0}}})],h.prototype,"expression",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],h.prototype,"title",void 0),h=i=(0,r._)([(0,c.j)("esri.symbols.support.FeatureExpressionInfo")],h);const f=h;var m,y=n(46368);const g=(0,s.w)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),_=new s.X({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let w=class extends o.Z{static{m=this}constructor(e){super(e),this.featureExpressionInfo=void 0,this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e.expression?e:void 0:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,n,i){t[n]=e.write({},i),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):null!=e||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new m({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&(0,l._W)(this.featureExpressionInfo,e.featureExpressionInfo)}};(0,r._)([(0,a.Cb)({type:f,json:{write:!0}})],w.prototype,"featureExpressionInfo",void 0),(0,r._)([(0,u.r)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],w.prototype,"readFeatureExpressionInfo",null),(0,r._)([(0,d.c)("featureExpressionInfo",{featureExpressionInfo:{type:f},"featureExpression.value":{type:[0]}})],w.prototype,"writeFeatureExpressionInfo",null),(0,r._)([(0,a.Cb)({type:g.apiValues,nonNullable:!0,json:{type:g.jsonValues,read:g.read,write:{writer:g.write,isRequired:!0}}})],w.prototype,"mode",null),(0,r._)([(0,a.Cb)({type:Number,json:{write:!0}})],w.prototype,"offset",void 0),(0,r._)([(0,a.Cb)({type:y.f9,json:{type:String,read:_.read,write:_.write}})],w.prototype,"unit",null),w=m=(0,r._)([(0,c.j)("esri.symbols.support.ElevationInfo")],w)},23099:function(e,t,n){n.d(t,{Z:function(){return j}});var i=n(73440),r=(n(61432),n(61100)),s=n(93568),o=n(90403),l=n(17155),a=(n(96711),n(83850),n(48023)),u=n(13132),c=n(47566),d=n(13689),p=n(58132),h=n(96094);n(96373),n(11034);function f(e){const t=function(e){return"constant"===e.kind?e.value[0]:e.values[e.values.length-1]}(function(e){if(!e.hasVisualVariables("size"))return{kind:"constant",value:[(0,h.F2)(e.trailWidth)]};const t=e.getVisualVariablesForType("size")[0],n=[],i=[];let r;if(t.stops){for(const e of t.stops)n.push(e.value),i.push((0,h.F2)(e.size));r=t.stops.length}else n.push(t.minDataValue,t.maxDataValue),i.push((0,h.F2)(t.minSize),(0,h.F2)(t.maxSize)),r=2;return{kind:"ramp",stops:n,values:i,count:r}}(e)),n=t,i=Math.max(t/2,5),r=Math.round((0,h.F2)(e.maxPathLength)/i)+1,{density:s}=e;return{smoothing:(0,h.F2)(e.smoothing),interpolate:!0,velocityScale:"flow-from"===e.flowRepresentation?1:-1,verticesPerLine:r,minSpeedThreshold:.001,segmentLength:i,maxTurnAngle:1,collisions:!0,lineCollisionWidth:n,lineSpacing:10,density:s}}function m(e,t){let n=!0;return n=n&&e.collisions===t.collisions,n=n&&e.density===t.density,n=n&&e.interpolate===t.interpolate,n=n&&e.lineCollisionWidth===t.lineCollisionWidth,n=n&&e.lineSpacing===t.lineSpacing,n=n&&e.maxTurnAngle===t.maxTurnAngle,n=n&&e.minSpeedThreshold===t.minSpeedThreshold,n=n&&e.segmentLength===t.segmentLength,n=n&&e.smoothing===t.smoothing,n=n&&e.velocityScale===t.velocityScale,n=n&&e.verticesPerLine===t.verticesPerLine,n}var y=n(92086),g=n(82846),_=n(27583),w=n(51870),b=n(55277),x=n(19843),v=n(55138);function T(e,t,n,i){const{spatialReference:r}=e;return function(e){const t=(0,b.c)(e),n=new x.U({width:2,color:(0,_.al)(.1,.2,1,1),innerWidth:1,innerColor:(0,_.al)(.2,.4,1,1),cap:v.R.ROUND});return t.map((e=>(0,b.Y)(n,e)))}(n.map((n=>n.map((n=>{const[s,o]=function({x:e,y:t},n){const{extent:i,size:[r,s]}=n;return[e/r*i.width+i.xmin,(s-t)/s*i.height+i.ymin]}(n,t),{absoluteZ:l}=(0,w.tq)(s,o,0,r,e,i),a=(0,g.al)(s,o,l);return e.renderCoordsHelper.toRenderCoords(a,r,a),a})))))}function E(e,t){return null==t?e:Math.max(e,t)}function I(e,t){return null==t?e:Math.min(e,t)}var S=n(70880),C=n(26475),F=n(94125),R=n(65759);class D{constructor(e,t){this.streamlines=e,this._geometries=t,this._object3D=null,this._engineLayer=null}get attached(){return null!=this._object3D&&null!=this._engineLayer}attach(e){const{_geometries:t}=this;if(null==t)return;this.detach();const n=new R.F(e,{pickable:!1,updatePolicy:F.j.SYNC}),i=new C.T({geometries:t});i.visible=!0,n.add(i),this._object3D=i,this._engineLayer=n}detach(){this.attached&&(this._engineLayer=(0,r.SC)(this._engineLayer),this._object3D=(0,r.M2)(this._object3D))}}let L=class extends S.Z{constructor(e){super(e),this.simulationSettings=null,this.loadImagery=null,this.createGeometry=null}async load(e,t){const n=await this.loadImagery(e,t);if(null==n)return null;const i=this._createFlowFieldFromData(n),r=this._getStreamlines(e,i),s=this.createGeometry(e,r);return new D(r,s)}_createFlowFieldFromData(e){return(0,p.hB)(this.simulationSettings,e)}_getStreamlines(e,t){const{size:[n,i]}=e;return(0,p.x5)(this.simulationSettings,t,n,i)}};(0,i._)([(0,l.Cb)()],L.prototype,"simulationSettings",void 0),(0,i._)([(0,l.Cb)()],L.prototype,"loadImagery",void 0),(0,i._)([(0,l.Cb)()],L.prototype,"createGeometry",void 0),L=(0,i._)([(0,a.j)("esri.views.3d.support.flow.StreamlinesStyle3D")],L);var z=n(25907);let j=class extends y.Z{constructor(e){super(e),this.type="flow",this._preorderIterator=new z.AA,this._abortController=null,this._debouncedLoad=(0,s.Ds)((async()=>{const{view:e,_style:t}=this;if(null==t)return;const n=this._computeExtent();if(null==n)return;const i={extent:n,timeExtent:this.layer.timeExtent,size:this._viewSizeWithEqualRatio(n),pixelRatio:e.state.contentPixelRatio};null==this._abortController&&(this._abortController=new AbortController);const r=this._abortController,o=await t.load(i,r.signal);(0,s.k_)(r.signal),null!=o&&(this._resources?.detach(),o.attach(e.stage),this._resources=o)})),this._loadImagery=(e,t)=>{const{extent:n,size:[i,r],timeExtent:s}=e;return(0,p.KK)(this.layer,n,i,r,s,t)},this._createFlowGeometry=(e,t)=>T(this.view,e,t,this.elevationInfo)}initialize(){this.addHandles([(0,o.gx)((()=>this.newStyleRequired),(()=>this._updateStyle()),o.Z_)]),this.updatingHandles.add((()=>this._style),(()=>this._triggerLoad())),this._updateStyle(),this.updatingHandles.addWhen((()=>!this.view.basemapTerrain?.updating),(()=>this._triggerLoad()))}destroy(){this._abortController=(0,r.IM)(this._abortController),this.clear()}get layer(){return this.layerView.layer}get flowRenderer(){const e=this.layer.renderer;return"flow"!==e?.type?null:e}get elevationInfo(){return new d.Z({mode:"absolute-height",offset:1e3})}get dataBounds(){const{fullExtent:e}=this.layer,{spatialReference:t}=this.view.basemapTerrain,n=(0,u.projectOrLoad)(e,t).geometry;return null==n?null:(0,c.oJ)(n)}get simulationSettings(){const{flowRenderer:e}=this;return null==e?null:f(e)}get newStyleRequired(){const e=this._style?.simulationSettings,t=this.simulationSettings;return null!=e&&null!=t&&!m(e,t)}doRefresh(){return this._triggerLoad()}clear(){this._resources?.detach(),this._resources=null}_triggerLoad(){return(0,s.R8)(this.updatingHandles.addPromise(this._debouncedLoad()))}_updateStyle(){const{simulationSettings:e}=this;null!=e&&(this._style?.destroy(),this._style=new L({simulationSettings:e,loadImagery:this._loadImagery,createGeometry:this._createFlowGeometry}))}_computeExtent(){const e=this.view.basemapTerrain,t=e?.rootTiles;if(null==t||0===t.length)return null;const{spatialReference:n}=e,{dataBounds:i}=this;if(!n||null==i)return null;const r=function(e,t,n){let[i,r,s,o]=[null,null,null,null];for(t.reset(e);!t.done;){const e=t.next();if(null==e)continue;if(!e.visible){t.skipSubtree();continue}const l=e.extent;e.leaf&&e.rendered&&(0,c.kK)(l,n)&&(i=I(l[0],i),r=I(l[1],r),s=E(l[2],s),o=E(l[3],o))}return null==i||null==r||null==s||null==o?null:(0,c.Ue)([i,r,s,o])}(t,this._preorderIterator,i);return null==r?null:((0,c.jV)(r,i,r),(0,c.HH)(r,n))}_viewSizeWithEqualRatio(e){const t=(e.xmax-e.xmin)/(e.ymax-e.ymin),[n,i]=this.view.size;return n<i?[n,Math.floor(n/t)]:[Math.floor(i*t),i]}get test(){}};(0,i._)([(0,l.Cb)()],j.prototype,"type",void 0),(0,i._)([(0,l.Cb)()],j.prototype,"_style",void 0),(0,i._)([(0,l.Cb)()],j.prototype,"layer",null),(0,i._)([(0,l.Cb)()],j.prototype,"flowRenderer",null),(0,i._)([(0,l.Cb)()],j.prototype,"elevationInfo",null),(0,i._)([(0,l.Cb)()],j.prototype,"dataBounds",null),(0,i._)([(0,l.Cb)()],j.prototype,"simulationSettings",null),(0,i._)([(0,l.Cb)()],j.prototype,"newStyleRequired",null),j=(0,i._)([(0,a.j)("esri.views.3d.layers.FlowSubView3D")],j)},55277:function(e,t,n){n.d(t,{Y:function(){return y},c:function(){return w}});var i=n(26821),r=n(41788),s=n(27583),o=n(47925),l=n(8008),a=n(60199),u=n(39909),c=n(38766),d=n(56172),p=n(81749),h=n(25952),f=n(52061),m=n(52964);function y(e,t,n=null){const r=[],y=t.mapPositions;!function(e,t){const{attributeData:{position:n},removeDuplicateStartEnd:i}=e,r=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(n)&&i,s=n.length/3-(r?1:0),o=new Array(2*(s-1)),l=r?n.slice(0,-3):n;let a=0;for(let e=0;e<s-1;e++)o[a++]=e,o[a++]=e+1;t.push([f.T.POSITION,new p.a(l,o,3,r)])}(t,r);const w=r[0][1].data,b=r[0][1].indices.length,x=(0,c.LE)(b);return function(e,t,n){if(null!=e.attributeData.colorFeature)return;const i=e.attributeData.color;t.push([f.T.COLOR,new p.a(i??s.hq,n,4)])}(t,r,x),function(e,t,n){null==e.attributeData.sizeFeature&&t.push([f.T.SIZE,new p.a([e.attributeData.size??1],n,1,!0)])}(t,r,x),function(e,t,n){e.attributeData.normal&&t.push([f.T.NORMAL,new p.a(e.attributeData.normal,n,3)])}(t,r,x),function(e,t,n){null!=e.attributeData.colorFeature&&t.push([f.T.COLORFEATUREATTRIBUTE,new p.a([e.attributeData.colorFeature],n,1,!0)])}(t,r,x),function(e,t,n){null!=e.attributeData.sizeFeature&&t.push([f.T.SIZEFEATUREATTRIBUTE,new p.a([e.attributeData.sizeFeature],n,1,!0)])}(t,r,x),function(e,t,n){null!=e.attributeData.opacityFeature&&t.push([f.T.OPACITYFEATUREATTRIBUTE,new p.a([e.attributeData.opacityFeature],n,1,!0)])}(t,r,x),function(e,t,n){if(null==e.overlayInfo||e.overlayInfo.renderCoordsHelper.viewingMode!==d.JY.Global||!e.overlayInfo.spatialReference.isGeographic)return;const r=(0,a.bg)(n.length),s=(0,o.Iu)(e.overlayInfo.spatialReference);for(let e=0;e<r.length;e+=3)(0,l.gH)(n,e,r,e,s);const c=n.length/3,h=(0,u.xx)(c+1);let m=g,y=_,w=0,b=0;(0,i.t8)(m,r[b++],r[b++]),b++,h[0]=0;for(let e=1;e<c+1;++e)e===c&&(b=0),(0,i.t8)(y,r[b++],r[b++]),b++,w+=(0,i.TK)(m,y),h[e]=w,[m,y]=[y,m];t.push([f.T.DISTANCETOSTART,new p.a(h,t[0][1].indices,1,!0)])}(t,r,w),new h.Z(e,r,y,m.V.Line,n)}const g=(0,r.Ue)(),_=(0,r.Ue)();function w(e,t){if(null==e||0===e.length)return[];const n=[];return e.forEach((e=>{const i=e.length,r=(0,a.bg)(3*i);e.forEach(((e,t)=>{r[3*t]=e[0],r[3*t+1]=e[1],r[3*t+2]=e[2]}));const s={attributeData:{position:r,normal:t},removeDuplicateStartEnd:!1};n.push(s)})),n}},85754:function(e,t,n){n.d(t,{V5:function(){return s},e7:function(){return r},zc:function(){return o}});var i=n(76554);async function r(e,t=e.popupTemplate){if(null==t)return[];const n=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:r}=t,{objectIdField:s,typeIdField:o,globalIdField:l,relationships:a}=e;if(n.includes("*"))return["*"];const u=r?(0,i.CH)(e):[],c=(0,i.Q0)(e.fieldsIndex,[...n,...u]);return o&&c.push(o),c&&s&&e.fieldsIndex?.has(s)&&!c.includes(s)&&c.push(s),c&&l&&e.fieldsIndex?.has(l)&&!c.includes(l)&&c.push(l),a&&a.forEach((t=>{const{keyField:n}=t;c&&n&&e.fieldsIndex?.has(n)&&!c.includes(n)&&c.push(n)})),c}function s(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function o(e,t){return null!=s(e,{defaultPopupTemplateEnabled:t})}},62052:function(e,t,n){n.d(t,{s:function(){return s}});var i=n(15322);class r extends i.G{constructor(e,t){super(e,t,"webmap")}}function s(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass}new r(2,34)}}]);