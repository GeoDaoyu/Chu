"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[22922],{29328:function(e,t,r){r.d(t,{F:function(){return f},M:function(){return i}});const i={Base64:0,Hex:1,String:2,Raw:3};function s(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function n(e){const t=[];for(let r=0,i=8*e.length;r<i;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function o(e){const t=[];for(let r=0,i=32*e.length;r<i;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}function a(e,t,r,i,n,o){return s(function(e,t){return e<<t|e>>>32-t}(s(s(t,e),s(i,o)),n),r)}function l(e,t,r,i,s,n,o){return a(t&r|~t&i,e,t,s,n,o)}function u(e,t,r,i,s,n,o){return a(t&i|r&~i,e,t,s,n,o)}function c(e,t,r,i,s,n,o){return a(t^r^i,e,t,s,n,o)}function d(e,t,r,i,s,n,o){return a(r^(t|~i),e,t,s,n,o)}function h(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let r=1732584193,i=-271733879,n=-1732584194,o=271733878;for(let t=0;t<e.length;t+=16){const a=r,h=i,f=n,p=o;r=l(r,i,n,o,e[t],7,-680876936),o=l(o,r,i,n,e[t+1],12,-389564586),n=l(n,o,r,i,e[t+2],17,606105819),i=l(i,n,o,r,e[t+3],22,-1044525330),r=l(r,i,n,o,e[t+4],7,-176418897),o=l(o,r,i,n,e[t+5],12,1200080426),n=l(n,o,r,i,e[t+6],17,-1473231341),i=l(i,n,o,r,e[t+7],22,-45705983),r=l(r,i,n,o,e[t+8],7,1770035416),o=l(o,r,i,n,e[t+9],12,-1958414417),n=l(n,o,r,i,e[t+10],17,-42063),i=l(i,n,o,r,e[t+11],22,-1990404162),r=l(r,i,n,o,e[t+12],7,1804603682),o=l(o,r,i,n,e[t+13],12,-40341101),n=l(n,o,r,i,e[t+14],17,-1502002290),i=l(i,n,o,r,e[t+15],22,1236535329),r=u(r,i,n,o,e[t+1],5,-165796510),o=u(o,r,i,n,e[t+6],9,-1069501632),n=u(n,o,r,i,e[t+11],14,643717713),i=u(i,n,o,r,e[t],20,-373897302),r=u(r,i,n,o,e[t+5],5,-701558691),o=u(o,r,i,n,e[t+10],9,38016083),n=u(n,o,r,i,e[t+15],14,-660478335),i=u(i,n,o,r,e[t+4],20,-405537848),r=u(r,i,n,o,e[t+9],5,568446438),o=u(o,r,i,n,e[t+14],9,-1019803690),n=u(n,o,r,i,e[t+3],14,-187363961),i=u(i,n,o,r,e[t+8],20,1163531501),r=u(r,i,n,o,e[t+13],5,-1444681467),o=u(o,r,i,n,e[t+2],9,-51403784),n=u(n,o,r,i,e[t+7],14,1735328473),i=u(i,n,o,r,e[t+12],20,-1926607734),r=c(r,i,n,o,e[t+5],4,-378558),o=c(o,r,i,n,e[t+8],11,-2022574463),n=c(n,o,r,i,e[t+11],16,1839030562),i=c(i,n,o,r,e[t+14],23,-35309556),r=c(r,i,n,o,e[t+1],4,-1530992060),o=c(o,r,i,n,e[t+4],11,1272893353),n=c(n,o,r,i,e[t+7],16,-155497632),i=c(i,n,o,r,e[t+10],23,-1094730640),r=c(r,i,n,o,e[t+13],4,681279174),o=c(o,r,i,n,e[t],11,-358537222),n=c(n,o,r,i,e[t+3],16,-722521979),i=c(i,n,o,r,e[t+6],23,76029189),r=c(r,i,n,o,e[t+9],4,-640364487),o=c(o,r,i,n,e[t+12],11,-421815835),n=c(n,o,r,i,e[t+15],16,530742520),i=c(i,n,o,r,e[t+2],23,-995338651),r=d(r,i,n,o,e[t],6,-198630844),o=d(o,r,i,n,e[t+7],10,1126891415),n=d(n,o,r,i,e[t+14],15,-1416354905),i=d(i,n,o,r,e[t+5],21,-57434055),r=d(r,i,n,o,e[t+12],6,1700485571),o=d(o,r,i,n,e[t+3],10,-1894986606),n=d(n,o,r,i,e[t+10],15,-1051523),i=d(i,n,o,r,e[t+1],21,-2054922799),r=d(r,i,n,o,e[t+8],6,1873313359),o=d(o,r,i,n,e[t+15],10,-30611744),n=d(n,o,r,i,e[t+6],15,-1560198380),i=d(i,n,o,r,e[t+13],21,1309151649),r=d(r,i,n,o,e[t+4],6,-145523070),o=d(o,r,i,n,e[t+11],10,-1120210379),n=d(n,o,r,i,e[t+2],15,718787259),i=d(i,n,o,r,e[t+9],21,-343485551),r=s(r,a),i=s(i,h),n=s(n,f),o=s(o,p)}return[r,i,n,o]}function f(e,t=i.Hex){const r=t||i.Base64,s=h(n(e),8*e.length);switch(r){case i.Raw:return s;case i.Hex:return function(e){const t="0123456789abcdef",r=[];for(let i=0,s=4*e.length;i<s;i++)r.push(t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15));return r.join("")}(s);case i.String:return o(s);case i.Base64:return function(e){const t=[];for(let r=0,i=4*e.length;r<i;r+=3){const i=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255;for(let s=0;s<4;s++)8*r+6*s>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-s)&63))}return t.join("")}(s)}}},86640:function(e,t,r){r.d(t,{Z:function(){return m}});var i,s=r(73440),n=r(3480),o=r(41773),a=r(63255),l=r(26636),u=r(8914),c=r(17155),d=(r(61432),r(96711),r(1194)),h=r(48023),f=r(29884);const p=(0,o.w)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),g=p.jsonValues.slice();(0,n.e$)(g,"orthometric");const y=(0,o.w)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let m=i=class extends a.Z{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,r){return p.write(e,t,r)}readHeightModel(e,t,r){return p.read(e)||(r?.messages&&r.messages.push(function(e,t){return new u.Z("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}(e,{context:r})),null)}readHeightUnit(e,t,r){return y.read(e)||(r?.messages&&r.messages.push(b(e,{context:r})),null)}readHeightUnitService(e,t,r){return(0,l.$C)(e)||y.read(e)||(r?.messages&&r.messages.push(b(e,{context:r})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new i({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const r=(0,l.cM)(t);return new i({heightModel:e.heightModel,heightUnit:r??void 0,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new i;return t.read(e,{origin:"web-scene"}),t}};function b(e,t){return new u.Z("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}(0,s._)([(0,c.Cb)({type:p.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:g,default:"ellipsoidal",write:{isRequired:!0}}}}})],m.prototype,"heightModel",void 0),(0,s._)([(0,f.c)("web-scene","heightModel")],m.prototype,"writeHeightModel",null),(0,s._)([(0,d.r)(["web-scene","service"],"heightModel")],m.prototype,"readHeightModel",null),(0,s._)([(0,c.Cb)({type:y.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:y.jsonValues,write:{writer:y.write,isRequired:!0}}}}})],m.prototype,"heightUnit",void 0),(0,s._)([(0,d.r)("web-scene","heightUnit")],m.prototype,"readHeightUnit",null),(0,s._)([(0,d.r)("service","heightUnit")],m.prototype,"readHeightUnitService",null),(0,s._)([(0,c.Cb)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],m.prototype,"vertCRS",void 0),(0,s._)([(0,d.r)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],m.prototype,"readVertCRS",null),m=i=(0,s._)([(0,h.j)("esri.geometry.HeightModelInfo")],m)},4469:function(e,t,r){r.d(t,{DE:function(){return a},Nf:function(){return u},dp:function(){return o},o2:function(){return l},yZ:function(){return n}});var i=r(99574),s=r(26636);function n(e,t){const r=t||e.extent,i=e.width,n=(0,s.c9)(r?.spatialReference);return r&&i?r.width/i*n*s.hd*96:0}function o(e,t){return e/((0,s.c9)(t)*s.hd*96)}function a(e){return e/(96*s.hd)}function l(e,t,r){return function(e,t){return 0===t||(0,i.W8)(e,t)||e<t}(e,t)&&function(e,t){return 0===t||(0,i.W8)(e,t)||e>t}(e,r)}function u(e,t){return(0,i.W8)(e,t)?0:(e||Number.POSITIVE_INFINITY)>(t||Number.POSITIVE_INFINITY)?1:-1}},56346:function(e,t,r){r.d(t,{Z:function(){return h}});var i=r(73440),s=r(70880),n=r(3480),o=r(29292),a=r(43254),l=r(17155),u=(r(61432),r(96711),r(48023)),c=r(76554),d=r(3411);let h=class extends s.Z{constructor(e){super(e),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){return this.expressionsUsedInTitle.length>0?this._get("_arcadeTask")||(0,o.vr)((()=>(0,d.L)())):null}get featureUtilsPromise(){return this._get("featureUtilsPromise")??r.e(11407).then(r.bind(r,11407)).then((e=>this._featureUtils=e))}get calculatedExpressions(){const e=new a.Z;if(!this.expressionsUsedInTitle.length)return e;if(!this._arcadeTask?.value){for(const t of this.expressionsUsedInTitle??[])e.push({name:t.name,invalid:!0});return e}for(const t of this.expressionsUsedInTitle)try{const r=this._arcadeTask.value.arcade.parseScript(t.expression,["$layer","$map","$datastore"]);if(r.isAsync){e.push({name:t.name,invalid:!0});break}e.push({name:t.name,syntax:r,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(r,{vars:{$feature:"any"}})})}catch{e.push({name:t.name,invalid:!0});break}return e}get expressionsUsedInTitle(){let e=this.effectivePopupTemplate?.title??"";return"string"!=typeof e?[]:(e=e.toLowerCase(),this.effectivePopupTemplate?.expressionInfos?.filter((t=>e.includes(`{expression/${t.name.toLowerCase()}}`)))??[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some((e=>!0===e.invalid))}get requiredFields(){const e=new Set;if(this._arcadeTask?.value&&!this.hasBadExpressions)for(const t of this.calculatedExpressions?.toArray()??[])try{const r=this._arcadeTask.value.arcade.extractFieldLiterals(t.syntax);for(const t of r){const r=t.split("."),i=this.fieldsIndex.get(r.at(-1)??"");i&&e.add(i.name)}}catch{}const t=this._extractFieldNames(this.workingTitle);for(const r of t){const t=this.fieldsIndex.get(r);t&&e.add(t.name)}return null!=this.objectIdField&&e.add(this.objectIdField),e}get titleFromDisplayField(){let e="";return this.displayField&&(e=this.fieldsIndex.get(this.displayField)?.name??""),e||(e=this.fieldsIndex.get(this.objectIdField)?.name??""),e?`{${e}}`:""}get workingTitle(){const e=this.effectivePopupTemplate?this.effectivePopupTemplate.title:"";return""===e||null==e||this.hasBadExpressions||"string"!=typeof e?this.titleFromDisplayField:e}async getTitle(e,t,r){const i=t.getObjectId()??t.attributes[e.objectIdField];return(await this.getTitles(e,[t],r)).get(i)??""}async getTitles(e,t,r){const i=new Map,s=r?.timeZone??"system";try{const[{substituteFieldsInLinksAndAttributes:n}]=await Promise.all([this.featureUtilsPromise,this._arcadeTask?.promise]);r?.fetchMissingFields&&(t=await this._checkAndReQueryGraphics(e,t));const{fieldInfoMap:o,workingTitle:a}=this,l=a&&o;t.forEach((t=>{const r=t.getObjectId()??t.attributes[e.objectIdField],u=l?n({attributes:t.attributes,expressionAttributes:null,fieldInfoMap:o,globalAttributes:this._createFormattedAttributes(e,t,s).global,layer:e,text:a}):"";i.set(r,u)}))}catch{}return i}async _checkAndReQueryGraphics(e,t){const r=t.map((t=>t.getObjectId()??t.attributes[e.objectIdField])).filter(n.pC);if(r.length!==t.length)return t;if(t.some((e=>!(0,c.R9)(e,this.requiredFields)))){const i=e.createQuery();i.where="1=1",i.outFields=[...this.requiredFields],i.objectIds=r;const s=await e.queryFeatures(i);if(s?.features.length===t.length)return s.features}return t}_createFieldInfoMap(e){const t=new Map;if(!e)return t;for(const r of e){if(!r.fieldName)continue;const e=this.fieldsIndex.get(r.fieldName)?.name??r.fieldName;r.fieldName=e,t.set(e.toLowerCase(),r)}return t}_createFormattedAttributes(e,t,r="system"){const i=this.effectivePopupTemplate?.fieldInfos??[],s={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&this._arcadeTask?.value){const r=this._arcadeTask.value.Feature.createFromGraphicLikeObject(t.geometry,t.attributes,e,null);for(const e of this.calculatedExpressions)try{s[`expression/${e.name}`]=e.func({vars:{$feature:r}})}catch{}}const n={...t.attributes,...s};return{global:this._featureUtils.formatAttributes({fieldInfos:i,attributes:n,graphic:t,timeZone:r,layer:e,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(e){return(0,c.ld)(e).filter((e=>!(0===e.indexOf("relationships/")||0===e.indexOf("expression/"))))}};(0,i._)([(0,l.Cb)({readOnly:!0})],h.prototype,"_arcadeTask",null),(0,i._)([(0,l.Cb)()],h.prototype,"_featureUtils",void 0),(0,i._)([(0,l.Cb)({readOnly:!0})],h.prototype,"featureUtilsPromise",null),(0,i._)([(0,l.Cb)({readOnly:!0})],h.prototype,"calculatedExpressions",null),(0,i._)([(0,l.Cb)()],h.prototype,"displayField",void 0),(0,i._)([(0,l.Cb)()],h.prototype,"effectivePopupTemplate",void 0),(0,i._)([(0,l.Cb)()],h.prototype,"expressionsUsedInTitle",null),(0,i._)([(0,l.Cb)()],h.prototype,"fieldsIndex",void 0),(0,i._)([(0,l.Cb)()],h.prototype,"fieldInfoMap",null),(0,i._)([(0,l.Cb)()],h.prototype,"fields",void 0),(0,i._)([(0,l.Cb)()],h.prototype,"objectIdField",void 0),(0,i._)([(0,l.Cb)()],h.prototype,"requiredFields",null),h=(0,i._)([(0,u.j)("esri.layers.support.TitleCreator")],h)},3651:function(e,t,r){var i;r.d(t,{x:function(){return i}}),function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"}(i||(i={}))}}]);