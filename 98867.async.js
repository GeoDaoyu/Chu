"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[98867],{45415:function(e,t,r){function s(e,t,r,s,n){i(e,t,r||0,s||e.length-1,n||a)}function i(e,t,r,s,a){for(;s>r;){if(s-r>600){var o=s-r+1,l=t-r+1,c=Math.log(o),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(o-u)/o)*(l-o/2<0?-1:1);i(e,t,Math.max(r,Math.floor(t-l*u/o+d)),Math.min(s,Math.floor(t+(o-l)*u/o+d)),a)}var h=e[t],f=r,g=s;for(n(e,r,t),a(e[s],h)>0&&n(e,r,s);f<g;){for(n(e,f,g),f++,g--;a(e[f],h)<0;)f++;for(;a(e[g],h)>0;)g--}0===a(e[r],h)?n(e,r,g):n(e,++g,s),g<=t&&(r=g+1),t<=g&&(s=g-1)}}function n(e,t,r){var s=e[t];e[t]=e[r],e[r]=s}function a(e,t){return e<t?-1:e>t?1:0}r.d(t,{q:function(){return s}})},96946:function(e,t,r){r.d(t,{Q:function(){return o},b:function(){return L}});var s=r(3480),i=r(79487),n=(r(61432),r(63974)),a=r(45415);class o{constructor(e=9,t){this._compareMinX=h,this._compareMinY=f,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),v.prune(),T.prune(),I.prune(),E.prune()}all(e){l(this._data,e)}search(e,t){let r=this._data;const s=this._toBBox;if(b(e,r))for(v.clear();r;){for(let i=0,n=r.children.length;i<n;i++){const n=r.children[i],a=r.leaf?s(n):n;b(e,a)&&(r.leaf?t(n):p(e,a)?l(n,t):v.push(n))}r=v.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!b(e,t))return!1;for(v.clear();t;){for(let s=0,i=t.children.length;s<i;s++){const i=t.children[s],n=t.leaf?r(i):i;if(b(e,n)){if(t.leaf||p(e,n))return!0;v.push(i)}}t=v.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new M([]),this}remove(e){if(!e)return this;let t,r=this._data,n=null,a=0,o=!1;const l=this._toBBox(e);for(I.clear(),E.clear();r||I.length>0;){if(r||(r=I.pop(),n=I.data[I.length-1],a=E.pop()??0,o=!0),r.leaf&&(t=(0,s.cq)(r.children,(0,i.CY)(e),r.children.length,r.indexHint),-1!==t))return r.children.splice(t,1),I.push(r),this._condense(I),this;o||r.leaf||!p(r,l)?n?(a++,r=n.children[a],o=!1):r=null:(I.push(r),E.push(a),a=0,n=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,s){const i=r-t+1;let n=this._maxEntries;if(i<=n){const s=new M(e.slice(t,r+1));return c(s,this._toBBox),s}s||(s=Math.ceil(Math.log(i)/Math.log(n)),n=Math.ceil(i/n**(s-1)));const a=new A([]);a.height=s;const o=Math.ceil(i/n),l=o*Math.ceil(Math.sqrt(n));S(e,t,r,l,this._compareMinX);for(let i=t;i<=r;i+=l){const t=Math.min(i+l-1,r);S(e,i,t,o,this._compareMinY);for(let r=i;r<=t;r+=o){const i=Math.min(r+o-1,t);a.children.push(this._build(e,r,i,s-1))}}return c(a,this._toBBox),a}_insert(e,t,r){const s=this._toBBox,i=r?e:s(e);I.clear();const n=function(e,t,r,s){for(;s.push(t),!0!==t.leaf&&s.length-1!==r;){let r,s=1/0,i=1/0;for(let n=0,a=t.children.length;n<a;n++){const a=t.children[n],o=g(a),l=y(e,a)-o;l<i?(i=l,s=o<s?o:s,r=a):l===i&&o<s&&(s=o,r=a)}t=r||t.children[0]}return t}(i,this._data,t,I);for(n.children.push(e),d(n,i);t>=0&&I.data[t].children.length>this._maxEntries;)this._split(I,t),t--;!function(e,t,r){for(let s=r;s>=0;s--)d(t.data[s],e)}(i,I,t)}_split(e,t){const r=e.data[t],s=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,s);const n=this._chooseSplitIndex(r,i,s);if(!n)return;const a=r.children.splice(n,r.children.length-n),o=r.leaf?new M(a):new A(a);o.height=r.height,c(r,this._toBBox),c(o,this._toBBox),t?e.data[t-1].children.push(o):this._splitRoot(r,o)}_splitRoot(e,t){this._data=new A([e,t]),this._data.height=e.height+1,c(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let s,i,n;s=i=1/0;for(let a=t;a<=r-t;a++){const t=u(e,0,a,this._toBBox),o=u(e,a,r,this._toBBox),l=_(t,o),c=g(t)+g(o);l<s?(s=l,n=a,i=c<i?c:i):l===s&&c<i&&(i=c,n=a)}return n}_chooseSplitAxis(e,t,r){const s=e.leaf?this._compareMinX:h,i=e.leaf?this._compareMinY:f;this._allDistMargin(e,t,r,s)<this._allDistMargin(e,t,r,i)&&e.children.sort(s)}_allDistMargin(e,t,r,s){e.children.sort(s);const i=this._toBBox,n=u(e,0,t,i),a=u(e,r-t,r,i);let o=m(n)+m(a);for(let s=t;s<r-t;s++){const t=e.children[s];d(n,e.leaf?i(t):t),o+=m(n)}for(let s=r-t-1;s>=t;s--){const t=e.children[s];d(a,e.leaf?i(t):t),o+=m(a)}return o}_condense(e){for(let t=e.length-1;t>=0;t--){const r=e.data[t];if(0===r.children.length)if(t>0){const i=e.data[t-1],n=i.children;n.splice((0,s.cq)(n,r,n.length,i.indexHint),1)}else this.clear();else c(r,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function l(e,t){let r=e;for(T.clear();r;){if(!0===r.leaf)for(const e of r.children)t((0,i.CY)(e));else T.pushArray(r.children);r=T.pop()??null}}function c(e,t){u(e,0,e.children.length,t,e)}function u(e,t,r,s,i){i||(i=new M([])),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let n,a=t;a<r;a++)n=e.children[a],d(i,e.leaf?s(n):n);return i}function d(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function h(e,t){return e.minX-t.minX}function f(e,t){return e.minY-t.minY}function g(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function m(e){return e.maxX-e.minX+(e.maxY-e.minY)}function y(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function _(e,t){const r=Math.max(e.minX,t.minX),s=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),n=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,n-s)}function p(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function b(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function S(e,t,r,s,i){const n=[t,r];for(;n.length;){const t=n.pop(),r=n.pop();if(t-r<=s)continue;const o=r+Math.ceil((t-r)/s/2)*s;(0,a.q)(e,o,r,t,i),n.push(r,o,o,t)}}const v=new n.Z,T=new n.Z,I=new n.Z,E=new n.Z({deallocator:void 0});class L{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class R extends L{constructor(){super(...arguments),this.height=1,this.indexHint=new s.SO}}class M extends R{constructor(e){super(),this.children=e,this.leaf=!0}}class A extends R{constructor(e){super(),this.children=e,this.leaf=!1}}},96610:function(e,t,r){r.d(t,{G6:function(){return w},IN:function(){return a},Ie:function(){return x},J9:function(){return M},Jd:function(){return n},Kq:function(){return L},RF:function(){return E},U1:function(){return A},oh:function(){return i},s9:function(){return R},vY:function(){return s}});r(90756);function s(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null}function i(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:s}=e,i=r[0]??1,n=r[1]??1;return{originPosition:"lowerLeft",scale:[i,"lowerLeft"===t?n:-n,r[2]??1,r[3]??1],translate:[s[0]??0,s[1]??0,s[2]??0,s[3]??0]}}function n({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function a({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function o({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}function l({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}function c(e,t){return e&&t?f:e&&!t?d:!e&&t?h:u}const u=(e,t)=>{const r=[];if(!t.length)return null;const s=t[0];let i=n(e,s[0]),o=a(e,s[1]);r.push([i,o]);for(let s=1;s<t.length;s++){const[l,c]=t[s],u=n(e,l),d=a(e,c);u===i&&d===o||r.push([u-i,d-o]),i=u,o=d}return r},d=(e,t)=>{const r=[];if(!t.length)return null;const s=t[0];let i=n(e,s[0]),l=a(e,s[1]),c=o(e,s[2]);r.push([i,l,c]);for(let s=1;s<t.length;s++){const[u,d,h]=t[s],f=n(e,u),g=a(e,d),m=o(e,h);f===i&&g===l&&m===c||r.push([f-i,g-l,m]),i=f,l=g,c=m}return r},h=(e,t)=>{const r=[];if(!t.length)return null;const s=t[0];let i=n(e,s[0]),o=a(e,s[1]),c=l(e,s[2]);r.push([i,o,c]);for(let s=1;s<t.length;s++){const[u,d,h]=t[s],f=n(e,u),g=a(e,d),m=l(e,h);f===i&&g===o&&m===c||r.push([f-i,g-o,m]),i=f,o=g,c=m}return r},f=(e,t)=>{const r=[];if(!t.length)return null;const s=t[0];let i=n(e,s[0]),c=a(e,s[1]),u=o(e,s[2]),d=l(e,s[3]);r.push([i,c,u,d]);for(let s=1;s<t.length;s++){const[h,f,g,m]=t[s],y=n(e,h),_=a(e,f),p=o(e,g),b=l(e,m);y===i&&_===c&&p===u&&b===d||r.push([y-i,_-c,p,b]),i=y,c=_,u=p,d=b}return r};function g({scale:e,translate:t},r){return r*e[0]+t[0]}function m({scale:e,translate:t},r){return r*e[1]+t[1]}function y({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function _({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function p(e,t){return e&&t?T:e&&!t?S:!e&&t?v:b}const b=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=g(e,s[0]),n=m(e,s[1]);r[0]=[i,n];const{scale:a,originPosition:o}=e,l=a[0],c="lowerLeft"===o?a[1]:-a[1];for(let e=1;e<t.length;e++){const[s,a]=t[e];i+=l*s,n+=c*a,r[e]=[i,n]}return r},S=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=g(e,s[0]),n=m(e,s[1]);r[0]=[i,n,y(e,s[2])];const{scale:a,originPosition:o}=e,l=a[0],c="lowerLeft"===o?a[1]:-a[1];for(let s=1;s<t.length;s++){const[a,o,u]=t[s];i+=l*a,n+=c*o,r[s]=[i,n,y(e,u)]}return r},v=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=g(e,s[0]),n=m(e,s[1]);r[0]=[i,n,_(e,s[2])];const{scale:a,originPosition:o}=e,l=a[0],c="lowerLeft"===o?a[1]:-a[1];for(let s=1;s<t.length;s++){const[a,o,u]=t[s];i+=l*a,n+=c*o,r[s]=[i,n,_(e,u)]}return r},T=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=g(e,s[0]),n=m(e,s[1]);r[0]=[i,n,y(e,s[2]),_(e,s[3])];const{scale:a,originPosition:o}=e,l=a[0],c="lowerLeft"===o?a[1]:-a[1];for(let s=1;s<t.length;s++){const[a,o,u,d]=t[s];i+=l*a,n+=c*o,r[s]=[i,n,y(e,u),_(e,d)]}return r};function I(e,t,r){const s=new Array(r.length);for(let i=0;i<r.length;i++)s[i]=t(e,r[i]);return s}function E(e,t,r){const s=i(e);return t.x=n(s,r.x),t.y=a(s,r.y),null!=r.z&&(t.z=o(s,r.z)),null!=r.m&&(t.m=l(s,r.m)),t}function L(e,t,r){const s=function(e,t,r,s){const i=[],n=c(r,s);for(let r=0;r<t.length;r++){const s=n(e,t[r]);s&&s.length>=3&&i.push(s)}return i.length?i:null}(i(e),r.rings,r.hasZ,r.hasM);return s?(t.rings=s,t.hasZ=r.hasZ??!1,t.hasM=r.hasM??!1,t):null}function R(e,t,r){const s=function(e,t,r,s){const i=[],n=c(r,s);for(let r=0;r<t.length;r++){const s=n(e,t[r]);s&&s.length>=2&&i.push(s)}return i.length?i:null}(i(e),r.paths,r.hasZ,r.hasM);return s?(t.paths=s,t.hasZ=r.hasZ??!1,t.hasM=r.hasM??!1,t):null}function M(e,t,r,s=r?.hasZ??!1,n=r?.hasM??!1){if(null!=r){const a=i(e);t.points=p(s,n)(a,r.points),t.hasZ=s,t.hasM=n}return t}function A(e,t,r,s=null!=r?.z,n=null!=r?.m){if(null==r)return t;const a=i(e);return t.x=g(a,r.x),t.y=m(a,r.y),s&&(t.z=y(a,r.z)),n&&(t.m=_(a,r.m)),t}function x(e,t,r,s=r?.hasZ??!1,n=r?.hasM??!1){if(null!=r){const a=i(e);t.rings=I(a,p(s,n),r.rings),t.hasZ=s,t.hasM=n}return t}function w(e,t,r,s=r?.hasZ??!1,n=r?.hasM??!1){if(null!=r){const a=i(e);t.paths=I(a,p(s,n),r.paths),t.hasZ=s,t.hasM=n}return t}},70677:function(e,t,r){r.d(t,{H:function(){return l}});var s=r(61432),i=r(96946),n=r(47566);const a={minX:0,minY:0,maxX:0,maxY:0};function o(e,t,r){(function(e){a.minX=e[0],a.minY=e[1],a.maxX=e[2],a.maxY=e[3]})(t),e.search(a,r)}class l{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new i.Q(9,(0,s.Z)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach(((r,s)=>{e[t++]=s})),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((e=>this._idByBounds.has(e)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=(0,n.cS)();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),o(this._index,e,(e=>t(this._idByBounds.get(e))))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},95014:function(e,t,r){r.d(t,{Z:function(){return g}});var s=r(3480),i=r(88194),n=r(87833),a=r(96711),o=r(16447),l=r(47566),c=r(64246),u=r(70677),d=r(14588),h=r(80613);const f=(0,o.Ue)();class g{constructor(e){this.geometryInfo=e,this._boundsStore=new u.H,this._featuresById=new Map,this._usedMemory=0,this.events=new n.Z,this.featureAdapter=h.n}get usedMemory(){return this._usedMemory}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,r,s,i]=this.fullBounds;return{xmin:t,ymin:r,xmax:s,ymax:i,spatialReference:(0,d.S2)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(e){const t=e.map((e=>this._upsert(e)));return this._emitChanged(),t.filter(s.pC)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged(),this._usedMemory=0}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const r of e){const e=this._boundsStore.get(r.objectId);e&&t((0,o.JR)(f,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const t=e.objectId;if(null==t)return void a.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new i.Z("featurestore:invalid-feature","feature id is missing",{feature:e}));const r=this._featuresById.get(t);let s;if(r?(e.displayId=r.displayId,s=this._boundsStore.get(t),this._boundsStore.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(r)??0):null!=this.onFeatureAdd&&this.onFeatureAdd(e),!e.geometry?.coords?.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);s=(0,c.$)(null!=s?s:(0,l.Ue)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=s&&this._boundsStore.set(t,s),this._featuresById.set(t,e),this._usedMemory+=this.estimateFeatureUsedMemory?.(e)??0}_upsert(e){const t=e?.objectId;if(null==t)return a.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new i.Z("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const r=this._featuresById.get(t);if(!r)return this._add(e),e;this._usedMemory-=this.estimateFeatureUsedMemory?.(r)??0;const{geometry:s,attributes:n}=e;for(const e in n)r.attributes[e]=n[e];return s&&(r.geometry=s,this._boundsStore.set(t,(0,c.$)((0,l.Ue)(),s,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),this._usedMemory+=this.estimateFeatureUsedMemory?.(r)??0,r}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._boundsStore.delete(t),this._featuresById.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(e)??0,e}}},57536:function(e,t,r){r.d(t,{T:function(){return g}});var s=r(28947),i=r(93568),n=r(90756),a=r(34042),o=r(8554),l=r(85240),c=r(33235),u=r(81499),d=r(70196),h=r(73176),f=r(95584);async function g(e,t,r){const g=(0,i.$h)(r),{point:m,distance:y,returnEdge:_,vertexMode:p}=t;if(!_&&"none"===p)return{candidates:[]};let b=(0,s.d9)(t.query);b=await e.schedule((()=>(0,d.j6)(b,e.definitionExpression,e.spatialReference)),g),b=await e.reschedule((()=>(0,h.O_)(b,{availableFields:e.availableFields,fieldsIndex:e.fieldsIndex,geometryType:e.geometryType,spatialReference:e.spatialReference})),g);const S=!(0,o.fS)(m.spatialReference,e.spatialReference);S&&await(0,l._W)(m.spatialReference,e.spatialReference);const v="number"==typeof y?y:y.x,T="number"==typeof y?y:y.y,I={xmin:m.x-v,xmax:m.x+v,ymin:m.y-T,ymax:m.y+T,spatialReference:m.spatialReference},E=S?(0,l.iV)(I,e.spatialReference):I;if(!E)return{candidates:[]};const L=(await(0,a.aX)((0,n.im)(m),null,{signal:g}))[0],R=(await(0,a.aX)((0,n.im)(E),null,{signal:g}))[0];if(null==L||null==R)return{candidates:[]};const M=new u.y(await e.reschedule((()=>e.searchFeatures((0,c.e)(R.toJSON()))),g),b,e);await e.reschedule((()=>e.executeObjectIdsQuery(M)),g),await e.reschedule((()=>e.executeTimeQuery(M)),g),await e.reschedule((()=>e.executeAttributesQuery(M)),g),await e.reschedule((()=>async function(e,t,r){const{query:s}=t,{spatialRel:i}=s;if(!t?.items?.length||!s.geometry||!i)return;const n=await(0,f.cW)(i,s.geometry,e.geometryType,e.hasZ,e.hasM),a=await e.runSpatialFilter(t.items,(e=>n(e.geometry)),r);t.items=a}(e,M,g)),g);const A=L.toJSON(),x=S?(0,l.iV)(A,e.spatialReference):A,w=S?Math.max(E.xmax-E.xmin,E.ymax-E.ymin)/2:y;return M.createSnappingResponse({...t,point:x,distance:w},b.returnZ,m.spatialReference)}},80613:function(e,t,r){r.d(t,{n:function(){return i}});var s=r(24564);const i={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new s.u_(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>e.ensureCentroid(t)}},47641:function(e,t,r){r.d(t,{b:function(){return a}});var s=r(93568),i=r(39355),n=r(78891);class a{constructor(){this._tasks=new Array,this._numPendingTasks=(0,i.t)(0),this._running=(0,i.t)(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get running(){return this._running.value}_updateRunning(){this._running.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return n.J;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return new Promise(((s,i)=>{this._tasks.push(new o(s,i,e,t,r)),++this._numPendingTasks.value,this._updateRunning()})).finally((()=>--this._numPendingTasks.value))}unshift(e,t,r){return new Promise(((s,i)=>{this._tasks.unshift(new o(s,i,e,t,r)),++this._numPendingTasks.value,this._updateRunning()})).finally((()=>--this._numPendingTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();this._updateRunning();try{const r=(0,s.Hc)(t.signal);if(r&&!t.abortCallback)t.reject((0,s.zE)());else{const i=r?t.abortCallback?.((0,s.zE)()):t.callback(e);(0,s.y8)(i)?i.then(t.resolve,t.reject):t.resolve(i)}}catch(e){t.reject(e)}return!0}cancelAll(){const e=(0,s.zE)();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0,this._updateRunning()}}class o{constructor(e,t,r,s,i){this.resolve=e,this.reject=t,this.callback=r,this.signal=s,this.abortCallback=i}}},93333:function(e,t,r){r.d(t,{F:function(){return i},o:function(){return n}});var s=r(90756);function i(e){return{geometryType:(0,s.Ji)(e[0]),geometries:e.map((e=>e.toJSON()))}}function n(e,t,r){const i=(0,s.q9)(t);return e.map((e=>{const t=i.fromJSON(e);return t.spatialReference=r,t}))}},56545:function(e,t,r){r.d(t,{LP:function(){return d},cv:function(){return u},en:function(){return c},lA:function(){return l}});var s=r(81001),i=r(10218),n=r(28947),a=r(95490),o=r(82674);function l(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function c(e){return"string"==typeof e?(0,a.mN)(e):(0,n.d9)(e)}function u(e,t,r){const s={};for(const i in e){if("declaredClass"===i)continue;const n=e[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n))s[i]=n.map((e=>u(e)));else if("object"==typeof n)if(n.toJSON){const e=n.toJSON(r?.[i]);s[i]=t?e:JSON.stringify(e)}else s[i]=t?n:JSON.stringify(n);else s[i]=n}return s}async function d(e,t,n){const a=function(e,t){return e?t&&(0,o.rU)(e)?t:(0,o.Pi)(e)??i.id?.findCredential(e)?.token:null}(e,t);if(a)return a;!i.id&&s.default.request.useIdentity&&await r.e(39428).then(r.bind(r,39428));return(await i.id.getCredential(e,n))?.token}},26334:function(e,t,r){r.d(t,{g:function(){return n},s:function(){return a}});var s=r(1800),i=r(12816);async function n(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,r=await(0,i.ME)("esri/t9n/basemaps");return r[e]||r[t]}const a={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return(0,s.V)("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]}}},18177:function(e,t,r){r.d(t,{Qs:function(){return L},RH:function(){return I},Us:function(){return h},wZ:function(){return l},zb:function(){return u},zw:function(){return _}});var s=r(43254),i=r(61100),n=r(95490),a=r(8971),o=r(26334);function l(e,t){return e.allLayerViews.find((e=>e.uid===t))?.layer.parent===e.map?.basemap}let c;function u(e){return!!e?.baseLayers.concat(e.referenceLayers).some(d)}function d(e){if(g(e.url))return!0;if("vector-tile"===e.type)for(const t in e.sourceNameToSource){if(g(e.sourceNameToSource[t]?.sourceUrl))return!0}return!1}function h(e,t){if(null==t||null==e)return{spatialReference:null,updating:!1};if("not-loaded"===t.loadStatus)return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(0===t.baseLayers.length)return{spatialReference:null,updating:!1};const r=t.baseLayers.at(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const s=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?r.tileInfo?.spatialReference:r.spatialReference]).filter(Boolean),i=e.spatialReference;return i?{spatialReference:s.find((e=>i.equals(e)))??s[0]??null,updating:!1}:{spatialReference:s[0],updating:!1}}const f=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function g(e){if(!e)return!1;const t=new n.R9((0,n.hF)(e));return!!t.authority&&f.test(t.authority)}function m(e){return e?!e.loaded&&e.resourceInfo?b(e.resourceInfo.data):{baseLayers:y(e.baseLayers),referenceLayers:y(e.referenceLayers)}:null}function y(e){return(s.Z.isCollection(e)?e.toArray():e).map(_)}function _(e){return{type:e.type,effect:"effect"in e?e.effect:void 0,url:E("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:"map-image"!==e.type&&"wms"!==e.type||null==e.sublayers?void 0:e.sublayers?.map((e=>({id:e.id,visible:e.visible}))),activeLayerId:"wmts"===e.type?e.activeLayer?.id:void 0}}function p(e){return e.isReference||"ArcGISSceneServiceLayer"===e.layerType}function b(e){return e?{baseLayers:S((e.baseMapLayers??[]).filter((e=>!p(e)))),referenceLayers:S((e.baseMapLayers??[]).filter((e=>p(e))))}:null}function S(e){return e.map((e=>function(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;case"ArcGISSceneServiceLayer":t="scene";break;default:t="unknown"}return{type:t,effect:e.effect,url:E(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}(e)))}function v(e,t,r){return null!=e!=(null!=t)?"not-equal":e&&t?T(e.baseLayers,t.baseLayers)?T(e.referenceLayers,t.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function T(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!I(e[r],t[r]))return!1;return!0}function I(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(!(0,a.yQ)(e.effect,t.effect))return!1;if(null!=e.activeLayerId||null!=t.activeLayerId)return e.activeLayerId===t.activeLayerId;if(null!=e.sublayers||null!=t.sublayers){if(null==e.sublayers||null==t.sublayers||e.sublayers.length!==t.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const s=e.sublayers.at(r),i=t.sublayers.at(r);if(s?.id!==i?.id||s?.visible!==i?.visible)return!1}}return!0}function E(e){return e?(0,n.Fv)(e).replace(/^\s*https?:/i,"").toLowerCase():""}function L(e){if(!e)return null;const{thumbnailUrl:t}=e;if(t)return t;const r=function(e){if(c)return c(e);let t=null;const r=m(e),s=!r?.baseLayers.length;for(const e in o.s){const i=v(r,b(o.s[e]),{mustMatchReferences:s});if("equal"===i){t=e;break}"base-layers-equal"===i&&(t=e)}return t}(e);return r?o.s[r].thumbnailUrl:(0,i.ei)(e.baseLayers,R)}function R(e){return"portalItem"in e?e.portalItem?.thumbnailUrl:void 0}},99734:function(e,t,r){var s;r.d(t,{n:function(){return s}}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(s||(s={}))},50399:function(e,t,r){r.d(t,{G5:function(){return M},S0:function(){return A},T8:function(){return s},sq:function(){return x},z4:function(){return _}});var s,i=r(12818),n=(r(61432),r(96711)),a=r(61100),o=r(24498),l=r(63974),c=r(93568),u=r(90403),d=r(39355),h=r(32555),f=r(47641),g=r(97332),m=r(99734),y=r(78891);function _(){return new L.Scheduler}!function(e){e.RESOURCE_CONTROLLER_IMMEDIATE="immediate",e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.LOD_RENDERER="LoD renderer",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.OVERLAY_RENDERER="overlay renderer",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="clouds generator",e.MAPVIEW_FETCH_QUEUE="mapview fetch queue",e.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",e.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",e[e.NONE=0]="NONE",e[e.TEST_PRIO=1]="TEST_PRIO"}(s||(s={}));const p=new Map([[s.RESOURCE_CONTROLLER_IMMEDIATE,0],[s.RESOURCE_CONTROLLER,4],[s.SLIDE,0],[s.STREAM_DATA_LOADER,0],[s.ELEVATION_QUERY,0],[s.TERRAIN_SURFACE,1],[s.SURFACE_GEOMETRY_UPDATES,1],[s.LOD_RENDERER,2],[s.GRAPHICS_CORE,2],[s.I3S_CONTROLLER,2],[s.POINT_CLOUD_LAYER,2],[s.FEATURE_TILE_FETCHER,2],[s.CLOUDS_GENERATOR,2],[s.OVERLAY,4],[s.OVERLAY_RENDERER,4],[s.STAGE,4],[s.GRAPHICS_DECONFLICTOR,4],[s.FILTER_VISIBILITY,4],[s.SCALE_VISIBILITY,4],[s.FRUSTUM_VISIBILITY,4],[s.POINT_OF_INTEREST_FREQUENT,6],[s.POINT_OF_INTEREST_INFREQUENT,30],[s.LABELER,8],[s.FEATURE_QUERY_ENGINE,8],[s.FEATURE_TILE_TREE,16],[s.FEATURE_TILE_TREE_ACTIVE,0],[s.ELEVATION_ALIGNMENT,12],[s.ELEVATION_ALIGNMENT_SCENE,14],[s.TEXT_TEXTURE_ATLAS,12],[s.TEXTURE_UNLOAD,12],[s.LINE_OF_SIGHT_TOOL,16],[s.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[s.SNAPPING,0],[s.SHADOW_ACCUMULATOR,30],[s.MAPVIEW_FETCH_QUEUE,0],[s.MAPVIEW_LAYERVIEW_UPDATE,2],[s.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function b(e){return p.has(e)?p.get(e):"number"==typeof e?e:1}const S=(0,h.HA)(6.5),v=(0,h.HA)(1),T=(0,h.HA)(30),I=(0,h.HA)(1e3/30),E=(0,h.HA)(100);var L,R;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,d.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new o.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=m.n.INTERACTING,this._tasks=new l.Z,this._runQueue=new l.Z,this._load=0,this._idleStateCallbacks=new l.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,u.YP)((()=>g.Z.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),u.nn);for(const e of Object.keys(s))this.performanceInfo.tasks.set(s[e],new o.Z(s[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,a.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())})))}registerTask(e,r){const s=new t(this,e,r);return this._tasks.push(s),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new o.Z(e)),s}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),this.state===m.n.IDLE&&this._idleUpdatesStartFired&&r.idleBegin();const s=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){s._idleUpdatesStartFired&&(r.idleEnd(),s._state===m.n.IDLE&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==m.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}frame(e){this._startFrameTaskTimes();const t=this._updateBudget(e);if(t){const e=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-e)}else this._recordFrameTaskTimes(0);return t}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=S,r=e.frameDuration,s=v;switch(this.state){case m.n.IDLE:t=(0,h.HA)(0),r=(0,h.HA)(Math.max(E,e.frameDuration)),s=T;break;case m.n.INTERACTING:r=(0,h.HA)(Math.max(I,e.frameDuration));case m.n.ANIMATING:}return r=(0,h.HA)(r-e.elapsedFrameTime-t),this.state!==m.n.IDLE&&r<v&&!this._forceTask?(this._forceTask=!0,!1):(r=(0,h.HA)(Math.max(r,s)),this._budget.reset(r),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case m.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case m.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset((0,h.HA)(0)),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return R.SCHEDULED;let t=R.IDLE;return this._tasks.forAll((r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t=R.READY:t!==R.READY&&(t=R.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((r=>{r.name===e&&(t+=r.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do{for(;this._runQueue.length>0;){const e=this._budget.now(),t=this._runQueue.pop();this._budget.resetProgress();try{t.task.runTask(this._budget)===y.J&&(t.blockFrame=this._frameNumber)}catch(e){n.Z.getLogger("esri.views.support.Scheduler").error(`Exception in task "${t.name}"`,e),t.blockFrame=this._frameNumber}!this._budget.hasProgressed&&t.blockFrame!==this._frameNumber&&t.needsUpdate&&(t.name,s.I3S_CONTROLLER,t.blockFrame=this._frameNumber),t.schedulePriority=t.basePriority;const r=this._budget.now()-e;if(t.runtime+=r,this._frameTaskTimes.set(t.priority,this._frameTaskTimes.get(t.priority)+r),this._budget.remaining<=0)return void this._updatingChanged()}}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const e of Object.keys(s))this._frameTaskTimes.set(s[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).push(e))),this.performanceInfo.total.push(e)}get test(){return this._test}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,r){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new f.b,this._handles=new i.Z,this._basePriority=b(t),this.schedulePriority=this._basePriority,this._task=(0,d.t)(null!=r?r:this._queue),this._handles.add((0,u.gx)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(M),this._scheduler.removeTask(this),this.schedule=x.schedule,this.reschedule=x.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=b(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class r{constructor(){this._begin=performance?.now()??0,this._budget=0,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e){this._begin=this.now(),this._budget=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=r}(L||(L={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(R||(R={}));const M=new L.Budget;function A(e){const t=new L.Budget;return t.reset(e),t}M.enabled=!1;const x=new class{remove(){}processQueue(){}schedule(e,t,r){try{if((0,c.Hc)(t)){const e=(0,c.zE)();return r?Promise.resolve(r(e)):Promise.reject(e)}return(0,c.gx)(e(M))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}}},78891:function(e,t,r){r.d(t,{J:function(){return s}});const s=Symbol("Yield")},97332:function(e,t,r){r.d(t,{Z:function(){return l}});var s=r(73440),i=r(70880),n=r(17155),a=(r(61432),r(96711),r(83850),r(48023));let o=class extends i.Z{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,s._)([(0,n.Cb)()],o.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,s._)([(0,n.Cb)()],o.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o=(0,s._)([(0,a.j)("esri.views.support.debugFlags")],o);const l=new o}}]);