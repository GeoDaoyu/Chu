"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[69415],{46041:function(e,t,r){r.d(t,{L:function(){return x},b:function(){return b}});var i=r(26821),n=r(41788),o=r(27583),s=r(27349),a=r(89755),l=r(19615),c=r(42609),u=r(28692),h=r(39863),d=r(37124),p=r(19155),f=r(23027),y=r(2013),m=r(85119),g=r(48857),v=r(52061),_=r(15150);function b(e){const t=new _.kG,{vertex:r,fragment:n}=t,{terrainDepthTest:b}=e;return r.include(a.H),t.include(l.R,e),t.vertex.include(s.$S,e),t.attributes.add(v.T.UV0,"vec2"),r.uniforms.add(new f.$("viewport",(e=>e.camera.fullViewport)),new m.p("lineSize",((e,t)=>e.size>0?Math.max(1,e.size)*t.camera.pixelRatio:0)),new d.$("pixelToNDC",(e=>(0,i.t8)(w,2/e.camera.fullViewport[2],2/e.camera.fullViewport[3]))),new m.p("borderSize",((e,t)=>e.borderColor?t.camera.pixelRatio:0)),new p.A("screenOffset",((e,t)=>(0,i.t8)(w,e.horizontalScreenOffset*t.camera.pixelRatio,0)))),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),b&&t.varyings.add("depth","float"),e.occlusionTestEnabled&&t.include(c.P),e.hasScreenSizePerspective&&(0,h.m8)(r),r.main.add(g.H`
    ProjectHUDAux projectAux;
    vec4 endPoint = projectPositionHUD(projectAux);

    vec3 vpos = projectAux.posModel;
    if (rejectBySlice(vpos)) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
    ${(0,g.If)(e.occlusionTestEnabled,g.H`if (!testHUDVisibility(endPoint)) {
             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
             return;
           }`)}

    ${e.hasScreenSizePerspective?g.H`vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);`:"vec2 screenOffsetScaled = screenOffset;"}
    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
    // correct depth value
    vec3 posView = (view * vec4(position, 1.0)).xyz;
    ${(0,g.If)(b,"depth = posView.z;")}

    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
    vec4 startPoint = proj * vec4(posView, 1.0);

    // Apply screen offset to both start and end point
    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
    startPoint.xy += screenOffsetNorm * startPoint.w;
    endPoint.xy += screenOffsetNorm * endPoint.w;

    // Align start and end to pixel origin
    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${(0,g.If)(e.hudDepth,e.hudDepthAlignStart?"endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);")}
    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);

    // The direction of the line in screen space
    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?g.H`float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);`:g.H`float lineSizeScaled = lineSize;
               float borderSizeScaled = borderSize;`}
    float halfPixelSize = lineSizeScaled * 0.5;

    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
    float padding = 1.0 + borderSizeScaled;
    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

    // Offset x/y from the center of the line in screen space
    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

    // Compute a coverage varying which we can use in the fragment shader to determine
    // how much a pixel is actually covered by the line (i.e. to anti alias the line).
    // This works by computing two coordinates that can be linearly interpolated and then
    // subtracted to find out how far away from the line edge we are.
    float edgeDirection = (uv0.x * 2.0 - 1.0);

    float halfBorderSize = 0.5 * borderSizeScaled;
    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

    coverageSampling = vec4(
      // Edge coordinate
      outerEdgeCoverageSampler,

      // Border edge coordinate
      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

      // Line offset
      halfPixelSize - 0.5,

      // Border offset
      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
    );

    lineSizes = vec2(lineSizeScaled, borderSizeScaled);
    gl_Position = projectedPosition;`),n.uniforms.add(new y.N("uColor",(e=>e.color??o.AG)),new y.N("borderColor",(e=>e.borderColor??o.AG))),b&&(n.include(u.S,e),n.uniforms.add(new d.$("inverseViewport",(e=>e.inverseViewport)))),n.main.add(g.H`
    ${(0,g.If)(b,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }")}

    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

    float borderAlpha = uColor.a * borderColor.a * coverage.y;
    float colorAlpha = uColor.a * coverage.x;

    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);
    ${(0,g.If)(!e.hudDepth,g.H`vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
           fragColor = vec4(finalRgb, finalAlpha);`)}`),t}const w=(0,n.Ue)(),x=Object.freeze(Object.defineProperty({__proto__:null,build:b},Symbol.toStringTag,{value:"Module"}))},12414:function(e,t,r){function i(){return new Float32Array(2)}function n(e,t){const r=new Float32Array(2);return r[0]=e,r[1]=t,r}function o(){return i()}function s(){return n(1,1)}function a(){return n(1,0)}function l(){return n(0,1)}r.d(t,{AG:function(){return c},Ue:function(){return i},al:function(){return n},hq:function(){return u}});const c=o(),u=s(),h=a(),d=l();Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:h,UNIT_Y:d,ZEROS:c,clone:function(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},create:i,fromValues:n,ones:s,unitX:a,unitY:l,zeros:o},Symbol.toStringTag,{value:"Module"}))},86640:function(e,t,r){r.d(t,{Z:function(){return g}});var i,n=r(73440),o=r(3480),s=r(41773),a=r(63255),l=r(26636),c=r(8914),u=r(17155),h=(r(61432),r(96711),r(1194)),d=r(48023),p=r(29884);const f=(0,s.w)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),y=f.jsonValues.slice();(0,o.e$)(y,"orthometric");const m=(0,s.w)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let g=i=class extends a.Z{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,r){return f.write(e,t,r)}readHeightModel(e,t,r){return f.read(e)||(r?.messages&&r.messages.push(function(e,t){return new c.Z("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}(e,{context:r})),null)}readHeightUnit(e,t,r){return m.read(e)||(r?.messages&&r.messages.push(v(e,{context:r})),null)}readHeightUnitService(e,t,r){return(0,l.$C)(e)||m.read(e)||(r?.messages&&r.messages.push(v(e,{context:r})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new i({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const r=(0,l.cM)(t);return new i({heightModel:e.heightModel,heightUnit:r??void 0,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new i;return t.read(e,{origin:"web-scene"}),t}};function v(e,t){return new c.Z("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}(0,n._)([(0,u.Cb)({type:f.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:y,default:"ellipsoidal",write:{isRequired:!0}}}}})],g.prototype,"heightModel",void 0),(0,n._)([(0,p.c)("web-scene","heightModel")],g.prototype,"writeHeightModel",null),(0,n._)([(0,h.r)(["web-scene","service"],"heightModel")],g.prototype,"readHeightModel",null),(0,n._)([(0,u.Cb)({type:m.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:m.jsonValues,write:{writer:m.write,isRequired:!0}}}}})],g.prototype,"heightUnit",void 0),(0,n._)([(0,h.r)("web-scene","heightUnit")],g.prototype,"readHeightUnit",null),(0,n._)([(0,h.r)("service","heightUnit")],g.prototype,"readHeightUnitService",null),(0,n._)([(0,u.Cb)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],g.prototype,"vertCRS",void 0),(0,n._)([(0,h.r)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],g.prototype,"readVertCRS",null),g=i=(0,n._)([(0,d.j)("esri.geometry.HeightModelInfo")],g)},774:function(e,t,r){r.d(t,{d:function(){return a}});var i=r(82846),n=r(30146),o=r(47566),s=r(8554);function a(e,t,r,i){return!(null==e||((0,s.fS)(t,i)?((0,o.JG)(r,e),0):(l[0]=e[0],l[1]=e[1],l[2]=0,!(0,n.projectBuffer)(l,t,0,l,i,0)||(r[0]=l[0],r[1]=l[1],l[0]=e[2],l[1]=e[3],l[2]=0,!(0,n.projectBuffer)(l,t,0,l,i,0)||(r[2]=l[0],r[3]=l[1],0)))))}const l=(0,i.Ue)()},41207:function(e,t,r){r.d(t,{S$:function(){return u},Ue:function(){return s},Ws:function(){return c},_k:function(){return l},iL:function(){return a}});var i=r(38949),n=r(24910),o=r(12659);function s(e){return e?{ray:(0,o.Ue)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,o.Ue)(),c0:0,c1:Number.MAX_VALUE}}function a(e,t=s()){return(0,o.JG)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function l(e,t,r=s()){const i=(0,n.l)(e.vector);return(0,o.al)(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function c(e,t){return h(e,e.c0,t)}function u(e,t){return h(e,e.c1,t)}function h(e,t,r){return(0,n.f)(r,e.ray.origin,(0,n.g)(r,e.ray.direction,t))}new i.x((()=>s()))},33869:function(e,t,r){r.d(t,{Hf:function(){return m},JG:function(){return g},Jp:function(){return _},N9:function(){return E},NQ:function(){return n},Nu:function(){return i},Ue:function(){return y},Zr:function(){return w},g8:function(){return O},hr:function(){return b},q_:function(){return v},rN:function(){return T},xu:function(){return S},zq:function(){return x}});var i,n,o,s=r(38949),a=r(31865),l=r(24910),c=r(82846),u=r(73749),h=r(27583),d=r(41207),p=r(77773),f=r(69811);function y(e){return e?[(0,p.Ue)(e[0]),(0,p.Ue)(e[1]),(0,p.Ue)(e[2]),(0,p.Ue)(e[3]),(0,p.Ue)(e[4]),(0,p.Ue)(e[5])]:[(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)()]}function m(){return[(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)()]}function g(e,t){for(let r=0;r<E;r++)(0,p.JG)(e[r],t[r]);return e}function v(e,t,r,i=F){const n=(0,a.Jp)(f.MP.get(),t,e);(0,a.U_)(n,n);for(let e=0;e<C;++e){const t=(0,u.t)(f.o6.get(),L[e],n);(0,l.i)(i[e],t[0]/t[3],t[1]/t[3],t[2]/t[3])}_(r,i)}function _(e,t){(0,p.zk)(t[n.FAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_TOP_LEFT],e[i.LEFT]),(0,p.zk)(t[n.NEAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_RIGHT],t[n.FAR_TOP_RIGHT],e[i.RIGHT]),(0,p.zk)(t[n.FAR_BOTTOM_LEFT],t[n.FAR_BOTTOM_RIGHT],t[n.NEAR_BOTTOM_RIGHT],e[i.BOTTOM]),(0,p.zk)(t[n.NEAR_TOP_LEFT],t[n.NEAR_TOP_RIGHT],t[n.FAR_TOP_RIGHT],e[i.TOP]),(0,p.zk)(t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_RIGHT],t[n.NEAR_TOP_RIGHT],e[i.NEAR]),(0,p.zk)(t[n.FAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_LEFT],t[n.FAR_TOP_LEFT],e[i.FAR])}function b(e,t){for(let r=0;r<E;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function w(e,t){return P(e,(0,d.iL)(t,R.get()))}function x(e,t){for(let r=0;r<E;r++){const i=e[r];if(!(0,p.Er)(i,t))return!1}return!0}function T(e,t,r){return P(e,(0,d._k)(t,r,R.get()))}function O(e,t){for(let r=0;r<E;r++)if((0,p.jH)(e[r],t)>0)return!1;return!0}function P(e,t){for(let r=0;r<E;r++)if(!(0,p.oq)(e[r],t))return!1;return!0}(o=i||(i={}))[o.LEFT=0]="LEFT",o[o.RIGHT=1]="RIGHT",o[o.BOTTOM=2]="BOTTOM",o[o.TOP=3]="TOP",o[o.NEAR=4]="NEAR",o[o.FAR=5]="FAR",function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(n||(n={}));const S={bottom:[n.FAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_LEFT,n.FAR_BOTTOM_LEFT],near:[n.NEAR_BOTTOM_LEFT,n.NEAR_BOTTOM_RIGHT,n.NEAR_TOP_RIGHT,n.NEAR_TOP_LEFT],far:[n.FAR_BOTTOM_RIGHT,n.FAR_BOTTOM_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_RIGHT],right:[n.NEAR_BOTTOM_RIGHT,n.FAR_BOTTOM_RIGHT,n.FAR_TOP_RIGHT,n.NEAR_TOP_RIGHT],left:[n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_TOP_LEFT,n.FAR_TOP_LEFT],top:[n.FAR_TOP_LEFT,n.NEAR_TOP_LEFT,n.NEAR_TOP_RIGHT,n.FAR_TOP_RIGHT]},E=6,C=8,L=[(0,h.al)(-1,-1,-1,1),(0,h.al)(1,-1,-1,1),(0,h.al)(1,1,-1,1),(0,h.al)(-1,1,-1,1),(0,h.al)(-1,-1,1,1),(0,h.al)(1,-1,1,1),(0,h.al)(1,1,1,1),(0,h.al)(-1,1,1,1)],R=new s.x(d.Ue),F=m()},73584:function(e,t,r){r.d(t,{Ku:function(){return u},Wt:function(){return a},qC:function(){return f}});r(61432);var i,n=r(88194),o=r(86640),s=r(66619);function a(e,t,r){const s=u(e),a=t,c=l(s,a,r);if(s){const t=o.Z.deriveUnitFromSR(s,e.spatialReference).heightUnit;if(!r&&t!==s.heightUnit){const e=new n.Z("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${t})`,{horizontalUnit:t});return new n.Z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:s,error:e})}}if(!function(e){return"heightModelInfo"in e&&null!=e.heightModelInfo||null!=e.spatialReference||!p(e)}(e)||c===i.Unsupported)return new n.Z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:s});switch(c){case i.Units:{const e=s?.heightUnit||"unknown",t=a?.heightUnit||"unknown",r=new n.Z("layerview:incompatible-height-unit",`The vertical units of the layer (${e}) must match the vertical units of the scene (${t})`,{layerUnit:e,sceneUnit:t});return new n.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:s,sceneHeightModelInfo:a,error:r})}case i.HeightModel:{const e=s?.heightModel||"unknown",t=a?.heightModel||"unknown",r=new n.Z("layerview:incompatible-height-model",`The height model of the layer (${e}) must match the height model of the scene (${t})`,{layerHeightModel:e,sceneHeightModel:t});return new n.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:s,sceneHeightModelInfo:a,error:r})}case i.CRS:{const e=s?.vertCRS||"unknown",t=a?.vertCRS||"unknown",r=new n.Z("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${e}) must match the vertical datum of the scene (${t})`,{layerDatum:e,sceneDatum:t});return new n.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:s,sceneHeightModelInfo:a,error:r})}}return null}function l(e,t,r){if(!c(e)||!c(t))return i.Unsupported;if(null==e||null==t)return i.Ok;if(!r&&e.heightUnit!==t.heightUnit)return i.Units;if(e.heightModel!==t.heightModel)return i.HeightModel;switch(e.heightModel){case"gravity-related-height":return i.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?i.Ok:i.CRS;default:return i.Unsupported}}function c(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function u(e){if("integrated-mesh-3dtiles"===e.type)return null;const t=e.url?(0,s.Qc)(e.url):void 0,r=e.spatialReference?.vcsWkid;return(null!=r||null==t||"ImageServer"!==t.serverType)&&h(e)&&e.heightModelInfo?e.heightModelInfo:p(e)?o.Z.deriveUnitFromSR(m,e.spatialReference):null}function h(e){return"heightModelInfo"in e}function d(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function p(e){return d(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):y(e)}function f(e){return null!=e.layers||y(e)||d(e)||h(e)}function y(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}!function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"}(i||(i={}));const m=new o.Z({heightModel:"gravity-related-height"})},49211:function(e,t,r){r.d(t,{Wh:function(){return d},Pj:function(){return f},FS:function(){return w},TF:function(){return x},Xw:function(){return v},PA:function(){return y},MS:function(){return T},S6:function(){return p},dF:function(){return b},R3:function(){return _},_0:function(){return O}});var i=r(61432),n=r(85881),o=r(67908),s=r(45213),a=r(16447),l=r(47566),c=r(96610),u=r(98842),h=r(49651);r(61418);class d{constructor(e,t,r){this.uid=e,this.geometry=t,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function p(e){return null!=e.geometry}class f{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function y(e,t){const r=u.Mk.fromJSON(e.geometryType),i=s.Z.fromJSON(e.spatialReference),n=e.transform,a=e.objectIdFieldName,l=t?.maxStringAttributeLength,d=t?.maxStringAttributeFields;let p;const f=e.features.map((t=>{const s=function(e,t,r,i){return{uid:(0,o.D)(),objectId:i&&e.attributes?e.attributes[i]:null,attributes:e.attributes,geometry:m(e.geometry,t,r),visible:!0}}(t,r,i,e.objectIdFieldName),u=s.geometry;if(O(s.attributes,d,l,(e=>{p??=[];const t=T(s,a);null!=t&&p.push({objectId:t,attribute:e})})),null!=u&&n)switch(u.type){case"point":s.geometry=(0,c.U1)(n,u,u);break;case"multipoint":s.geometry=(0,c.J9)(n,u,u);break;case"polygon":s.geometry=(0,c.Ie)(n,u,u);break;case"polyline":s.geometry=(0,c.G6)(n,u,u);break;case"extent":case"mesh":s.geometry=u}return s}));return{geometryType:r,features:f,spatialReference:i,fields:e.fields?.map((e=>h.Z.fromJSON(e)))??[],objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null,missingAttributes:p}}function m(e,t,r){if(null==e)return null;switch(t){case"point":{const t=e;return{x:t.x,y:t.y,z:t.z,m:t.m,hasZ:null!=t.z,hasM:null!=t.m,type:"point",spatialReference:r}}case"polyline":{const t=e;return{paths:t.paths,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polyline",spatialReference:r}}case"polygon":{const t=e;return{rings:t.rings,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const t=e;return{points:t.points,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"multipoint",spatialReference:r}}}}function g(e){if(null==e)return 0;switch(e.type){case"point":return n.Mm+10+8+24;case"polyline":case"polygon":{let t=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),o="polyline"===e.type?e.paths:e.rings;if(("polyline"===e.type?e.curvePaths:e.curveRings)?.length){const e=3*(0,i.Z)("curve-densification-max-segments")*128;t=8*e*r+128*e+32*(o.length+1)}else t=(0,n.kk)(o);return n.Mm+64+t+34}case"multipoint":{const t=(0,n.kk)(e.points);return n.Mm+t+64+34+32}case"extent":return n.Mm+10+64+34;case"mesh":{const t=e.vertexAttributes;return n.Mm+(0,n.G7)(t.position,t.normal,t.uv,t.tangent)}default:return n.Mm}}function v(e){let t=32;return t+=(0,n.F$)(e.attributes),t+=3,t+=8+g(e.geometry),t}function _(e){if(null==e)return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const r of e.paths)t+=r.length;return t}case"polygon":{let t=0;for(const r of e.rings)t+=r.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function b(e){if(null==e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function w(e,t){switch((0,a.cS)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let r=0;r<e.paths.length;r++)(0,a.Wi)(t,e.paths[r],!!e.hasZ);break;case"polygon":for(let r=0;r<e.rings.length;r++)(0,a.Wi)(t,e.rings[r],!!e.hasZ);break;case"multipoint":(0,a.Wi)(t,e.points,!!e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}return t}function x(e,t){switch((0,l.cS)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let r=0;r<e.paths.length;r++)(0,l.Wi)(t,e.paths[r]);break;case"polygon":for(let r=0;r<e.rings.length;r++)(0,l.Wi)(t,e.rings[r]);break;case"multipoint":(0,l.Wi)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function T(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}function O(e,t,r,i){if(t?.size&&null!=r&&e)for(const n in e){if(!t.has(n))continue;const o=e[n];"string"==typeof o&&o.length>r&&(i(n),e[n]="")}}},47747:function(e,t,r){r.d(t,{E:function(){return i}});class i{constructor(e,t){this.renderer=e,this.symbol=t,this.color=null,this.size=null,this.opacity=null,this.outlineSize=null,this.heading=null,this.tilt=null,this.roll=null}}},2290:function(e,t,r){r.d(t,{Lz:function(){return v},RX:function(){return g},Wf:function(){return f},j3:function(){return y}});var i=r(31865),n=r(10934),o=r(24910),s=r(82846),a=r(74238),l=r(30146),c=r(90210),u=r(27762),h=r(90494),d=r(95786),p=r(52061);function f(e,t,r,i,n){const o=e.stageObject,s=o.geometries;let a=0;for(const e of s){if(!(0,d.T)(e))continue;const{update:s,averageGeometrySampledElevation:l}=S(e,t,r,i,n);a+=l,s&&o.geometryVertexAttributeUpdated(e,p.T.POSITION)}return a/s.length}function y(e,t,r,n,s,l){const h=e.stageObject,d=t.centerPointInElevationSR;let p=0;h.usesVerticalDistanceToGround?(n(d,P),(0,c.ub)(h,P.verticalDistanceToGround),p=P.sampledElevation):(n(d,P),"absolute-height"!==t.mode&&(p=P.sampledElevation));const f=(0,i.JG)(m,l??h.transformation),y=(0,o.i)(O,f[12],f[13],f[14]);u.h.TESTS_DISABLE_OPTIMIZATIONS?(b[0]=d.x,b[1]=d.y,b[2]=P.z,(0,a.B)(d.spatialReference,b,f,s.spatialReference)&&(l?(0,i.JG)(l,f):h.transformation=f)):s.setAltitudeOfTransformation(P.z,f);const g=_/s.unitInMeters;return(Math.abs(f[12]-y[0])>=g||Math.abs(f[13]-y[1])>=g||Math.abs(f[14]-y[2])>=g)&&(l?(0,i.JG)(l,f):h.transformation=f),p}const m=(0,n.Ue)();function g(e,t,r,i,n){const s=e.graphics3DSymbolLayer.lodRenderer;if(null==s)return 0;const l=t.centerPointInElevationSR;i(l,P);const c="absolute-height"!==t.mode?P.sampledElevation:0,h=s.instanceData,d=e.instanceIndex,p=T;h.getGlobalTransform(d,p);const f=(0,o.i)(O,p[12],p[13],p[14]);u.h.TESTS_DISABLE_OPTIMIZATIONS?(b[0]=l.x,b[1]=l.y,b[2]=P.z,(0,a.B)(l.spatialReference,b,p,n.spatialReference)&&h.setGlobalTransform(d,p)):n.setAltitudeOfTransformation(P.z,p);const y=_/n.unitInMeters;return(u.h.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(p[12]-f[0])>=y||Math.abs(p[13]-f[1])>=y||Math.abs(p[14]-f[2])>=y)&&h.setGlobalTransform(d,p),c}function v(e,t,r,i,n){const o=e.stageObject,s=o.geometries;if(0===s.length)return 0;let a=0,l=null,c=0,u=!1;for(const e of s){if(!(0,d.T)(e))continue;const s=e.attributes.get(p.T.POSITION);if(s!==l){const{update:o,averageGeometrySampledElevation:a}=S(e,t,r,i,n);c=a,l=s,u=o}u&&o.geometryVertexAttributeUpdated(e,p.T.POSITION),a+=c}return a/s.length}const _=.01,b=(0,s.Ue)(),w=(0,s.Ue)(),x=(0,s.Ue)(),T=(0,n.Ue)(),O=(0,s.Ue)(),P=new c.Lm;function S(e,t,r,i,n){let o=!1;const s=e.transformation,a=t.requiresSampledElevationInfo;w[0]=s[12],w[1]=s[13],w[2]=s[14],e.invalidateBoundingInfo();const c=e.getMutableAttribute(p.T.POSITION),d=c.data,f=c.size,y=d.length/f,m=new h.sb(e.mapPositions,r);let g=0,v=0;for(let e=0;e<y;e++){if(x[0]=d[g],x[1]=d[g+1],x[2]=d[g+2],i(m,P),a&&(v+=P.sampledElevation),u.h.TESTS_DISABLE_OPTIMIZATIONS)d[g]=m.array[m.offset],d[g+1]=m.array[m.offset+1],d[g+2]=P.z,(0,l.projectBuffer)(d,r,g,d,n.spatialReference,g,1),d[g]-=w[0],d[g+1]-=w[1],d[g+2]-=w[2],o=!0;else{b[0]=d[g]+w[0],b[1]=d[g+1]+w[1],b[2]=d[g+2]+w[2],n.setAltitude(b,P.z),d[g]=b[0]-w[0],d[g+1]=b[1]-w[1],d[g+2]=b[2]-w[2];const e=_/n.unitInMeters;(Math.abs(x[0]-d[g])>=e||Math.abs(x[1]-d[g+1])>=e||Math.abs(x[2]-d[g+2])>=e)&&(o=!0)}g+=f,m.offset+=3}return v/=y,{update:o,averageGeometrySampledElevation:v}}},95964:function(e,t,r){r.d(t,{K:function(){return l},Y:function(){return a}});var i=r(3480),n=(r(61432),r(93568)),o=r(82868),s=r(50399);class a{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}async queryElevation(e,t,r,i,n){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,n,r,i)}}class l{constructor(e,t,r,i){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...i,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(s.T8.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(s.G5);else for(const e of this._queries)e.result.reject((0,n.zE)())}queryElevation(e,t,r,o=0){const s=(0,n.hh)(),a={x:e,y:t,minDemResolution:o,result:s,signal:r};return this._queries.push(a),(0,n.fu)(r,(()=>{(0,i.Od)(this._queries,a),s.reject((0,n.zE)())})),s.promise}get running(){return this._queries.length>0}runTask(e){const t=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return t.forEach((e=>e.result.reject())),void e.madeProgress();const i=t.map((e=>[e.x,e.y])),s=t.reduce(((e,t)=>Math.min(e,t.minDemResolution)),1/0),a=new o.Z({points:i,spatialReference:this.spatialReference}),l=t.length>1&&t.some((e=>!!e.signal))?new AbortController:null,c=null!=l?l.signal:t[0].signal;if(null!=l){let e=0;t.forEach((r=>(0,n.fu)(r.signal,(()=>{e++,r.result.reject((0,n.zE)()),e===t.length&&l.abort()}))))}const u={...this._queryOptions,minDemResolution:s,signal:c};r.queryElevation(a,u).then((e=>{t.forEach(((t,r)=>{null!=t.signal&&t.signal.aborted?t.result.reject((0,n.zE)()):t.result.resolve(e.geometry.points[r][2])}))})).catch((e=>{t.forEach((t=>t.result.reject(e)))})),e.madeProgress()}get test(){}}},80139:function(e,t,r){r.d(t,{S:function(){return a}});var i=r(96711),n=r(75970),o=r(25136);const s=()=>i.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function a(e,t){if(!(0,n.Pd)(e))return s().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const r=l[e.callout.type];return r?new r(e,t):(s().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const l={line:o.YT}},25120:function(e,t,r){r.d(t,{z:function(){return i}});class i{constructor(e,t,r){this.graphic=e,this.renderingInfo=t,this.layer=r}}},25136:function(e,t,r){r.d(t,{YT:function(){return X},_D:function(){return te},Ly:function(){return ee}});var i=r(53147),n=r(61432),o=r(96094),s=r(82846),a=r(27583),l=r(47747),c=r(75970),u=r(2290),h=r(90210),d=r(94290),p=r(25120),f=r(63082),y=r(6586),m=r(33474),g=r(36027),v=r(29819),_=r(18056),b=r(81749),w=r(25952),x=r(52061),T=r(29138),O=r(12414),P=r(52890),S=r(41044),E=r(59797),C=r(19596),L=r(948),R=r(92991),F=r(58257),A=r(29107),M=r(46041),D=r(65650),I=r(51135);class U extends A.A{constructor(e,t){super(e,t,new F.J(M.L,(()=>r.e(21251).then(r.bind(r,21251)))))}initializePipeline(e){const{hudDepth:t,terrainDepthTest:r}=e,i={func:r?D.wb.ALWAYS:D.wb.LESS};return(0,I.sm)(t?{depthTest:i,depthWrite:I.ck}:{blending:(0,I.wK)(D.zi.ONE,D.zi.SRC_ALPHA,D.zi.ONE_MINUS_SRC_ALPHA,D.zi.ONE_MINUS_SRC_ALPHA),depthTest:i,colorWrite:I.gf})}}var j=r(73440),G=r(83046),N=r(91041);class z extends N.W{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.terrainDepthTest=!1,this.draped=!1}}(0,j._)([(0,G.o)()],z.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,j._)([(0,G.o)()],z.prototype,"occlusionTestEnabled",void 0),(0,j._)([(0,G.o)()],z.prototype,"hasVerticalOffset",void 0),(0,j._)([(0,G.o)()],z.prototype,"hasScreenSizePerspective",void 0),(0,j._)([(0,G.o)()],z.prototype,"hudDepth",void 0),(0,j._)([(0,G.o)()],z.prototype,"hudDepthAlignStart",void 0),(0,j._)([(0,G.o)()],z.prototype,"terrainDepthTest",void 0);var H=r(64801);class B extends C.F5{constructor(e,t){super(e,W),this.intersectDraped=void 0,this.produces=new Map([[L.r.LINE_CALLOUTS,e=>(0,S.c1)(e)],[L.r.LINE_CALLOUTS_HUD_DEPTH,e=>(0,S.c1)(e)]]),this._configuration=new z(t),this._uniqueMaterialIdentifier=V(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective,this._configuration.hudDepth=t.slot===L.r.LINE_CALLOUTS_HUD_DEPTH,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration}get visible(){return this.parameters.color[3]>=H.e||(this.parameters.borderColor?.[3]??0)>=H.e}intersect(){}createGLMaterial(e){return new k(e)}createBufferWriter(){return new $}validateParameters(e){this._uniqueMaterialIdentifier=V(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}}function V({renderOccluded:e,isDecoration:t,horizontalScreenOffset:r,color:i,size:n,occlusionTest:o,shaderPolygonOffset:s,hudDepthAlignStart:a,centerOffsetUnits:l,hasSlicePlane:c,screenSizePerspective:u,verticalOffset:h,borderColor:d}){return T.pv`${e}:${t}:${r}:[${i}]:${n}:${o}:${s}:${a}:${l}:${c}:${null!=u}:{${h.screenLength}:${h.minWorldLength}:${h.maxWorldLength}}:[${d}]`}class k extends E.Z{beginSlot(e){return this.getTechnique(U,e)}}class W extends C.Mt{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=(0,a.al)(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const Z=(0,P.U$)().vec3f(x.T.POSITION).vec3f(x.T.NORMAL).vec2f16(x.T.UV0).vec4f(x.T.CENTEROFFSETANDDISTANCE),q=[(0,O.al)(0,0),(0,O.al)(1,0),(0,O.al)(0,1),(0,O.al)(1,0),(0,O.al)(1,1),(0,O.al)(0,1)];class ${constructor(){this.vertexBufferLayout=Z}elementCount(e){return 6*e.get(x.T.POSITION).indices.length}write(e,t,r,i,n,o){(0,R.ho)(r.get(x.T.POSITION),e,n.position,o,6),(0,R.s5)(r.get(x.T.NORMAL),t,n.normal,o,6),(0,R.SW)(r.get(x.T.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,o,6);for(let e=0;e<q.length;++e)n.uv0.setVec(o+e,q[e]);return null}}var J=r(52964);class X extends m.k{static{this.elevationModeChangeTypes={definedChanged:h.lO.UPDATE,staysOnTheGround:h.lO.UPDATE,onTheGroundChanged:h.lO.RECREATE}}constructor(e,t){super(e,null,t,K),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new B(this._materialParameters,this._context.spherical)}_perInstanceMaterialParameters(e){const t=this._materialParameters;return t.horizontalScreenOffset=e.horizontalScreenOffset??0,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get _materialParameters(){const e=new W,t=this.symbol,r=t.callout;if(r.color){const t=i.Z.toUnitRGBA(r.color);t[3]*=this._getLayerOpacity(),e.color=t}else e.color=a.AG;if(e.size=(0,o.F2)(r.size||0),t.verticalOffset){const{screenLength:r,minWorldLength:i,maxWorldLength:n}=t.verticalOffset;e.verticalOffset={screenLength:(0,o.F2)(r),minWorldLength:i||0,maxWorldLength:null!=n?n:1/0}}e.borderColor=null!=r.border?.color?i.Z.toUnitRGBA(r.border.color):null;const s="object"===t.symbolLayers.at(0).type,l="label-3d"===t.type;return e.occlusionTest=!s&&!(0,n.Z)("enable-feature:non-occluded-hud"),s&&(e.shaderPolygonOffset=0),e.hudDepthAlignStart=l,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Q}createGraphics3DGraphic(e,t){const r=e.renderingInfo,i=e.graphic,n=this.setGraphicElevationContext(i,new d.o,r.elevationOffset||0),o=r.symbol,s="on-the-ground"===this._elevationContext.mode&&("cim"===o.type||!o.symbolLayers.some((e=>"object"===e.type||"text"===e.type)));if("label-3d"!==o.type&&s)return null;if("point-3d"===o.type&&o.symbolLayers.every((e=>"text"===e.type&&!(0,c.as)(e))))return null;const a=(0,g.zE)(i.geometry);return null==a?null:this._createAs3DShape(a,n,r,i.uid,t)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=(0,h.GC)(X.elevationModeChangeTypes,r,i);return n!==h.lO.UPDATE||e?.forEach((e=>{const r=t(e);null!=r&&this.updateGraphicElevationContext(e.graphic,r)})),n}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,t,r=0){return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(r),t}updateGraphicElevationContext(e,t){const{elevationContext:r,metadata:i}=t;this.setGraphicElevationContext(e,r,i?.elevationOffset??0),t.needsElevationUpdates=(0,h.Xf)(r.mode)}computeComplexity(){return new _.eH({verticesPerFeature:6})}_getOrCreateMaterial(e,t){const r=this._perInstanceMaterialParameters(e),i=V(r);if(i===this._materials[0]?.uniqueMaterialIdentifier)return this._materials[0];if(t){let e=t.get(i);return null==e&&(e=new B(r,this._context.spherical),t.set(i,e)),e}return new B(r,this._context.spherical)}_createAs3DShape(e,t,r,i,n){const o=this._context.layerViewUid,s=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerViewUid:o}),a=this._getOrCreateMaterial(r,n),l=new w.Z(a,function(e){const{translation:t,centerOffset:r}=e,i=new b.a(t?[t[0],t[1],t[2]]:[0,0,0],Y,3,!0),n=new b.a(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],Y,4,!0);return[[x.T.POSITION,i],[x.T.NORMAL,new b.a([0,0,1],Y,3,!0)],[x.T.CENTEROFFSETANDDISTANCE,n]]}(r),null,J.V.Point,s),c=(0,v.ZC)(this._context,e,l,t,i);if(null==c)return null;const d=new f.z(this,c.object,null,u.j3,t);return d.metadata=new y.n(r.elevationOffset),d.alignedSampledElevation=c.sampledElevation,d.needsElevationUpdates=(0,h.Xf)(t.mode),(0,v.dO)(d,e,this._context.elevationProvider),d}}const Y=[0],Q={mode:"relative-to-ground",offset:0},K={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class ee extends l.E{constructor(e,t,r=(0,s.Ue)(),i=(0,a.Ue)(),n=0,o="world",l=0){super(e,t),this.translation=r,this.centerOffset=i,this.horizontalScreenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=l}}class te extends p.z{}},63082:function(e,t,r){r.d(t,{n:function(){return d},z:function(){return p}});var i=r(24910),n=r(82846),o=r(16447),s=r(69055),a=r(90210),l=r(15592),c=r(36027),u=r(32420),h=r(57225);class d{constructor(e,t,r){this.baseMaterial=e,this.edgeMaterial=t,this.hasSlicePlane=r}}class p{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,r,i,n,o=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._sharedResource=r,this.elevationAligner=i,this.elevationContext=n,this._edgeState=o,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}get usedMemory(){return this.graphics3DSymbolLayer.usedMemory}layerOpacityChanged(e,t){const{stageObject:r,_edgeState:i,_stageLayer:n}=this;if(null==i)return;const o=f(i.baseMaterial);i.edgeMaterial.objectTransparency!==o&&(i.edgeMaterial.objectTransparency=o,this.resetEdgeObject(t)),n.stage.renderer.withEdgeView((t=>t.updateAllComponentOpacities(r,[e])))}updateHighlights(e){}slicePlaneEnabledChanged(e,t){const{stageObject:r,_edgeState:i,_stageLayer:n}=this;null!=i&&n.stage.renderer.withEdgeView((n=>{n.updateAllComponentMaterials(r,i.edgeMaterial,e,!t),i.hasSlicePlane=e}))}setVisibility(e){const{_edgeState:t,stageObject:r,_stageLayer:i}=this;null!=i&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(i.add(r),this._addedToStage=!0),null!=t&&i.stage.renderer.withEdgeView((i=>{i.hasObject(r)?i.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(t,i,!1)})))}get visible(){return this._visible}alignWithElevation(e,t,r,i){if(null==this.elevationAligner)return;null!=r&&(0,l.aO)(this.elevationContext.featureExpressionInfoContext,r);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,((r,i)=>(0,a.qZ)(r,e,this.elevationContext,t,i)),t),this.resetEdgeObject(i)}alignWithAbsoluteElevation(e,t,r){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,((t,r)=>{r.sampledElevation=e,r.verticalDistanceToGround=0,r.z=e}),t),this.resetEdgeObject(r)}getCenterObjectSpace(e=(0,n.Ue)()){return(0,i.c)(e,(0,s.a)(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=(0,o.Ue)()){const t=this.stageObject.boundingVolumeObjectSpace;return(0,o.op)(e,t.min),(0,o.Tn)(e,t.max),e}computeAttachmentOrigin(e){const t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(g)&&((0,i.t)(g,g,t),(0,i.f)(e.render.origin,e.render.origin,g),e.render.num++)}async getProjectedBoundingBox(e,t,r,n,s){const a=this.getBoundingBoxObjectSpace(s),l=v,u=(0,o.wp)(a)?1:l.length;for(let e=0;e<u;e++){const t=l[e];m[0]=a[t[0]],m[1]=a[t[1]],m[2]=a[t[2]],(0,i.t)(m,m,this.stageObject.transformation),y[3*e]=m[0],y[3*e+1]=m[1],y[3*e+2]=m[2]}if(!e(y,0,u))return null;(0,o.cS)(a);let h=null;this.calculateRelativeScreenBounds&&(h=this.calculateRelativeScreenBounds());for(let e=0;e<3*u;e+=3){for(let t=0;t<3;t++)a[t]=Math.min(a[t],y[e+t]),a[t+3]=Math.max(a[t+3],y[e+t]);h&&r.push({location:y.slice(e,e+3),screenSpaceBoundingRect:h})}if(t?.service&&"absolute-height"!==this.elevationContext.mode){(0,o.be)(a,g);const e="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let r=0;if(t.useViewElevation)r=t.service.getElevation(g[0],g[1],e)??0;else try{const i=(0,c.Si)(a,t.service.spatialReference,t);r=await t.service.queryElevation(g[0],g[1],n,i,e)??0}catch(e){}(0,o.cv)(a,0,0,-this.alignedSampledElevation+r)}return a}addObjectState(e){e.stateType===u.V_.Highlight&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===u.V_.MaskOccludee&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:t,stageObject:r,_stageLayer:i,_visible:n}=this;null!=t&&i.stage.renderer.withEdgeView((i=>{n?this._addOrUpdateEdgeObject(t,i,e):i.removeObject(r)}))}_addOrUpdateEdgeObject(e,t,r){const i=f(e.baseMaterial);e.edgeMaterial.objectTransparency=i,t.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!r).then((()=>this._stageLayer?.sync()))}}function f(e){return e.transparent?h.i.TRANSPARENT:h.i.OPAQUE}const y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=(0,n.Ue)(),g=(0,n.Ue)(),v=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},6586:function(e,t,r){r.d(t,{n:function(){return i}});class i{constructor(e,t=null){this.labelText=t,this.elevationOffset=e??0}}},33638:function(e,t,r){r.d(t,{JK:function(){return o},t7:function(){return i},wg:function(){return n}});const i=3,n=3,o=10},19269:function(e,t,r){r.d(t,{q:function(){return R}});var i=r(3480),n=r(29292),o=(r(61432),r(93568)),s=r(44550),a=r(85881),l=r(77450),c=r(26821),u=r(41788),h=r(24910),d=r(82846),p=r(67764),f=r(774),y=r(16447),m=r(47566),g=r(8554),v=r(49211),_=r(64246),b=r(10841),w=r(15592);const x=new l.Z(Array,(e=>(0,y.t8)(e,y.bM)),null,10,5),T=(0,m.Ue)();class O{get labelLayers(){return this._labelLayers||i.ow}get extent(){return this._extent}get isElevationSource(){return this.layers.some((e=>e?.isElevationSource))}constructor(e,t,r,i,n){this.graphic=e,this.graphics3DSymbol=t,this.layers=r,this._visibleFlags=b.P.ALL_LABEL,++t.referenced,this._featureExpressionFeature=n?(0,w.Tz)(n,e,i):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic((t=>{t.initialize(e),t.setVisibility(this.isVisible())}))}destroy(){this._forEachSymbolLayerGraphic((e=>e.destroy())),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic((e=>e.destroy())),this._labelLayers=null}addLabelGraphic(e,t){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(b.E.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic((t=>{"draped"===t.type&&(e=!0)})),e}isVisible(e=b.E.GRAPHIC,t){const r=t?this._visibleFlags|t|b.E.LABEL*t:this._visibleFlags;return e===b.E.GRAPHIC?(r&b.P.ALL_GRAPHIC)===b.P.ALL_GRAPHIC:(r&b.P.ALL_LABEL)===b.P.ALL_LABEL}setVisibilityFlag(e,t,r){const i=this.isVisible(e);r?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);const n=this.isVisible(e);if(i===n)return!1;if(e===b.E.LABEL)this._forEachLabelGraphic((e=>e.setVisibility(n)));else{this._forEachSymbolLayerGraphic((e=>e.setVisibility(n)));const e=this.isVisible(b.E.LABEL);this._forEachLabelGraphic((t=>t.setVisibility(e)))}return!0}getVisibilityFlag(e,t){return 0!=(this._visibleFlags&e*t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(null==t)return!1;this._extent=(0,m.Ue)(),(0,v.TF)(t,this._extent);const r=t.spatialReference;if(!(0,g.fS)(r,e)&&!(0,f.d)(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,t,r){let i=e.geometry;return"mesh"!==i.type&&"extent"!==i.type||(i=p.Z.fromExtent("mesh"===i.type?i.extent:i)),(0,_.GH)(i,t,r)}get usedMemory(){let e=(0,a.F$)(this.graphic.attributes);return this._forEachSymbolLayerGraphic((t=>e+=t.usedMemory)),e}computeAttachmentOrigin(){const e={render:{origin:(0,d.Ue)(),num:0},draped:{origin:(0,u.Ue)(),num:0}};for(const t of this.layers)null!=t&&t.computeAttachmentOrigin(e);return e.render.num>1&&(0,h.g)(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&(0,c.bA)(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,r,i,o){return o||(o={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),o.boundingBox?(0,y.cS)(o.boundingBox):o.boundingBox=(0,y.cS)(),o.requiresDrapedElevation=!1,await(0,n.Ed)(this.layers,(async n=>{if(null==n)return;const s="draped"===n.type?t:e,a=x.acquire(),l=await n.getProjectedBoundingBox(s,r,o.screenSpaceObjects,i,a);isFinite(l[2])&&isFinite(l[5])||(o.requiresDrapedElevation=!0),l&&(0,y.TC)(o.boundingBox,a),x.release(a)})),(0,y.sU)(o.boundingBox)||(0,m.sU)((0,y.y8)(o.boundingBox,T))?o:null}needsElevationUpdates(){for(const e of this.layers)if(null!=e&&("object3d"===e.type||"lod-instance"===e.type)&&e.needsElevationUpdates)return!0;return this._labelLayers?.some((e=>e?.needsElevationUpdates??!1))??!1}alignWithElevation(e,t,r){this._forEachRenderedGraphic((i=>{"object3d"!==i.type&&"lod-instance"!==i.type||i.alignWithElevation(e,t,this._featureExpressionFeature,r)}))}alignWithAbsoluteElevation(e,t,r){this._forEachRenderedGraphic((i=>{"object3d"===i.type&&i.alignWithAbsoluteElevation(e,t,r)}))}addObjectStateSet(e){this._forEachSymbolLayerGraphic((t=>t.addObjectState(e)))}removeObjectState(e){this._forEachSymbolLayerGraphic((t=>t.removeObjectState(e)))}updateHighlights(e){this._forEachSymbolLayerGraphic((t=>t.updateHighlights(e)))}_forEachGraphicList(e,t){e?.forEach((e=>e&&t(e)))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this.labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}}var P=r(63082),S=r(8164),E=r(80606),C=r(95787),L=r(37294);class R extends C.w{set symbol(e){this._symbol=e,e.symbolLayers.forEach(((t,r)=>{const i=this.symbolLayers[r];null!=i&&(i.symbol=e,i.symbolLayer=t)}))}get symbol(){return this._symbol}constructor(e,t,r){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const i=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const s=[],{make:a}=await Promise.all([r.e(65344),r.e(80746),r.e(232),r.e(93151),r.e(13957),r.e(65009),r.e(10511),r.e(78740),r.e(27477)]).then(r.bind(r,27925));for(let r=0;r<i;r++){const n=t.at(r);if(!1===n.enabled)continue;F.renderPriority=1-(1+r)/i,F.renderPriorityStep=1/i,F.ignoreDrivers=n.ignoreDrivers;const l=a(this.symbol,n,this._context,F),c=(0,o.$F)(e,(()=>{this.symbolLayers[r]=null,l.destroy()}));c&&s.push(c),this.symbolLayers[r]=l}if(await(0,n.Ed)(this.symbolLayers,(async(e,t)=>{if(null!=e)try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[t]=null}})),s.forEach((e=>e.remove())),(0,o.k_)(e),this.symbolLayers.length&&!this.symbolLayers.some((e=>!!e)))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return null!=t?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some((e=>e?.queryForSnapping))}updateFocus(e,t){this.symbolLayers.forEach((r=>r?.updateFocus(e,t)))}createGraphics3DGraphic(e,t){const r=e.graphic,i=this.symbolLayers.map((t=>t?.createGraphics3DGraphic(e)??null)),n=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new O(r,t||this,i,e.layer,n)}get complexity(){return(0,s.IQ)(this.symbolLayers.map((e=>null!=e?e.complexity:null)))}globalPropertyChanged(e,t){const r=this.symbolLayers.length;for(let i=0;i<r;i++){const r=this.symbolLayers[i],n=e=>{const t=e.layers[i];return t instanceof P.z?t:null};if(null!=r&&!r.globalPropertyChanged(e,t,n))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==C.P.LOADED?E.W.RecreateSymbol:this.symbolLayers.reduce(((r,i)=>r!==E.W.RecreateSymbol&&null!=i?Math.min(r,i.applyRendererDiff(e,t)):r),E.W.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===C.P.FAILED)return;if("partial"!==e.diff.type)return;const t=e.diff.diff;if(!t.symbolLayers||"partial"!==t.symbolLayers.type)return;const r=t.symbolLayers.diff;this.symbolLayers.forEach(((t,i)=>{if(null==t)return;const n=r[i];if(n){const r={diff:n,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(r),e.symbolStatePatches.push(...r.symbolLayerStatePatches),r.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push(((e,t)=>{const n=e.layers[i];null!=n&&r.graphics3DGraphicPatches.forEach((e=>e(n,t)))}))}}))}updateGeometry(e,t){return this._updateGeometryOrTransform(e,((e,r)=>e.updateGeometry(r,t)))}updateTransform(e,t,r,i){return this._updateGeometryOrTransform(e,((e,n)=>e.updateTransform(n,t,r,i)))}_updateGeometryOrTransform(e,t){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(null==i)continue;const n=e.layers[r];if(!n||!t(i,n))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const r=this.symbolLayers[t];if(null==r)continue;const i=e.layers[t];null!=i&&r.onRemoveGraphic(i)}}getFastUpdateStatus(){let e=!1,t=!1;for(const r of this.symbolLayers)if(null!=r){if(r.loadStatus===C.P.LOADING)return E.X.Loading;r.isFastUpdatesEnabled()?t=!0:e=!0}return t?e?E.X.Mixed:E.X.Fast:e?E.X.Slow:E.X.Undefined}async queryForSnapping(e,t,r,n){const s=this.symbolLayers.filter(i.pC).filter((e=>null!=e.queryForSnapping)).map((i=>i.queryForSnapping(e,t,r,n))),a=await Promise.all(s);return(0,o.k_)(n),a.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)null!=e&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}get cachedMemory(){return(0,L.n)(this)}}const F=new S.W},8164:function(e,t,r){r.d(t,{U:function(){return n},W:function(){return o}});var i=r(56172);class n{constructor(e,t,r,i){this.scheduler=e,this.schedule=t,this.layerViewUid=r,this.compressionTracker=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===i.JY.Global}}class o{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}}},33474:function(e,t,r){r.d(t,{k:function(){return g}});var i=r(53147),n=(r(61432),r(96711)),o=r(82846),s=r(27583),a=r(28931),l=r(44550),c=r(90210),u=r(94290),h=r(15592),d=r(36027),p=r(80606),f=r(95787),y=r(76e3);const m=()=>n.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class g extends f.w{constructor(e,t,r,i,n=!0){super(r.schedule),this.symbol=e,this.symbolLayer=t,this._context=r,this._drivenOpacityFallbackAlwaysOpaque=n,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=m(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=i.renderPriority,this._renderPriorityStep=i.renderPriorityStep,this._elevationContext=new u.o,this.updateComplexity(),this.ignoreDrivers=i.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=v(this._context.renderer,n)),this._updateElevationContext()}get view(){return this._context.stage.view}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get usedMemory(){const e=this.complexity;return null==e?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const t=this._drivenProperties,r=v(e,this._drivenOpacityFallbackAlwaysOpaque);return r.color!==t.color||r.opacity!==t.opacity||r.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||r.size!==t.size||r.rotation!==t.rotation}get needsDrivenTransparentPass(){return(this._drivenProperties.color||this._drivenProperties.opacity)&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,r,i){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,s=`${i} geometry failed to be created`;n?!this._logGeometryValidationWarnings(t,r,i)&&o&&0===o.length&&"rings"===r&&t.length>0&&t[0].length>2&&m().warnOncePerTick(`${s} (filled rings should use clockwise winding - try reversing the order of vertices)`):m().warnOncePerTick(`${s} (failed to project geometry to view spatial reference)`)}updateFocus(e,t){}_logGeometryValidationWarnings(e,t,r){const i=`${r} geometry failed to be created`;return!e.length||1===e.length&&!e[0].length?(m().warnOncePerTick(`${i} (no ${t} were defined)`),!0):!(Array.isArray(e)&&Array.isArray(e[0])||(m().warnOncePerTick(`${i} (${t} should be defined as a 2D array)`),0))}_validateGeometry(e,t=null,r=null){if(null!=t&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const t=e;if(!isFinite(t.x)||!isFinite(t.y))return m().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":(0,a.Zy)(e)}return!0}_defaultElevationInfoNoZ(){return _}_defaultElevationInfoZ(){return b}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t=new u.o){const r=e.geometry,i=this.getDefaultElevationInfo(r);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:i.unit,t.mode=this.getGeometryElevationMode(r,i),t.offsetMeters=this._elevationContext.meterUnitOffset??i.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;n&&(t.mode="relative-to-ground",t.offsetMeters=0);const o=n?h.O$:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(o,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}updateTransform(e,t,r,i){return!1}onRemoveGraphic(e){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;return this._context.layer.opacity??1}_getCombinedOpacity(e,t=w){const r=this.draped?1:this._getLayerOpacity();return this._drivenProperties.opacity||this._drivenProperties.color?r:e?r*e.a:t.hasIntrinsicColor?r:0}_getCombinedOpacityAndColor(e,t=w){const r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return(0,d.Uu)(null,r);const n=null!=e?i.Z.toUnitRGB(e):o.hq;return(0,d.Uu)(n,r)}_getVertexOpacityAndColor(e,t,r=null){const i=this._drivenProperties.color?e.color??t:null,n=this._drivenProperties.opacity?e.opacity??t[3]:null,o=(0,d.Uu)(i,n);return r&&(o[0]*=r,o[1]*=r,o[2]*=r,o[3]*=r),o}isFastUpdatesEnabled(){return null!=this._fastUpdates}updateComplexity(){this.complexity=this.computeComplexity()}computeComplexity(){return(0,l.u)(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r),!0;case"elevationInfo":{const e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,e)!==c.lO.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,r){let i=c.lO.UPDATE;return e?.forEach((e=>{const n=t(e);if(null!=n){const t=e.graphic;this.setGraphicElevationContext(t,n.elevationContext),n.needsElevationUpdates=r(n.elevationContext.mode)}else i=c.lO.RECREATE})),i}applyRendererDiff(e,t){return p.W.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const t=this._fastUpdates.visualVariables,r=t.size?(0,y.kD)(t.size.field,e):0,i=t.color?(0,y.kD)(t.color.field,e):0,n=t.opacity?(0,y.kD)(t.opacity.field,e):0;return(0,s.al)(r,i,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&m().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}}}function v(e,t){const r={color:!1,opacity:!1,opacityAlwaysOpaque:t,size:!1,rotation:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach((e=>{switch(e.type){case"color":if(r.color=!0,e.stops)for(let t=0;t<e.stops.length;t++){const i=e.stops[t].color;i&&i.a<1&&(r.opacityAlwaysOpaque=!1)}break;case"opacity":r.opacity=!0,r.opacityAlwaysOpaque=!1;break;case"size":r.size=!0;break;case"rotation":r.rotation=!0}})),r}const _={mode:"on-the-ground",offset:0,unit:"meters"},b={mode:"absolute-height",offset:0,unit:"meters"},w={hasIntrinsicColor:!1}},26834:function(e,t,r){r.d(t,{l:function(){return a}});var i=r(44550),n=r(80606),o=r(95787),s=r(37294);class a extends o.w{constructor(e,t,r){super(t),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:i.WU}globalPropertyChanged(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(e,t):n.W.RecreateSymbol}prepareSymbolPatch(e){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.updateGeometry(e,t)}updateTransform(e,t,r,i){return this.graphics3DSymbol?.updateTransform(e,t,r,i)??!1}onRemoveGraphic(){}updateFocus(){}getFastUpdateStatus(){return this.graphics3DSymbol?.getFastUpdateStatus()??n.X.Loading}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}get cachedMemory(){return(0,s.n)(this)}}},95787:function(e,t,r){r.d(t,{P:function(){return i},w:function(){return s}});var i,n=r(61100),o=r(93568);class s{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=i.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===i.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===i.FAILED?(t&&t(this._loadError),this._loader??Promise.resolve()):(null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then((()=>{this._abortController=null,this._loadStatus=i.LOADED}),(e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=i.FAILED,!(0,o.D_)(e)&&this.logger&&e.message&&this.logger.warn(e.message),e}))),this._loader.then(e,t).catch((()=>{})),this._loader)}abortLoad(){null!=this._abortController?this._abortController=(0,n.IM)(this._abortController):this._loadStatus===i.LOADING&&(this._loadStatus=i.FAILED),this._loader=null}}!function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"}(i||(i={}))},18056:function(e,t,r){r.d(t,{SX:function(){return a},VT:function(){return s},Y6:function(){return n},eH:function(){return i},ti:function(){return o}});class i{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new a}}class n extends i{constructor(e){super(e),this.estimated=!0}}class o extends i{constructor(e,t){super(t),this.numComplexities=e}}class s extends n{constructor(e,t){super(t),this.numComplexities=e}}class a{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}}},47451:function(e,t,r){r.d(t,{Cj:function(){return o},PY:function(){return n},aT:function(){return s}});var i=r(27583);const n=1.2,o=i.AG,s=4},44550:function(e,t,r){r.d(t,{BN:function(){return m},IQ:function(){return d},V9:function(){return h},WU:function(){return u},bz:function(){return p},iu:function(){return v},u:function(){return y}});var i=r(79487),n=r(46781),o=r(33638),s=r(36786),a=r(18056),l=r(80300),c=r(35720);const u=new a.Y6({});function h(e){return"web-style"===e.type?u:d(e.symbolLayers.toArray().map((t=>y(e,t))))}function d(e){let t=0,r=0,i=0,n=!1,o=0;const s=new a.SX;for(const a of e)null!=a&&(t+=a.verticesPerFeature,r+=a.verticesPerCoordinate,i+=a.drawCallsPerFeature,s.bytesPerFeature+=a.memory.bytesPerFeature,s.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,s.resourceBytes+=a.memory.resourceBytes,s.draped.bytesPerFeature+=a.memory.bytesPerFeature,s.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,n=n||a.estimated,++o);return n?new a.VT(o,{verticesPerFeature:t,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:s}):new a.ti(o,{verticesPerFeature:t,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:s})}function p(e){const t=d(e);return t.numComplexities>0&&(t.verticesPerFeature/=t.numComplexities,t.verticesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities),t}const f={};function y(e,t){const r=m(e,t),s=(0,l.eU)(t)?2:0;switch(t.type){case"extrude":return new a.eH({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:s,memory:r});case"fill":if("mesh-3d"===e.type)return new a.eH({drawCallsPerFeature:s,memory:r});if(null!=t.outline&&t.outline.size>0)return new a.eH({verticesPerFeature:-12,verticesPerCoordinate:9,memory:r});case"water":return new a.eH({verticesPerFeature:-6,verticesPerCoordinate:3,memory:r});case"line":return new a.eH({verticesPerFeature:-6,verticesPerCoordinate:6,memory:r});case"object":return t.resource?.href?new a.Y6({verticesPerFeature:100,memory:r}):{...g(t.resource?.primitive??n.S),memory:r};case"path":{let e=0,n=0;switch(t.profile){case"circle":e=o.JK;break;case"quad":e=4;break;default:return void(0,i.Bg)(t.profile)}switch(t.join){case"round":n=o.t7;break;case"miter":case"bevel":n=1;break;default:return}const s=2*e,l=e*n*2,c=l+s;let u=-2*l-s;switch(t.cap){case"none":break;case"butt":case"square":u+=2*(e-1);break;case"round":u+=2*(e*(o.wg-1)*2+e);break;default:return}return new a.eH({verticesPerFeature:u,verticesPerCoordinate:c,memory:r})}case"text":{const t="label-3d"===e.type?0:2;return new a.eH({verticesPerFeature:6,memory:r,drawCallsPerFeature:t})}case"icon":return new a.eH({verticesPerFeature:6,memory:r});default:return}}function m(e,t){const r="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?_.EXTRUDE_EDGES:_.EXTRUDE;case"fill":return null!=t.outline&&t.outline.size>0?_.FILL_OUTLINE:_.FILL;case"water":return _.FILL;case"line":return"round"===t.join?_.LINE_ROUND:_.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return _.PATH_ROUND_CIRCLE;case"quad":return _.PATH_ROUND_QUAD;default:return void(0,i.Bg)(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return _.PATH_MITER_CIRCLE;case"quad":return _.PATH_MITER_QUAD;default:return void(0,i.Bg)(t.profile)}default:return}case"object":return r?_.OBJECT_POINT:_.OBJECT_POLYGON;case"icon":case"text":return r?_.ICON_POINT:_.ICON_POLYGON;default:return}}function g(e){const t=f[e];if(t)return t;const r=v((0,s.t)(e,new c.Gp({},{spherical:!0})).levels);return f[e]=new a.eH({verticesPerFeature:r}),f[e]}function v(e){return e.reduce(((e,t,r)=>e+t.numVertices*(1/10**r)),0)/e.reduce(((e,t,r)=>e+1/10**r),0)}const _={ICON_POINT:{bytesPerFeature:3062.2534325974652,bytesPerFeatureLabel:3605.891255,resourceBytes:0,draped:{bytesPerFeature:2029.6324697040875,bytesPerFeatureLabel:3844.951315}},ICON_POLYGON:{bytesPerFeature:3379.2552364427283,bytesPerFeatureLabel:3144.1341316666667,resourceBytes:0,draped:{bytesPerFeature:2594.5439970589305,bytesPerFeatureLabel:3391.0192816666668}},OBJECT_POINT:{bytesPerFeature:755.5754513856272,bytesPerFeatureLabel:3229.7766,resourceBytes:0,draped:{bytesPerFeature:755.5754513856272,bytesPerFeatureLabel:3229.7766}},OBJECT_POLYGON:{bytesPerFeature:1235.9612556276838,bytesPerFeatureLabel:2710.5796950000004,resourceBytes:0,draped:{bytesPerFeature:1235.9612556276838,bytesPerFeatureLabel:2710.5796950000004}},LINE_MITER:{bytesPerFeature:2343.0098144295366,bytesPerFeatureLabel:2863.2415183333333,resourceBytes:0,draped:{bytesPerFeature:2118.062960542706,bytesPerFeatureLabel:2993.8707950000003}},LINE_ROUND:{bytesPerFeature:3180.281669156425,bytesPerFeatureLabel:2884.062711666667,resourceBytes:0,draped:{bytesPerFeature:2687.1048133674676,bytesPerFeatureLabel:2965.844025}},PATH_MITER_CIRCLE:{bytesPerFeature:26642.015762630304,bytesPerFeatureLabel:3147.8341749999995,resourceBytes:0,draped:{bytesPerFeature:26642.015762630304,bytesPerFeatureLabel:3147.8341749999995}},PATH_ROUND_CIRCLE:{bytesPerFeature:21137.659435445064,bytesPerFeatureLabel:2827.1294000000003,resourceBytes:0,draped:{bytesPerFeature:21137.659435445064,bytesPerFeatureLabel:2827.1294000000003}},PATH_MITER_QUAD:{bytesPerFeature:25592.283303929427,bytesPerFeatureLabel:3354.641775,resourceBytes:0,draped:{bytesPerFeature:25592.283303929427,bytesPerFeatureLabel:3354.641775}},PATH_ROUND_QUAD:{bytesPerFeature:23212.92773696872,bytesPerFeatureLabel:3173.6644499999998,resourceBytes:0,draped:{bytesPerFeature:23212.92773696872,bytesPerFeatureLabel:3173.6644499999998}},FILL:{bytesPerFeature:3069.6014181747005,bytesPerFeatureLabel:3050.617135,resourceBytes:0,draped:{bytesPerFeature:2547.9765396831167,bytesPerFeatureLabel:3166.2821483333337}},FILL_OUTLINE:{bytesPerFeature:3653.779598313774,bytesPerFeatureLabel:2787.5897050000003,resourceBytes:0,draped:{bytesPerFeature:2884.528596112384,bytesPerFeatureLabel:2907.420548333333}},EXTRUDE:{bytesPerFeature:5785.658350054202,bytesPerFeatureLabel:2787.498365,resourceBytes:0,draped:{bytesPerFeature:5785.658350054202,bytesPerFeatureLabel:2787.498365}},EXTRUDE_EDGES:{bytesPerFeature:3380.451670091342,bytesPerFeatureLabel:2245.881308333333,resourceBytes:0,draped:{bytesPerFeature:3380.451670091342,bytesPerFeatureLabel:2245.881308333333}}}},10841:function(e,t,r){var i,n;r.d(t,{E:function(){return n},P:function(){return i}}),function(e){e[e.USER=1]="USER",e[e.SCALE_RANGE=2]="SCALE_RANGE",e[e.FILTER=4]="FILTER",e[e.DECONFLICTION=8]="DECONFLICTION",e[e.ALL_GRAPHIC=15]="ALL_GRAPHIC",e[e.ALL_LABEL=255]="ALL_LABEL"}(i||(i={})),function(e){e[e.GRAPHIC=1]="GRAPHIC",e[e.LABEL=16]="LABEL"}(n||(n={}))},80606:function(e,t,r){var i,n;r.d(t,{W:function(){return i},X:function(){return n}}),function(e){e[e.RecreateSymbol=0]="RecreateSymbol",e[e.RecreateGraphics=1]="RecreateGraphics",e[e.FastUpdate=2]="FastUpdate"}(i||(i={})),function(e){e[e.Slow=0]="Slow",e[e.Fast=1]="Fast",e[e.Mixed=2]="Mixed",e[e.Loading=3]="Loading",e[e.Undefined=4]="Undefined"}(n||(n={}))},29819:function(e,t,r){r.d(t,{Cd:function(){return d},S9:function(){return m},S_:function(){return y},ZC:function(){return h},dO:function(){return f}});var i=r(82846),n=r(6961),o=r(16447),s=r(28931),a=r(60856),l=r(90210),c=r(36027),u=r(26475);function h(e,t,r,i,n){if(p(e,t))return null;r.localOrigin=m(e,t);const o=new u.T({geometries:[r],castShadow:!1,layerViewUid:e.layerViewUid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:o,sampledElevation:(0,l.bD)(o,t,e.elevationProvider,e.renderCoordsHelper,i)}}function d(e,t,r,i){return p(t,r)?null:(0,l.bD)(e,r,t.elevationProvider,t.renderCoordsHelper,i)}function p(e,t){const r=e.clippingExtent;return!!r&&((0,n.K)(t,g,e.elevationProvider.spatialReference),!(0,o.BD)(r,g))}function f(e,t,r){const i=e.elevationContext,o=r.spatialReference;(0,n.K)(t,g,o),i.centerPointInElevationSR=(0,a.T)(g[0],g[1],t.hasZ?g[2]:0,null!=o?o:null)}function y(e){switch(e.type){case"point":return e;case"polygon":case"extent":return(0,c.zE)(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const r=(0,s.n8)(t,(0,s.ok)(t)/2);return(0,a.T)(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.extent.center}return null}function m(e,t){return(0,n.K)(t,g,e.renderCoordsHelper.spatialReference),e.localOriginFactory.getOrigin(g)}const g=(0,i.Ue)()},37294:function(e,t,r){r.d(t,{n:function(){return i}});function i(e){return 2216+4096*e.symbolLayers.length+e.complexity.memory.resourceBytes}},15165:function(e,t,r){r.d(t,{W:function(){return i},l:function(){return n}});class i{constructor(e,t=0,r=0,i=0,n=0,o=null){this.usedMemory=e,this.displayedFeatures=t,this.totalFeatures=r,this.maximumFeatures=i,this.nodes=n,this.core=o}}function n(e){return"performanceInfo"in e}},80300:function(e,t,r){r.d(t,{hM:function(){return c},C8:function(){return u},$s:function(){return h},eU:function(){return l}});var i=r(53147),n=(r(61432),r(96094)),o=r(27583);var s=r(57225),a=r(49466);function l(e){return e&&e.enabled&&(function(e){return"extrude"===e.type}(e)||function(e){return"fill"===e.type}(e))&&null!=e.edges}function c(e,t){return u(function(e){return e&&e.enabled&&e.edges||null}(e),t)}function u(e,t){if(null==e)return null;const r=null!=e.color?(0,o.nI)(i.Z.toUnitRGBA(e.color)):(0,o.al)(0,0,0,0),s=(0,n.F2)(e.size),l=(0,n.F2)(e.extensionLength);switch(e.type){case"solid":return h({color:r,size:s,extensionLength:l,...t});case"sketch":return function(e){return{...p,...e,type:a.Pb.Sketch}}({color:r,size:s,extensionLength:l,...t});default:return}}function h(e){return{...d,...e,type:a.Pb.Solid}}const d={color:(0,o.al)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:s.i.OPAQUE,hasSlicePlane:!1},p={color:(0,o.al)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:s.i.OPAQUE,hasSlicePlane:!1}},90494:function(e,t,r){r.d(t,{Fb:function(){return o},KO:function(){return s},sb:function(){return n}});var i=r(27936);class n{constructor(e,t=null,r=0){this.array=e,this.spatialReference=t,this.offset=r}}function o(e){return"array"in e}function s(e,t,r="ground"){if((0,i.f)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(o(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,t.spatialReference??e.spatialReference,r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},38600:function(e,t,r){r.d(t,{c:function(){return n}});var i=r(47566);class n{constructor(e="scene"){this.context=e,this.extent=(0,i.cS)()}}},58300:function(e,t,r){r.d(t,{G:function(){return s},O:function(){return o}});var i=r(82846),n=r(30146);function o(e,t,r){if(null==e||null==r)return!1;let i=!0;return a[0]=null!=e.xmin?e.xmin:0,a[1]=null!=e.ymin?e.ymin:0,a[2]=null!=e.zmin?e.zmin:0,i=i&&(0,n.projectBuffer)(a,e.spatialReference,0,t,r,0),a[0]=null!=e.xmax?e.xmax:0,a[1]=null!=e.ymax?e.ymax:0,a[2]=null!=e.zmax?e.zmax:0,i=i&&(0,n.projectBuffer)(a,e.spatialReference,0,t,r,3),null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.zmin&&(t[2]=-1/0),null==e.xmax&&(t[3]=1/0),null==e.ymax&&(t[4]=1/0),null==e.zmax&&(t[5]=1/0),i}function s(e,t,r){if(null==e||null==r)return!1;let i=!0;return a[0]=null!=e.xmin?e.xmin:0,a[1]=null!=e.ymin?e.ymin:0,a[2]=null!=e.zmin?e.zmin:0,i=i&&(0,n.projectBuffer)(a,e.spatialReference,0,a,r,0),t[0]=a[0],t[1]=a[1],a[0]=null!=e.xmax?e.xmax:0,a[1]=null!=e.ymax?e.ymax:0,a[2]=null!=e.zmax?e.zmax:0,i=i&&(0,n.projectBuffer)(a,e.spatialReference,0,a,r,0),t[2]=a[0],t[3]=a[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),i}const a=(0,i.Ue)()},316:function(e,t,r){r.d(t,{W8:function(){return l},kD:function(){return a}});var i=r(41788),n=r(24910),o=r(82846),s=r(77773);function a(e,t,r,i){return d(e,t,r,u(i,t,r,!0))}function l(e,t,r,i){const o=(0,n.e)(r,(0,n.d)(e,i,t));return(0,n.f)(e,t,(0,n.g)(e,r,o))}const c={dir:(0,o.Ue)(),len:0,clip:(0,i.Ue)()};function u(e,t,r,i){const o=c;return e?(r&&i&&(o.len=(0,n.j)(t,r)),(0,n.c)(o.dir,e)):i?(o.len=(0,n.j)(t,r),(0,n.d)(o.dir,r,t),(0,n.g)(o.dir,o.dir,1/o.len)):((0,n.d)(o.dir,r,t),(0,n.n)(o.dir,o.dir)),o}function h(e,t,r){const i=(0,n.e)((0,s.st)(e),r.dir),o=-(0,s.jH)(e,t);if(o<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return o>0;if((o<0||i<0)&&!(o<0&&i<0))return!0;const a=o/i;return i>0?a<r.clip[1]&&(r.clip[1]=a):a>r.clip[0]&&(r.clip[0]=a),r.clip[0]<=r.clip[1]}function d(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let r=0;r<e.length;r++)if(!h(e[r],t,i))return!1;return!0}},54998:function(e,t,r){r.d(t,{AD:function(){return _},_N:function(){return p},nO:function(){return v},Hz:function(){return g}});var i=r(79487),n=r(64497),o=r(92638),s=r(41044),a=r(45701),l=r(90285),c=r(48857),u=r(5998),h=r(92217);class d extends h.x{constructor(e,t){super(e,"int",u.P.Draw,((r,i,n)=>r.setUniform1i(e,t(i,n))))}}var p,f=r(29193),y=r(95285),m=r(52061);!function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"}(p||(p={}));const g=429496.7296;function v(e,t){(0,n.I)(e/g*.5+.5,t)}function _(e,t){switch(t.componentData){case p.Varying:return function(e,t){const{vertex:r,fragment:i}=e;r.include(a.n),r.uniforms.add(new f.R("componentColorTex",(e=>e.componentParameters.texture.texture))),e.attributes.add(m.T.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4");const n=t.output===s.H_.ObjectAndLayerIdColor;n&&e.varyings.add("vObjectAndLayerIdColor","vec4"),e.include(o.A),r.constants.add("stride","float",(0,y.B)()?3:2),r.code.add(c.H`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(c.H`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);
    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

  float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);
    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return uninterpolatedRGBAToFloat(encodedElevation) * ${c.H.float(g)};
  }

  ${n?c.H`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);
            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:c.H`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(c.H`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?c.H`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}(e,t);case p.Uniform:return function(e,t){const{vertex:r,fragment:i}=e;e.varyings.add("vExternalColor","vec4"),r.uniforms.add(new l.$("externalColor",(e=>e.componentParameters.externalColor))).code.add(c.H`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const n=t.output===s.H_.ObjectAndLayerIdColor;i.uniforms.add(new d("externalColorMixMode",(e=>e.componentParameters.externalColorMixMode))).code.add(c.H`
    void readExternalColor(out vec4 color, out int colorMixMode) {
      color = vExternalColor;
      colorMixMode = externalColorMixMode;
    }

    void outputObjectAndLayerIdColor() {
      ${(0,c.If)(n,"fragColor = vec4(0, 0, 0, 0);")}
    }
  `)}(e,t);case p.COUNT:return;default:(0,i.Bg)(t.componentData)}}},28692:function(e,t,r){r.d(t,{S:function(){return s}});var i=r(20638),n=r(48857),o=r(71063);function s(e){e.include(i.K),e.uniforms.add(new o.e("geometryDepthTexture",(e=>e.geometryDepth?.attachment))),e.code.add(n.H`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}},82915:function(e,t,r){r.d(t,{as:function(){return n},t9:function(){return s}});var i=r(63974);class n{constructor(){this.adds=new i.Z,this.removes=new i.Z,this.updates=new i.Z({allocator:e=>e||new o,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class o{}class s{constructor(e){this.pending=e,this.adds=new Array,this.removes=new Array,this.updates=new Array}clearAddsAndRemoves(){this.adds.forEach((e=>this.pending.adds.removeUnordered(e))),this.removes.forEach((e=>this.pending.removes.removeUnordered(e))),this.adds.length=0,this.removes.length=0}clearUpdates(){this.updates.forEach((e=>this.pending.updates.removeUnordered(e))),this.updates.length=0}clear(){this.clearUpdates(),this.clearAddsAndRemoves()}}},95786:function(e,t,r){r.d(t,{T:function(){return i}});r(25952);function i(e){return null!=e.mapPositions}},92181:function(e,t,r){r.d(t,{i_:function(){return a},w0:function(){return l},Wd:function(){return c}});var i=r(82846),n=r(32033),o=r(19821);class s{constructor(e,t,r){this.object=e,this.geometryId=t,this.primitiveIndex=r}}class a extends n.x{constructor(){super(...arguments),this.intersector=o.q.HUD}}class l extends s{constructor(e,t){super(e.object,e.geometryId,e.primitiveIndex),this.center=(0,i.d9)(t)}}function c(e){return(0,n.n)(e)&&e.intersector===o.q.HUD&&!!e.target&&"center"in e.target}},92490:function(e,t,r){r.d(t,{j:function(){return p},r:function(){return f}});var i=r(24910),n=r(82846),o=r(12659),s=r(56172),a=r(48636),l=r(92181),c=r(61442),u=r(32033),h=r(19821),d=r(43925);const p=1e-5;class f{constructor(e){this.options=new c.o,this._results=new m,this.transform=new d.yn,this.camera=new a.Z,this.tolerance=p,this.verticalOffset=null,this._ray=(0,o.Ue)(),this._rayEnd=(0,n.Ue)(),this._rayBeginTransformed=(0,n.Ue)(),this._rayEndTransformed=(0,n.Ue)(),this.viewingMode=e??s.JY.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,r){this.resetWithRay((0,o.zk)(e,t,this._ray),r)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,o.JG)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===s.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,i.f)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,r,i,n){this.point=t,this.filterPredicate=i,this.tolerance=r??p;const o=(0,d.W9)(this.verticalOffset);if(e&&e.length>0){const t=n?e=>{n(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const r of e){const e=r.getSpatialQueryAccelerator?.();null!=e?(null!=o?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,o):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):r.objects.forEach((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const r=e.effectiveTransformation,n=(0,d.W9)(this.verticalOffset);for(const o of t){if(!o.visible)continue;const{material:t,id:s}=o;if(!t.visible)continue;this.transform.setAndInvalidateLazyTransforms(r,o.transformation),(0,i.t)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,i.t)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const a=this.transform.transform;null!=n&&(n.objectTransform=this.transform),t.intersect(o,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,r,i,n)=>this.handleObjectIntersection({object:e,geometryId:s,primitiveIndex:i},t,r,a,n)))}}handleObjectIntersection(e,t,r,i,n){if(t<0||null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const o=n?this._results.hud:this._results;e=n?new l.w0(e,n):e;const s=n?i=>i.set(h.q.HUD,e,t,r):n=>n.set(h.q.OBJECT,e,t,r,i);if((null==o.min.distance||t<o.min.distance)&&s(o.min),this.options.store!==c.e.MIN&&(null==o.max.distance||t>o.max.distance)&&s(o.max),this.options.store===c.e.ALL)if(n){const e=new l.i_(this._ray);s(e),this._results.hud.all.push(e)}else{const e=new u.x(this._ray);s(e),this._results.all.push(e)}}sortResults(e=this._results.all){e.sort(((e,t)=>e.distance!==t.distance?(e.distance??0)-(t.distance??0):e.drapedLayerOrder!==t.drapedLayerOrder?y(e.drapedLayerOrder,t.drapedLayerOrder):y(e.renderPriority,t.renderPriority)))}}function y(e,t){return(t??-Number.MAX_VALUE)-(e??-Number.MAX_VALUE)}class m{constructor(){this.min=new u.x((0,o.Ue)()),this.max=new u.x((0,o.Ue)()),this.hud={min:new l.i_((0,o.Ue)()),max:new l.i_((0,o.Ue)()),all:new Array},this.ground=new u.x((0,o.Ue)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}},57225:function(e,t,r){var i;r.d(t,{i:function(){return i}}),function(e){e[e.TRANSPARENT=0]="TRANSPARENT",e[e.OPAQUE=1]="OPAQUE"}(i||(i={}))},10517:function(e,t,r){r.d(t,{Np:function(){return n},YE:function(){return i},q9:function(){return s}});var i,n,o=r(82915);function s(e){const t=new Map,r=r=>{let i=t.get(r);return i||(i=new o.t9(e),t.set(r,i)),i};return e.removes.forAll((e=>{a(e)&&r(e.material).removes.push(e)})),e.adds.forAll((e=>{a(e)&&r(e.material).adds.push(e)})),e.updates.forAll((e=>{a(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)})),t}function a(e){return e.geometry.indexCount>=1}!function(e){e[e.Default=0]="Default",e[e.Screenshot=1]="Screenshot",e[e.ObjectAndLayerID=2]="ObjectAndLayerID"}(i||(i={})),function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(n||(n={}))},49466:function(e,t,r){r.d(t,{G7:function(){return n},Pb:function(){return i},UR:function(){return g},lV:function(){return v}});var i,n,o=r(54998),s=r(57716),a=r(28984),l=r(45701),c=r(80357),u=r(9535),h=r(48857),d=r(15727),p=r(57798),f=r(18489),y=r(29193),m=r(52061);function g(e,t){const{vertex:r}=e;r.include(l.n),e.include(s.O,t);const{silhouette:i,legacy:n,spherical:g}=t;r.uniforms.add(new y.R("componentDataTex",(e=>e.componentDataTexture))),e.attributes.add(m.T.COMPONENTINDEX,"float");r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.code.add(h.H`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = ${h.H.float(3)}  * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, ${h.H.float(0)});
      vec2 otherIndex = _componentTextureCoords(componentIndex, ${h.H.float(1)});
      vec2 verticalOffsetIndex = _componentTextureCoords(float(componentIndex), ${h.H.float(2)} );
      vec3 normal = normalModel();
      vec3 normal2 = ${i?h.H`decompressNormal(normal2Compressed)`:h.H`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = uninterpolatedRGBAToFloat(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) * ${h.H.float(o.Hz)};

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / ${h.H.float(8)} ),
        otherValue.y * 255.0 - ${h.H.float(128)},
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),n?r.code.add(h.H`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new d.j("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel))),r.code.add(h.H`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),i?(e.attributes.add(m.T.NORMAL2COMPRESSED,"vec2"),r.code.add(h.H`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):r.code.add(h.H`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),n?r.code.add(h.H`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(a.$,t),r.uniforms.add(new p.c("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new d.j("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new c.B("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL)),new c.B("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new u.J("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new u.J("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH))),r.code.add(h.H`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${g?"normalize(transformWorldFromModelTL + rotatedModelPosition);":"vec3(0.0, 0.0, 1.0);"}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new f.C("transformProjFromView",(e=>e.camera.projectionMatrix))).code.add(h.H`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(h.H`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function v(e){return e===i.Sketch||e===i.Mixed}!function(e){e[e.Solid=0]="Solid",e[e.Sketch=1]="Sketch",e[e.Mixed=2]="Mixed",e[e.COUNT=3]="COUNT"}(i||(i={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.SILHOUETTE=1]="SILHOUETTE"}(n||(n={}))},48636:function(e,t,r){r.d(t,{Z:function(){return P}});var i=r(73440),n=r(70880),o=r(96711),s=r(99574),a=r(96094),l=r(17155),c=(r(61432),r(83850),r(48023)),u=r(31865),h=r(10934),d=r(26821),p=r(41788),f=r(24910),y=r(82846),m=r(73749),g=r(27583),v=r(33869),_=r(12659),b=r(63271),w=r(56172);var x,T=r(10517);let O=x=class extends n.Z{constructor(e){super(e),this._ray=(0,_.Ue)(),this._viewport=(0,g.al)(0,0,1,1),this._padding=(0,g.al)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,p.al)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,h.Ue)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,h.Ue)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,h.Ue)(),this._frustumDirty=!0,this._frustum=(0,v.Ue)(),this._fullViewport=(0,g.Ue)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,y.Ue)(),this._up=(0,y.Ue)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,f.d)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,u.JG)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,f.i)((0,y.Ue)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,f.i)((0,y.Ue)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,f.i)((0,y.Ue)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,m.d)((0,g.Ue)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,m.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,m.d)((0,g.Ue)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,m.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[T.Np.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[T.Np.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[T.Np.RIGHT]+this._padding[T.Np.LEFT]}set fullWidth(e){this.width=e-(this._padding[T.Np.RIGHT]+this._padding[T.Np.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[T.Np.TOP]+this._padding[T.Np.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[T.Np.TOP]+this._padding[T.Np.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[T.Np.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[T.Np.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,m.a)(this._padding,e)||(this._viewport[0]+=e[T.Np.LEFT]-this._padding[T.Np.LEFT],this._viewport[1]+=e[T.Np.BOTTOM]-this._padding[T.Np.BOTTOM],this._viewport[2]-=e[T.Np.RIGHT]+e[T.Np.LEFT]-(this._padding[T.Np.RIGHT]+this._padding[T.Np.LEFT]),this._viewport[3]-=e[T.Np.TOP]+e[T.Np.BOTTOM]-(this._padding[T.Np.TOP]+this._padding[T.Np.BOTTOM]),(0,m.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,u.Jp)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,u.U_)((0,h.Ue)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,h.Ue)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovX(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovY(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,f.j)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,u.U_)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,u.p4)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const{near:t,far:r}=this;return 2*t*r/(r+t-e*(r-t))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2)*2,i=r*this._aspect,n=r/this.rows,o=i/this.columns,s=-i/2+this.column*o,a=s+o,l=-r/2+this.row*n,c=l+n,d=(0,u.oy)((0,h.Ue)(),s*(1+2*this._padding[T.Np.LEFT]/e),a*(1+2*this._padding[T.Np.RIGHT]/e),l*(1+2*this._padding[T.Np.BOTTOM]/t),c*(1+2*this._padding[T.Np.TOP]/t),this.near,this.far),p=this._get("projectionMatrix");return p&&(0,u.fS)(p,d)?p:d}copyFrom(e){(0,f.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,m.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,m.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,d.JG)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,u.JG)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,v.JG)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,u.JG)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,m.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up,this.fov=e.fov}clone(){return(new x).copyFrom(this)}equals(e){return(0,f.q)(this.eye,e.eye)&&(0,f.q)(this.center,e.center)&&(0,f.q)(this.up,e.up)&&(0,m.a)(this._viewport,e.viewport)&&(0,m.a)(this._padding,e.padding)&&(0,d.I6)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,m.f)(e.screenPadding,this.screenPadding)>=t||(0,m.f)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,f.a)(C,e.eye,e.center),(0,f.a)(L,this.eye,this.center);const r=(0,f.e)(C,L),i=(0,f.y)(C),n=(0,f.y)(L),o=5e-4;return r*r>=(1-1e-10)*i*n&&(0,f.x)(e.eye,this.eye)<Math.max(i,n)*o*o}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,b.SR)(this.viewForward,(0,f.d)(C,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=(0,a.s1)()){return e[0]=(this.padding[T.Np.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[T.Np.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,r=.5){return e[0]=this.padding[T.Np.LEFT]+this.width*t,e[1]=this.padding[T.Np.BOTTOM]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==S&&(0,f.c)(S,e),S[3]=1,(0,m.t)(S,S,this.projectionMatrix);const r=Math.abs(S[3]);(0,f.g)(S,S,1/r);const i=this.fullViewport;t[0]=(0,s.t7)(0,i[0]+i[2],.5+.5*S[0]),t[1]=(0,s.t7)(0,i[1]+i[3],.5+.5*S[1]),t[2]=.5*(S[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;S[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],S[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],S[2]=(2*e[2]-1)*e[3],S[3]=e[3],null!=this.inverseProjectionMatrix&&((0,m.t)(S,S,this.inverseProjectionMatrix),t[0]=S[0],t[1]=S[1],t[2]=S[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,R),this.renderToScreen(R,t),t}projectToRenderScreen(e,t){if(S[0]=e[0],S[1]=e[1],S[2]=e[2],S[3]=1,(0,m.t)(S,S,this.viewProjectionMatrix),0===S[3])return null;const r=S;(0,f.g)(r,r,1/Math.abs(S[3]));const i=this.fullViewport,n=(0,s.t7)(0,i[0]+i[2],.5+.5*r[0]),o=(0,s.t7)(0,i[1]+i[3],.5+.5*r[1]);return"x"in t?(t.x=n,t.y=o):(t[0]=n,t[1]=o,t.length>2&&(t[2]=.5*(r[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,R),t)}unprojectFromRenderScreen(e,t){if((0,u.Jp)(E,this.projectionMatrix,this.viewMatrix),!(0,u.U_)(E,E))return null;const r=this.fullViewport;return S[0]=2*(e[0]-r[0])/r[2]-1,S[1]=2*(e[1]-r[1])/r[3]-1,S[2]=2*e[2]-1,S[3]=1,(0,m.t)(S,S,E),0===S[3]?null:(t[0]=S[0]/S[3],t[1]=S[1]/S[3],t[2]=S[2]/S[3],t)}constrainWindowSize(e,t,r,i){const n=e*this.pixelRatio,o=t*this.pixelRatio,s=Math.max(n-r/2,0),a=Math.max(this.fullHeight-o-i/2,0),l=-Math.min(n-r/2,0),c=-Math.min(this.fullHeight-o-i/2,0),u=r-l- -Math.min(this.fullWidth-n-r/2,0),h=i-c- -Math.min(o-i/2,0);return[Math.round(s),Math.round(a),Math.round(u),Math.round(h)]}computeUp(e){e===w.JY.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}_computeUpGlobal(){(0,f.d)(C,this.center,this.eye);const e=(0,f.l)(this.center);e<1?((0,f.i)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,f.e)(C,this.center))>.9999*(0,f.l)(C)*e||((0,f.h)(this._up,C,this.center),(0,f.h)(this._up,this._up,C),(0,f.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,f.E)(C,this.eye,this.center),Math.abs(C[2])<=.9999&&((0,f.g)(C,C,C[2]),(0,f.i)(this._up,-C[0],-C[1],1-C[2]),(0,f.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,r=""){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,f.q)(e,t)||((0,f.c)(t,e),this._markViewDirty(),r.length&&this.notifyChange(r)):o.Z.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,v.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,u.zB)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,i._)([(0,l.Cb)()],O.prototype,"_viewport",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"_padding",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"_fov",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"_nearFar",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"_viewDirty",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"_viewMatrix",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"_pixelRatio",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"pixelRatio",null),(0,i._)([(0,l.Cb)()],O.prototype,"row",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"column",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"_rows",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"rows",null),(0,i._)([(0,l.Cb)()],O.prototype,"_columns",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"columns",null),(0,i._)([(0,l.Cb)()],O.prototype,"eye",null),(0,i._)([(0,l.Cb)()],O.prototype,"center",null),(0,i._)([(0,l.Cb)()],O.prototype,"_center",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"up",null),(0,i._)([(0,l.Cb)()],O.prototype,"_up",void 0),(0,i._)([(0,l.Cb)()],O.prototype,"viewMatrix",null),(0,i._)([(0,l.Cb)({readOnly:!0})],O.prototype,"viewForward",null),(0,i._)([(0,l.Cb)({readOnly:!0})],O.prototype,"viewUp",null),(0,i._)([(0,l.Cb)({readOnly:!0})],O.prototype,"viewRight",null),(0,i._)([(0,l.Cb)({readOnly:!0})],O.prototype,"nearFar",null),(0,i._)([(0,l.Cb)()],O.prototype,"near",null),(0,i._)([(0,l.Cb)()],O.prototype,"far",null),(0,i._)([(0,l.Cb)()],O.prototype,"viewport",null),(0,i._)([(0,l.Cb)({readOnly:!0})],O.prototype,"screenViewport",null),(0,i._)([(0,l.Cb)({readOnly:!0})],O.prototype,"screenPadding",null),(0,i._)([(0,l.Cb)()],O.prototype,"x",null),(0,i._)([(0,l.Cb)()],O.prototype,"y",null),(0,i._)([(0,l.Cb)()],O.prototype,"width",null),(0,i._)([(0,l.Cb)()],O.prototype,"height",null),(0,i._)([(0,l.Cb)()],O.prototype,"fullWidth",null),(0,i._)([(0,l.Cb)()],O.prototype,"fullHeight",null),(0,i._)([(0,l.Cb)({readOnly:!0})],O.prototype,"_aspect",null),(0,i._)([(0,l.Cb)()],O.prototype,"padding",null),(0,i._)([(0,l.Cb)({readOnly:!0})],O.prototype,"projectionMatrix",null),(0,i._)([(0,l.Cb)({readOnly:!0})],O.prototype,"inverseProjectionMatrix",null),(0,i._)([(0,l.Cb)()],O.prototype,"fov",null),(0,i._)([(0,l.Cb)()],O.prototype,"fovX",null),(0,i._)([(0,l.Cb)()],O.prototype,"fovY",null),(0,i._)([(0,l.Cb)()],O.prototype,"viewInverseTransposeMatrix",null),(0,i._)([(0,l.Cb)({readOnly:!0})],O.prototype,"_projectionMatrixInternal",null),(0,i._)([(0,l.Cb)()],O.prototype,"relativeElevation",void 0),O=x=(0,i._)([(0,c.j)("esri.views.3d.webgl.RenderCamera")],O);const P=O,S=(0,g.Ue)(),E=(0,h.Ue)(),C=(0,y.Ue)(),L=(0,y.Ue)(),R=(0,a.J$)()},17426:function(e,t,r){r.d(t,{x:function(){return n}});var i=r(39355);class n{constructor(){this._pendingCompressionTasks=(0,i.t)(0)}get compressing(){return!!this._pendingCompressionTasks.value}increment(){this._pendingCompressionTasks.value++}decrement(){this._pendingCompressionTasks.value--}}},92105:function(e,t,r){r.d(t,{i:function(){return c},o:function(){return l}});var i=r(93568),n=r(13132);let o,s=null;async function a(e){s||(s=r.e(45059).then(r.bind(r,45059)).then((e=>o=e))),await s,(0,i.k_)(e)}async function l(e,t,r,i){if(!e)return null;const s=e.spatialReference;return(0,n.isLoaded)()||(0,n.canProjectWithoutEngine)(s,t)?(0,n.project)(e,t):o?o.projectGeometry(e,t,r,i):(await Promise.race([a(i),(0,n.load)(i)]),l(e,t,r,i))}async function c(e,t){try{return e?.spatialReference?await(0,n.projectWithZConversion)(e,t):null}catch{return null}}}}]);