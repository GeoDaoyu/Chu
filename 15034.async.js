"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[15034,92284],{58426:function(e,t,i){i.d(t,{$c:function(){return d},Hg:function(){return y},jW:function(){return p},xb:function(){return g}});var r=i(70880),s=i(43254),n=i(22018);const o=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(e){return e instanceof r.Z}function l(e){return e instanceof s.Z?Object.keys(e.items):a(e)?(0,n.vw)(e).keys():e?Object.keys(e):[]}function c(e,t){return e instanceof s.Z?e.items[t]:e[t]}function h(e){return e?e.declaredClass:null}function u(e,t){const i=e.diff;if(i&&"function"==typeof i)return i(e,t);const r=l(e),s=l(t);if(0===r.length&&0===s.length)return;if(!r.length||!s.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter((e=>!r.includes(e))),p=r.filter((e=>!s.includes(e))),d=r.filter((i=>s.includes(i)&&c(e,i)!==c(t,i))).concat(n,p).sort(),y=h(e);if(y&&o.has(y)&&d.length)return{type:"complete",oldValue:e,newValue:t};let g;const f=a(e)&&a(t);for(const r of d){const s=c(e,r),n=c(t,r);let o;if((f||"function"!=typeof s&&"function"!=typeof n)&&s!==n&&(null!=s||null!=n)){if(i&&i[r]&&"function"==typeof i[r])o=i[r]?.(s,n);else if(s instanceof Date&&n instanceof Date){if(s.getTime()===n.getTime())continue;o={type:"complete",oldValue:s,newValue:n}}else o="object"==typeof s&&"object"==typeof n&&h(s)===h(n)?u(s,n):{type:"complete",oldValue:s,newValue:n};null!=o&&(null!=g?g.diff[r]=o:g={type:"partial",diff:{[r]:o}})}}return g}function p(e,t){return function(e,t){if(null==e)return!1;const i=t.split(".");let r=e;for(const e of i){if("complete"===r.type)return!0;if("partial"!==r.type)return!1;{const t=r.diff[e];if(!t)return!1;r=t}}return!0}(e,t)}function d(e,t){if(!e)return!1;if("partial"===e.type){const i=Object.keys(e.diff);return 1===i.length&&i[0]===t}return!1}function y(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&h(e)!==h(t)?{type:"complete",oldValue:e,newValue:t}:u(e,t)}function g(e){if(null==e)return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!g(e))return!1;for(const e of t.removed)if(!g(e))return!1;for(const e of t.changed)if(!g(e))return!1;return!0}case"partial":for(const t in e.diff)if(!g(e.diff[t]))return!1;return!0}}},56216:function(e,t,i){i.d(t,{Kb:function(){return o},o2:function(){return c},sV:function(){return l},xn:function(){return a}});var r=i(53147),s=i(47747),n=i(71618);function o(e,t){const i=function(e,t){if(null!=e.symbol)return e.symbol;const i=t?.renderer;return null!=i&&"dot-density"!==i.type?i.getSymbol(e,t):null}(e,t);if(null==i)return null;const r=t?.renderer,o=new s.E(r,i);if(null==r||!("visualVariables"in r)||!r.visualVariables)return o;const a=(0,n.getVisualVariableValues)(r,e,t)??[],l=["proportional","proportional","proportional"];for(const{variable:e,value:t}of a)if(null!=t||"size"===e.type&&e.useSymbolValue)switch(e.type){case"color":o.color=t?.toRgba();break;case"size":if("outline"===e.target)o.outlineSize=t;else{const i=e.axis,r=e.useSymbolValue?"symbol-value":t??"proportional";switch(i){case"width":l[0]=r;break;case"depth":l[1]=r;break;case"height":l[2]=r;break;case"width-and-depth":l[0]=l[1]=r;break;default:l[0]=l[1]=l[2]=r}}break;case"opacity":o.opacity=t;break;case"rotation":switch(e.axis){case"tilt":o.tilt=t;break;case"roll":o.roll=t;break;default:o.heading=t}}return"proportional"===l[0]&&"proportional"===l[1]&&"proportional"===l[2]||(o.size=l),o}async function a(e,t){const i=await async function(e,t){return null!=e.symbol?e.symbol:t?.renderer?.getSymbolAsync(e,t)??null}(e,t);if(!i)return null;const o=t?.renderer,a=new s.E(o,i);if(!o||!("visualVariables"in o)||!o.visualVariables)return a;const l=(0,n.getVisualVariableValues)(o,e,t)??[],c=["proportional","proportional","proportional"];for(const{variable:e,value:t}of l)if("color"===e.type)a.color=r.Z.toUnitRGBA(t);else if("size"===e.type)if("outline"===e.target)a.outlineSize=t;else{const i=e.axis,r=e.useSymbolValue?"symbol-value":t;"width"===i?c[0]=r:"depth"===i?c[1]=r:"height"===i?c[2]=r:c[0]=c[1]="width-and-depth"===i?r:c[2]=r}else"opacity"===e.type?a.opacity=t:"rotation"===e.type&&"tilt"===e.axis?a.tilt=t:"rotation"===e.type&&"roll"===e.axis?a.roll=t:"rotation"===e.type&&(a.heading=t);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(a.size=c),a}function l(e,t=0){const i=e[t];return"number"==typeof i&&isFinite(i)?i:null}function c(e){for(let t=0;t<3;t++){const i=e[t];if("number"==typeof i)return isFinite(i)?i:0}return 0}},9350:function(e,t,i){i.d(t,{CJ:function(){return c},Rz:function(){return u},js:function(){return p},xA:function(){return l},z3:function(){return h}});i(61432);var r=i(89636),s=i(38096),n=i(19886),o=i(45433),a=i(54914);const l=n.Z.fromJSON(a.I4),c=s.Z.fromJSON(a.ET),h=r.Z.fromJSON(a.lF),u=o.Z.fromJSON(a.qP);function p(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return l;case"polyline":return c;case"polygon":case"extent":return h}return null}n.Z.fromJSON(a.eG),s.Z.fromJSON(a.wW),r.Z.fromJSON(a.lj)},54914:function(e,t,i){i.d(t,{ET:function(){return o},I4:function(){return n},SQ:function(){return r},X1:function(){return s},eG:function(){return c},lF:function(){return a},lj:function(){return u},qP:function(){return l},wW:function(){return h}});const r=[252,146,31,255],s=[153,153,153,255],n={type:"esriSMS",style:"esriSMSCircle",size:6,color:r,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},o={type:"esriSLS",style:"esriSLSSolid",width:.75,color:r},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},c={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},h={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},u={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},17617:function(e,t,i){i.r(t),i.d(t,{default:function(){return d}});var r=i(73440),s=i(70880),n=i(15894),o=i(61100),a=i(17155),l=(i(61432),i(96711),i(83850),i(48023)),c=i(98185),h=i(43295);let u=class extends(n.Z.IdentifiableMixin(s.Z)){constructor(e){super(e),this.drapeSourcePriorityOffset=0,this.processor=null,this.slicePlaneEnabled=!1,this.layer=new p,this.suspended=!1}initialize(){this._set("processor",new c.D({owner:this,drapeSourcePriorityOffset:this.drapeSourcePriorityOffset}))}destroy(){this._set("processor",(0,o.SC)(this.processor))}get loadedGraphics(){return this.getGraphics()}get updating(){return!!this.processor?.updating}get symbolUpdateType(){return this.processor.graphicsCore.symbolUpdateType}getHit(e){return this.processor.getHit(e)}whenGraphicBounds(e,t){return this.processor.whenGraphicBounds(e,t)}graphicChanged(e){this.processor.graphicsCore.graphicUpdateHandler(e)}get updatePolicy(){return this.processor.graphicsCore.effectiveUpdatePolicy}async queryGraphics(){return this.loadedGraphics}highlight(e,t){return this.processor.highlight(e,t?.name??h.b)}maskOccludee(e){return this.processor.maskOccludee(e)}get test(){return{graphics3DProcessor:this.processor}}};(0,r._)([(0,a.Cb)({constructOnly:!0})],u.prototype,"view",void 0),(0,r._)([(0,a.Cb)({constructOnly:!0})],u.prototype,"getGraphics",void 0),(0,r._)([(0,a.Cb)()],u.prototype,"loadedGraphics",null),(0,r._)([(0,a.Cb)()],u.prototype,"drapeSourcePriorityOffset",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],u.prototype,"updating",null),(0,r._)([(0,a.Cb)()],u.prototype,"processor",void 0),(0,r._)([(0,a.Cb)({type:Boolean})],u.prototype,"slicePlaneEnabled",void 0),(0,r._)([(0,a.Cb)()],u.prototype,"layer",void 0),(0,r._)([(0,a.Cb)()],u.prototype,"suspended",void 0),u=(0,r._)([(0,l.j)("esri.views.3d.layers.GraphicsView3D")],u);class p extends n.Z{constructor(){super(),this.type="graphics-view-3d-dummy",this.id=this.uid}}const d=u},5473:function(e,t,i){i.d(t,{_:function(){return p}});var r=i(73440),s=i(70880),n=i(87833),o=i(90403),a=i(17155),l=(i(61432),i(96711),i(83850),i(48023)),c=i(70395),h=i(94125),u=i(50399);let p=class extends s.Z{constructor(e){super(e),this._dirtyExtents=new c.D,this._globalDirty=!1,this._averageExtentUpdateSize=0,this._dirtyGraphicsSet=new Set,this._updateElevation=!1,this.graphicsCoreOwner=null,this.graphicsCore=null,this.events=new n.Z}initialize(){const e=this.elevationProvider,t=this.graphicsCoreOwner.view.resourceController.scheduler;this._task=t.registerTask(d(this.graphicsCore.layer.elevationInfo?.mode),this),this.addHandles([e.on("elevation-change",(e=>this._elevationChanged(e))),(0,o.YP)((()=>this.graphicsCoreOwner.suspended),(()=>this._suspendedChange())),this._task,(0,o.YP)((()=>d(this.graphicsCore.layer.elevationInfo?.mode)),(e=>this._task.priority=e))])}destroy(){this._dirtyGraphicsSet.clear(),this.graphicsCoreOwner=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null,this.elevationProvider=null}clear(){this._dirtyGraphicsSet.clear(),this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this._globalDirty=!0,this.notifyChange("updating")}get updating(){return this.running}get running(){return this._dirtyGraphicsSet.size>0||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}get updatingRemaining(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}runTask(e){for(this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,e.madeProgress()),e.run((()=>this._dirtyExtents.merge(e)));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.notifyChange("updating")}_updateDirtyGraphics(e){const t=this.graphicsCoreOwner.view.renderCoordsHelper,i=this.graphicsCore.effectiveUpdatePolicy===h.j.ASYNC;for(const r of this._dirtyGraphicsSet.keys()){const s=this.graphicsCore.getGraphics3DGraphicById(r);if(this._dirtyGraphicsSet.delete(r),null!=s&&(s.alignWithElevation(this.elevationProvider,t,i),this.graphicsCore.deconflictor?.setDirty(),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this._dirtyExtents.empty&&!e.done;){const t=this._dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:t,spatialReference:i});const r=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,i,(e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);null!=t&&t.needsElevationUpdates()&&this._dirtyGraphicsSet.add(e)})),this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-r)+.9*this._averageExtentUpdateSize,e.madeProgress()}}_markAllGraphicsElevationDirty(){this._dirtyExtents.clear(),this._dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach(((e,t)=>this._dirtyGraphicsSet.add(t)))}_elevationChanged(e){if("scene"===e.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const t=e.extent;if(this.graphicsCoreOwner.suspended){if(!this._updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this._updateElevation=!0)}this.events.emit("invalidate-elevation",e)}else t[0]===-1/0?this._globalDirty=!0:this._dirtyExtents.add(t),this.notifyChange("updating")}};function d(e){return null==e?u.T8.ELEVATION_ALIGNMENT:"relative-to-scene"===e?u.T8.ELEVATION_ALIGNMENT_SCENE:u.T8.ELEVATION_ALIGNMENT}(0,r._)([(0,a.Cb)()],p.prototype,"graphicsCoreOwner",void 0),(0,r._)([(0,a.Cb)()],p.prototype,"graphicsCore",void 0),(0,r._)([(0,a.Cb)()],p.prototype,"queryGraphicUIDsInExtent",void 0),(0,r._)([(0,a.Cb)()],p.prototype,"elevationProvider",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],p.prototype,"updating",null),(0,r._)([(0,a.Cb)({readOnly:!0})],p.prototype,"updatingRemaining",null),p=(0,r._)([(0,l.j)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],p)},18234:function(e,t,i){i.d(t,{L:function(){return z}});var r=i(73440),s=i(70880),n=i(90403),o=i(17155),a=(i(61432),i(96711),i(83850),i(48023)),l=i(47925),c=i(79487),h=i(99574),u=i(31865),p=i(10934),d=i(24910),y=i(82846),g=i(74238),f=i(774),_=i(2051),b=i(16447),S=i(47566),m=i(33869),C=i(88970),v=i(77773),w=i(12659),x=i(56172),E=i(316);const G=.5*Math.PI,I=G/Math.PI*180;class O{constructor(e){this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:(0,y.Ue)(),direction:(0,y.Ue)()},this._renderCoordsHelper=e.renderCoordsHelper;for(let e=0;e<4;e++)this._extent[e]={origin:(0,y.Ue)(),direction:(0,y.Ue)(),cap:{next:null,direction:(0,y.Ue)()}},this._planes[e]=(0,v.Ue)();this._planes[m.Nu.NEAR]=(0,v.Ue)(),this._planes[m.Nu.FAR]=(0,v.Ue)(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,t,i,r=!0){const s=this._extent;this._toRenderBoundingExtent(e,t,i),(0,d.f)(this._center.origin,s[0].origin,s[2].origin),(0,d.g)(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),r||(0,d.g)(this._center.direction,this._center.direction,-1);for(let e=0;e<4;e++){const t=s[e];this._renderCoordsHelper.worldUpAtPosition(t.origin,t.direction);const i=s[3===e?0:e+1];t.cap.next=i.origin,(0,d.E)(t.cap.direction,t.origin,i.origin),(0,v.my)(t.direction,t.cap.direction,t.origin,this._planes[e]),r||(0,d.g)(t.direction,t.direction,-1)}(0,v.my)(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[m.Nu.NEAR]),r?(0,v.tk)(this._planes[m.Nu.NEAR],this._planes[m.Nu.FAR]):((0,v.JG)(this._planes[m.Nu.FAR],this._planes[m.Nu.NEAR]),(0,v.tk)(this._planes[m.Nu.NEAR],this._planes[m.Nu.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=t,this._minGlobalAltitude=.9*(0,l.Iu)(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,t,i=!1){if(null==e)return!1;if(this._renderCoordsHelper.viewingMode===x.JY.Global){const i=this._maxSpanSpatialReference.isGeographic?I:G*t;if(this._maxSpan>i)return!0;if(null!=e.altitude&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(0===this._maxSpan){const t=this._extent[0];return!(i||!e.intersectsRay((0,w.re)(t.origin,t.direction)))}for(let t=0;t<this._extent.length;t++){const r=this._extent[t];if(!i&&e.intersectsRay((0,w.re)(r.origin,r.direction)))return!0;if(e.intersectsLineSegment((0,C.zk)(r.origin,r.cap.next,k),r.cap.direction))return!0}const r=i?this._planes:this._planesWithoutFar;for(let t=0;t<e.lines.length;t++){const i=e.lines[t];if((0,E.kD)(r,i.origin,i.endpoint,i.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,t,i){(0,S.be)(e,j),j[2]=i,(0,g.B)(t,j,P,this._renderCoordsHelper.spatialReference),(0,u.U_)(D,P),(0,b.cS)(A);for(const{x0:r,x1:s,y0:n,y1:o}of V)for(let a=0;a<5;a++){const l=a/4;j[0]=(0,h.t7)(e[r],e[s],l),j[1]=(0,h.t7)(e[n],e[o],l),j[2]=i,(0,_.S)(j,t,j,this._renderCoordsHelper.spatialReference),(0,d.t)(j,j,D),(0,b.pp)(A,j)}(0,d.i)(this._extent[0].origin,A[0],A[1],A[2]),(0,d.i)(this._extent[1].origin,A[3],A[1],A[2]),(0,d.i)(this._extent[2].origin,A[3],A[4],A[2]),(0,d.i)(this._extent[3].origin,A[0],A[4],A[2]);for(let e=0;e<4;++e)(0,d.t)(this._extent[e].origin,this._extent[e].origin,P)}_toRenderBoundingExtentLocal(e,t,i){(0,f.d)(e,t,R,this._renderCoordsHelper.spatialReference),(0,d.i)(this._extent[0].origin,R[0],R[1],i),(0,d.i)(this._extent[1].origin,R[2],R[1],i),(0,d.i)(this._extent[2].origin,R[2],R[3],i),(0,d.i)(this._extent[3].origin,R[0],R[3],i)}_toRenderBoundingExtent(e,t,i){switch(this._renderCoordsHelper.viewingMode){case x.JY.Global:this._toRenderBoundingExtentGlobal(e,t,i);break;case x.JY.Local:this._toRenderBoundingExtentLocal(e,t,i);break;default:(0,c.Bg)(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(e){if((0,v.jH)(e.planes[m.Nu.NEAR],this._center.origin)<0&&(0,d.e)(this._center.direction,e.direction)<0)return!0;for(let t=0;t<4;t++){const i=this._extent[t];if((0,v.jH)(e.planes[m.Nu.NEAR],i.origin)<0&&(0,d.e)(i.direction,e.direction)<0)return!0}return!1}}const V=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],j=(0,y.Ue)(),P=(0,p.Ue)(),D=(0,p.Ue)(),A=(0,b.Ue)(),R=(0,S.Ue)(),k=(0,C.Ue)();var U=i(50399),T=i(78891);let z=class extends s.Z{constructor(e){super(e),this.suspended=!1,this._extent=null,this._extentIntersectionDirty=!0,this._isVisibleBelowSurfaceInternal=!1,this.graphicsCoreOwner=null,this.updating=!0}initialize(){const{graphicsCoreOwner:e}=this;this._extentIntersection=new O({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,i=t.basemapTerrain,r=t.resourceController.scheduler;this.addHandles([t.on("resize",(()=>this._viewChange())),(0,n.YP)((()=>t.state.camera),(()=>this._viewChange()),n.Z_),r.registerTask(U.T8.FRUSTUM_VISIBILITY,this),(0,n.YP)((()=>i.visibleElevationBounds),(()=>this._elevationBoundsChange()))]),"local"===t.viewingMode?this._isVisibleBelowSurface=!0:this.addHandles([(0,n.YP)((()=>[i.baseOpacity,i.wireframe,t.map?.ground?.navigationConstraint?.type]),(()=>this._updateIsVisibleBelowSurface()),n.nn)])}destroy(){this._set("graphicsCoreOwner",null),this._extent=null,this._extentIntersection=null}_setDirty(){this.updating||this._set("updating",!0)}setExtent(e){this._extent=e,this._extentIntersectionDirty=!0,this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty(),this._extentIntersectionDirty=!0}set _isVisibleBelowSurface(e){this._isVisibleBelowSurfaceInternal=e,this._setDirty(),this._extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){const e=this.graphicsCoreOwner.view,t=e.basemapTerrain,i="local"===e.viewingMode,r="none"===e.map.ground?.navigationConstraint?.type;this._isVisibleBelowSurface=i||!t.opaque||r}_updateExtentIntersection(){if(!this._extentIntersectionDirty)return;this._extentIntersectionDirty=!1;const e=this.graphicsCoreOwner.view;let t;if(this._isVisibleBelowSurfaceInternal)t=-.3*(0,l.Iu)(e.spatialReference).radius;else{const{min:i,max:r}=e.basemapTerrain.visibleElevationBounds;t=i-Math.max(1,(r-i)*(1.2-1))}this._extentIntersection.update(this._extent,e.spatialReference,t)}get running(){return this.updating}runTask(e){if(this._set("updating",!1),!this._extent)return this._set("suspended",!1),T.J;this._updateExtentIntersection();const t=this.graphicsCoreOwner.view.frustum,i=(0,l.Iu)(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(t,i)),e.madeProgress()}};(0,r._)([(0,o.Cb)({readOnly:!0})],z.prototype,"suspended",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0})],z.prototype,"graphicsCoreOwner",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],z.prototype,"updating",void 0),z=(0,r._)([(0,a.j)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],z)},62564:function(e,t,i){i.d(t,{d:function(){return g}});var r=i(50702),s=(i(61432),i(32420));class n{}class o extends n{constructor(e,t){super(),this.objectStateId=e,this.object=t}remove(){this.object.removeStateID(this.objectStateId)}}class a extends n{constructor(e,t,i){super(),this.objectStateId=e,this.object=t,this.owner=i}remove(){this.owner.removeRenderGeometryObjectState(this.object,this.objectStateId)}}class l extends n{constructor(e,t){super(),this.objectStateId=e,this._removeCallback=t,this.object=null}remove(){this._removeCallback(this.objectStateId)}}class c{constructor(){this._items=[]}addObject(e,t){this._items.push(new o(t,e))}addRenderGeometry(e,t,i){this._items.push(new a(t,e,i))}addExternal(e,t){this._items.push(new l(t,e))}remove(e){this._remove((t=>t.objectStateId===e))}removeByObject(e){this._remove((t=>t.object===e))}removeAll(){this._items.forEach((e=>e.remove())),this._items=[]}_remove(e){const{_items:t}=this;for(let i=t.length-1;i>=0;--i){const r=t[i];e(r)&&(r.remove(),t.splice(i,1))}}}class h extends c{constructor(){super(...arguments),this.stateType=s.V_.MaskOccludee}}class u extends c{constructor(e){super(),this.highlightName=e,this.stateType=s.V_.Highlight}}class p{constructor(e){this.objectIdField=e,this.ids=new Set,this.paused=!1}hasGraphic(e){const t=this.objectIdField?e.graphic.attributes[this.objectIdField]:e.graphic.uid;return this.ids.has(t)}}class d extends p{constructor(e){super(e),this.stateType=s.V_.MaskOccludee,this.objectStateSet=new h}}class y extends p{constructor(e,t){super(t),this.highlightName=e,this.stateType=s.V_.Highlight,this.objectStateSet=new u(e)}}class g{constructor(e){this._graphicsCore=e,this._stateSets=new Array}destroy(){this.reset(),this._stateSets=null}reset(){this._stateSets&&(this._stateSets.forEach((e=>e.objectStateSet.removeAll())),this._stateSets.length=0)}acquireOccludeeSet(e){const t=new d(e);this._stateSets.push(t);const i=(0,r.kB)((()=>this.releaseSet(t)));return{set:t,handle:i}}acquireHighlightSet(e,t){const i=new y(e,t);this._stateSets.push(i);const s=(0,r.kB)((()=>this.releaseSet(i)));return{set:i,handle:s}}releaseSet(e){e.objectStateSet.removeAll();const t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}setUid(e,t){e.ids.add(t);const i=this._graphicsCore.graphics3DGraphics.get(t);i&&i.addObjectStateSet(e.objectStateSet)}setUids(e,t){t.forEach((t=>this.setUid(e,t)))}setObjectIds(e,t){t.forEach((t=>e.ids.add(t))),this._initializeSet(e)}addGraphic(e){this._stateSets.forEach((t=>{!t.paused&&t.hasGraphic(e)&&e.addObjectStateSet(t.objectStateSet)}))}removeGraphic(e){this._stateSets.forEach((t=>{t.hasGraphic(e)&&e.removeObjectState(t.objectStateSet)}))}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach((e=>e.objectStateSet.removeAll()))}_initializeSet(e){const t=this._graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach((t=>{t&&e.hasGraphic(t)&&t.addObjectStateSet(e.objectStateSet)})):e.ids.forEach((i=>{const r=t.get(i);r&&r.addObjectStateSet(e.objectStateSet)}))}get test(){}}},98185:function(e,t,i){i.d(t,{D:function(){return V}});var r=i(73440),s=i(46451),n=i(70880),o=i(50702),a=i(61100),l=i(93568),c=i(90403),h=i(17155),u=(i(61432),i(96711),i(83850),i(48023)),p=i(58426),d=i(60147),y=i(38209),g=i(74774),f=i(56216),_=i(29191),b=i(94808),S=i(47451),m=i(28994),C=i(5473),v=i(18234),w=i(62564),x=i(66290),E=i(36027),G=i(78637),I=i(94125),O=i(27546);let V=class extends n.Z{constructor(e){super(e),this.drapeSourcePriorityOffset=0,this.type="graphics-3d",this.graphicsCore=null,this.drapeSourceType=b.Lw.Features,this.scaleVisibilityEnabled=!1,this.frustumVisibilityEnabled=!1,this._suspendResumeExtent=null,this._updatingHandles=new d.R}initialize(){const{layer:e}=this,t="effectiveScaleRange"in e?e:null,i=!(0,O.Dc)()&&this.scaleVisibilityEnabled&&null!=t,r=new m.w({owner:this,layer:this.owner.layer,preferredUpdatePolicy:I.j.SYNC,graphicSymbolSupported:!0,componentFactories:{elevationAlignment:(e,t)=>new C._({graphicsCoreOwner:this,graphicsCore:e,queryGraphicUIDsInExtent:t,elevationProvider:this.view.elevationProvider}),scaleVisibility:i?(e,i)=>new x.c({graphicsCoreOwner:this,layer:t,queryGraphicUIDsInExtent:i,graphicsCore:e,basemapTerrain:this.owner.view.basemapTerrain}):null,objectStates:e=>new w.d(e)}});if(this._set("graphicsCore",r),this.frustumVisibilityEnabled&&this._set("frustumVisibility",new v.L({graphicsCoreOwner:this})),"fullOpacity"in this.owner){const e=this.owner;this._updatingHandles.add((()=>e.fullOpacity),(()=>this.graphicsCore.opacityChange()))}if("elevationInfo"in e){const t=e;this._updatingHandles.add((()=>t.elevationInfo),((e,t)=>{(0,p.Hg)(e,t)&&this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())}))}this._set("initializePromise",this._initializeAsync()),this._updatingHandles.addPromise(this.initializePromise)}async _initializeAsync(){try{await this.graphicsCore.initializePromise}catch(e){if((0,l.D_)(e))return;throw e}this.destroyed||(this.addHandles((0,c.YP)((()=>this.view.clippingArea),(()=>this._updateClippingExtent()),c.Z_)),this._updateClippingExtent(),this._setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this._updatingHandles.destroy(),this._set("frustumVisibility",(0,a.SC)(this.frustumVisibility)),this._set("graphicsCore",(0,a.SC)(this.graphicsCore))}get layer(){return this.owner.layer}get layerViewUid(){return this.owner.uid}get view(){return this.owner.view}get scaleVisibility(){return this.graphicsCore?.scaleVisibility}get elevationAlignment(){return this.graphicsCore?.elevationAlignment}get scaleVisibilitySuspended(){return!(null==this.scaleVisibility||!this.scaleVisibility.suspended)}get frustumVisibilitySuspended(){return null!=this.frustumVisibility&&this.frustumVisibility.suspended}get suspended(){return this.owner.suspended??!1}get updating(){return!!(this.graphicsCore?.updating||null!=this.scaleVisibility&&this.scaleVisibility.updating||null!=this.frustumVisibility&&this.frustumVisibility.updating||this._updatingHandles.updating)}get graphics3DGraphics(){return this.graphicsCore?.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphicsCore?.graphics3DGraphicsByObjectID}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner.fullOpacity??1}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}notifyGraphicGeometryChanged(e){this.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphicsCore.notifyGraphicVisibilityChanged(e)}notifyContentGeometryUpdate(){this.owner.notifyContentGeometryUpdate?.()}getRenderingInfo(e,t,i){const r=(0,f.Kb)(e,{renderer:t,arcade:i});if(r?.color){const e=r.color;e[0]=e[0]/255,e[1]=e[1]/255,e[2]=e[2]/255}return r}getRenderingInfoAsync(e,t,i,r){return(0,f.xn)(e,{renderer:t,arcade:i,...r})}getHit(e){if(this.owner.loadedGraphics){const t=this.owner.loadedGraphics.find((t=>t.uid===e));if(t){const e=this.layer instanceof y.Z?this.layer:null,i=(0,g.mW)(t,e);return{type:"graphic",graphic:i,layer:i.layer}}}return null}whenGraphicBounds(e,t){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(e,t):Promise.reject()}computeAttachmentOrigin(e,t){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(e,t):null}getSymbolLayerSize(e,t){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(e,t):null}maskOccludee(e){const t=this.graphicsCore?.objectStates;if(!t)return(0,o.kB)();const{set:i,handle:r}=t.acquireOccludeeSet(null);return t.setUid(i,e.uid),r}highlight(e,t){const i=this.graphicsCore?.objectStates;if(!i)return j;if(e instanceof _.Z)return j;const r=(0,G.OL)(e);if(0===r.length)return j;if(r[0]instanceof s.Z){const e=r.map((e=>e.uid)),{set:s,handle:n}=i.acquireHighlightSet(t,null);return i.setUids(s,e),n}if("number"==typeof r[0]){const e=r,{set:s,handle:n}=i.acquireHighlightSet(t,null);return i.setObjectIds(s,e),n}return j}_setupSuspendResumeExtent(){const{scaleVisibility:e,frustumVisibility:t}=this;if(null==e&&null==t)return;const i=({computedExtent:i,extentPadding:r})=>{this._suspendResumeExtent=(0,E.Go)(i,this._suspendResumeExtent,S.PY,r),null!=e&&e.setExtent(this._suspendResumeExtent),null!=t&&t.setExtent(this._suspendResumeExtent)};this.addHandles((0,c.YP)((()=>({computedExtent:this.graphicsCore?.computedExtent,extentPadding:this.graphicsCore?.extentPadding})),(e=>i(e)),c.tX))}_updateClippingExtent(){const e=this.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}};(0,r._)([(0,h.Cb)()],V.prototype,"drapeSourcePriorityOffset",void 0),(0,r._)([(0,h.Cb)()],V.prototype,"type",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],V.prototype,"owner",void 0),(0,r._)([(0,h.Cb)()],V.prototype,"layer",null),(0,r._)([(0,h.Cb)()],V.prototype,"layerViewUid",null),(0,r._)([(0,h.Cb)()],V.prototype,"view",null),(0,r._)([(0,h.Cb)({constructOnly:!0})],V.prototype,"graphicsCore",void 0),(0,r._)([(0,h.Cb)()],V.prototype,"scaleVisibility",null),(0,r._)([(0,h.Cb)({constructOnly:!0})],V.prototype,"frustumVisibility",void 0),(0,r._)([(0,h.Cb)()],V.prototype,"elevationAlignment",null),(0,r._)([(0,h.Cb)()],V.prototype,"scaleVisibilitySuspended",null),(0,r._)([(0,h.Cb)({readOnly:!0})],V.prototype,"frustumVisibilitySuspended",null),(0,r._)([(0,h.Cb)()],V.prototype,"suspended",null),(0,r._)([(0,h.Cb)({readOnly:!0})],V.prototype,"updating",null),(0,r._)([(0,h.Cb)()],V.prototype,"loadedGraphics",null),(0,r._)([(0,h.Cb)()],V.prototype,"fullOpacity",null),(0,r._)([(0,h.Cb)()],V.prototype,"slicePlaneEnabled",null),(0,r._)([(0,h.Cb)()],V.prototype,"drapeSourceType",void 0),(0,r._)([(0,h.Cb)()],V.prototype,"updatePolicy",null),(0,r._)([(0,h.Cb)({constructOnly:!0})],V.prototype,"scaleVisibilityEnabled",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],V.prototype,"frustumVisibilityEnabled",void 0),(0,r._)([(0,h.Cb)()],V.prototype,"initializePromise",void 0),V=(0,r._)([(0,u.j)("esri.views.3d.layers.graphics.GraphicsProcessor")],V);const j=(0,o.kB)()},85754:function(e,t,i){i.d(t,{V5:function(){return n},e7:function(){return s},zc:function(){return o}});var r=i(76554);async function s(e,t=e.popupTemplate){if(null==t)return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:s}=t,{objectIdField:n,typeIdField:o,globalIdField:a,relationships:l}=e;if(i.includes("*"))return["*"];const c=s?(0,r.CH)(e):[],h=(0,r.Q0)(e.fieldsIndex,[...i,...c]);return o&&h.push(o),h&&n&&e.fieldsIndex?.has(n)&&!h.includes(n)&&h.push(n),h&&a&&e.fieldsIndex?.has(a)&&!h.includes(a)&&h.push(a),l&&l.forEach((t=>{const{keyField:i}=t;h&&i&&e.fieldsIndex?.has(i)&&!h.includes(i)&&h.push(i)})),h}function n(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function o(e,t){return null!=n(e,{defaultPopupTemplateEnabled:t})}}}]);