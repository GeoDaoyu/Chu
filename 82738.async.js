"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[82738,17623,50820,66882],{50820:function(e,t,i){i.r(t),i.d(t,{CIMSymbolRasterizer:function(){return p}});var r=i(90756),s=i(88890),a=i(35236);class n{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let r=this._inFlightResourceMap.get(e);return r?r.then((e=>({width:e.width,height:e.height}))):(r=(0,a.n$)(e,t),this._inFlightResourceMap.set(e,r),r.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,s.mx)(e)}}var o=i(32566),l=i(80746),c=i(17623),h=i(84210),u=i(61421);class p{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new n}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,s,a,n,o,p,y,f){if(!e)return null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:g}=d;n||(n=(0,u.JW)(g));const v=await c.OverrideHelper.resolveSymbolOverrides(d,t,this._spatialReference,a,n,o,p),w=this._cimResourceManager,M=[];l.B$.fetchResources(v,w,M),l.B$.fetchFonts(v,w,M),M.length>0&&await Promise.all(M);const{width:b,height:x}=i;let C=m(n,b,x,s,f);const I=l.B$.getEnvelope(v,C,w);if(!I)return null;I.x===1/0&&(I.x=b+2),I.y===1/0&&(I.y=-x/2),I.width===-1/0&&(I.width=b),I.height===-1/0&&(I.height=x);let S=1,O=0,P=0;switch(g.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;I.width>b&&(e=b/I.width);let t=1;I.height>x&&(t=x/I.height),"preview"===s&&(I.width<b&&(e=b/I.width),I.height<x&&(t=x/I.height)),S=Math.min(e,t),O=I.x+I.width/2,P=I.y+I.height/2}break;case"CIMLineSymbol":if(f){P=I.y+I.height/2,O=I.x+I.width/2;const e=I.width-b,t=I.height-x;C={paths:(0,h.bA)(C.paths,{xmin:-1*I.width/2+e,xmax:I.width/2-e,ymin:-1*I.height/2+t,ymax:I.height/2-t,width:I.width-2*e,height:I.height-2*t})}}else{(y||I.height>x)&&(S=x/I.height),P=I.y+I.height/2;const e=I.x*S+b/2,t=(I.x+I.width)*S+b/2,i=(0,r.l9)(C)?C.paths:(0,r.oU)(C)?C.rings:null;if(null===i)throw new Error("Bad geometry, can't rasterise symbol!");i[0][0][0]-=e/S,i[0][2][0]-=(t-b)/S}break;case"CIMPolygonSymbol":if(f){P=I.y+I.height/2,O=I.x+I.width/2;const e=I.width-b,t=I.height-x;C={paths:(0,h.bA)(C.rings,{xmin:-1*I.width/2+e,xmax:I.width/2-e,ymin:-1*I.height/2+t,ymax:I.height/2-t,width:I.width-2*e,height:I.height-2*t})}}else{O=I.x+I.width/2,P=I.y+I.height/2;const e=I.x*S+b/2,t=(I.x+I.width)*S+b/2,i=I.y*S+x/2,r=(I.y+I.height)*S+x/2,{rings:s}=C;e<0&&(s[0][0][0]-=e,s[0][3][0]-=e,s[0][4][0]-=e),i<0&&(s[0][0][1]+=i,s[0][1][1]+=i,s[0][4][1]+=i),t>b&&(s[0][1][0]-=t-b,s[0][2][0]-=t-b),r>x&&(s[0][2][1]+=r-x,s[0][3][1]+=r-x)}}const k={type:"cim",data:{type:"CIMSymbolReference",symbol:v}};return this.rasterize(k,b,x,O,P,S,n,1,C)}rasterize(e,t,i,r,s,a,n,l=0,c=null,h=window.devicePixelRatio||1){const{data:p}=e;if(!p||"CIMSymbolReference"!==p.type||!p.symbol)return null;const{symbol:y}=p,f=this._canvas,d=1.3333333333333333*h;f.width=t*d,f.height=i*d,n||(n=(0,u.JW)(y)),c||(c=m(n,t,i,"legend")),f.width+=2*l,f.height+=2*l;const g=f.getContext("2d",{willReadFrequently:!0}),v=o.zA.createIdentity();return v.translate(-r,-s),v.scale(a*d,-a*d),v.translate(t*d/2+l,i*d/2+l),g.clearRect(0,0,f.width,f.height),new o.cD(g,this._cimResourceManager,v,!0).drawSymbol(y,c),g.getImageData(0,0,f.width,f.height)}}function m(e,t,i,r,s){const a=-t/2+1,n=t/2-1,o=i/2-1,l=-i/2+1;if(s&&("esriGeometryPolygon"===e||"esriGeometryPolyline"===e)){const r=function(e,t,i,r){return"esriGeometryPolygon"===t?{rings:(0,h.Iu)((0,h.bA)(e.rings,{xmin:0,ymin:0,width:i,height:r}),-1*i/2,-1*r/2)}:"esriGeometryPolyline"===t?{paths:(0,h.Iu)((0,h.bA)(e.paths,{xmin:0,ymin:0,width:i,height:r}),-1*i/2,-1*r/2)}:null}(s,e,t,i);if(r)return r}switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[a,0],[0,0],[n,0]]]};default:return"legend"===r?{rings:[[[a,o],[n,0],[n,l],[a,l],[a,o]]]}:{rings:[[[a,o],[n,o],[n,l],[a,l],[a,o]]]}}}},17623:function(e,t,i){i.d(t,{OverrideHelper:function(){return u}});var r=i(53147),s=i(92643),a=i(28947),n=i(299),o=i(15065),l=i(61421),c=i(66882);const h=e=>{if(!e)return[0,0,0,0];const{r:t,g:i,b:r,a:s}=e;return[t,i,r,255*s]};class u{static findApplicableOverrides(e,t,i){if(e&&t){if(e.primitiveName){let r=!1;for(const t of i)if(t.primitiveName===e.primitiveName){r=!0;break}if(!r)for(const r of t)r.primitiveName===e.primitiveName&&i.push(r)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const r of e.effects)u.findApplicableOverrides(r,t,i);if(e.symbolLayers)for(const r of e.symbolLayers)u.findApplicableOverrides(r,t,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const r of e.effects)u.findApplicableOverrides(r,t,i);if(e.markerPlacement&&u.findApplicableOverrides(e.markerPlacement,t,i),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const r of e.markerGraphics)u.findApplicableOverrides(r,t,i),u.findApplicableOverrides(r.symbol,t,i)}else"CIMCharacterMarker"===e.type?u.findApplicableOverrides(e.symbol,t,i):"CIMHatchFill"===e.type?u.findApplicableOverrides(e.lineSymbol,t,i):"CIMPictureMarker"===e.type&&u.findApplicableOverrides(e.animatedSymbolProperties,t,i)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&(0,l.hU)(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const i=(0,l.Ml)(e),r=e.primitiveName,s=[];for(const e of t)e.primitiveName===r&&s.push((0,l.Ml)(e));return{type:"cim-effect-param",effect:i,overrides:(0,l.Ul)(s)}}static async resolveSymbolOverrides(e,t,i,r,s,o,c){if(!e?.symbol)return null;let{symbol:h,primitiveOverrides:p}=e;const m=!!p;if(!m&&!r)return h;h=(0,a.d9)(h),p=(0,a.d9)(p);let y=!0;if(t||(t={attributes:{}},y=!1),m){if(y||(p=p.filter((e=>!e.valueExpressionInfo?.expression.includes("$feature")))),c||(p=p.filter((e=>!e.valueExpressionInfo?.expression.includes("$view")))),p.length>0){const e=(0,l.Qf)(t.attributes),r={spatialReference:i,fields:e,geometryType:s};await u.createRenderExpressions(p,r),u.evaluateOverrides(p,t,s??"esriGeometryPoint",o,c,new n.Z(e))}u.applyOverrides(h,p)}return r&&u.applyDictionaryTextOverrides(h,t,r,null),h}static{this._expressionToRenderExpression=new Map}static async createRenderExpressions(e,t){const i=[];for(const r of e){const e=r.valueExpressionInfo;if(!e||u._expressionToRenderExpression.has(e.expression))continue;const s=(0,o.Yi)(e.expression,t.spatialReference);i.push(s),s.then((t=>u._expressionToRenderExpression.set(e.expression,t)))}i.length>0&&await Promise.all(i)}static evaluateOverrides(e,t,i,r,a,n){const o={$view:{scale:a?.scale}};for(const a of e){a.value&&"object"==typeof a.value&&(0,s.jQ)(a.value)&&("Color"===a.propertyName||"StrokeColor"===a.propertyName)&&(a.value=h(a.value));const e=a.valueExpressionInfo;if(!e)continue;const l=u._expressionToRenderExpression.get(e.expression);l&&(a.value=(0,c.default)(l,t,o,i,n,r))}}static applyDictionaryTextOverrides(e,t,i,r,s="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const a=e.symbolLayers;if(!a)return;for(const n of a)n&&"CIMVectorMarker"===n.type&&u.applyDictionaryTextOverrides(n,t,i,r,"CIMTextSymbol"===e.type?e.textCase:s)}break;case"CIMVectorMarker":{const s=e.markerGraphics;if(!s)return;for(const e of s)e&&u.applyDictionaryTextOverrides(e,t,i,r)}break;case"CIMMarkerGraphic":{const a=e.textString;if(a&&a.includes("[")){const n=(0,l.H1)(a,i);e.textString=(0,l.E_)(t,n,r,s)}}}}static applyOverrides(e,t,i,r){if(e.primitiveName)for(const s of t)if(s.primitiveName===e.primitiveName){const t=(0,l.Le)(s.propertyName);if(r&&r.push({cim:e,nocapPropertyName:t,value:e[t]}),i){let t=!1;for(const r of i)r.primitiveName===e.primitiveName&&(t=!0);t||i.push(s)}null!=s.value&&(e[t]=s.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)u.applyOverrides(s,t,i,r);if(e.symbolLayers)for(const s of e.symbolLayers)u.applyOverrides(s,t,i,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const s of e.effects)u.applyOverrides(s,t,i,r);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const s of e.markerGraphics)u.applyOverrides(s,t,i,r),u.applyOverrides(s.symbol,t,i,r)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const i of e)void 0!==i.value&&(t+=`${i.primitiveName}${i.propertyName}${JSON.stringify(i.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new r.Z(t).toRgba();return e[3]*=255,e}return t}}},82738:function(e,t,i){i.d(t,{S:function(){return f},previewCIMSymbol:function(){return d}});var r=i(96094),s=i(80746),a=i(50820),n=i(17623),o=i(61421),l=i(77423),c=i(47967);const h=new a.CIMSymbolRasterizer(null),u=(0,r.Wz)(l.b_.size),p=(0,r.Wz)(l.b_.maxSize),m=(0,r.Wz)(l.b_.lineWidth);async function y(e,t,i){const r=t?.size;let s=null!=r&&"object"==typeof r&&"width"in r?r.width:r,a=null!=r&&"object"==typeof r&&"height"in r?r.height:r;if(!s||!a)if("esriGeometryPolygon"===i)s=a=t.maxSize?Math.min(t.maxSize,u):u;else{const r=await f(e,t,i);r&&(s=r.width,a=r.height),"esriGeometryPolyline"===i&&(s=t.maxSize?Math.min(t.maxSize,m):m),s=null!=s&&isFinite(s)?Math.min(s,p):u,a=null!=a&&isFinite(a)?Math.max(Math.min(a,p),1):u}return"legend"===t.style&&"esriGeometryPolyline"===i&&(s=m),{width:s,height:a}}async function f(e,t={},i){const r=t.cimOptions||t;i??=r.geometryType||(0,o.JW)(e?.data?.symbol);const{feature:a,fieldMap:l,viewParams:c}=r,u=await n.OverrideHelper.resolveSymbolOverrides(e.data,a,null,l,i,null,c);if(!u)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:u},e.data.primitiveOverrides=void 0;const p=[];return s.B$.fetchResources(u,h.resourceManager,p),s.B$.fetchFonts(u,h.resourceManager,p),p.length>0&&await Promise.all(p),s.B$.getEnvelope(u,null,h.resourceManager)}async function d(e,t={}){const{node:i,opacity:s,symbolConfig:a}=t,n=null!=a&&"object"==typeof a&&"isSquareFill"in a&&a.isSquareFill,l=t.cimOptions||t,u=l.geometryType||(0,o.JW)(e?.data?.symbol),p=await y(e,t,u),{feature:m,fieldMap:f}=l,d=t?.geometry||n||"esriGeometryPolygon"!==u?"preview":"legend";let g=p;const v=p;if(t?.geometry&&("esriGeometryPolygon"===u||"esriGeometryPolyline"===u)){const e=200;if((0,r.F2)(p.width)<e||(0,r.F2)(p.height)<e){const t=p.width>p.height?(0,r.Wz)(e)*p.height/p.width:(0,r.Wz)(e);g={width:p.width>p.height?(0,r.Wz)(e):(0,r.Wz)(e)*p.width/p.height,height:t}}}const w=await h.rasterizeCIMSymbolAsync(e,m,g,d,f,u,null,l.viewParams,l.allowScalingUp,t?.geometry?.toJSON());if(!w)return null;const{width:M,height:b}=w,x=document.createElement("canvas");x.width=M,x.height=b,x.getContext("2d").putImageData(w,0,0);const C=(0,r.F2)(v.width),I=(0,r.F2)(v.height),S=new Image(C,I);S.src=x.toDataURL(),S.ariaLabel=t.ariaLabel??null,S.alt=t.ariaLabel??"",null!=s&&(S.style.opacity=`${s}`);let O=S;if(null!=t.effectView){const e={shape:{type:"image",x:0,y:0,width:C,height:I,src:S.src},fill:null,stroke:null,offset:[0,0]};O=(0,c.wh)([[e]],[C,I],t)}return i&&O&&i.appendChild(O),O}},66882:function(e,t,i){i.d(t,{default:function(){return n}});var r=i(88194),s=i(96711),a=i(96610);function n(e,t,i,r,a,n){if(null==e)return null;const o=e.references("geometry")&&n?l(t,r,n):t,c=e.repurposeFeature(o,a);try{return e.evaluate(c,i)}catch(e){return s.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}const o=new Map;function l(e,t,i){const{transform:n,hasZ:l,hasM:c}=i;o.has(t)||o.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,i,r,s)=>(0,a.U1)(i,t,e,r,s);case"esriGeometryPolygon":return(e,i,r,s)=>(0,a.Ie)(i,t,e,r,s);case"esriGeometryPolyline":return(e,i,r,s)=>(0,a.G6)(i,t,e,r,s);case"esriGeometryMultipoint":return(e,i,r,s)=>(0,a.J9)(i,t,e,r,s);default:return s.Z.getLogger("esri.views.2d.support.arcadeOnDemand").error(new r.Z("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const h=o.get(t)(e.geometry,n,l,c);return{...e,geometry:h}}}}]);