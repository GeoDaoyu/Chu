"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[43141],{29328:function(e,t,r){r.d(t,{F:function(){return d},M:function(){return n}});const n={Base64:0,Hex:1,String:2,Raw:3};function i(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function o(e){const t=[];for(let r=0,n=8*e.length;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function s(e){const t=[];for(let r=0,n=32*e.length;r<n;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}function a(e,t,r,n,o,s){return i(function(e,t){return e<<t|e>>>32-t}(i(i(t,e),i(n,s)),o),r)}function l(e,t,r,n,i,o,s){return a(t&r|~t&n,e,t,i,o,s)}function u(e,t,r,n,i,o,s){return a(t&n|r&~n,e,t,i,o,s)}function c(e,t,r,n,i,o,s){return a(t^r^n,e,t,i,o,s)}function f(e,t,r,n,i,o,s){return a(r^(t|~n),e,t,i,o,s)}function p(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let r=1732584193,n=-271733879,o=-1732584194,s=271733878;for(let t=0;t<e.length;t+=16){const a=r,p=n,d=o,h=s;r=l(r,n,o,s,e[t],7,-680876936),s=l(s,r,n,o,e[t+1],12,-389564586),o=l(o,s,r,n,e[t+2],17,606105819),n=l(n,o,s,r,e[t+3],22,-1044525330),r=l(r,n,o,s,e[t+4],7,-176418897),s=l(s,r,n,o,e[t+5],12,1200080426),o=l(o,s,r,n,e[t+6],17,-1473231341),n=l(n,o,s,r,e[t+7],22,-45705983),r=l(r,n,o,s,e[t+8],7,1770035416),s=l(s,r,n,o,e[t+9],12,-1958414417),o=l(o,s,r,n,e[t+10],17,-42063),n=l(n,o,s,r,e[t+11],22,-1990404162),r=l(r,n,o,s,e[t+12],7,1804603682),s=l(s,r,n,o,e[t+13],12,-40341101),o=l(o,s,r,n,e[t+14],17,-1502002290),n=l(n,o,s,r,e[t+15],22,1236535329),r=u(r,n,o,s,e[t+1],5,-165796510),s=u(s,r,n,o,e[t+6],9,-1069501632),o=u(o,s,r,n,e[t+11],14,643717713),n=u(n,o,s,r,e[t],20,-373897302),r=u(r,n,o,s,e[t+5],5,-701558691),s=u(s,r,n,o,e[t+10],9,38016083),o=u(o,s,r,n,e[t+15],14,-660478335),n=u(n,o,s,r,e[t+4],20,-405537848),r=u(r,n,o,s,e[t+9],5,568446438),s=u(s,r,n,o,e[t+14],9,-1019803690),o=u(o,s,r,n,e[t+3],14,-187363961),n=u(n,o,s,r,e[t+8],20,1163531501),r=u(r,n,o,s,e[t+13],5,-1444681467),s=u(s,r,n,o,e[t+2],9,-51403784),o=u(o,s,r,n,e[t+7],14,1735328473),n=u(n,o,s,r,e[t+12],20,-1926607734),r=c(r,n,o,s,e[t+5],4,-378558),s=c(s,r,n,o,e[t+8],11,-2022574463),o=c(o,s,r,n,e[t+11],16,1839030562),n=c(n,o,s,r,e[t+14],23,-35309556),r=c(r,n,o,s,e[t+1],4,-1530992060),s=c(s,r,n,o,e[t+4],11,1272893353),o=c(o,s,r,n,e[t+7],16,-155497632),n=c(n,o,s,r,e[t+10],23,-1094730640),r=c(r,n,o,s,e[t+13],4,681279174),s=c(s,r,n,o,e[t],11,-358537222),o=c(o,s,r,n,e[t+3],16,-722521979),n=c(n,o,s,r,e[t+6],23,76029189),r=c(r,n,o,s,e[t+9],4,-640364487),s=c(s,r,n,o,e[t+12],11,-421815835),o=c(o,s,r,n,e[t+15],16,530742520),n=c(n,o,s,r,e[t+2],23,-995338651),r=f(r,n,o,s,e[t],6,-198630844),s=f(s,r,n,o,e[t+7],10,1126891415),o=f(o,s,r,n,e[t+14],15,-1416354905),n=f(n,o,s,r,e[t+5],21,-57434055),r=f(r,n,o,s,e[t+12],6,1700485571),s=f(s,r,n,o,e[t+3],10,-1894986606),o=f(o,s,r,n,e[t+10],15,-1051523),n=f(n,o,s,r,e[t+1],21,-2054922799),r=f(r,n,o,s,e[t+8],6,1873313359),s=f(s,r,n,o,e[t+15],10,-30611744),o=f(o,s,r,n,e[t+6],15,-1560198380),n=f(n,o,s,r,e[t+13],21,1309151649),r=f(r,n,o,s,e[t+4],6,-145523070),s=f(s,r,n,o,e[t+11],10,-1120210379),o=f(o,s,r,n,e[t+2],15,718787259),n=f(n,o,s,r,e[t+9],21,-343485551),r=i(r,a),n=i(n,p),o=i(o,d),s=i(s,h)}return[r,n,o,s]}function d(e,t=n.Hex){const r=t||n.Base64,i=p(o(e),8*e.length);switch(r){case n.Raw:return i;case n.Hex:return function(e){const t="0123456789abcdef",r=[];for(let n=0,i=4*e.length;n<i;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}(i);case n.String:return s(i);case n.Base64:return function(e){const t=[];for(let r=0,n=4*e.length;r<n;r+=3){const n=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255;for(let i=0;i<4;i++)8*r+6*i>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>6*(3-i)&63))}return t.join("")}(i)}}},75432:function(e,t,r){r.d(t,{B:function(){return d}});var n=r(88194),i=r(29328),o=r(9713),s=r(95490),a=r(18764),l=r(15853),u=r(66951),c=r(17155),f=r(84753),p=r(28938);function d(e){const t=e?.origins??[void 0];return(r,n)=>{const i=function(e,t,r){if("resource"===e?.type)return function(e,t,r){const n=(0,l.Oe)(t,r);return{type:String,read:(e,t,r)=>{const i=(0,p.r)(e,t,r);return n.type===String?i:"function"==typeof n.type?new n.type({url:i}):void 0},write:{isRequired:n.json?.write?.isRequired,writer(t,i,a,l){if(!l?.resources)return"string"==typeof t?void(i[a]=(0,p.t)(t,l)):void(i[a]=t.write({},l));const c=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),d=(0,p.t)(c,{...l,verifyItemRelativeUrls:l?.verifyItemRelativeUrls?{writtenUrls:l.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},p.M.NO),g=n.type!==String&&(!(0,o.l)(this)||l?.origin&&this.originIdOf(r)>(0,u.M9)(l.origin)),v={object:this,propertyName:r,value:t,targetUrl:d,dest:i,targetPropertyName:a,context:l,params:e};l?.portalItem&&d&&!(0,s.YP)(d)?g&&e?.contentAddressed?h(v):g?function(e){const{context:t,targetUrl:r,params:n,value:i,dest:o,targetPropertyName:a}=e;if(!t.portalItem)return;const l=t.portalItem.resourceFromPath(r),u=y(i,r,t),c=(0,f.B)(u),p=(0,s.Ml)(l.path),d=n?.compress??!1;c===p?(t.resources&&m({...e,resource:l,content:u,compress:d,updates:t.resources.toUpdate}),o[a]=r):h(e)}(v):function({context:e,targetUrl:t,dest:r,targetPropertyName:n}){e.portalItem&&e.resources&&(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(t),compress:!1}),r[n]=t)}(v):l?.portalItem&&(null==d||null!=(0,p.i)(d)||(0,s.jc)(d)||g)?h(v):i[a]=d}}}}(e,t,r);switch(e?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=p.b;return{read:e,write:t}}}}(e,r,n);for(const e of t){const t=(0,c.CJ)(r,e,n);for(const e in i)t[e]=i[e]}}}function h(e){const{targetUrl:t,params:r,value:o,context:l,dest:u,targetPropertyName:c}=e;if(!l.portalItem)return;const d=(0,p.p)(t),h=y(o,t,l);if(r?.contentAddressed&&"json"!==h.type)return void l.messages?.push(new n.Z("persistable:contentAddressingUnsupported",`Property "${c}" is trying to serializing a resource with content of type ${h.type} with content addressing. Content addressing is only supported for json resources.`,{content:h}));const g=r?.contentAddressed&&"json"===h.type?(0,i.F)(h.jsonString):d?.filename??(0,a.DO)(),v=(0,s.v_)(r?.prefix??d?.prefix,g),_=`${v}.${(0,f.B)(h)}`;if(r?.contentAddressed&&l.resources&&"json"===h.type){const e=l.resources.toKeep.find((({resource:e})=>e.path===_))??l.resources.toAdd.find((({resource:e})=>e.path===_));if(e)return void(u[c]=e.resource.itemRelativeUrl)}const S=l.portalItem.resourceFromPath(_);(0,s.jc)(t)&&l.resources&&l.resources.pendingOperations.push((0,s.gi)(t).then((e=>{S.path=`${v}.${(0,f.B)({type:"blob",blob:e})}`,u[c]=S.itemRelativeUrl})).catch((()=>{})));const b=r?.compress??!1;l.resources&&m({...e,resource:S,content:h,compress:b,updates:l.resources.toAdd}),u[c]=S.itemRelativeUrl}function m({object:e,propertyName:t,updates:r,resource:n,content:i,compress:o}){r.push({resource:n,content:i,compress:o,finish:r=>{!function(e,t,r){"string"==typeof e[t]?e[t]=r.url:e[t].url=r.url}(e,t,r)}})}function y(e,t,r){return"string"==typeof e?{type:"url",url:t}:{type:"json",jsonString:JSON.stringify(e.toJSON(r))}}},9713:function(e,t,r){function n(e){return e&&"getAtOrigin"in e&&"originOf"in e}r.d(t,{l:function(){return n}})},43141:function(e,t,r){r.r(t),r.d(t,{default:function(){return C}});var n=r(73440),i=r(78619),o=r(88194),s=r(96711),a=r(99574),l=r(84060),u=r(93568),c=r(90403),f=r(17155),p=(r(61432),r(83850),r(1194)),d=r(48023),h=r(75432),m=r(24910),y=r(82846),g=r(47925),v=r(71354),_=r(45213),S=r(30146),b=r(38209),x=r(38448),I=r(58560),w=r(55591),E=r(85330),P=r(27202),R=r(3752),A=r(93295),U=r(97113),j=r(51870),Z=r(28938);let O=class extends((0,I.Y)((0,E.q)((0,P.I)((0,R.M)((0,l.R)((0,w.N)((0,x.V)(b.Z)))))))){readModifications(e,t,r){this._modificationsSource={url:(0,Z.f)(e,r),context:r}}initialize(){this.addHandles((0,c.on)((()=>this.modifications),"after-changes",(()=>this.modifications=this.modifications),c.Z_))}constructor(e){super(e),this.operationalLayerType="IntegratedMesh3DTilesLayer",this.modifications=null,this._modificationsSource=null,this.spatialReference=new _.Z({wkid:4326,vcsWkid:115700}),this.fullExtent=new v.Z(-180,-90,180,90,this.spatialReference),this.url=null,this.type="integrated-mesh-3dtiles",this.path=null,this.minScale=0,this.maxScale=0,this.rootTilesetJSON=null}set elevationInfo(e){null!=e&&"absolute-height"!==e.mode||this._set("elevationInfo",e),this._validateElevationInfo(e)}_verifyArray(e,t){if(!Array.isArray(e)||e.length<t)return!1;for(const t of e)if("number"!=typeof t)return!1;return!0}_initFullExtent(){const e=this.rootTilesetJSON?.root?.boundingVolume;if(!e)return;if(e.box){const t=e?.box;if(t[3]>7972671&&t[7]>7972671&&t[11]>7945940)return}const t=this.rootTilesetJSON?.root?.transform,r=(0,y.Ue)();if(e.region&&this._verifyArray(e.region,6)){const t=e.region,r=(0,a.BV)(t[0]),n=(0,a.BV)(t[1]),i=t[4],o=(0,a.BV)(t[2]),s=(0,a.BV)(t[3]),l=t[5];this.fullExtent=new v.Z({xmin:r,ymin:n,zmin:i,xmax:o,ymax:s,zmax:l,spatialReference:this.spatialReference})}else if(e.sphere&&this._verifyArray(e.sphere,4)){const n=e.sphere,i=(0,y.al)(n[0],n[1],n[2]),o=n[3]/Math.sqrt(3),s=(0,y.Ue)();(0,m.d)(s,i,(0,y.al)(o,o,o));const a=(0,y.Ue)();if((0,m.f)(a,i,(0,y.al)(o,o,o)),t&&this._verifyArray(t,16)){const e=t;(0,m.t)(r,s,e),(0,m.c)(s,r),(0,m.t)(r,a,e),(0,m.c)(a,r)}(0,S.projectBuffer)(s,g.pn,0,s,_.Z.WGS84,0),(0,S.projectBuffer)(a,g.pn,0,a,_.Z.WGS84,0);const l=(0,y.Ue)(),u=(0,y.Ue)();(0,m.A)(l,s,a),(0,m.z)(u,s,a),this.fullExtent=new v.Z({xmin:l[0],ymin:l[1],zmin:l[2],xmax:u[0],ymax:u[1],zmax:u[2],spatialReference:this.spatialReference})}else if(e.box&&this._verifyArray(e.box,12)){const r=e.box,n=(0,y.al)(r[0],r[1],r[2]),i=(0,y.al)(r[3],r[4],r[5]),o=(0,y.al)(r[6],r[7],r[8]),s=(0,y.al)(r[9],r[10],r[11]),a=[];for(let e=0;e<8;++e)a.push((0,y.Ue)());if((0,m.f)(a[0],n,i),(0,m.f)(a[0],a[0],o),(0,m.f)(a[0],a[0],s),(0,m.a)(a[1],n,i),(0,m.f)(a[1],a[1],o),(0,m.f)(a[1],a[1],s),(0,m.f)(a[2],n,i),(0,m.a)(a[2],a[2],o),(0,m.f)(a[2],a[2],s),(0,m.a)(a[3],n,i),(0,m.a)(a[3],a[3],o),(0,m.f)(a[3],a[3],s),(0,m.f)(a[4],n,i),(0,m.f)(a[4],a[4],o),(0,m.a)(a[4],a[4],s),(0,m.a)(a[5],n,i),(0,m.f)(a[5],a[5],o),(0,m.a)(a[5],a[5],s),(0,m.f)(a[6],n,i),(0,m.a)(a[6],a[6],o),(0,m.a)(a[6],a[6],s),(0,m.a)(a[7],n,i),(0,m.a)(a[7],a[7],o),(0,m.a)(a[7],a[7],s),t&&this._verifyArray(t,16)){const e=t;for(let t=0;t<8;++t)(0,m.t)(a[t],a[t],e)}const l=(0,y.al)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),u=(0,y.al)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let e=0;e<8;++e)(0,S.projectBuffer)(a[e],g.pn,0,a[e],_.Z.WGS84,0),(0,m.A)(u,u,a[e]),(0,m.z)(l,l,a[e]);this.fullExtent=new v.Z({xmin:u[0],ymin:u[1],zmin:u[2],xmax:l[0],ymax:l[1],zmax:l[2],spatialReference:this.spatialReference})}}async load(e){return this.addResolvingPromise(this._doLoad(e)),this}async _doLoad(e){const t=null!=e?e.signal:null;try{await this.loadFromPortal({supportedTypes:["3DTiles Service"],validateItem:e=>{if(e.typeKeywords?.includes("IntegratedMesh"))return!0;throw new o.Z("portal:invalid-layer-item-type","Invalid layer item, expected '${expectedType}' ",{expectedType:"3DTiles Service containing IntegratedMesh"})}},e)}catch(e){(0,u.r9)(e)}if(null!=this._modificationsSource){const t=await U.Z.fromUrl(this._modificationsSource.url,this.spatialReference,e);this.setAtOrigin("modifications",t,this._modificationsSource.context.origin),this._modificationsSource=null}if(this.url){const e=(0,i.Z)(this.url,{query:{...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then((e=>{this.rootTilesetJSON=e.data,this._initFullExtent()}),(e=>{(0,u.r9)(e)}));await e}}beforeSave(){if(null!=this._modificationsSource)return this.load().then((()=>{}),(()=>{}))}async fetchAttributionData(){return this.load().then((()=>({})))}_validateElevationInfo(e){const t="Integrated mesh 3d tiles layers";(0,j.LR)(s.Z.getLogger(this),(0,j.Uy)(t,"absolute-height",e)),(0,j.LR)(s.Z.getLogger(this),(0,j.kf)(t,e))}};(0,n._)([(0,f.Cb)({type:["IntegratedMesh3DTilesLayer"]})],O.prototype,"operationalLayerType",void 0),(0,n._)([(0,f.Cb)({type:U.Z,clonable:e=>e.clone()}),(0,h.B)({origins:["web-scene","portal-item"],type:"resource",prefix:"modifications"})],O.prototype,"modifications",void 0),(0,n._)([(0,p.r)(["web-scene","portal-item"],"modifications")],O.prototype,"readModifications",null),(0,n._)([(0,f.Cb)({type:_.Z})],O.prototype,"spatialReference",void 0),(0,n._)([(0,f.Cb)({type:v.Z})],O.prototype,"fullExtent",void 0),(0,n._)([(0,f.Cb)(A.PV)],O.prototype,"elevationInfo",null),(0,n._)([(0,f.Cb)({type:["show","hide"]})],O.prototype,"listMode",void 0),(0,n._)([(0,f.Cb)(A.HQ)],O.prototype,"url",void 0),(0,n._)([(0,f.Cb)({readOnly:!0})],O.prototype,"type",void 0),(0,n._)([(0,f.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0},"portal-item":{read:!0,write:!0}},read:!1}})],O.prototype,"path",void 0),(0,n._)([(0,f.Cb)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:!1,write:!1}}}})],O.prototype,"minScale",void 0),(0,n._)([(0,f.Cb)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:!1,write:!1}}}})],O.prototype,"maxScale",void 0),O=(0,n._)([(0,d.j)("esri.layers.IntegratedMesh3DTilesLayer")],O);const C=O},38448:function(e,t,r){r.d(t,{V:function(){return s}});var n=r(73440),i=r(17155),o=(r(61432),r(96711),r(83850),r(48023));const s=e=>{let t=class extends e{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):"portalItem"in this?this.portalItem?.apiKey:null}set apiKey(e){null!=e?this._override("apiKey",e):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,n._)([(0,i.Cb)({type:String})],t.prototype,"apiKey",null),t=(0,n._)([(0,o.j)("esri.layers.mixins.APIKeyMixin")],t),t}},58560:function(e,t,r){r.d(t,{Y:function(){return l}});var n=r(73440),i=r(96711),o=r(17155),s=(r(61432),r(83850),r(48023)),a=r(66619);const l=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=(0,a.Qc)(this.url);if(e?.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",(0,a.Nm)(e,i.Z.getLogger(this)))}};return(0,n._)([(0,o.Cb)()],t.prototype,"title",null),(0,n._)([(0,o.Cb)({type:String})],t.prototype,"url",null),t=(0,n._)([(0,s.j)("esri.layers.mixins.ArcGISService")],t),t}},55591:function(e,t,r){r.d(t,{N:function(){return s}});var n=r(73440),i=r(17155),o=(r(61432),r(96711),r(83850),r(48023));const s=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return(0,n._)([(0,i.Cb)({type:Object,json:{write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0)})}}})],t.prototype,"customParameters",void 0),t=(0,n._)([(0,o.j)("esri.layers.mixins.CustomParametersMixin")],t),t}},27202:function(e,t,r){r.d(t,{I:function(){return x}});var n=r(73440),i=r(81001),o=r(10218),s=r(78619),a=r(29292),l=r(88194),u=r(96711),c=r(61100),f=r(93568),p=r(95490),d=r(17155),h=(r(61432),r(83850),r(1194)),m=r(48023),y=r(29884),g=r(75428),v=r(77601),_=r(96193),S=r(91525),b=r(47626);const x=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,c.SC)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,r){if(t.itemId)return new _.default({id:t.itemId,portal:r?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem?.id)try{const{load:n}=await r.e(64975).then(r.bind(r,64975));return(0,f.k_)(t),await n({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData,layerModuleTypeMap:e.layerModuleTypeMap,populateGroupLayer:e.populateGroupLayer},t)}catch(e){throw(0,f.D_)(e)||u.Z.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${e}`),e}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(e).catch((e=>((0,f.r9)(e),!0))))}async setUserPrivileges(e,t){if(!i.default.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(t);if(this.url)try{const{features:{edit:r,fullEdit:n},content:{updateItem:i}}=await this._fetchUserPrivileges(e,t);this._set("userHasEditingPrivileges",r),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",i)}catch(e){(0,f.r9)(e)}}async _fetchUserPrivileges(e,t){let r=this.portalItem;if(!e||!r||!r.loaded||r.sourceUrl)return this._fetchFallbackUserPrivileges(t);const n=!o.id?.findCredential(this.url),i=e===r.id;if(i&&r.portal.user)return this._getUserPrivileges(r,n);let s,a;if(i)s=r.portal.url;else try{s=await(0,g.oP)(this.url,t)}catch(e){(0,f.r9)(e)}if(!s||!(0,p.Zo)(s,r.portal.url))return this._fetchFallbackUserPrivileges(t);try{const e=null!=t?t.signal:null;a=await(o.id?.getCredential(`${s}/sharing`,{prompt:!1,signal:e}))}catch(e){(0,f.r9)(e)}if(!a)return{features:{edit:true,fullEdit:false},content:{updateItem:false}};try{if(i?await r.reload():(r=new _.default({id:e,portal:{url:s}}),await r.load(t)),r.portal.user)return this._getUserPrivileges(r,n)}catch(e){(0,f.r9)(e)}return{features:{edit:true,fullEdit:false},content:{updateItem:false}}}_getUserPrivileges(e,t){const r=(0,b.Ss)(e);return t&&(r.features.edit=!0),r}async _fetchFallbackUserPrivileges(e){let t=!0;try{t=await this._fetchUserHasEditingPrivileges(e)}catch(e){(0,f.r9)(e)}return{features:{edit:t,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(e){const t=this.url?o.id?.findCredential(this.url):null;if(!t)return!0;const r=I.credential===t?I.user:await this._fetchEditingUser(e);return I.credential=t,I.user=r,null==r?.privileges||r.privileges.includes("features:user:edit")}async _fetchEditingUser(e){const t=this.portalItem?.portal?.user;if(t)return t;const r=o.id?.findServerInfo(this.url??"");if(!r?.owningSystemUrl)return null;const n=`${r.owningSystemUrl}/sharing/rest`,i=v.Z.getDefault();if(i&&i.loaded&&(0,p.Fv)(i.restUrl)===(0,p.Fv)(n))return i.user;const l=`${n}/community/self`,u=null!=e?e.signal:null,c=await(0,a.q6)((0,s.Z)(l,{authMode:"no-prompt",query:{f:"json"},signal:u}));return c.ok?S.Z.fromJSON(c.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const r=t?.portal,n=this.portalItem?.id&&(this.portalItem.portal||v.Z.getDefault());return r&&n&&!(0,p.tm)(n.restUrl,r.restUrl)?(t.messages&&t.messages.push(new l.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return(0,n._)([(0,d.Cb)({type:_.default})],t.prototype,"portalItem",null),(0,n._)([(0,h.r)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),(0,n._)([(0,y.c)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),(0,n._)([(0,d.Cb)({clonable:!1})],t.prototype,"resourceReferences",void 0),(0,n._)([(0,d.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),(0,n._)([(0,d.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasFullEditingPrivileges",void 0),(0,n._)([(0,d.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasUpdateItemPrivileges",void 0),t=(0,n._)([(0,m.j)("esri.layers.mixins.PortalLayer")],t),t},I={credential:null,user:null}},3752:function(e,t,r){r.d(t,{M:function(){return s}});var n=r(73440),i=r(17155),o=(r(61432),r(96711),r(83850),r(48023));const s=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const e={minScale:this.minScale,maxScale:this.maxScale},t=this.parent;t&&"effectiveScaleRange"in t&&function(e,t){e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale}(e,t.effectiveScaleRange);const r=this._get("effectiveScaleRange");return r&&r.minScale===e.minScale&&r.maxScale===e.maxScale?r:e}};return(0,n._)([(0,i.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),(0,n._)([(0,i.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),(0,n._)([(0,i.Cb)({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=(0,n._)([(0,o.j)("esri.layers.mixins.ScaleRangeLayer")],t),t}},49076:function(e,t,r){r.d(t,{Z:function(){return h}});var n,i=r(73440),o=r(63255),s=r(28947),a=r(8914),l=r(17155),u=(r(61432),r(96711),r(48023)),c=r(29884),f=r(75432),p=r(67764),d=r(13132);let h=n=class extends o.Z{constructor(e){super(e),this.geometry=null,this.type="clip"}writeGeometry(e,t,r,n){if(n.layer?.spatialReference&&!n.layer.spatialReference.equals(this.geometry.spatialReference)){if(!(0,d.canProjectWithoutEngine)(e.spatialReference,n.layer.spatialReference))return void(n?.messages&&n.messages.push(new a.Z("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",{modification:this,spatialReference:n.layer.spatialReference,context:n})));const i=new p.Z;(0,d.projectPolygon)(e,i,n.layer.spatialReference),t[r]=i.toJSON(n)}else t[r]=e.toJSON(n);delete t[r].spatialReference}clone(){return new n({geometry:(0,s.d9)(this.geometry),type:this.type})}};(0,i._)([(0,l.Cb)({type:p.Z}),(0,f.B)()],h.prototype,"geometry",void 0),(0,i._)([(0,c.c)(["web-scene","portal-item"],"geometry")],h.prototype,"writeGeometry",null),(0,i._)([(0,l.Cb)({type:["clip","mask","replace"],nonNullable:!0}),(0,f.B)()],h.prototype,"type",void 0),h=n=(0,i._)([(0,u.j)("esri.layers.support.SceneModification")],h)},97113:function(e,t,r){r.d(t,{Z:function(){return p}});var n,i=r(73440),o=r(78619),s=r(43254),a=r(63255),l=r(95490),u=r(17155),c=(r(61432),r(96711),r(83850),r(48023)),f=r(49076);let p=n=class extends(a.Z.JSONSupportMixin(s.Z.ofType(f.Z))){constructor(e){super(e),this.url=null}clone(){return new n({url:this.url,items:this.items.map((e=>e.clone()))})}toJSON(e){return this.toArray().map((t=>t.toJSON(e))).filter((e=>!!e.geometry))}static fromJSON(e,t){const r=new n;for(const n of e)r.add(f.Z.fromJSON(n,t));return r}static async fromUrl(e,t,r){const i={url:(0,l.mN)(e),origin:"service"},s=await(0,o.Z)(e,{responseType:"json",signal:r?.signal}),a=t.toJSON(),u=[];for(const e of s.data)u.push(f.Z.fromJSON({...e,geometry:{...e.geometry,spatialReference:a}},i));return new n({url:e,items:u})}};(0,i._)([(0,u.Cb)({type:String})],p.prototype,"url",void 0),p=n=(0,i._)([(0,c.j)("esri.layers.support.SceneModifications")],p)},47626:function(e,t,r){r.d(t,{$o:function(){return f},Fj:function(){return l},IW:function(){return c},Ss:function(){return d},_$:function(){return a},ck:function(){return u},hz:function(){return p},qj:function(){return s}});var n=r(13132),i=r(45213),o=r(97290);function s(e,t){if(!a(e,t)){const r=e.typeKeywords;r?r.push(t):e.typeKeywords=[t]}}function a(e,t){return!!e.typeKeywords?.includes(t)}function l(e){return a(e,p.HOSTED_SERVICE)}function u(e,t){const r=e.typeKeywords;if(r){const e=r.indexOf(t);e>-1&&r.splice(e,1)}}function c(e,t,r){r?s(e,t):u(e,t)}async function f(e){const t=e.clone().normalize();let r;if(t.length>1)for(const e of t)r?e.width>r.width&&(r=e):r=e;else r=t[0];return async function(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return(0,o.Sx)(e);const r=i.Z.WGS84;return await(0,n.initializeProjection)(t,r),(0,n.project)(e,r)}(r)}const p={CHARTS:"Charts",DYNAMIC:"Dynamic",DEVELOPER_BASEMAP:"DeveloperBasemap",GROUP_LAYER_MAP:"Map",HOSTED_SERVICE:"Hosted Service",JSAPI:"ArcGIS API for JavaScript",LOCAL_SCENE:"ViewingMode-Local",METADATA:"Metadata",MULTI_LAYER:"Multilayer",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer",SINGLE_LAYER:"Singlelayer",SUBTYPE_GROUP_LAYER:"SubtypeGroupLayer",SUBTYPE_GROUP_TABLE:"SubtypeGroupTable",TABLE:"Table",TILED_IMAGERY:"Tiled Imagery"};function d(e){const{portal:t,isOrgItem:r,itemControl:n}=e,i=t.user?.privileges;let o=!i||i.includes("features:user:edit"),s=!!r&&!!i?.includes("features:user:fullEdit");const a="update"===n||"admin"===n;return a?s=o=!0:s&&(o=!0),{features:{edit:o,fullEdit:s},content:{updateItem:a}}}},84753:function(e,t,r){r.d(t,{B:function(){return i}});var n=r(95490);function i(e){return o[function(e){return"json"===e.type?"application/json":"blob"===e.type?e.blob.type:function(e){const t=(0,n.Ml)(e);return l[t]||s}(e.url)}(e)]||a}const o={},s="text/plain",a=o[s],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const e in l)o[l[e]]=e},51870:function(e,t,r){r.d(t,{AA:function(){return h},Jn:function(){return u},LR:function(){return R},Lt:function(){return p},O3:function(){return b},Ou:function(){return v},RL:function(){return f},Uy:function(){return w},VW:function(){return l},W_:function(){return I},Wb:function(){return E},XH:function(){return m},Zz:function(){return s},ap:function(){return g},fl:function(){return d},fm:function(){return A},jG:function(){return U},kf:function(){return P},mF:function(){return a},tR:function(){return j},tq:function(){return x},vQ:function(){return _},vu:function(){return c},zx:function(){return S}});var n=r(26636),i=r(46368);function o(e){return e?U:j}function s(e,t){return t?.mode?t.mode:o(e).mode}function a(e,t){return null!=t?t:o(e)}function l(e,t){return s(null==e||(e.hasZ??!1),t)}function u(e,t){return a(null==e||(e.hasZ??!1),t)}function c(e){const t=y(e);return l(e.geometry,t)}function f(e){const t=y(e),r=l(e.geometry,t),n=null!=t&&"on-the-ground"!==r?A(t):0,i=t?.featureExpressionInfo;return{mode:r,offset:n,featureExpressionInfo:i}}function p(e){return m(f(e))}function d(e){return m(e)||h(e)}function h(e){return"0"===e?.featureExpressionInfo?.expression}function m(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function y(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function g(e,t){if(!e?.offset)return 0;const{offset:r,unit:i}=e;if("decimal-degrees"===i)return 0;const o="unknown"!==i&&i?i:"meters",s=(0,n.y)(t);return s?(0,n.En)(r,o,s):0}function v(e,t,r){if(!r?.mode)return;const n=e.hasZ?e.z:0,i=g(r,e.spatialReference);switch(r.mode){case"absolute-height":return n-i;case"on-the-ground":return 0;case"relative-to-ground":return n-((t.elevationProvider.getElevation(e.x,e.y,n,e.spatialReference,"ground")??0)+i);case"relative-to-scene":return n-((t.elevationProvider.getElevation(e.x,e.y,n,e.spatialReference,"scene")??0)+i)}}function _(e,t,r,n=null){return b(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,r,n)}function S(e,t,r,n,i=null){return b(e,t[0],t[1],t.length>2?t[2]:0,r,n,i)}function b(e,t,r,n,i,o,s=null){if(null==o)return;const a=null!=s?s.mode:"absolute-height";if("on-the-ground"===a)return 0;const{absoluteZ:l}=x(t,r,n,i,e,o);return function(e,t,r,n,i,o,s,a){const l=g(s,i);switch(a){case"absolute-height":return e-l;case"relative-to-ground":return e-((o.elevationProvider.getElevation(t,r,n,i,"ground")??0)+l);case"relative-to-scene":return e-((o.elevationProvider.getElevation(t,r,n,i,"scene")??0)+l)}}(l,t,r,n,i,e,s,a)}function x(e,t,r,n,i,o){const s=g(o,n);switch(o.mode){case"absolute-height":return{absoluteZ:r+s,elevation:0};case"on-the-ground":{const r=i.elevationProvider.getElevation(e,t,0,n,"ground")??0;return{absoluteZ:r,elevation:r}}case"relative-to-ground":{const o=i.elevationProvider.getElevation(e,t,r,n,"ground")??0;return{absoluteZ:r+o+s,elevation:o}}case"relative-to-scene":{const o=i.elevationProvider.getElevation(e,t,r,n,"scene")??0;return{absoluteZ:r+o+s,elevation:o}}}}function I(e,t){if(null==t)return!1;const{mode:r}=t;return null!=r&&("scene"===e&&"relative-to-scene"===r||"ground"===e&&"absolute-height"!==r)}function w(e,t,r){return r&&r.mode!==t?`${e} only support ${t} elevation mode`:null}function E(e,t,r){return r?.mode===t?`${e} do not support ${t} elevation mode`:null}function P(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null}function R(e,t){t&&e.warn(".elevationInfo=",t)}function A(e){return(e?.offset??0)*(0,i.Z7)(e?.unit)}const U={mode:"absolute-height",offset:0},j={mode:"on-the-ground",offset:null}}}]);