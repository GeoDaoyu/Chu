"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[52616],{93191:function(e,t,n){n.d(t,{I:function(){return x},a:function(){return m},b:function(){return v}});var i=n(41044),r=n(27349),s=n(2679),o=n(68647),a=n(7086),l=n(13743),u=n(96541),c=n(85119),h=n(48857),d=n(34709),p=n(52061),f=n(75047),_=n(74826),y=n(15150);class m extends _.K{}function v(e){const t=new y.kG,{vertex:n,fragment:_,varyings:m}=t,{output:v,perspectiveInterpolation:x}=e;return(0,u.Sv)(n,e),t.include(s.w,e),t.include(a.H,e),t.fragment.include(r.f5,e),t.include(o.R,e),t.include(f.j,e),t.attributes.add(p.T.POSITION,"vec3"),t.attributes.add(p.T.UV0,"vec2"),x&&t.attributes.add(p.T.PERSPECTIVEDIVIDE,"float"),n.main.add(h.H`
    vpos = position;
    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    vTexCoord = uv0;
    gl_Position = transformPosition(proj, view, vpos);
    ${(0,h.If)(x,"gl_Position *= perspectiveDivide;")}`),m.add("vpos","vec3",{invariant:!0}),m.add("vTexCoord","vec2"),_.include(l.Y),_.uniforms.add(new c.p("opacity",(e=>e.opacity)),new d.A("tex",(e=>e.glTexture))).main.add(h.H`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${(0,h.If)(v===i.H_.ObjectAndLayerIdColor,"fragColor = vec4(0, 0, 0, 1); return;")}
    vec4 finalColor = texture(tex, vTexCoord) * opacity;
    outputColorHighlightOID(finalColor, vpos, finalColor.rgb);`),t}const x=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:m,build:v},Symbol.toStringTag,{value:"Module"}))},38874:function(e,t,n){function i(e,t,n){n=n||2;var i,s,a,l,u,c,d,p=t&&t.length,f=p?t[0]*n:e.length,_=r(e,0,f,n,!0),y=[];if(!_||_.next===_.prev)return y;if(p&&(_=h(e,t,_,n)),e.length>80*n){i=a=e[0],s=l=e[1];for(var m=n;m<f;m+=n)(u=e[m])<i&&(i=u),(c=e[m+1])<s&&(s=c),u>a&&(a=u),c>l&&(l=c);d=0!==(d=Math.max(a-i,l-s))?1/d:0}return o(_,y,n,i,s,d),y}function r(e,t,n,i,r){var s,o;if(r===D(e,t,n,i)>0)for(s=t;s<n;s+=i)o=P(s,e[s],e[s+1],o);else for(s=n-i;s>=t;s-=i)o=P(s,e[s],e[s+1],o);if(o&&w(o,o.next)){var a=o.next;S(o),o=a}return o}function s(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!w(i,i.next)&&0!==b(i.prev,i,i.next))i=i.next;else{var r=i.prev;if(S(i),(i=t=r)===i.next)break;n=!0}}while(n||i!==t);return t}function o(e,t,n,i,r,h,d){if(e){!d&&h&&y(e,i,r,h);for(var p,f,_=e;e.prev!==e.next;)if(p=e.prev,f=e.next,h?l(e,i,r,h):a(e))t.push(p.i/n),t.push(e.i/n),t.push(f.i/n),S(e),e=f.next,_=f.next;else if((e=f)===_){d?1===d?o(e=u(s(e),t,n),t,n,i,r,h,2):2===d&&c(e,t,n,i,r,h):o(s(e),t,n,i,r,h,1);break}}}function a(e){var t=e.prev,n=e,i=e.next;if(b(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(x(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&b(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(e,t,n,i){var r=e.prev,s=e,o=e.next;if(b(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,u=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,c=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,h=m(a,l,t,n,i),d=m(u,c,t,n,i),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&x(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&x(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&b(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&x(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&x(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&b(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function u(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;!w(r,o)&&T(r,i,i.next,o)&&I(r,o)&&I(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),S(i),S(i.next),i=e=o),i=i.next}while(i!==e);return s(i)}function c(e,t,n,i,r,a){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&g(l,u)){var c=M(l,u);return l=s(l,l.next),c=s(c,c.next),o(l,t,n,i,r,a),void o(c,t,n,i,r,a)}u=u.next}l=l.next}while(l!==e)}function h(e,t,n,i){var o,a,l,u=[];for(o=0,a=t.length;o<a;o++)(l=r(e,t[o]*i,o<a-1?t[o+1]*i:e.length,i,!1))===l.next&&(l.steiner=!0),u.push(v(l));for(u.sort(d),o=0;o<u.length;o++)n=s(n=f(u[o],n),n.next);return n}function d(e,t){return e.x-t.x}function p(e){if(e.next.prev===e)return e;let t=e;for(;;){const n=t.next;if(n.prev===t||n===t||n===e)break;t=n}return t}function f(e,t){var n=function(e,t){var n,i=t,r=e.x,s=e.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>o){if(o=a,a===r){if(s===i.y)return i;if(s===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n;var l,u=n,c=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&x(s<h?r:o,s,c,h,s<h?o:r,s,i.x,i.y)&&(l=Math.abs(s-i.y)/(r-i.x),I(i,e)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&_(n,i)))&&(n=i,d=l)),i=i.next}while(i!==u);return n}(e,t);if(!n)return t;var i=M(n,e),r=s(n,n.next);let o=p(i);return s(o,o.next),r=p(r),p(t===n?r:t)}function _(e,t){return b(e.prev,e,t.prev)<0&&b(t.next,e,e.next)<0}function y(e,t,n,i){var r=e;do{null===r.z&&(r.z=m(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,s,o,a,l,u=1;do{for(n=e,e=null,s=null,o=0;n;){for(o++,i=n,a=0,t=0;t<u&&(a++,i=i.nextZ);t++);for(l=u;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=i}s.nextZ=null,u*=2}while(o>1)}(r)}function m(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function x(e,t,n,i,r,s,o,a){return(r-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(i-a)-(n-o)*(t-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&T(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(I(e,t)&&I(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(b(e.prev,e,t.prev)||b(e,t.prev,t))||w(e,t)&&b(e.prev,e,e.next)>0&&b(t.prev,t,t.next)>0)}function b(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function w(e,t){return e.x===t.x&&e.y===t.y}function T(e,t,n,i){var r=C(b(e,t,n)),s=C(b(e,t,i)),o=C(b(n,i,e)),a=C(b(n,i,t));return r!==s&&o!==a||!(0!==r||!E(e,n,t))||!(0!==s||!E(e,i,t))||!(0!==o||!E(n,e,i))||!(0!==a||!E(n,t,i))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function C(e){return e>0?1:e<0?-1:0}function I(e,t){return b(e.prev,e,e.next)<0?b(e,t,e.next)>=0&&b(e,e.prev,t)>=0:b(e,t,e.prev)<0||b(e,e.next,t)<0}function M(e,t){var n=new O(e.i,e.x,e.y),i=new O(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function P(e,t,n,i){var r=new O(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function O(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function D(e,t,n,i){for(var r=0,s=t,o=n-i;s<n;s+=i)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}n.d(t,{e:function(){return i}}),i.deviation=function(e,t,n,i){var r=t&&t.length,s=r?t[0]*n:e.length,o=Math.abs(D(e,0,s,n));if(r)for(var a=0,l=t.length;a<l;a++){var u=t[a]*n,c=a<l-1?t[a+1]*n:e.length;o-=Math.abs(D(e,u,c,n))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*n,p=i[a+1]*n,f=i[a+2]*n;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},i.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++)for(var o=0;o<t;o++)n.vertices.push(e[r][s][o]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n}},83695:function(e,t,n){function i(){return[1,0,0,1,0,0]}function r(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}n.d(t,{Ue:function(){return i},Wd:function(){return s},d9:function(){return r}});const s=[1,0,0,1,0,0];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:s,clone:r,create:i,fromValues:function(e,t,n,i,r,s){return[e,t,n,i,r,s]}},Symbol.toStringTag,{value:"Module"}))},50639:function(e,t,n){n.d(t,{Iu:function(){return u},Jp:function(){return o},U1:function(){return a},U_:function(){return s},Us:function(){return c},bA:function(){return l},vc:function(){return d},xJ:function(){return h},yR:function(){return r}});var i=n(66130);function r(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function s(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5];let l=n*s-i*r;return l?(l=1/l,e[0]=s*l,e[1]=-i*l,e[2]=-r*l,e[3]=n*l,e[4]=(r*a-s*o)*l,e[5]=(i*o-n*a)*l,e):null}function o(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=n[0],c=n[1],h=n[2],d=n[3],p=n[4],f=n[5];return e[0]=i*u+s*c,e[1]=r*u+o*c,e[2]=i*h+s*d,e[3]=r*h+o*d,e[4]=i*p+s*f+a,e[5]=r*p+o*f+l,e}function a(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=Math.sin(n),c=Math.cos(n);return e[0]=i*c+s*u,e[1]=r*c+o*u,e[2]=i*-u+s*c,e[3]=r*-u+o*c,e[4]=a,e[5]=l,e}function l(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=n[0],c=n[1];return e[0]=i*u,e[1]=r*u,e[2]=s*c,e[3]=o*c,e[4]=a,e[5]=l,e}function u(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=n[0],c=n[1];return e[0]=i,e[1]=r,e[2]=s,e[3]=o,e[4]=i*u+s*c+a,e[5]=r*u+o*c+l,e}function c(e,t){const n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e[4]=0,e[5]=0,e}function h(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function d(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function p(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}const f=o,_=p;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},equals:function(e,t){const n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],u=t[0],c=t[1],h=t[2],d=t[3],p=t[4],f=t[5],_=(0,i.bn)();return Math.abs(n-u)<=_*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-c)<=_*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=_*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-d)<=_*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-p)<=_*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(l-f)<=_*Math.max(1,Math.abs(l),Math.abs(f))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},fromRotation:c,fromScaling:h,fromTranslation:d,identity:r,invert:s,mul:f,multiply:o,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},multiplyScalarAndAdd:function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e},rotate:a,scale:l,set:function(e,t,n,i,r,s,o){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=s,e[5]=o,e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},sub:_,subtract:p,translate:u},Symbol.toStringTag,{value:"Module"}))},26191:function(e,t,n){n.d(t,{E:function(){return d},H:function(){return h}});var i=n(96373),r=n(30748),s=n(26821),o=n(24910);const a=(0,n(82846).Ue)(),l=(0,r.Ue)(),u=(0,r.Ue)(),c=(0,r.Ue)();function h(e,t,n){return(0,o.i)(a,t[0],t[1],1),(0,o.o)(a,a,(0,i.p4)(l,n)),0===a[2]?(0,s.t8)(e,a[0],a[1]):(0,s.t8)(e,a[0]/a[2],a[1]/a[2])}function d(e,t,n){return p(u,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]),p(c,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]),(0,i.Jp)(e,(0,i.uj)(u,u),c),0!==e[8]&&(e[0]/=e[8],e[1]/=e[8],e[2]/=e[8],e[3]/=e[8],e[4]/=e[8],e[5]/=e[8],e[6]/=e[8],e[7]/=e[8],e[8]/=e[8]),e}function p(e,t,n,r,s,u,c,h,d){(0,i.t8)(e,t,r,u,n,s,c,1,1,1),(0,o.i)(a,h,d,1),(0,i.uj)(l,e);const[p,f,_]=(0,o.o)(a,a,(0,i.p4)(l,l));return(0,i.t8)(l,p,0,0,0,f,0,0,0,_),(0,i.Jp)(e,l,e)}},76264:function(e,t,n){n.d(t,{Sy:function(){return l},UZ:function(){return o},XZ:function(){return a},x3:function(){return u}});var i=n(62197),r=n(45213),s=n(90756);const o={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new i.Z({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:r.Z.WebMercator}),minus180Line:new i.Z({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:r.Z.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new i.Z({paths:[[[180,-180],[180,180]]],spatialReference:r.Z.WGS84}),minus180Line:new i.Z({paths:[[[-180,-180],[-180,180]]],spatialReference:r.Z.WGS84})}};function a(e,t){return Math.ceil((e-t)/(2*t))}function l(e,t){const n=u(e);for(const e of n)for(const n of e)n[0]+=t;return e}function u(e){return(0,s.oU)(e)?e.rings:e.paths}},37204:function(e,t,n){n.d(t,{SR:function(){return h},Ui:function(){return c}});var i=n(69306),r=n(47566),s=n(62951),o=n(28931),a=n(90756),l=n(76264),u=n(8554);function c(e){return d(e,!0)}function h(e){return d(e,!1)}function d(e,t){if(null==e)return null;const n=e.spatialReference,r=(0,u.C5)(n),o=(0,i.A)(e)?e.toJSON():e;if(!r)return o;const c=(0,u.sS)(n)?102100:4326,h=l.UZ[c].maxX,d=l.UZ[c].minX;if((0,a.wp)(o))return f(o,h,d);if((0,a.aW)(o))return o.points=o.points.map((e=>f(e,h,d))),o;if((0,a.YX)(o))return p(o,r);if((0,a.oU)(o)||(0,a.l9)(o)){const e=(0,s.$P)(g,o),n={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},i=(0,l.XZ)(n.xmin,d)*(2*h),r=0===i?o:(0,l.Sy)(o,i);return n.xmin+=i,n.xmax+=i,n.xmax>h?v(r,h,t):n.xmin<d?v(r,d,t):r}return o}function p(e,t){if(!t)return e;const n=function(e,t){const n=[],{ymin:i,ymax:r,xmin:s,xmax:o}=e,a=e.xmax-e.xmin,[l,u]=t.valid,{x:c,frameId:h}=_(e.xmin,t),{x:d,frameId:p}=_(e.xmax,t),f=c===d&&a>0;if(a>2*u){const e={xmin:s<o?c:d,ymin:i,xmax:u,ymax:r},t={xmin:l,ymin:i,xmax:s<o?d:c,ymax:r},a={xmin:0,ymin:i,xmax:u,ymax:r},f={xmin:l,ymin:i,xmax:0,ymax:r},_=[],m=[];y(e,a)&&_.push(h),y(e,f)&&m.push(h),y(t,a)&&_.push(p),y(t,f)&&m.push(p);for(let e=h+1;e<p;e++)_.push(e),m.push(e);n.push(new x(e,[h]),new x(t,[p]),new x(a,_),new x(f,m))}else c>d||f?n.push(new x({xmin:c,ymin:i,xmax:u,ymax:r},[h]),new x({xmin:l,ymin:i,xmax:d,ymax:r},[p])):n.push(new x({xmin:c,ymin:i,xmax:d,ymax:r},[h]));return n}(e,t).map((e=>e.extent));return n.length<2?n[0]||e:n.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:n.map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}}function f(e,t,n){if(Array.isArray(e)){const i=e[0];if(i>t){const n=(0,l.XZ)(i,t);e[0]=i+n*(-2*t)}else if(i<n){const t=(0,l.XZ)(i,n);e[0]=i+t*(-2*n)}}else{const i=e.x;if(i>t){const n=(0,l.XZ)(i,t);e.x+=n*(-2*t)}else if(i<n){const t=(0,l.XZ)(i,n);e.x+=t*(-2*n)}}return e}function _(e,t){const[n,i]=t.valid,r=2*i;let s,o=0;return e>i?(s=Math.ceil(Math.abs(e-i)/r),e-=s*r,o=s):e<n&&(s=Math.ceil(Math.abs(e-n)/r),e+=s*r,o=-s),{x:e,frameId:o}}function y(e,t){const{xmin:n,ymin:i,xmax:r,ymax:s}=t;return m(e,n,i)&&m(e,n,s)&&m(e,r,s)&&m(e,r,i)}function m(e,t,n){return t>=e.xmin&&t<=e.xmax&&n>=e.ymin&&n<=e.ymax}function v(e,t,n=!0){const i=!(0,a.l9)(e);if(i&&(0,o.Zy)(e),n)return(new b).cut(e,t);const r=i?e.rings:e.paths,s=i?4:2,l=r.length,u=-2*t;for(let e=0;e<l;e++){const t=r[e];if(t&&t.length>=s){const e=[];for(const n of t)e.push([n[0]+u,n[1]]);r.push(e)}}return i?e.rings=r:e.paths=r,e}class x{constructor(e,t){this.extent=e,this.frameIds=t}}const g=(0,r.Ue)();class b{constructor(){this._linesIn=[],this._linesOut=[]}cut(e,t){let n;if(this._xCut=t,e.rings)this._closed=!0,n=e.rings,this._minPts=4;else{if(!e.paths)return null;this._closed=!1,n=e.paths,this._minPts=2}for(const e of n){if(!e||e.length<this._minPts)continue;let t=!0;for(const n of e)t?(this.moveTo(n),t=!1):this.lineTo(n);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),n=[];for(const e of this._linesIn)e&&e.length>=this._minPts&&n.push(e);const i=-2*this._xCut;for(const e of this._linesOut)if(e&&e.length>=this._minPts){for(const t of e)t[0]+=i;n.push(e)}return this._closed?e.rings=n:e.paths=n,e}moveTo(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}lineTo(e){const t=this._side(e[0]);if(t*this._prevSide==-1){const n=this._intersect(this._prevPt,e);this._lineTo(this._xCut,n,0),this._prevSide=0,this._lineTo(e[0],e[1],t)}else this._lineTo(e[0],e[1],t);this._prevSide=t,this._prevPt=e}close(){const e=this._firstPt,t=this._prevPt;e[0]===t[0]&&e[1]===t[1]||this.lineTo(e),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(e,t,n){this._closed?(this._lineIn.push([n<=0?e:this._xCut,t]),this._lineOut.push([n>=0?e:this._xCut,t])):(n<=0&&this._lineIn.push([e,t]),n>=0&&this._lineOut.push([e,t]))}_lineTo(e,t,n){this._closed?(w(this._lineIn,n<=0?e:this._xCut,t),w(this._lineOut,n>=0?e:this._xCut,t)):n<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([e,t])):n>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([e,t])):this._prevSide<0?(this._lineIn.push([e,t]),this._lineOut.push([e,t])):this._prevSide>0&&(this._lineOut.push([e,t]),this._lineIn.push([e,t]))}_checkClosingPt(e){const t=e.length;t>3&&e[0][0]===this._xCut&&e[t-2][0]===this._xCut&&e[1][0]===this._xCut&&(e[0][1]=e[t-2][1],e.pop())}_side(e){return e<this._xCut?-1:e>this._xCut?1:0}_intersect(e,t){const n=(this._xCut-e[0])/(t[0]-e[0]);return e[1]+n*(t[1]-e[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function w(e,t,n){const i=e.length;i>1&&e[i-1][0]===t&&e[i-2][0]===t?e[i-1][1]=n:e.push([t,n])}},77271:function(e,t,n){n.d(t,{L:function(){return h}});var i=n(73440),r=n(70880),s=n(17155),o=(n(61432),n(96711),n(83850),n(48023)),a=n(67764),l=n(13132),u=n(47566),c=n(37204);let h=class extends r.Z{constructor(e){super(e)}get bounds(){const e=this.coords;return null==e?.extent?null:(0,u.oJ)(e.extent)}get coords(){const e=this.element.georeference?.coords;return(0,l.projectOrLoad)(e,this.spatialReference).geometry}get normalizedCoords(){return a.Z.fromJSON((0,c.Ui)(this.coords))}get normalizedBounds(){const e=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=e?(0,u.oJ)(e):null}};(0,i._)([(0,s.Cb)()],h.prototype,"spatialReference",void 0),(0,i._)([(0,s.Cb)()],h.prototype,"element",void 0),(0,i._)([(0,s.Cb)()],h.prototype,"bounds",null),(0,i._)([(0,s.Cb)()],h.prototype,"coords",null),(0,i._)([(0,s.Cb)()],h.prototype,"normalizedCoords",null),(0,i._)([(0,s.Cb)()],h.prototype,"normalizedBounds",null),h=(0,i._)([(0,o.j)("esri.layers.support.MediaElementView")],h)},77523:function(e,t,n){n.d(t,{X:function(){return o}});var i=n(18208),r=n(90017),s=n(33566);class o extends i.c{constructor(e,t,n){super(e,t),this._updateControlPoints=n,this.editSourcePoints=!1}updateVertices(e,t,n=r.b.ACCUMULATE_STEPS){return this._apply(new a(this.data,e,t,this.editSourcePoints,this._updateControlPoints),n)}}class a extends s.y{constructor(e,t,n,i,r){super(e,t,n),this._editSourcePoints=i,this._updateControlPoints=r}_notifyChanges(e){super._notifyChanges(e),this._updateControlPoints(this._editSourcePoints)}canAccumulate(e){return this._editSourcePoints===e._editSourcePoints&&super.canAccumulate(e)}}},24381:function(e,t,n){n.d(t,{A:function(){return c}});var i=n(73440),r=n(50702),s=n(93568),o=n(90403),a=n(17155),l=(n(61432),n(96711),n(83850),n(48023)),u=n(73584);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,u.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,r.kB)((()=>e.abort()))),await(0,o.N1)((()=>this.view.defaultsFromMap?.heightModelInfoReady),t),(0,s.k_)(t);const n=(0,u.Wt)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(n)throw n}};return(0,i._)([(0,a.Cb)()],t.prototype,"view",void 0),(0,i._)([(0,a.Cb)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,i._)([(0,l.j)("esri.views.3d.layers.LayerView3D")],t),t}},15705:function(e,t,n){n.r(t),n.d(t,{default:function(){return ne}});var i=n(73440),r=n(88194),s=n(50702),o=(n(61432),n(96302)),a=n(26191),l=n(93568),u=n(90403),c=n(17155),h=(n(96711),n(83850),n(48023)),d=n(30748),p=n(47566),f=n(77271),_=n(94808),y=n(24381),m=n(70880),v=n(99574),x=n(61100),g=n(26636),b=n(50639),w=n(83695),T=n(26821),E=n(41788),C=n(60147),I=n(77523),M=n(96620),P=n(18753),S=n(42888),O=n(54074),D=n(8316);const A=Symbol(),R=Symbol();let L=class extends m.Z{get editSourcePoints(){return!!this.options?.reshapeOptions.editSourcePoints!==this._isEditSourcePointsToggled}get updating(){return this._updatingHandles.updating}get _preferredInteractionTool(){return this.options?.tool??"transform"}get _toolType(){switch(this._preferredInteractionTool){case"transform":return"transform-3d";case"reshape":return"reshape-3d"}}get _validatedSelectedElement(){const e=this.selectedElement;if(!e)return null;const{layer:{source:t}}=this;return t?"hasElement"in t?t.hasElement(e)?e:null:t===e?e:null:null}constructor(e){super(e),this.enabled=!1,this._isEditSourcePointsToggled=!1,this._updatingHandles=new C.R,this._isOpacityToggled=!1,this._factor=1,this._tool=null,this._object=null,this._createToolAbortController=null,this._onPointerMove=(0,l.Ds)((async e=>{const t=await this._updatingHandles.addPromise(this._findElementAtScreenPoint(e));this.destroyed||(this.removeHandles(R),t&&t!==this.selectedElement&&(this.view.cursor="pointer",this.addHandles((0,s.kB)((()=>this.view.cursor=null)),R)))})),this._tmpMat2=(0,w.Ue)(),this._tmpVec2=(0,E.Ue)()}destroy(){this._createToolAbortController=(0,x.IM)(this._createToolAbortController)}initialize(){this.addHandles([(0,s.ed)(this._updatingHandles),this._updatingHandles.add((()=>this.enabled),(e=>this._enableDisable(e)),u.nn),this._updatingHandles.add((()=>this._preferredInteractionTool),(e=>this._preferredInteractionToolChanged(e)))])}_enableDisable(e){if(!e)return void this.removeHandles(A);this._dynamicImports();const{view:t}=this,n=new P.G7;n.add(P.Lk.undo,(()=>{this._object?.operations?.undo(),this._object?.emit("modified-externally")})),n.add(P.Lk.redo,(()=>{this._object?.operations?.redo(),this._object?.emit("modified-externally")})),n.addToggle(P.Lk.preserveAspectRatio,(e=>{"transform-3d"===this._tool?.type&&(this._tool.preserveAspectRatio="key-down"===e.type)})),n.addToggle(P.Lk.editSourcePoints,(e=>{"reshape-3d"===this._tool?.type&&(this._isEditSourcePointsToggled="key-down"===e.type)})),n.addToggle(P.Lk.rotateIncrements,(e=>{"transform-3d"===this._tool?.type&&(this._tool.snapRotation="key-down"===e.type)})),n.add(P.Lk.toggleOpacity,(()=>{const e=this._object?.element;e&&(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)})),n.add(P.Lk.moveUp,(()=>this._move(0,this._factor))),n.add(P.Lk.moveDown,(()=>this._move(0,-this._factor))),n.add(P.Lk.moveRight,(()=>this._move(this._factor,0))),n.add(P.Lk.moveLeft,(()=>this._move(-this._factor,0))),n.addToggle(P.Lk.factorModifier,(e=>this._factor="key-down"===e.type?10:1)),this._isOpacityToggled=!1,this.addHandles([n.register(t,M.f.TOOL),(0,s.kB)((()=>{this._isOpacityToggled&&this.selectedElement&&(this.selectedElement.opacity*=2,this._isOpacityToggled=!1)})),t.on("immediate-click",(e=>this._onClick(e)),M.f.TOOL),t.on("pointer-move",(e=>this._onPointerMove(e).catch((()=>{}))),M.f.TOOL),this._updatingHandles.add((()=>this._validatedSelectedElement),((e,t)=>{t&&e!==t&&this._isOpacityToggled&&(t.opacity*=2,this._isOpacityToggled=!1),this._selectedElementChanged(e)}),u.nn),(0,s.kB)((()=>{t.cursor=null,this._removeTool()}))],A)}async _onClick(e){await this._updatingHandles.addPromise(e.defer((async()=>{const t=await this._findElementAtScreenPoint(e);this.destroyed||(t&&e.stopPropagation(),this.selectedElement=t,this.selectedElement&&(this.view.cursor=null))})))}async _selectedElementChanged(e){e?.georeference?this._object?.element!==e&&await this._updatingHandles.addPromise(this._recreateTool()):this._removeTool()}async _recreateTool(){this._createToolAbortController=(0,x.IM)(this._createToolAbortController),this._removeTool();const e=this._validatedSelectedElement;if(!e)return;const t=new AbortController;this._createToolAbortController=t;const{ManipulatedObject3DMediaElement:n,ExtentTransformTool:i,ReshapeTool3D:r,automaticAreaMeasurementUtils:o,automaticLengthMeasurementUtils:a}=await this._dynamicImports();if(t.signal.aborted)return;const{view:l,layer:c,_toolType:h}=this;switch(this._object=new n({view:l,layer:c,element:e,tool:this._preferredInteractionTool}),h){case"transform-3d":{this._tool=new i({view:l,object:this._object,automaticLengthMeasurementUtils:a});const e=l.inputManager;e.isModifierKeyDown(P.Lk.rotateIncrements.key)&&(this._tool.snapRotation=!0),e.isModifierKeyDown(P.Lk.preserveAspectRatio.key)&&(this._tool.preserveAspectRatio=!0)}break;case"reshape-3d":{const e=(0,S.u)(l),{snappingManager:t}=e;this._tool=new r({view:l,object:this._object,enableMidpoints:!1,enableZShape:!1,snappingManager:t,enableMoveObject:!1,autoHideManipulators:!0,enableDeleteVertices:!1,sketchOptions:{tooltips:{enabled:!0,inputEnabled:!0,visibleElements:{area:!1}}},automaticAreaMeasurementUtils:o,automaticLengthMeasurementUtils:a}),this.addHandles([e,(0,u.YP)((()=>({editSourcePoints:this.editSourcePoints,operations:this._object?.operations})),(e=>{e.operations instanceof I.X&&(e.operations.editSourcePoints=e.editSourcePoints)}),u.tX)],this._tool)}}this.addHandles([(0,s.kB)((()=>{this._object=(0,x.SC)(this._object),this._tool&&(l.tools.remove(this._tool),this._tool=null)}))],this._tool),l.addAndActivateTool(this._tool)}_preferredInteractionToolChanged(e){const{_tool:t}=this;if(!t)return;if(this._toolType!==t.type)return void this._updatingHandles.addPromise(this._recreateTool());const{_object:n}=this;n&&(n.tool=e)}async _dynamicImports(){const[{ManipulatedObject3DMediaElement:e},{ExtentTransformTool:t,ReshapeTool3D:i},r,s]=await Promise.all([Promise.all([n.e(68472),n.e(31004)]).then(n.bind(n,31004)),Promise.all([n.e(9519),n.e(66288),n.e(65513),n.e(56870),n.e(30903),n.e(43825),n.e(82845),n.e(52846),n.e(8455),n.e(48044),n.e(48119),n.e(20144),n.e(92889),n.e(37727),n.e(56034),n.e(96009),n.e(57399)]).then(n.bind(n,56034)),await(0,O.A)(),await(0,D.U)()]);return{ManipulatedObject3DMediaElement:e,ExtentTransformTool:t,ReshapeTool3D:i,automaticAreaMeasurementUtils:r,automaticLengthMeasurementUtils:s}}async _findElementAtScreenPoint(e){const t=(await this.view.hitTest(e,{include:[this.layer]})).results[0];return"media"===t?.type?t.element:null}_removeTool(){this._tool&&this.removeHandles(this._tool)}_move(e,t){const{view:n,_object:i}=this,r=i?.operations;if(!r)return;const s=n.overlayPixelSizeInMapUnits(n.pointsOfInterest.focus.location)*(0,g.c9)(n.spatialReference)/(0,g.c9)(r.data.spatialReference),{_tmpMat2:o,_tmpVec2:a}=this,l=(0,b.Us)(o,(0,v.Vl)(360-this.view.camera.heading)),u=(0,T.t8)(a,s*e,s*t);(0,T.iu)(u,u,l),r.move(u[0],u[1],0),i.emit("modified-externally")}};(0,i._)([(0,c.Cb)({constructOnly:!0})],L.prototype,"view",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0})],L.prototype,"layer",void 0),(0,i._)([(0,c.Cb)()],L.prototype,"selectedElement",void 0),(0,i._)([(0,c.Cb)()],L.prototype,"enabled",void 0),(0,i._)([(0,c.Cb)()],L.prototype,"options",void 0),(0,i._)([(0,c.Cb)()],L.prototype,"editSourcePoints",null),(0,i._)([(0,c.Cb)()],L.prototype,"_isEditSourcePointsToggled",void 0),(0,i._)([(0,c.Cb)()],L.prototype,"updating",null),(0,i._)([(0,c.Cb)()],L.prototype,"_preferredInteractionTool",null),(0,i._)([(0,c.Cb)()],L.prototype,"_validatedSelectedElement",null),L=(0,i._)([(0,h.j)("esri.views.3d.layers.support.MediaLayerInteraction")],L);var Z=n(61471),H=n(81749),U=n(25952),j=n(89341),k=n(31097),z=n(14357),V=n(28751),G=n(94125),N=n(52061),W=n(3113),B=n(5527);let X=class extends m.Z{constructor(e){super(e),this.editSourcePoints=!1}};(0,i._)([(0,c.Cb)()],X.prototype,"editSourcePoints",void 0),X=(0,i._)([(0,h.j)("esri.views.3d.layers.support.MediaLayerInteractionOptions.ReshapeOptions")],X);let q=class extends m.Z{constructor(e){super(e),this.tool="transform",this.reshapeOptions=new X}};(0,i._)([(0,c.Cb)()],q.prototype,"tool",void 0),(0,i._)([(0,c.Cb)({type:X})],q.prototype,"reshapeOptions",void 0),q=(0,i._)([(0,h.j)("esri.views.3d.layers.support.MediaLayerInteractionOptions")],q);const F=e=>{let t=class extends e{constructor(...e){super(...e),this.layer=null,this.interactive=!1,this.interactionOptions=new q,this.selectedElement=null}highlight(e,t){throw new Error("missing implementation")}};return(0,i._)([(0,c.Cb)()],t.prototype,"layer",void 0),(0,i._)([(0,c.Cb)()],t.prototype,"interactive",void 0),(0,i._)([(0,c.Cb)({type:q})],t.prototype,"interactionOptions",void 0),(0,i._)([(0,c.Cb)()],t.prototype,"selectedElement",void 0),t=(0,i._)([(0,h.j)("esri.views.layers.MediaLayerView")],t),t};var $=n(43295),J=n(27546),Y=n(65650);let K=class extends((0,y.A)(F(B.Z))){get interactive(){return this._interaction.enabled}set interactive(e){this._interaction&&(this._interaction.enabled=e)}get selectedElement(){return this._interaction.selectedElement}set selectedElement(e){this._interaction&&(this._interaction.selectedElement=e)}get visibleAtCurrentScale(){return(0,J.GB)(this.layer.effectiveScaleRange,this.view.scale)}get usedMemory(){return Array.from(this._renderElements.values()).reduce(((e,t)=>e+(t.getRenderData()?.texture.usedMemory??0)),0)}constructor(e){super(e),this.type="media-3d",this.drapeSourceType=_.Lw.Features,this.updatePolicy=G.j.SYNC,this.ignoresMemoryFactor=!0,this.unloadedMemory=0,this._uidToElement=new Map,this._highlightedElements=new Map,this._elementsInHighlightedId=new Map,this._renderElements=new Map,this._lastDrapingExtent=null,this._update=(0,l.Ds)((async(e,t,n)=>{const i=await this._collectMediaElements(e,t,n);this._synchronizeRenderElements(i)}),0);const{view:t,layer:n}=e;this._interaction=new L({view:t,layer:n}),this.addHandles((0,u.YP)((()=>this.interactionOptions),(e=>this._interaction.options=e),u.tX))}initialize(){const{view:e,layer:t}=this;this._renderer=e.basemapTerrain.overlayManager.registerGeometryDrapeSource(this);const n=()=>this._updateWithLastDrapingExtent();this.addHandles([(0,s.kB)((()=>e.basemapTerrain.overlayManager.unregisterDrapeSource(this))),(0,u.on)((()=>t.effectiveSource),"change",n),(0,u.on)((()=>t.effectiveSource),"refresh",n)]),this._updatingHandles.add((()=>this.suspended),n)}setDrapingExtent(e,t){this._lastDrapingExtent={overlays:e,spatialReference:t},this._updateWithLastDrapingExtent()}getHit(e){const t=this._uidToElement.get(e);return t?{type:"media",element:t,layer:this.layer}:null}highlight(e,t){const n=new k.j(t?.name??$.b),i=(0,o.TW)(e)?Array.from(e):[e];this._elementsInHighlightedId.set(n,i);for(const e of i){const t=this._highlightedElements.get(e);t?t.add(n):this._highlightedElements.set(e,new Set([n]));const i=this._renderElements.get(e)?.getRenderData();i&&(i.renderGeometry.geometry.addHighlight(n),this._renderer.modifyGeometries([i.renderGeometry],j.$.HIGHLIGHT))}return(0,s.kB)((()=>{const e=this._elementsInHighlightedId.get(n);if(e){for(const t of e){const e=this._highlightedElements.get(t);if(!e)continue;e.delete(n);const i=this._renderElements.get(t)?.getRenderData();i&&(i.renderGeometry.geometry.removeHighlight(n),this._renderer.modifyGeometries([i.renderGeometry],j.$.HIGHLIGHT)),0===e.size&&this._highlightedElements.delete(t)}this._elementsInHighlightedId.delete(n)}}))}isUpdating(){return super.isUpdating()||this._interaction.updating}_updateWithLastDrapingExtent(){if(null==this._lastDrapingExtent||this.suspended)return void(this._renderer&&this._synchronizeRenderElements(new Set));const{overlays:e,spatialReference:t}=this._lastDrapingExtent;this._updatingHandles.addPromise(this._update(e,t).catch((()=>{})))}async _collectMediaElements(e,t,n){const i=this.layer.effectiveSource;return null==i?new Set:new Set((await Promise.all(e.map((e=>i.queryElements((0,p.HH)(e.extent,t),{signal:n}))))).flat())}_synchronizeRenderElements(e){this._synchronizeRenderElementsRemove(e),this._synchronizeRenderElementsAdd(e)}_synchronizeRenderElementsRemove(e){this._renderElements.forEach(((t,n)=>{e.has(n)||(this._removeElement(n,t),this.emit("element-render-changed",{element:n}))}))}_synchronizeRenderElementsAdd(e){for(const t of e)this._renderElements.has(t)||this._createRenderElement(t)}_removeElement(e,t){this._destroyRenderData(e,t),this._renderElements.delete(e),this._uidToElement.delete(e.uid),t.handle.remove()}_createRenderElement(e){const t=new f.L({spatialReference:this.view.spatialReference,element:e}),n=new ee((0,s.AL)([this._updatingHandles.add((()=>e.opacity),(e=>n.getRenderData()?.material.setParameters({opacity:e}))),this._updatingHandles.add((()=>t.coords),(()=>{n.data?this._updateGeometry(t,n):this._initializeRenderData(t,n)})),this._updatingHandles.add((()=>e.content),(()=>this._initializeRenderData(t,n))),(0,s.ed)(t)]));this._renderElements.set(e,n),this._uidToElement.set(e.uid,e),this._updatingHandles.addPromise(e.load().catch((()=>{}))),this._initializeRenderData(t,n)}_initializeRenderData(e,t){const{coords:n,element:i}=e,{contentWidth:r,contentHeight:s}=i;if(null==n||null==i.content)return void this._destroyRenderData(i,t);if(t.data)return;const o=this._createTexture(i.content),a=o.load(this.view.stage.renderView.renderingContext),u=()=>{if(!o.loaded)return;this.view.stage.addTexture(o);const e=new W.j({draped:!0,texture:o,opacity:i.opacity,perspectiveInterpolation:!0}),a=this._getPositionAttributeArray(n),l=this._getPerspectiveDivideAttributeArray(a,r,s),u=[0,1,2,0,2,3],c=new U.Z(e,[[N.T.POSITION,new H.a(a,u,3,!0)],[N.T.UV0,new H.a([0,0,1,0,1,1,0,1],u,2,!0)],[N.T.PERSPECTIVEDIVIDE,new H.a(l,u,1,!0)]]),h=new z.z(c,{layerViewUid:this.uid,graphicUid:i.uid});this._highlightedElements.get(i)?.forEach((e=>h.geometry.addHighlight(e))),this._renderer.addGeometries([h],j.T.ADD),t.data=new te(h,o,e),this.emit("element-render-changed",{element:i})};(0,l.y8)(a)?(t.data=o,this._updatingHandles.addPromise(a),a.then(u).catch((()=>o.dispose()))):u()}_updateGeometry(e,t){const{coords:n,element:i}=e;if(null==n||null==i.content)return void this._destroyRenderData(i,t);const r=t.getRenderData();if(!r)return;const s=this._getPositionAttributeArray(n);r.renderGeometry.geometry.setAttributeData(N.T.POSITION,s);const o=this._getPerspectiveDivideAttributeArray(s,i.contentWidth,i.contentHeight);r.renderGeometry.geometry.setAttributeData(N.T.PERSPECTIVEDIVIDE,o),r.renderGeometry.geometry.invalidateBoundingInfo(),this._renderer.modifyGeometries([r.renderGeometry],j.$.GEOMETRY),this.emit("element-render-changed",{element:i})}_getPositionAttributeArray(e){const[t,n,i,r]=e.rings[0];return[t[0],t[1],Z.gi,r[0],r[1],Z.gi,i[0],i[1],Z.gi,n[0],n[1],Z.gi]}_getPerspectiveDivideAttributeArray(e,t,n){(0,a.E)(Q,[0,0,t,0,t,n,0,n],[e[0],e[1],e[3],e[4],e[6],e[7],e[9],e[10]]);const i=Q[6]/Q[8]*t,r=Q[7]/Q[8]*n;return[1,1+i,1+i+r,1+r]}_destroyRenderData(e,t){const n=t.data;if(null==n)return;if(t.data=null,"dispose"in n)return void n.dispose();const i=n.texture;i.unload(),this.view.stage.removeTexture(i),this._renderer.removeGeometries([n.renderGeometry],j.T.REMOVE),this.emit("element-render-changed",{element:e})}_createTexture(e){const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,n=e instanceof HTMLImageElement?e.naturalHeight:e.height;if("getFrame"in e)throw new r.Z("media-layer-view-3d","animation is not supported");return new V.x(e,{wrap:{s:Y.e8.CLAMP_TO_EDGE,t:Y.e8.CLAMP_TO_EDGE},preMultiplyAlpha:!0,width:t,height:n,mipmap:!0,updateCallback:()=>this.view.basemapTerrain.overlayManager.requestRender()})}get test(){}};(0,i._)([(0,c.Cb)({readOnly:!0})],K.prototype,"type",void 0),(0,i._)([(0,c.Cb)()],K.prototype,"layer",void 0),(0,i._)([(0,c.Cb)()],K.prototype,"interactive",null),(0,i._)([(0,c.Cb)()],K.prototype,"selectedElement",null),(0,i._)([(0,c.Cb)({readOnly:!0})],K.prototype,"visibleAtCurrentScale",null),K=(0,i._)([(0,h.j)("esri.views.3d.layers.MediaLayerView3D")],K);const Q=(0,d.Ue)();class ee{constructor(e){this.handle=e}getRenderData(){return this.data&&"type"in this.data&&"RenderData"===this.data.type?this.data:null}}class te{constructor(e,t,n){this.renderGeometry=e,this.texture=t,this.material=n,this.type="RenderData"}}const ne=K},36121:function(e,t,n){n.d(t,{IM:function(){return a},VD:function(){return u},qj:function(){return o},tl:function(){return l},wp:function(){return s}});var i=n(52890),r=n(52061);const s=(0,i.U$)().vec3f(r.T.POSITION),o=(0,i.U$)().vec3f(r.T.POSITION).vec2f16(r.T.UV0),a=(0,i.U$)().vec3f(r.T.POSITION).vec4u8(r.T.COLOR),l=((0,i.U$)().vec3f(r.T.POSITION).vec2f16(r.T.UV0).vec4u8(r.T.OLIDCOLOR),(0,i.U$)().vec3f(r.T.POSITION).vec2f(r.T.UV0)),u=(0,i.U$)().vec3f(r.T.POSITION).vec2f(r.T.UV0).vec4u8(r.T.OLIDCOLOR)},3113:function(e,t,n){n.d(t,{j:function(){return D}});var i=n(81342),r=n(41044),s=n(32420),o=n(59797),a=n(71356),l=n(19596),u=n(61536),c=n(948),h=n(61719),d=n(52061),p=n(29296),f=n(36121),_=n(42266),y=n(92991),m=n(58257),v=n(29107),x=n(33610),g=n(26041),b=n(93191),w=n(51135);class T extends v.A{constructor(e,t){super(e,t,new m.J(b.I,(()=>n.e(67160).then(n.bind(n,67160)))),E)}_getPipelineState(e,t){const{oitPass:n,output:i,hasOccludees:s,cullFace:o}=e,a=n===x.M.NONE;return(0,w.sm)({blending:(0,r.c1)(i)?a?w.Zo:(0,u.j7)(n):null,culling:(0,w.zp)(o),depthTest:{func:(0,u.Bh)(n)},depthWrite:(0,u.W$)(e),drawBuffers:(0,u.u_)(n,i),colorWrite:w.gf,stencilWrite:s?g.s3:null,stencilTest:s?t?g.eD:g.RY:null,polygonOffset:(0,u.eZ)(e)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}}const E=new Map([[d.T.POSITION,0],[d.T.UV0,2],[d.T.PERSPECTIVEDIVIDE,3]]);var C=n(73440),I=n(31839),M=n(34479),P=n(83046),S=n(91041);class O extends S.W{constructor(e){super(),this.draped=e,this.cullFace=s.Vr.None,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=I.I.None,this.emissionSource=M.jo.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1,this.snowCover=!1}}(0,C._)([(0,P.o)({count:s.Vr.COUNT})],O.prototype,"cullFace",void 0),(0,C._)([(0,P.o)()],O.prototype,"enableOffset",void 0),(0,C._)([(0,P.o)()],O.prototype,"writeDepth",void 0),(0,C._)([(0,P.o)()],O.prototype,"hasOccludees",void 0),(0,C._)([(0,P.o)()],O.prototype,"terrainDepthTest",void 0),(0,C._)([(0,P.o)()],O.prototype,"cullAboveTerrain",void 0),(0,C._)([(0,P.o)()],O.prototype,"perspectiveInterpolation",void 0);class D extends _.c{constructor(e){super(e,L),this.vertexAttributeLocations=E,this.supportsEdges=!0,this.produces=new Map([[c.r.OPAQUE_MATERIAL,e=>(0,r.Gy)(e)],[c.r.TRANSPARENT_MATERIAL,e=>(0,r.D5)(e)&&this.parameters.writeDepth],[c.r.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,r.D5)(e)&&!this.parameters.writeDepth],[c.r.DRAPED_MATERIAL,e=>(0,r.D5)(e)||(0,r.Gy)(e)]]),this._configuration=new O(e.draped)}dispose(){this.setParameters({texture:void 0})}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<u.ve,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new A(e)}createBufferWriter(){let e=f.qj;return this.parameters.perspectiveInterpolation&&(e=e.clone().f32(d.T.PERSPECTIVEDIVIDE)),new R(e)}}class A extends o.Z{constructor(e){super({...e,...e.material.parameters}),this.parameters=e;const t=this._material.parameters.texture;(0,a.f)(t)&&e.textures.updater.add(t)}dispose(){this.parameters.textures.updater.remove(this._material.parameters.texture)}beginSlot(e){return this.getTechnique(T,e)}}class R extends p.G{write(e,t,n,r,s,o){for(const r of this.vertexBufferLayout.fields.keys()){const a=n.get(r);if(a)if(r===d.T.PERSPECTIVEDIVIDE){(0,h.hu)(1===a.size);const e=s.getField(r,i.ly);e&&(0,y.XW)(a,e,o)}else(0,y.i9)(r,a,e,t,s,o)}return null}}class L extends l.Mt{constructor(e,t){super(),this.texture=e,this.draped=t,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=s.Vr.None,this.opacity=1,this.perspectiveInterpolation=!1}get glTexture(){return this.texture.glTexture}}},42266:function(e,t,n){n.d(t,{c:function(){return o}});var i=n(82846),r=n(19596),s=n(87807);class o extends r.F5{constructor(){super(...arguments),this._pp0=(0,i.al)(0,0,1),this._pp1=(0,i.al)(0,0,0)}intersect(e,t,n,i,r,o){return(0,s.Bw)(e,n,i,r,void 0,o)}intersectDraped(e,t,n,i){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],(0,s.Bw)(e,t,this._pp0,this._pp1,void 0,i)}}},42888:function(e,t,n){n.d(t,{u:function(){return p}});var i=n(50702),r=n(94413),s=n(43254),o=n(83986),a=n(676),l=n(22590),u=n(81972);const c=s.Z.ofType(a.Z);var h=n(9217);const d=new Map;function p(e){if(!d.has(e)){const t=function(e,t){const n=(0,o.w)((()=>e.map?.allLayers),(e=>new a.Z({layer:e})),{recycleItems:!0,createCollection:()=>new c}),r=new u.Z({enabled:!0,selfEnabled:!1,featureEnabled:!0,featureSources:n,distance:t?.distance??l.c.distance,touchSensitivityMultiplier:t?.touchSensitivityMultiplier??l.c.touchSensitivityMultiplier});return{...(0,i.ed)(n),options:r}}(e,{distance:10}),n=function(e,t){return new h.N({view:e,options:t})}(e,t.options);d.set(e,{referenceCount:0,snappingManager:n,remove:()=>{t.remove(),n.destroy()}})}const t=d.get(e);t.referenceCount++;const n=(0,i.kB)((()=>{return n=e,(i=t).referenceCount--,void(i.referenceCount>0||(0,r.Y)((()=>{0===i.referenceCount&&(i.remove(),d.delete(n))})));var n,i}));return{snappingManager:t.snappingManager,...n}}},5527:function(e,t,n){n.d(t,{Z:function(){return f}});var i=n(73440),r=n(70880),s=n(87833),o=n(15894),a=n(96711),l=n(61100),u=n(76329),c=n(17155),h=(n(61432),n(83850),n(48023)),d=n(60147),p=n(27546);let f=class extends(o.Z.IdentifiableMixin(u.Z.EsriPromiseMixin(s.Z.EventedMixin(r.Z)))){get spatialReferenceSupported(){return!0}constructor(e){super(e),this._updatingHandles=new d.R,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",n=this.layer?.title||"no title";a.Z.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${n}', id: '${t}')`,e)}}))}destroy(){this._updatingHandles=(0,l.SC)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const e=this.view.timeExtent,t=this.layer?.visibilityTimeExtent;return!e||!t||!e.intersection(t).isEmpty}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&this.parent&&!this.parent.suspended&&this.view?.ready&&(0,p.Cy)(e)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const e=this.parent?.suspended?this.parent.suspendInfo:{};this.view?.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0);const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,p.Cy)(t)&&this.visibleAtCurrentScale||(e.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(e.outsideVisibilityTimeExtent=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"spatialReferenceSupported",null),(0,i._)([(0,c.Cb)()],f.prototype,"view",void 0),(0,i._)([(0,c.Cb)()],f.prototype,"fullOpacity",null),(0,i._)([(0,c.Cb)()],f.prototype,"layer",void 0),(0,i._)([(0,c.Cb)()],f.prototype,"parent",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"suspended",null),(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"suspendInfo",null),(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"legendEnabled",null),(0,i._)([(0,c.Cb)({type:Boolean,readOnly:!0})],f.prototype,"updating",null),(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"updatingProgress",null),(0,i._)([(0,c.Cb)()],f.prototype,"updateSuspended",null),(0,i._)([(0,c.Cb)()],f.prototype,"visible",null),(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"visibleAtCurrentScale",null),(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"visibleAtCurrentTimeExtent",null),f=(0,i._)([(0,h.j)("esri.views.layers.LayerView")],f)},54074:function(e,t,n){n.d(t,{A:function(){return a}});var i=n(73799),r=n(72575);const s=e=>({autoAreaByElevationMode(t,n,r=(0,i.ln)()){if("on-the-ground"===n){const n=e.geodesicArea(t);return null!=n?n:(0,i.X)(t,r)}return(0,i.oN)(t,r)},autoArea2D(e,t=(0,i.ln)()){return this.autoAreaByElevationMode(e,"on-the-ground",t)}});let o=null;async function a(){return o||(o=s(await(0,r.g)())),o}},8316:function(e,t,n){n.d(t,{U:function(){return o}});var i=n(82846),r=n(49510),s=n(55274);async function o(){return e=await(0,s.H)(),{autoLength2D:t=>e.geodesicLength(t)??(0,r.Sx)(t),autoDistanceBetweenPoints2D:(t,n)=>e.geodesicDistanceBetweenPoints(t,n)??(0,r.xI)(t,n),autoDistance2D:(t,n,i)=>(a[0]=t[0],a[1]=t[1],a[2]=3===t.length?t[2]:0,l[0]=n[0],l[1]=n[1],l[2]=3===n.length?n[2]:0,e.geodesicDistance(a,l,i)??(0,r.qj)(a,l,i))};var e}const a=(0,i.Ue)(),l=(0,i.Ue)()},73799:function(e,t,n){n.d(t,{X:function(){return p},bT:function(){return v},ln:function(){return m},oN:function(){return d}});var i=n(1925),r=n(26636),s=n(38874),o=n(24910),a=n(82846),l=n(2051),u=n(77773),c=n(79012),h=n(27250);function d(e,t={positionsWorldCoords:[]}){return f(e,t)}function p(e,t={positionsWorldCoords:[]}){return f(e,t,!1)}function f(e,t,n=e.hasZ){const s=(0,h.m)(e.spatialReference),d=(0,r.oq)(s);if(null==d)return null;const p=(e,t)=>!(t.length<2||((0,o.i)(e,t[0],t[1],n&&t[2]||0),0));let f=0;for(const n of e.rings){const i=n.length;if(i<3)continue;const{positionsWorldCoords:r}=t;for(;r.length<i;)r.push((0,a.Ue)());const h=_,d=(0,o.i)(y,0,0,0),m=1/i;for(let t=0;t<i;t++){if(!p(h,n[t]))return null;if(!(0,l.S)(h,e.spatialReference,r[t],s))return null;(0,o.b)(d,d,r[t],m)}const x=(0,u.zk)(r[0],r[1],d,(0,u.re)());if(0===(0,o.k)((0,u.st)(x)))continue;for(let e=0;e<i;e++)(0,u.tx)(x,d,r[e],r[e]);const g=v(r);for(let e=0;e<g.length;e+=3)f+=(0,c.wu)(r[g[e]],r[g[e+1]],r[g[e+2]])}return(0,i.ne)(f,d)}const _=(0,a.Ue)(),y=(0,a.Ue)();function m(){return{positionsWorldCoords:[]}}function v(e){return(0,s.e)(function(e){const t=new Float64Array(2*e.length);for(let n=0;n<e.length;++n){const i=e[n],r=2*n;t[r]=i[0],t[r+1]=i[1]}return t}(e),[],2)}},72575:function(e,t,n){n.d(t,{g:function(){return a}});var i=n(1925),r=n(95872),s=n(10618);const o=e=>({geodesicArea(t){const{spatialReference:n}=t;return(0,s.T5)(n,l,(t=>function(e,t){try{return(0,i.ne)(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch(e){return null}}(e,t)),t)}});async function a(){const e=await Promise.all([n.e(27093),n.e(13746)]).then(n.bind(n,13746));return o(e)}function l(e){return(0,i.ne)(Math.abs((0,r.p8)([e],"square-meters")[0]),"square-meters")}}}]);