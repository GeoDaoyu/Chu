"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[91351],{85886:function(e,t,n){var r;n.d(t,{E:function(){return r}}),function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"}(r||(r={}))},91351:function(e,t,n){n.r(t),n.d(t,{TextureCompressionWorkerOutput:function(){return C},compress:function(){return R},compressRGBADataToKTX2:function(){return A},createTextureDataKTX2:function(){return f},initializeBasisEncoder:function(){return B},initializeDXTEncoder:function(){return T}});var r=n(1800);let a;var s=n(85886);let i;var l=n(65650);let u,c,o=null,_=null;class C{constructor(e,t){this.internalFormat=e,this.compressedTexture=t}}async function R(e){let t;if(t=e.data instanceof ImageBitmap?function(e){const t=new OffscreenCanvas(e.width,e.height),n=t.getContext("2d");return n.drawImage(e,0,0),n.getImageData(0,0,t.width,t.height).data}(e.data):function(e,t,n,r,a){const s=new Uint8ClampedArray(e).subarray(0,t*n*r);if(!a)return s;const i=new Uint8ClampedArray(s.length),l=t*r;for(let e=0;e<n;e++){const t=e*l,r=(n-e-1)*l;i.set(s.subarray(t,t+l),r)}return i}(e.data,e.width,e.height,e.components,e.needsFlip),e.hasS3TC){_||await T();const n=new Uint8Array(t.length);if(_?.encode(t,e.width,e.height,e.preMultiplyAlpha,n)){const e=function(e,t){const n=new Int32Array(e.buffer,e.byteOffset,31);let r,a;switch(n[21]){case d:r=8,a=l.q_.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case p:r=16,a=l.q_.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case w:r=16,a=l.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}let s=1,i=n[4],u=n[3];(3&i||3&u)&&(i=i+3&-4,u=u+3&-4);const c=i,o=u;let _,C;n[2]&h&&!1!==t&&(s=Math.max(1,n[7]));let R=e.byteOffset+n[1]+4;const B=[];for(let t=0;t<s;++t)C=(i+3>>2)*(u+3>>2)*r,_=new Uint8Array(e.buffer,R,C),B.push(_),R+=C,i=Math.max(1,i>>1),u=Math.max(1,u>>1);return{textureData:{type:"compressed",levels:B},internalFormat:a,width:c,height:o}}(n,!0),t=[n.buffer];return{result:new C(e?.internalFormat??null,e?.textureData??null),transferList:t}}return{result:new C(null,null)}}if(e.hasETC){if(o||await B(),e.preMultiplyAlpha&&!_&&await T(),e.preMultiplyAlpha){const n=new Uint8ClampedArray(t.length);_?.premultiply(new Uint8Array(t),e.width,e.height,n),t=n}const n=await A(t,e.width,e.height,e.hasMipmap),r=n?await f(n):null,a=r?.compressedTexture?.levels.map((e=>e.buffer))||[];return{result:new C(r?.internalFormat??null,r?.compressedTexture??null),transferList:a}}return{result:new C(null,null)}}async function B(){o||(o=await(u??=(a??=(async()=>{const e=await n.e(60879).then(n.bind(n,60879)),t=await e.default({locateFile:e=>(0,r.V)(`esri/libs/basisu/${e}`)});return t.initializeBasis(),t})(),a)))}async function T(){_||(_=await(c??=(i??=(async()=>{const e=await n.e(3276).then(n.bind(n,3276));return await e.default({locateFile:e=>(0,r.V)(`esri/libs/dxtEncoder/${e}`)})})(),i)))}async function A(e,t,n,r,a=255,s=0,i=!1,l=!1){if(!o)return null;const u=new o.BasisEncoder;u.setPerceptual(!l),u.setCheckForAlpha(!0),u.setForceAlpha(!1),u.setRenormalize(l),u.setMipGen(r),u.setMipSRGB(!l),u.setCreateKTX2File(!0),u.setKTX2SRGBTransferFunc(!l),u.setQualityLevel(a),u.setCompressionLevel(s);const c=new Uint8Array(e.byteLength);u.setSliceSourceImage(0,new Uint8Array(e),t,n,i);const _=u.encode(c),C=new Uint8Array(c.buffer,0,_),R=new o.KTX2File(new Uint8Array(C));return R.isValid()?(u.delete(),C):(R.close(),R.delete(),u.delete(),null)}async function f(e){if(!o)return new C(null,null);const t=new o.KTX2File(new Uint8Array(e));t.startTranscoding();const[n,r]=t.getHasAlpha()?[s.E.ETC2_RGBA,l.q_.COMPRESSED_RGBA8_ETC2_EAC]:[s.E.ETC1_RGB,l.q_.COMPRESSED_RGB8_ETC2],a=t.getLevels(),i=[];for(let e=0;e<a;e++)i.push(new Uint8Array(t.getImageTranscodedSizeInBytes(e,0,0,n))),t.transcodeImage(i[e],e,0,0,n,0,-1,-1);return t.close(),t.delete(),{internalFormat:r,compressedTexture:{type:"compressed",levels:i}}}const h=131072;function G(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const d=G("DXT1"),p=G("DXT3"),w=G("DXT5")}}]);