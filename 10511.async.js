"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[10511,71618],{90757:function(e,t,n){function i(e,t,n){return{objectId:e,target:t,distance:n,type:"vertex"}}function r(e,t,n,i,r,o=!1){return{objectId:e,target:t,distance:n,type:"edge",start:i,end:r,draped:o}}n.d(t,{p:function(){return r},u:function(){return i}})},56216:function(e,t,n){n.d(t,{Kb:function(){return a},o2:function(){return c},sV:function(){return l},xn:function(){return s}});var i=n(53147),r=n(47747),o=n(71618);function a(e,t){const n=function(e,t){if(null!=e.symbol)return e.symbol;const n=t?.renderer;return null!=n&&"dot-density"!==n.type?n.getSymbol(e,t):null}(e,t);if(null==n)return null;const i=t?.renderer,a=new r.E(i,n);if(null==i||!("visualVariables"in i)||!i.visualVariables)return a;const s=(0,o.getVisualVariableValues)(i,e,t)??[],l=["proportional","proportional","proportional"];for(const{variable:e,value:t}of s)if(null!=t||"size"===e.type&&e.useSymbolValue)switch(e.type){case"color":a.color=t?.toRgba();break;case"size":if("outline"===e.target)a.outlineSize=t;else{const n=e.axis,i=e.useSymbolValue?"symbol-value":t??"proportional";switch(n){case"width":l[0]=i;break;case"depth":l[1]=i;break;case"height":l[2]=i;break;case"width-and-depth":l[0]=l[1]=i;break;default:l[0]=l[1]=l[2]=i}}break;case"opacity":a.opacity=t;break;case"rotation":switch(e.axis){case"tilt":a.tilt=t;break;case"roll":a.roll=t;break;default:a.heading=t}}return"proportional"===l[0]&&"proportional"===l[1]&&"proportional"===l[2]||(a.size=l),a}async function s(e,t){const n=await async function(e,t){return null!=e.symbol?e.symbol:t?.renderer?.getSymbolAsync(e,t)??null}(e,t);if(!n)return null;const a=t?.renderer,s=new r.E(a,n);if(!a||!("visualVariables"in a)||!a.visualVariables)return s;const l=(0,o.getVisualVariableValues)(a,e,t)??[],c=["proportional","proportional","proportional"];for(const{variable:e,value:t}of l)if("color"===e.type)s.color=i.Z.toUnitRGBA(t);else if("size"===e.type)if("outline"===e.target)s.outlineSize=t;else{const n=e.axis,i=e.useSymbolValue?"symbol-value":t;"width"===n?c[0]=i:"depth"===n?c[1]=i:"height"===n?c[2]=i:c[0]=c[1]="width-and-depth"===n?i:c[2]=i}else"opacity"===e.type?s.opacity=t:"rotation"===e.type&&"tilt"===e.axis?s.tilt=t:"rotation"===e.type&&"roll"===e.axis?s.roll=t:"rotation"===e.type&&(s.heading=t);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(s.size=c),s}function l(e,t=0){const n=e[t];return"number"==typeof n&&isFinite(n)?n:null}function c(e){for(let t=0;t<3;t++){const n=e[t];if("number"==typeof n)return isFinite(n)?n:0}return 0}},18881:function(e,t,n){var i,r;function o(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function a(e){return null!=e&&!isNaN(e)&&isFinite(e)}function s(e){return e.valueExpression?i.Expression:e.field&&"string"==typeof e.field?i.Field:i.Unknown}function l(e,t){const n=t||s(e),o=e.valueUnit||"unknown";return n===i.Unknown?r.Constant:e.stops?r.Stops:null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?r.ClampedLinear:"unknown"===o?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?r.Proportional:r.Additive:r.Identity:r.RealWorldSize}n.d(t,{PS:function(){return s},QW:function(){return l},RY:function(){return i},hL:function(){return r},iY:function(){return o},qh:function(){return a}}),function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"}(i||(i={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(r||(r={}))},71618:function(e,t,n){n.r(t),n.d(t,{getAllSizes:function(){return z},getColor:function(){return g},getOpacity:function(){return b},getRotationAngle:function(){return m},getSize:function(){return y},getSizeForValue:function(){return x},getSizeFromNumberOrVariable:function(){return v},getSizeRangeAtScale:function(){return V},getVisualVariableValues:function(){return w},viewScaleRE:function(){return f}});var i=n(53147),r=n(46451),o=n(79487),a=n(96711),s=n(4207),l=n(18881);const c=()=>a.Z.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),u=e=>c().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),p=()=>c().error("Use of arcade expressions requires an arcade context"),d=new r.Z,h=Math.PI,f=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function g(e,t,n){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!r)return;if("esri.renderers.visualVariables.ColorVariable"!==r.declaredClass)return void u("ColorVariable");const o="number"==typeof t,a=o?null:t,s=a?.attributes;let c=o?t:null;const d=r.field,{ipData:h,hasExpression:f}=r.cache;let g=r.cache.compiledFunc;if(!d&&!f){const e=r.stops;return e&&e[0]&&e[0].color}if("number"!=typeof c)if(f){if(null==n?.arcade)return void p();const e={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},t=n.arcade.arcadeUtils,i=t.getViewInfo(e),o=t.createExecContext(a,i,n.timeZone);if(!g){const e=t.createSyntaxTree(r.valueExpression);g=t.createFunction(e),r.cache.compiledFunc=g}c=t.executeFunction(g,o)}else s&&(c=s[d]);const b=r.normalizationField,m=null!=s&&null!=b?parseFloat(s[b]):void 0;if(null!=c&&(!b||o||!isNaN(m)&&0!==m)){(0,l.qh)(m)&&!o&&(c/=m);const e=E(c,h);if(e){const t=e[0],o=e[1],a=t===o?r.stops[t].color:i.Z.blendColors(r.stops[t].color,r.stops[o].color,e[2],null!=n?n.color:void 0);return new i.Z(a)}}}function b(e,t,n){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.OpacityVariable"!==i.declaredClass)return void u("OpacityVariable");const r="number"==typeof t,o=r?null:t,a=o?.attributes;let s=r?t:null;const c=i.field,{ipData:d,hasExpression:h}=i.cache;let f=i.cache.compiledFunc;if(!c&&!h){const e=i.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof s)if(h){if(null==n?.arcade)return void p();const e={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},t=n.arcade.arcadeUtils,r=t.getViewInfo(e),a=t.createExecContext(o,r,n.timeZone);if(!f){const e=t.createSyntaxTree(i.valueExpression);f=t.createFunction(e),i.cache.compiledFunc=f}s=t.executeFunction(f,a)}else a&&(s=a[c]);const g=i.normalizationField,b=null!=a&&null!=g?parseFloat(a[g]):void 0;if(null!=s&&(!g||r||!isNaN(b)&&0!==b)){(0,l.qh)(b)&&!r&&(s/=b);const e=E(s,d);if(e){const t=e[0],n=e[1];if(t===n)return i.stops[t].opacity;{const r=i.stops[t].opacity;return r+(i.stops[n].opacity-r)*e[2]}}}}function m(e,t,n){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.RotationVariable"!==i.declaredClass)return void u("RotationVariable");const r=i.axis||"heading",o="heading"===r&&"arithmetic"===i.rotationType?90:0,a="heading"===r&&"arithmetic"===i.rotationType?-1:1,s="number"==typeof t?null:t,l=s?.attributes,c=i.field,{hasExpression:d}=i.cache;let h=i.cache.compiledFunc,f=null;if(!c&&!d)return f;if(d){if(null==n?.arcade)return void p();const e={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},t=n.arcade.arcadeUtils,r=t.getViewInfo(e),o=t.createExecContext(s,r,n.timeZone);if(!h){const e=t.createSyntaxTree(i.valueExpression);h=t.createFunction(e),i.cache.compiledFunc=h}f=t.executeFunction(h,o)}else l&&(f=l[c]);return f="number"!=typeof f||isNaN(f)?null:o+a*f,f}function y(e,t,n){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.SizeVariable"!==i.declaredClass)return void u("SizeVariable");const r=x(function(e,t,n){const i="number"==typeof t,r=i?null:t,o=r?.attributes;let a=i?t:null;const{isScaleDriven:s}=e.cache;let c=e.cache.compiledFunc;if(s){const t=null!=n?n.scale:void 0,i=null!=n?n.view:void 0;a=null==t||"3d"===i?function(e){let t=null,n=null;const i=e.stops;return i?(t=i[0].value,n=i[i.length-1].value):(t=e.minDataValue||0,n=e.maxDataValue||0),(t+n)/2}(e):t}else if(!i)switch(e.inputValueType){case l.RY.Expression:{if(null==n?.arcade)return void p();const t={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},i=n.arcade.arcadeUtils,o=i.getViewInfo(t),s=i.createExecContext(r,o,n.timeZone);if(!c){const t=i.createSyntaxTree(e.valueExpression);c=i.createFunction(t),e.cache.compiledFunc=c}a=i.executeFunction(c,s);break}case l.RY.Field:o&&(a=o[e.field]);break;case l.RY.Unknown:a=null}if(!(0,l.qh)(a))return null;if(i||!e.normalizationField)return a;const u=o?parseFloat(o[e.normalizationField]):null;return(0,l.qh)(u)&&0!==u?a/u:null}(i,t,n),i,t,n,i.cache.ipData);return null==r||isNaN(r)?void 0:r}function v(e,t,n){return null==e?null:(0,l.iY)(e)?y(e,t,n):(0,l.qh)(e)?e:null}function S(e,t,n){return(0,l.qh)(n)&&e>n?n:(0,l.qh)(t)&&e<t?t:e}function x(e,t,n,i,r){switch(t.transformationType){case l.hL.Additive:return function(e,t,n,i){const r=v(t.minSize,n,i)||t.minDataValue;return null==e&&null==r?null:(e??0)+(r??0)}(e,t,n,i);case l.hL.Constant:return function(e,t,n){const i=e.stops;let r=i?.length&&i[0].size;return null==r&&(r=e.minSize),v(r,t,n)}(t,n,i);case l.hL.ClampedLinear:return function(e,t,n,i){const r=v(t.minSize,n,i);if(null==e)return r;const{minDataValue:o,maxDataValue:a}=t;if(null==o||null==a)return null;const s=(e-o)/(a-o),l=v(t.maxSize,n,i),c=null!=i?i.shape:void 0;if(e<=o)return r;if(e>=a)return l;if(null==r||null==l)return null;if("area"===t.scaleBy&&c){const e="circle"===c,t=e?h*(r/2)**2:r*r,n=t+s*((e?h*(l/2)**2:l*l)-t);return e?2*Math.sqrt(n/h):Math.sqrt(n)}return r+s*(l-r)}(e,t,n,i);case l.hL.Proportional:return function(e,t,n,i){const r=v(t.minSize,n,i);if(null==e||null==r)return r;const o=null!=i?i.shape:void 0,{minDataValue:a}=t;if(null==a)return null;const s=e/a,l=v(t.maxSize,n,i);let c=null;return c="circle"===o?2*Math.sqrt(s*(r/2)**2):"square"===o||"diamond"===o||"image"===o?Math.sqrt(s*r**2):s*r,S(c,r,l)}(e,t,n,i);case l.hL.Stops:return function(e,t,n,i,r){if(null==e)return null;const[o,a,s]=E(e,r);if(o===a)return v(t.stops?.[o].size,n,i);{const e=v(t.stops?.[o].size,n,i),r=v(t.stops?.[a].size,n,i);return null==e||null==r?null:e+(r-e)*s}}(e,t,n,i,r);case l.hL.RealWorldSize:return function(e,t,n,i){const r=(i?.resolution??1)*s.a[t.valueUnit],o=v(t.minSize,n,i),a=v(t.maxSize,n,i),{valueRepresentation:l}=t;if(null==e)return o;let c=null;return c="area"===l?2*Math.sqrt(e/h)/r:"radius"===l||"distance"===l?2*e/r:e/r,S(c,o,a)}(e,t,n,i);case l.hL.Identity:return e;case l.hL.Unknown:return null}}function V(e,t,n){const{isScaleDriven:i}=e.cache;if(!(i&&"3d"===n||t))return null;const r={scale:t,view:n};let o=v(e.minSize,d,r),a=v(e.maxSize,d,r);if(null!=o||null!=a){if(o>a){const e=a;a=o,o=e}return{minSize:o,maxSize:a}}}function w(e,t,n){if(!e.visualVariables)return;const i=[],r=[],o=[],a=[],s=[];for(const t of e.visualVariables)switch(t.type){case"color":r.push(t);break;case"opacity":o.push(t);break;case"rotation":s.push(t);break;case"size":a.push(t)}return r.forEach((e=>{const r=g(e,t,n);i.push({variable:e,value:r})})),o.forEach((e=>{const r=b(e,t,n);i.push({variable:e,value:r})})),s.forEach((e=>{const r=m(e,t,n);i.push({variable:e,value:r})})),a.forEach((e=>{const r=y(e,t,n);i.push({variable:e,value:r})})),i}function E(e,t){if(!t)return;let n=0,i=t.length-1;return t.some(((t,r)=>e<t?(i=r,!0):(n=r,!1))),[n,i,(e-t[n])/(t[i]-t[n])]}function z(e,t,n){const i=["proportional","proportional","proportional"];for(const r of e){const e=r.useSymbolValue?"symbol-value":y(r,t,n)??"proportional";switch(r.axis){case"width":i[0]=e;break;case"depth":i[1]=e;break;case"height":i[2]=e;break;case"width-and-depth":i[0]=e,i[1]=e;break;case"all":case void 0:case null:i[0]=e,i[1]=e,i[2]=e;break;default:(0,o.Bg)(r.axis)}}return i}},25276:function(e,t,n){n.d(t,{A:function(){return H},m:function(){return j}});var i=n(53147),r=(n(61432),n(88194)),o=n(28947),a=n(26636),s=n(38874),l=n(96373),c=n(30748),u=n(31865),p=n(10934),d=n(24910),h=n(82846),f=n(27583),g=n(74238),b=n(16447),m=n(60199),y=n(38766),v=n(2875),S=n(90757),x=n(56216),V=n(88331),w=n(56172),E=n(90210),z=n(63082),_=n(33474),C=n(36027),R=n(80606),I=n(67169),P=n(80300),U=n(27762),O=n(90494),L=n(59894),M=n(57716),T=n(81749),F=n(32420),A=n(25952),D=n(95786),k=n(72913),N=n(26475),B=n(52061),Z=n(35720),q=n(52964);const G=["polygon","extent"];class j extends _.k{constructor(e,t,n,i){super(e,t,n,i,function(e){return 1===(e.material?.color?.a??1)}(t)),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=(0,C.bh)(this._getSymbolSize());if(e)throw new r.Z("graphics3dextrudesymbollayer:invalid-size",e)}const e=this.symbolLayer,t=e?.material,n=t?.color,i=this._getCombinedOpacityAndColor(n),o=(0,h.nI)(i),a=i[3],s=this.needsDrivenTransparentPass,l=t?.emissive,c={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:o,ambient:o,opacity:a,drivenOpacity:s,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:e.castShadows,emissiveStrength:l?.strength??0,emissiveSource:V.V6.Color,offsetTransparentBackfaces:!0,normalType:M.r.Compressed},u=new Z.Gp(c,this._context);u.setParameters({cullFace:u.transparent?F.Vr.None:F.Vr.Back});const p=new Z.Gp({...c,cullFace:F.Vr.Back},this._context);this._materials[ge.Main]=u,this._materials[ge.Bottom]=p}destroy(){super.destroy(),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,G,this.symbolLayer.type))return null;const n=this._getVertexOpacityAndColor(e.renderingInfo,this._getFallbackOpacityAndColor(),255),i=this.setGraphicElevationContext(t);return this._createAs3DShape(t,e.renderingInfo,n,i,t.uid)}layerOpacityChanged(e,t){const n=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(n);this._materials[ge.Main]?.setParameters({opacity:i}),this._materials[ge.Bottom]?.setParameters({opacity:i});const r=this._getLayerOpacity();e?.forEach((e=>t(e)?.layerOpacityChanged(r,this._context.isAsync)))}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,E.B5)}slicePlaneEnabledChanged(e,t){return this._materials[ge.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[ge.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e?.forEach((e=>{const n=t(e);null!=n&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[ge.Main]?.setParameters(e),this._materials[ge.Bottom]?.setParameters(e),!0}_getExtrusionSize(e){let t;return t=e.size&&this._drivenProperties.size?(0,x.sV)(e.size,2)??0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters,t}applyRendererDiff(e,t){return this._drivenPropertiesChanged(t)?R.W.RecreateSymbol:R.W.RecreateGraphics}async queryForSnapping(e,t,n,i){const r=this._getExtrusionSize(n)*this._context.renderCoordsHelper.unitInMeters/(0,a._R)(t),{objectId:s,target:l}=e,c=(0,o.d9)(l);switch(c.z=(c.z??0)+r,e.type){case"edge":{const{start:t,end:n}=e,i=(0,o.d9)(t),a=(0,o.d9)(n);return i.z=(i.z??0)+r,a.z=(a.z??0)+r,[(0,S.p)(s,c,1/0,i,a)]}case"vertex":return[(0,S.u)(s,c,1/0),(0,S.p)(s,l,1/0,l,c)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,t,n,i,r){const o=(0,I.Nu)(e.geometry);if(null==o)return null;if(0===o.rings.length||!o.rings.some((e=>e.length>0)))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=(0,L.VP)(o,this._context.elevationProvider,this._context.renderCoordsHelper,i);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const f=(0,C.zE)(o);if(null==f)return null;const S=new Array,x=new Array,V=(0,b.Ue)(),_=(0,p.Ue)(),R=(0,h.Ue)(),M=this._context.renderCoordsHelper.viewingMode===w.JY.Global;M||this._context.renderCoordsHelper.worldUpAtPosition(null,R),(0,g.B)(o.spatialReference,[f.x,f.y,0],_,this._context.renderCoordsHelper.spatialReference);const T=(0,p.Ue)();(0,u.U_)(T,_);const F=(0,c.Ue)();(0,l.XL)(F,T);const{polygons:A,mapPositions:Z,position:q}=a,G=new Map,j=this._materials[ge.Main];for(const e of A){const i=e.count;if(this._context.clippingExtent&&((0,b.FY)(e.mapPositions,V),!(0,b.Zp)(V,this._context.clippingExtent)))continue;const o=(0,s.e)(e.mapPositions,e.holeIndices,3);if(0===o.length)continue;const a=o.length,l=6*i,c=(0,y.$z)(l+a),u=(0,y.$z)(a),p=(0,m.bg)(3*l),d=(0,m.bg)(3*l),h=(0,m.bg)(3*l),f=(0,m.bg)(l);H(q,Z,o,e,p,h,d,f,c,u,this._getExtrusionSize(t),R,M),(0,v.t)(p,p,T);const g=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerViewUid:this._context.layerViewUid}),w=new me(p,h,(0,k.nG)(d),f),E=W(j,c,c.length-u.length,w,n,g),z=i,C=i,I=2*e.count,P=new ye(z,C,I,a/3);re(E,P,_),G.set(E,P),S.push(E,W(this._materials[ge.Bottom],u,0,w,n,g)),x.push(w.heights)}if(0===S.length)return null;const Y=new N.T({geometries:S,layerViewUid:this._context.layerViewUid,graphicUid:r,isElevationSource:!0});Y.transformation=_;const $=(0,P.hM)(this.symbolLayer,{opacity:this._getLayerOpacity()}),J=$?new z.n(this._materials[ge.Main],$,this._context.slicePlaneEnabled):null,K=new z.z(this,Y,null,((e,t,n,i,r)=>function(e,t,n,i,r,o,a){const s=e.stageObject,l=s.geometries,c=l.length,h="absolute-height"!==t.mode;let f=0;const g=s.transformation,b=(0,u.iS)((0,p.Ue)(),g);for(let e=0;e<c;e+=2){const t=l[e];if(!(0,D.T)(t))continue;const c=t.getMutableAttribute(B.T.POSITION).data,u=o[e/2],p=new O.sb(t.mapPositions),m=c.length/3;let y=!1,v=0;{let e=0;for(let t=0;t<m;t++){ie[0]=c[e],ie[1]=c[e+1],ie[2]=c[e+2],i(p,se),h&&(v+=se.sampledElevation),U.h.TESTS_DISABLE_OPTIMIZATIONS?((0,d.i)(oe,p.array[p.offset],p.array[p.offset+1],se.z+u[e/3]),null!=n&&r.toRenderCoords(oe,n,oe),(0,d.t)(oe,oe,b)):((0,d.i)(oe,c[e],c[e+1],c[e+2]),(0,d.t)(oe,oe,g),r.setAltitude(oe,se.z+u[e/3]),(0,d.t)(oe,oe,b)),c[e]=oe[0],c[e+1]=oe[1],c[e+2]=oe[2];const t=ue/r.unitInMeters;(Math.abs(ie[0]-c[e])>=t||Math.abs(ie[1]-c[e+1])>=t||Math.abs(ie[2]-c[e+2])>=t)&&(y=!0),p.offset+=3,e+=3}}if(y){const n=a.get(t);n&&re(t,n,g),s.geometryVertexAttributeUpdated(l[e],B.T.NORMALCOMPRESSED),t.invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(l[e],B.T.POSITION),l[e+1].invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(l[e+1],B.T.POSITION)}f+=v/m}return f/c}(e,t,n,i,r,x,G)),i,J);return K.alignedSampledElevation=a.sampledElevation,K.needsElevationUpdates=(0,E.B5)(i.mode),K}_getFallbackOpacityAndColor(){const e=this.symbolLayer?.material?.color;return i.Z.toUnitRGBA(e)??f.AG}}function W(e,t,n,i,r,o){const a=(0,y.LE)(t.length),s=[[B.T.POSITION,new T.a(i.positions,t,3,!0)],[B.T.NORMALCOMPRESSED,new T.a(i.normals,t,2,!0)],[B.T.COLOR,new T.a(r,a,4,!0)]];return new A.Z(e,s,i.elevation,q.V.Mesh,o,n)}function H(e,t,n,i,r,o,a,s,l,c,u,p,h){const f=n.length/3;let g=2*i.count;!function(e,t,n,i,r,o,a,s,l,c,u,p,h,f,g,b,m){(0,d.c)(ae,b),l??=[],c??=[],u??=[];const y=g>0?1:-1;let v=3*n,S=0,x=3*S,V=i,w=3*V;for(let n=0;n<i;++n){const n=e[v],i=e[v+1],r=e[v+2];m&&(ae[0]=n,ae[1]=i,ae[2]=r,(0,d.n)(ae,ae)),s[x+0]=n,s[x+1]=i,s[x+2]=r;const o=t[v+0],a=t[v+1],p=t[v+2];l[x+0]=o,l[x+1]=a,l[x+2]=p,c[x+0]=-y*ae[0],c[x+1]=-y*ae[1],c[x+2]=-y*ae[2],u[S]=0,s[w+0]=n+g*ae[0],s[w+1]=i+g*ae[1],s[w+2]=r+g*ae[2],l[w+0]=o,l[w+1]=a,l[w+2]=p,u[V]=g,x+=3,w+=3,v+=3,S+=1,V+=1}v=3*o,x=0,w=3*f;const E=g<0?ce:le,z=g<0?le:ce;for(let e=0;e<a;++e)h[x]=r[v+E[0]],h[x+1]=r[v+E[1]],h[x+2]=r[v+E[2]],p[w]=r[v+z[0]]+i,p[w+1]=r[v+z[1]]+i,p[w+2]=r[v+z[2]]+i,x+=3,w+=3,v+=3}(e,t,i.index,i.count,n,0,f,r,o,a,s,l,c,g,u,p,h);let b=0,m=2*i.count;g=0;const y=i.pathLengths[0];J(r,o,s,a,b,y,i.count,m,l,g,u),m+=4*y,g+=2*y,b+=y;for(let e=1;e<i.pathLengths.length;++e){const t=i.pathLengths[e];J(r,o,s,a,b,t,i.count,m,l,g,u),m+=4*t,g+=2*t,b+=t}}function Y(e,t,n,i,r,o,a){i[o]=i[a],a*=3,e[o*=3]=e[a],e[o+1]=e[a+1],e[o+2]=e[a+2],t[o]=t[a],t[o+1]=t[a+1],t[o+2]=t[a+2],n[o]=r[0],n[o+1]=r[1],n[o+2]=r[2]}const $=(0,h.Ue)();function J(e,t,n,i,r,o,a,s,l,c,u){t??=[],n??=[],i??=[];let p=r,d=r+1,h=r+a,f=r+a+1,g=s,b=s+1,m=s+2*o,y=s+2*o+1;u<0&&(p=r+a+1,f=r);let v=3*c;for(let s=0;s<o;++s)s===o-1&&(d=r,u>0?f=r+a:p=r+a),ne(e,p,d,h,$),Y(e,t,i,n,$,g,p),Y(e,t,i,n,$,b,d),Y(e,t,i,n,$,m,h),Y(e,t,i,n,$,y,f),l[v]=g,l[v+1]=m,l[v+2]=y,l[v+3]=g,l[v+4]=y,l[v+5]=b,v+=6,p++,d++,h++,f++,g+=2,b+=2,m+=2,y+=2}const K=(0,h.Ue)(),Q=(0,h.Ue)(),X=(0,h.Ue)(),ee=(0,h.Ue)(),te=(0,h.Ue)();function ne(e,t,n,i,r){t*=3,n*=3,i*=3,(0,d.i)(K,e[t++],e[t++],e[t++]),(0,d.i)(Q,e[n++],e[n++],e[n++]),(0,d.i)(X,e[i++],e[i++],e[i++]),(0,d.d)(ee,Q,K),(0,d.d)(te,X,K),(0,d.h)(r,te,ee),(0,d.n)(r,r)}const ie=(0,h.Ue)();function re(e,t,n){const i=e.getMutableAttribute(B.T.POSITION),r=e.getMutableAttribute(B.T.NORMALCOMPRESSED).data,{topVertexStart:o,topVertexCount:a,topFaceStart:s,topFaceCount:l}=t,c=i.data,u=a,p=e.attributes.get(B.T.POSITION).indices,h=s+l,f=o+a,g=(0,m.bg)(3*u);for(let e=0;e<u;++e){const t=3*e;g[t+0]=0,g[t+1]=0,g[t+2]=0}const b=pe,y=de,v=he,S=fe,x=ae;for(let e=s;e<h;++e){const t=3*e;for(let e=0;e<3;++e){const i=p[t+e];S[e]=i;const r=3*i;(0,d.i)(oe,c[r+0],c[r+1],c[r+2]),(0,d.t)(b[e],oe,n)}(0,d.a)(y,b[1],b[0]),(0,d.a)(v,b[2],b[0]),(0,d.h)(x,y,v),(0,d.n)(x,x);for(let e=0;e<3;++e){const t=3*(S[e]-o);g[t+0]+=x[0],g[t+1]+=x[1],g[t+2]+=x[2]}}for(let e=o;e<f;++e){const t=3*(e-o),n=g[t+0],i=g[t+1],a=g[t+2],s=Math.sqrt(n*n+i*i+a*a);(0,k.hd)(r,e,n/s,i/s,a/s)}}const oe=(0,h.Ue)(),ae=(0,h.Ue)(),se=new E.Lm,le=[0,2,1],ce=[0,1,2],ue=.01,pe=[(0,h.Ue)(),(0,h.Ue)(),(0,h.Ue)()],de=(0,h.Ue)(),he=(0,h.Ue)(),fe=[0,0,0];var ge,be;(be=ge||(ge={}))[be.Main=0]="Main",be[be.Bottom=1]="Bottom";class me{constructor(e,t,n,i){this.positions=e,this.elevation=t,this.normals=n,this.heights=i}}class ye{constructor(e,t,n,i){this.topVertexStart=e,this.topVertexCount=t,this.topFaceStart=n,this.topFaceCount=i}}},67169:function(e,t,n){n.d(t,{JJ:function(){return m},LN:function(){return h},Nu:function(){return b},dd:function(){return g},z:function(){return f}});var i=n(38874),r=n(71354),o=n(67764),a=n(93070),s=n(38766),l=n(18344),c=n(81749),u=n(25952),p=n(52061),d=n(52964);function h(e,t,n){const r=(t.length>0?t[0]:e.length/3)-1,o=(0,l.i)(e,r,n);if(o!==a.R.Z){e=e.slice();for(let t=0;t<e.length;t+=3)e[t+o]=e[t+2]}return(0,i.e)(e,t,3)}function f(e){const t=[[p.T.POSITION,new c.a(e.attributeData.position,e.indices,3,!0)]],n=(0,s.LE)(e.indices.length);return null!=e.attributeData.colorFeature?t.push([p.T.COLORFEATUREATTRIBUTE,new c.a([e.attributeData.colorFeature],n,1,!0)]):e.attributeData.color&&t.push([p.T.COLOR,new c.a(e.attributeData.color,n,4,!0)]),e.attributeData.uvMapSpace&&t.push([p.T.UVMAPSPACE,new c.a(e.attributeData.uvMapSpace,e.indices,4,!0)]),e.attributeData.boundingRect&&t.push([p.T.BOUNDINGRECT,new c.a(e.attributeData.boundingRect,e.indices,9,!0)]),new u.Z(e.material,t,e.mapPositions,d.V.Mesh,e.attributeData.objectAndLayerIdColor)}function g(e,t=null){const n=[[p.T.POSITION,new c.a(e.attributeData.position,e.indices,3,!0)],[p.T.UV0,new c.a(e.attributeData.uv0,e.indices,2,!0)]];return new u.Z(e.material,n,e.mapPositions,d.V.Mesh,t)}function b(e){switch(e.type){case"extent":if(e instanceof r.Z)return o.Z.fromExtent(e);break;case"polygon":return e}return null}class m{constructor(e,t,n){this.renderData=e,this.layerViewUid=t,this.graphicUid=n,this.outGeometries=new Array}}},61324:function(e,t,n){n.d(t,{V:function(){return l},r:function(){return c}});var i=n(30146),r=n(60199),o=n(53328),a=n(90210),s=n(61471);function l(e,t,n,i){const s="polygon"===e.type?o.ZI.CCW_IS_HOLE:o.ZI.NONE,l="polygon"===e.type?e.rings:e.paths,{position:c,outlines:p}=(0,o.Ni)(l,!!e.hasZ,s,e.spatialReference),d=(0,r.bg)(c.length),h=(0,a.rR)(c,e.spatialReference,0,d,0,c,0,c.length/3,t,n,i),f=null!=h;return{lines:f?u(p,c,d):[],projectionSuccess:f,sampledElevation:h}}function c(e,t){const n="polygon"===e.type?o.ZI.CCW_IS_HOLE:o.ZI.NONE,r="polygon"===e.type?e.rings:e.paths,{position:a,outlines:l}=(0,o.Ni)(r,!1,n),c=(0,i.projectBuffer)(a,e.spatialReference,0,a,t,0);for(let e=2;e<a.length;e+=3)a[e]=s.gi;return{lines:c?u(l,a):[],projectionSuccess:c}}function u(e,t,n=null){const i=new Array;for(const{index:o,count:a}of e){if(a<=1)continue;const e=3*o,s=3*a;i.push({position:(0,r.Rq)(t,3*o,3*a),mapPositions:null!=n?(0,r.Rq)(n,e,s):void 0})}return i}},59894:function(e,t,n){n.d(t,{VP:function(){return l},rm:function(){return c}});var i=n(30146),r=n(60199),o=n(53328),a=n(90210),s=n(61471);function l(e,t,n,i){const s=(0,o.Ni)(e.rings,!!e.hasZ&&"on-the-ground"!==i.mode,o.ZI.CCW_IS_HOLE,e.spatialReference),l=(0,r.bg)(s.position.length),c=(0,a.rR)(s.position,e.spatialReference,0,l,0,s.position,0,s.position.length/3,t,n,i),d=null!=c;return new b(s.position,l,p(s.polygons,s.position,l),u(s.outlines,s.position,l),d,c)}function c(e,t){const n=(0,o.Ni)(e.rings,!1,o.ZI.CCW_IS_HOLE),r=(0,i.projectBuffer)(n.position,e.spatialReference,0,n.position,t,0);for(let e=2;e<n.position.length;e+=3)n.position[e]=s.gi;return{position:n.position,polygons:p(n.polygons,n.position),outlines:u(n.outlines,n.position),projectionSuccess:r}}function u(e,t,n=null){return e.filter((({count:e})=>e>1)).map((({index:e,count:i})=>{const o=3*e,a=3*i;return null!=n?new h(e,i,(0,r.Rq)(t,o,a),(0,r.Rq)(n,o,a)):new d(e,i,(0,r.Rq)(t,o,a))}))}function p(e,t,n=null){const i=new Array;for(const{index:o,count:a,holeIndices:s,pathLengths:l}of e){if(a<=1)continue;const e=3*o,c=3*a,u=s.map((e=>e-o)),p=null!=n?new f(o,a,(0,r.Rq)(t,3*o,3*a),(0,r.Rq)(n,e,c),u,l):new g(o,a,(0,r.Rq)(t,3*o,3*a),u,l);i.push(p)}return i}class d{constructor(e,t,n){this.index=e,this.count=t,this.position=n}}class h extends d{constructor(e,t,n,i){super(e,t,n),this.mapPositions=i}}class f extends h{constructor(e,t,n,i,r,o){super(e,t,n,i),this.holeIndices=r,this.pathLengths=o}}class g extends d{constructor(e,t,n,i,r){super(e,t,n),this.holeIndices=i,this.pathLengths=r}}class b{constructor(e,t,n,i,r,o){this.position=e,this.mapPositions=t,this.polygons=n,this.outlines=i,this.projectionSuccess=r,this.sampledElevation=o}}}}]);