"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[36302,34042],{34042:function(e,t,n){n.d(t,{it:function(){return v},aX:function(){return b},hR:function(){return w}});var r=n(81001),i=n(88194),s=n(96711),o=n(67764),u=n(62197),c=n(76264),a=n(8554),l=n(97290),f=n(78619),p=n(90756),h=n(56545);var d=n(95490),g=n(93333);const y=()=>s.Z.getLogger("esri.geometry.support.normalizeUtils");function S(e){return"polygon"===e[0].type}function m(e){return"polyline"===e[0].type}function w(e,t){if(!(e instanceof u.Z||e instanceof o.Z)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw y().error(e),new i.Z("internal:geometry",e)}const n=(0,c.x3)(e),r=[];for(const e of n){const n=[];r.push(n),n.push([e[0][0],e[0][1]]);for(let r=0;r<e.length-1;r++){const i=e[r][0],s=e[r][1],o=e[r+1][0],u=e[r+1][1],c=Math.sqrt((o-i)*(o-i)+(u-s)*(u-s)),a=(u-s)/c,l=(o-i)/c,f=c/t;if(f>1){for(let e=1;e<=f-1;e++){const r=e*t,o=l*r+i,u=a*r+s;n.push([o,u])}const e=(c+Math.floor(f-1)*t)/2,r=l*e+i,o=a*e+s;n.push([r,o])}n.push([o,u])}}return function(e){return"polygon"===e.type}(e)?new o.Z({rings:r,spatialReference:e.spatialReference}):new u.Z({paths:r,spatialReference:e.spatialReference})}function x(e,t,n){if(t){const t=w(e,1e6);e=(0,l.Sx)(t,!0)}return n&&(e=(0,c.Sy)(e,n)),e}function R(e,t,n){if(Array.isArray(e)){const r=e[0];if(r>t){const n=(0,c.XZ)(r,t);e[0]=r+n*(-2*t)}else if(r<n){const t=(0,c.XZ)(r,n);e[0]=r+t*(-2*n)}}else{const r=e.x;if(r>t){const n=(0,c.XZ)(r,t);e=e.clone().offset(n*(-2*t),0)}else if(r<n){const t=(0,c.XZ)(r,n);e=e.clone().offset(t*(-2*n),0)}}return e}function M(e,t){let n=-1;for(let r=0;r<t.cutIndexes.length;r++){const i=t.cutIndexes[r],s=t.geometries[r],o=(0,c.x3)(s);for(let e=0;e<o.length;e++){const t=o[e];t.some((n=>{if(n[0]<180)return!0;{let n=0;for(let e=0;e<t.length;e++){const r=t[e][0];n=r>n?r:n}n=Number(n.toFixed(9));const r=-360*(0,c.XZ)(n,180);for(let n=0;n<t.length;n++){const t=s.getPoint(e,n);s.setPoint(e,n,t.clone().offset(r,0))}return!0}}))}if(i===n){if(S(e))for(const t of(0,c.x3)(s))e[i]=e[i].addRing(t);else if(m(e))for(const t of(0,c.x3)(s))e[i]=e[i].addPath(t)}else n=i,e[i]=s}return e}async function b(e,t,n){if(!Array.isArray(e))return b([e],t);t&&"string"!=typeof t&&y().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i="string"==typeof t?t:t?.url??r.default.geometryServiceUrl;let s,S,m,w,v,Z,C,P,U=0;const X=[],_=[];for(const t of e)if(null!=t)if(s||(s=t.spatialReference,S=(0,a.C5)(s),m=s.isWebMercator,Z=m?102100:4326,w=c.UZ[Z].maxX,v=c.UZ[Z].minX,C=c.UZ[Z].plus180Line,P=c.UZ[Z].minus180Line),S)if("mesh"===t.type)_.push(t);else if("point"===t.type)_.push(R(t.clone(),w,v));else if("multipoint"===t.type){const e=t.clone();e.points=e.points.map((e=>R(e,w,v))),_.push(e)}else if("extent"===t.type){const e=t.clone()._normalize(!1,!1,S);_.push(e.rings?new o.Z(e):e)}else if(t.extent){const e=t.extent,n=(0,c.XZ)(e.xmin,v)*(2*w);let r=0===n?t.clone():(0,c.Sy)(t.clone(),n);e.offset(n,0);let{xmin:i,xmax:s}=e;i=Number(i.toFixed(9)),s=Number(s.toFixed(9)),e.intersects(C)&&s!==w?(U=s>U?s:U,r=x(r,m),X.push(r),_.push("cut")):e.intersects(P)&&i!==v?(U=s*(2*w)>U?s*(2*w):U,r=x(r,m,360),X.push(r),_.push("cut")):_.push(r)}else _.push(t.clone());else _.push(t);else _.push(t);let L=(0,c.XZ)(U,w),N=-90;const J=L,O=new u.Z;for(;L>0;){const e=360*L-180;O.addPath([[e,N],[e,-1*N]]),N*=-1,L--}if(X.length>0&&J>0){const t=M(X,await async function(e,t,n,r){const i=(0,h.en)(e),s=t[0].spatialReference,o={...r,responseType:"json",query:{...i.query,f:"json",sr:(0,a.B9)(s),target:JSON.stringify({geometryType:(0,p.Ji)(t[0]),geometries:t}),cutter:JSON.stringify(n)}},u=await(0,f.Z)(i.path+"/cut",o),{cutIndexes:c,geometries:l=[]}=u.data;return{cutIndexes:c,geometries:l.map((e=>{const t=(0,p.im)(e);return t.spatialReference=s,t}))}}(i,X,O,n)),r=[],s=[];for(let n=0;n<_.length;n++){const i=_[n];if("cut"!==i)s.push(i);else{const i=t.shift(),o=e[n];null!=o&&"polygon"===o.type&&o.rings&&o.rings.length>1&&i.rings.length>=o.rings.length?(r.push(i),s.push("simplify")):s.push(m?(0,l.$)(i):i)}}if(!r.length)return s;const o=await async function(e,t,n){const r="string"==typeof e?(0,d.mN)(e):e,i=t[0].spatialReference,s=(0,p.Ji)(t[0]),o={...n,query:{...r.query,f:"json",sr:(0,a.B9)(i),geometries:JSON.stringify((0,g.F)(t))}},{data:u}=await(0,f.Z)(r.path+"/simplify",o);return(0,g.o)(u.geometries,s,i)}(i,r,n),u=[];for(let e=0;e<s.length;e++){const t=s[e];"simplify"!==t?u.push(t):u.push(m?(0,l.$)(o.shift()):o.shift())}return u}const q=[];for(let e=0;e<_.length;e++){const t=_[e];if("cut"!==t)q.push(t);else{const e=X.shift();q.push(!0===m?(0,l.$)(e):e)}}return q}function v(e,t,n){const r=(0,a.C5)(n);if(null==r)return e;const[i,s]=r.valid,o=2*s;let u=0,c=0;t>s?u=Math.ceil(Math.abs(t-s)/o):t<i&&(u=-Math.ceil(Math.abs(t-i)/o)),e>s?c=Math.ceil(Math.abs(e-s)/o):e<i&&(c=-Math.ceil(Math.abs(e-i)/o));let l=e+(u-c)*o;const f=l-t;return f>s?l-=o:f<i&&(l+=o),l}},76264:function(e,t,n){n.d(t,{Sy:function(){return c},UZ:function(){return o},XZ:function(){return u},x3:function(){return a}});var r=n(62197),i=n(45213),s=n(90756);const o={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new r.Z({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:i.Z.WebMercator}),minus180Line:new r.Z({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:i.Z.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new r.Z({paths:[[[180,-180],[180,180]]],spatialReference:i.Z.WGS84}),minus180Line:new r.Z({paths:[[[-180,-180],[-180,180]]],spatialReference:i.Z.WGS84})}};function u(e,t){return Math.ceil((e-t)/(2*t))}function c(e,t){const n=a(e);for(const e of n)for(const n of e)n[0]+=t;return e}function a(e){return(0,s.oU)(e)?e.rings:e.paths}},93333:function(e,t,n){n.d(t,{F:function(){return i},o:function(){return s}});var r=n(90756);function i(e){return{geometryType:(0,r.Ji)(e[0]),geometries:e.map((e=>e.toJSON()))}}function s(e,t,n){const i=(0,r.q9)(t);return e.map((e=>{const t=i.fromJSON(e);return t.spatialReference=n,t}))}},56545:function(e,t,n){n.d(t,{LP:function(){return f},cv:function(){return l},en:function(){return a},lA:function(){return c}});var r=n(81001),i=n(10218),s=n(28947),o=n(95490),u=n(82674);function c(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function a(e){return"string"==typeof e?(0,o.mN)(e):(0,s.d9)(e)}function l(e,t,n){const r={};for(const i in e){if("declaredClass"===i)continue;const s=e[i];if(null!=s&&"function"!=typeof s)if(Array.isArray(s))r[i]=s.map((e=>l(e)));else if("object"==typeof s)if(s.toJSON){const e=s.toJSON(n?.[i]);r[i]=t?e:JSON.stringify(e)}else r[i]=t?s:JSON.stringify(s);else r[i]=s}return r}async function f(e,t,s){const o=function(e,t){return e?t&&(0,u.rU)(e)?t:(0,u.Pi)(e)??i.id?.findCredential(e)?.token:null}(e,t);if(o)return o;!i.id&&r.default.request.useIdentity&&await n.e(39428).then(n.bind(n,39428));return(await i.id.getCredential(e,s))?.token}},65015:function(e,t,n){n.d(t,{$:function(){return r},l:function(){return i}});const r=50,i=5},55623:function(e,t,n){n.d(t,{RN:function(){return h},TS:function(){return p},wK:function(){return d}});var r=n(26636),i=n(60508),s=n(62197),o=n(45213),u=n(95872),c=n(34042),a=n(8554),l=n(97290),f=n(65015);function p(e,t,n){const r=1===e?10:e;return r**(n?Math.round(function(e,t){return Math.log(e)/Math.log(t)}(f.$/t,r)):0)}function h(e){const{isGeographic:t,isWebMercator:n}=e;return!t&&!n}function d(e,t,n){const f="number"==typeof e?null:e,p=n??f?.spatialReference;if(null==p||!(0,a.JY)(p)||h(p))return(0,r.c9)(p);let d=f?.x??e,g=f?.y??t;const y=1/Math.sqrt(2);let S=d+y,m=g+y;const{isWebMercator:w,isGeographic:x}=p;let R=x&&!(0,u.Gb)(p)?o.Z.WGS84:p;if(w){let e=new i.Z({x:d,y:g,spatialReference:p});(0,l.Sx)(e,!0,e),d=e.x,g=e.y,e=new i.Z({x:S,y:m,spatialReference:p}),(0,l.Sx)(e,!0,e),S=e.x,m=e.y,R=o.Z.WGS84}const M=new s.Z({paths:[[[d,g],[S,m]]],spatialReference:R}),b=(0,c.hR)(M,10);let v;try{[v]=(0,u.Jf)([b],"meters")}catch{return(0,r.c9)(p)}return v}},36302:function(e,t,n){n.d(t,{GridSnappingEngine:function(){return x}});var r=n(73440),i=n(70880),s=n(96711),o=n(99574),u=n(26636),c=n(17155),a=(n(61432),n(83850),n(48023)),l=n(24910),f=n(13132),p=n(34042),h=n(4469),d=n(65015),g=n(55623),y=n(17609),S=n(29668),m=n(50620),w=n(80677);let x=class extends i.Z{constructor(e){super(e),this.options=null}destroy(){this._set("options",null)}get grid(){return this.view.grid}get effectiveViewRotation(){return this.grid?.rotateWithMap?0:(0,o.Vl)(this.view.rotation??0)}get gridRotation(){return(0,o.Vl)(this.grid?.rotation??0)}get gridCenter(){const{spatialReference:e,grid:t}=this;if(!t||!e||!(0,f.isLoadedOrLoadFor)(t.center.spatialReference,e))return null;try{const n=(0,f.project)(t.center,e),r=e.isWrappable&&null!=this.view?.center?(0,p.it)(n.x,this.view.center.x,e):n.x;return(0,y.Ue)(r,n.y,n.z)}catch(e){return s.Z.getLogger(this).errorOnce("Grid Snapping - Failed to project grid center.",e),null}}get offsetScaleFactor(){const{pixelsPerStride:e,grid:t}=this;if(!t||!e)return 1;const{majorLineInterval:n,dynamicScaling:r}=t;return n<1?null:(0,g.TS)(n,e,r)}get spatialReference(){return this.view.spatialReference}get gridMetersPerStride(){const{grid:e}=this;return e?(0,u.En)(e.spacing,e.units,"meters"):null}get viewMetersPerPixel(){const{viewMetersPerSRUnit:e}=this;return null==e?null:e*(0,h.dp)(this.view.scale,this.view.spatialReference)}get viewMetersPerSRUnit(){const{spatialReference:e}=this.view;return this.gridCenter?(0,g.wK)(this.gridCenter[0],this.gridCenter[1],e):null}get pixelsPerStride(){const{gridMetersPerStride:e,viewMetersPerPixel:t}=this;return t&&e?e/t:null}get updating(){return null!=this.grid&&null!=this.spatialReference&&null==this.viewMetersPerSRUnit}async fetchCandidates(e,t,n){const{options:r,view:i}=this;if(!r?.effectiveGridEnabled||!i.grid||n.feature?.attributes&&S.Ry in n.feature.attributes)return[];const s=n.coordinateHelper.arrayToPoint(e),o=r.distance*("touch"===n.pointer?r.touchSensitivityMultiplier:1);return this.fetchCandidatesSync(s,o)}fetchCandidatesSync(e,t){const n=[],{grid:r,effectiveViewRotation:i,gridRotation:s,gridCenter:o,viewMetersPerPixel:u,viewMetersPerSRUnit:c,offsetScaleFactor:a,spatialReference:l,gridMetersPerStride:p,pixelsPerStride:h}=this;if(!(r&&u&&c&&o&&l&&a&&p&&h))return n;if(!r.dynamicScaling&&h<d.l)return n;if(!(0,f.isLoadedOrLoadFor)(e.spatialReference,l))return n;const g=(0,f.project)(e,l),S=(0,y.Ue)(g.x,g.y,g.z),x=R(S,-s,o,-i),Z=p/c*a,C=M(x,Z,o),{shouldSnapX:P,shouldSnapY:U}=b(C,x,t,u,c);if(!P&&!U)return[];const X=(0,y.Ue)((P?C:x)[0],(U?C:x)[1]),_=R(X,s,o,i),L=R(C,s,o,i);if(U){const e=v(C,x,Z,"y"),t=R(e,s,o,i);n.push(new w.u({lineStart:L,lineEnd:t,targetPoint:_,isDraped:!1}))}if(P){const e=v(C,x,Z,"x"),t=R(e,s,o,i);n.push(new w.u({lineStart:L,lineEnd:t,targetPoint:_,isDraped:!1}))}return P&&U&&n.push(new m.m(_,n[0],n[1],!1)),n}};(0,r._)([(0,c.Cb)({constructOnly:!0})],x.prototype,"view",void 0),(0,r._)([(0,c.Cb)()],x.prototype,"options",void 0),(0,r._)([(0,c.Cb)()],x.prototype,"grid",null),(0,r._)([(0,c.Cb)()],x.prototype,"effectiveViewRotation",null),(0,r._)([(0,c.Cb)()],x.prototype,"gridRotation",null),(0,r._)([(0,c.Cb)()],x.prototype,"gridCenter",null),(0,r._)([(0,c.Cb)()],x.prototype,"offsetScaleFactor",null),(0,r._)([(0,c.Cb)()],x.prototype,"spatialReference",null),(0,r._)([(0,c.Cb)()],x.prototype,"gridMetersPerStride",null),(0,r._)([(0,c.Cb)()],x.prototype,"viewMetersPerPixel",null),(0,r._)([(0,c.Cb)()],x.prototype,"viewMetersPerSRUnit",null),(0,r._)([(0,c.Cb)()],x.prototype,"pixelsPerStride",null),(0,r._)([(0,c.Cb)()],x.prototype,"updating",null),x=(0,r._)([(0,a.j)("esri.views.interactive.snapping.GridSnappingEngine")],x);const R=(e,t,n,r)=>{const i=(0,y.by)(e[0],e[1],e[2]);return(0,l.K)(i,(0,l.K)(i,i,n,t),n,r)},M=(e,t,n)=>{const r=(e[0]-n[0])/t,i=(e[1]-n[1])/t,s=Math.trunc(r),o=Math.trunc(i),u=Math.round(r%1),c=Math.round(i%1),a=n[0]+(s+u)*t,l=n[1]+(o+c)*t;return(0,y.Ue)(a,l)},b=(e,t,n,r,i)=>{if(r<=0)return{shouldSnapX:!1,shouldSnapY:!1};const s=(e[0]-t[0])/r,o=(e[1]-t[1])/r;return{shouldSnapX:Math.abs(s*i)<n,shouldSnapY:Math.abs(o*i)<n}},v=(e,t,n,r)=>{if("y"===r){const r=t[0]>e[0]?1:-1;return(0,y.Ue)(e[0]+n*r,e[1])}const i=t[1]>e[1]?1:-1;return(0,y.Ue)(e[0],e[1]+n*i)}}}]);