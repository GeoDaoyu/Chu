"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[13904],{65838:function(e,t,n){n.r(t),n.d(t,{default:function(){return _e}});var i=n(73440),r=n(997),s=n(89314),a=n(88194),o=n(84060),l=n(93568),u=n(90403),c=n(17155),p=(n(61432),n(96711)),d=(n(83850),n(48023)),f=n(38209),m=n(83263),h=n(55591),g=n(9642),y=n(85330),v=n(27202),b=n(57554),w=n(19306),x=n(3752),I=n(99671),C=n(93295),S=n(49651),T=n(72327),_=n(71354),E=n(62065),k=n(78619),F=n(8761);function A(e){return e.endsWith("?")?e.slice(0,-1):e}function $(e){return e.filter((({coverageSubType:e})=>null==e||""===e||/^rectified(grid|dataset)/i.test(e)))}function D(e){const t={};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1!==i.nodeType)continue;const r=(0,F.ZB)(i).toLowerCase();switch(r){case"title":case"abstract":t[r]=(0,F.Y)(i);break;case"identifier":t.id=(0,F.Y)(i);break;case"wgs84boundingbox":{const e=(0,F.kH)(i,"LowerCorner"),n=(0,F.kH)(i,"UpperCorner");t.lonLatEnvelope=new _.Z({xmin:e[0],ymin:e[1],xmax:n[0],ymax:n[1],spatialReference:{wkid:4326}})}break;case"coveragesummary":t.coverageSummaries=t.coverageSummaries||[],t.coverageSummaries.push(D(i))}}return t}function P(e,t){if(e.coverageSummaries)for(let n=0;n<e.coverageSummaries.length;n++)e.coverageSummaries[n].abstract=e.coverageSummaries[n].abstract||e.abstract,e.coverageSummaries[n].lonLatEnvelope=e.coverageSummaries[n].lonLatEnvelope||e.lonLatEnvelope,e.coverageSummaries[n].title=e.coverageSummaries[n].title||e.title,P(e.coverageSummaries[n],t);null!=e.id&&t.push(e)}function L(e){const t=(0,F.sb)(e.querySelector("Operation[name=GetCapabilities]"),"Get")?.getAttribute("xlink:href")||"",n=(0,F.sb)(e.querySelector("Operation[name=DescribeCoverage]"),"Get")?.getAttribute("xlink:href")||"",i=(0,F.sb)(e.querySelector("Operation[name=GetCoverage]"),"Get")?.getAttribute("xlink:href")||"";return{getCapabilities:A(t),describeCoverage:A(n),getCoverage:A(i)}}function R(e,t=null){let n=null;n="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e;let i=n.documentElement.getAttribute("version");"1.0"===i?i="1.0.0":"1.1"===i&&(i="1.1.0");const r=i||t||"1.0.0",s=r.slice(0,3);let o;if("2.0"===s)o=function(e){const t=(0,F.sb)(e,"ServiceIdentification"),n=(0,F.Y)(t,"Title"),i=(0,F.tz)(t,"ServiceTypeVersion"),r=(0,F.tz)(t,"Profile"),s=L((0,F.sb)(e,"OperationsMetadata")),a=(0,F.$3)(e,"Contents/CoverageSummary"),o=[];for(let e=0;e<a.length;e++){const t=a[e],n=(0,F.Y)(t,"CoverageId"),i=(0,F.sb)(t,"WGS84BoundingBox");let r;if(i){const e=(0,F.kH)(i,"LowerCorner"),t=(0,F.kH)(i,"UpperCorner");r=new _.Z({xmin:e[0],ymin:e[1],xmax:t[0],ymax:t[1],spatialReference:{wkid:4326}})}const s=(0,F.Y)(t,"CoverageSubtype")||"RectifiedGridCoverage";o.push({id:n,lonLatEnvelope:r,coverageSubType:s})}const l=(0,F.sb)(e,"ServiceMetadata");return{name:n,supportedVersions:i,supportedFormats:(0,F.tz)(l,"formatSupported"),supportedInterpolations:(0,F.tz)(l,"interpolationSupported").concat((0,F.tz)(l,"InterpolationSupported")),onlineResources:s,profiles:r,coverages:o,gridCoverages:$(o),version:"2.0.1"}}(n);else if("1.1"===s)o=function(e){const t=(0,F.Y)(e,"ServiceIdentification/Title"),n=(0,F.tz)(e,"ServiceIdentification/ServiceTypeVersion"),i=L((0,F.sb)(e,"OperationsMetadata")),r=[],s=(0,F.sb)(e,"Contents");for(let e=0;e<s.childNodes.length;e++){const t=s.childNodes[e];1===t.nodeType&&(0,F.W9)(t,"CoverageSummary")&&P(D(t),r)}const a=(0,F.tz)(s,"SupportedFormat");return{name:t,onlineResources:i,coverages:r,gridCoverages:$(r),supportedVersions:n,supportedFormats:a,version:"1.1.0"}}(n);else{if("1.0"!==s)throw new a.Z("wcsraster:parsecapabilities","the capabilities version is not supported");o=function(e){const t=(0,F.Y)(e,"Service/name"),n=(0,F.sb)(e,"Capability"),i=(0,F.sb)(n,"GetCapabilities/Get/OnlineResource")?.getAttribute("xlink:href")??"",r=(0,F.sb)(n,"DescribeCoverage/Get/OnlineResource")?.getAttribute("xlink:href")??"",s=(0,F.sb)(n,"GetCoverage/Get/OnlineResource")?.getAttribute("xlink:href")??"",a={getCapabilities:A(i),describeCoverage:A(r),getCoverage:A(s)},o=(0,F.$3)(e,"CoverageOfferingBrief"),l=[];for(let e=0;e<o.length;e++){const t=o[e],n=(0,F.Y)(t,"name"),i=(0,F.$3)(t,"pos"),r=(0,F.kH)(i[0]),s=(0,F.kH)(i[1]),a=new _.Z({xmin:r[0],ymin:r[1],xmax:s[0],ymax:s[1],spatialReference:{wkid:4326}});l.push({id:n,lonLatEnvelope:a})}return{name:t,onlineResources:a,coverages:l,gridCoverages:$(l),supportedVersions:["1.0.0"],version:"1.0.0"}}(n)}return o.version=r,o}var O=n(67764),V=n(11472),N=n(57528);function Z(e){e.variables.forEach((e=>e.dimensions.forEach((e=>e.values??=(0,N.Rw)(e)))))}function B(e){return{requestResponseCRSs:(0,F.tz)(e,"requestResponseCRSs").map((e=>e.split(":")[1])),nativeCRSs:(0,F.tz)(e,"nativeCRSs").map((e=>e.split(":")[1]))}}function M(e,t){const n=(0,F.tz)(e,"1.0.0"===t?"interpolationMethod":"InterpolationMethod"),i="1.0.0"===t?e.getAttribute("default"):(0,F.Y)(e,"InterpolationMethods/Default");return null!=i?[i].concat(n.filter((e=>e.toLowerCase()!==i.toLowerCase()))):n}function j(e){return null==e?["nearest"]:e.map((e=>{const t=e.toLowerCase();return t.includes("nearest")?"nearest":t.includes("linear")?"bilinear":t.includes("cubic")?"cubic":null})).filter((e=>!!e))}function Y(e){const t=(0,F.$3)(e,"pos"),n=(0,F.kH)(t[0]),i=(0,F.kH)(t[1]);return new _.Z({xmin:n[0],ymin:n[1],xmax:i[0],ymax:i[1],spatialReference:{wkid:4326}})}function z(e,t){const n=(0,F.tz)(e,t);return n?.length&&""!==n[0]&&!isNaN(Number(n[0]))?n.map((e=>Number(e))):null}function H(e){const t=(0,F.kH)(e,"MinimumValue"),n=(0,F.kH)(e,"MaximumValue");return t.length&&n.length?t.map(((e,t)=>({min:e,max:n[t],avg:-1,stddev:-1}))):null}function U(e){return null==e?null:e.every((t=>t===e[0]))?e[0]:e}function W(e){const t=[],n=(0,F.$3)(e,"RangeSet");let i=[];for(let e=0;e<n.length;e++){const r=(0,F.Y)(n[e],"name"),s=(0,F.Y)(n[e],"label"),a=[],o=z(n[e],"nullValues/singleValue"),l=(0,F.$3)(n[e],"AxisDescription");for(let e=0;e<l.length;e++){const t=(0,F.Y)(l[e],"name"),n=(0,F.Y)(l[e],"label"),r=(0,F.tz)(l[e],"singleValue");if(0===r.length){const t=(0,F.Y)(l[e],"min"),n=(0,F.Y)(l[e],"max"),i=Number((0,F.Y)(l[e],"res"))||1;if(null!==t&&null!==n)for(let e=parseInt(t,10);e<=parseInt(n,10);e+=i)r.push(e.toString())}"band"===t.toLowerCase()&&(i=r),a.push({name:t,label:n,values:r})}t.push({name:r,label:s,nullValues:o,axis:a})}return{rangeSet:t,bandNames:i}}function G(e=null){if(!e)return{resolution:null,units:null};let t=e.toUpperCase();const n=["Years","Months","Days","Hours","Minutes","Seconds"];let i,r,s;return t.includes("PT")?(t=t.slice(2),s=["H","M","S"].findIndex((e=>t.includes(e))),i=n[3+s],r=parseFloat(t.slice(0,-1))):(t=t.slice(1),s=["Y","M","D"].findIndex((e=>t.includes(e))),s>-1&&(i=n[s]),r=parseFloat(t.slice(0,-1))),{resolution:r,units:i}}function q(e){const t=(0,F.$3)(e,"timeposition");if(t.length>0){const e=[];for(let n=0;n<t.length;n++)e.push(new Date((0,F.Y)(t[n])));return{begin:e[0],end:e[e.length-1],values:e}}const n=(0,F.sb)(e,"timePeriod")||(0,F.sb)(e,"TimePeriod");return n?{begin:new Date((0,F.Y)(n,"beginPosition")||(0,F.Y)(n,"BeginPosition")),end:new Date((0,F.Y)(n,"endPosition")||(0,F.Y)(n,"EndPosition")),...G((0,F.Y)(n,"timeResolution")||(0,F.Y)(n,"TimeResolution"))}:null}function J(e){const t=(0,F.sb)(e,"spatialDomain"),n=(0,F.sb)(t,"Envelope")||(0,F.sb)(t,"EnvelopeWithTimePeriod"),i=n.getAttribute("srsName").split(":"),r=i[i.length-1],s=(0,F.$3)(n,"pos"),a=(0,F.kH)(s[0]),o=(0,F.kH)(s[1]),l=parseInt(r,10),u=isNaN(l)?null:{wkid:l},c=new _.Z({xmin:a[0],ymin:a[1],xmax:o[0],ymax:o[1],spatialReference:u}),p=(0,F.sb)(t,"RectifiedGrid"),d=(0,F.Y)(p,"low").split(" "),f=(0,F.Y)(p,"high").split(" "),m=parseInt(f[0],10)-parseInt(d[0],10)+1,h=parseInt(f[1],10)-parseInt(d[1],10)+1,g=(0,F.kH)(t,"origin/pos"),y=(0,F.$3)(t,"offsetVector"),v={envelope:c,columns:m,rows:h,offset:{x:parseFloat((0,F.Y)(y[0]).split(" ")[0]),y:parseFloat((0,F.Y)(y[1]).split(" ")[1])},origin:{x:g[0],y:g[1]}},b=(0,F.sb)(e,"temporalDomain")||(0,F.sb)(e,"TemporalDomain");return{spatialDomain:v,temporalDomain:b?q(b):null}}function Q(e){const t={version:"1.0"};let n,i=[];for(let r=0;r<e.childNodes.length;r++){const s=e.childNodes[r];if(1===s.nodeType)if((0,F.W9)(s,"description"))t.description=(0,F.Y)(s);else if((0,F.W9)(s,"name"))t.name=(0,F.Y)(s);else if((0,F.W9)(s,"label"))t.label=(0,F.Y)(s);else if((0,F.W9)(s,"supportedFormats"))t.supportedFormats=(0,F.tz)(s,"formats");else if((0,F.W9)(s,"supportedCRSs"))t.supportedCRSs=B(s);else if((0,F.W9)(s,"supportedInterpolations"))t.supportedInterpolations=M(s,"1.0.0");else if((0,F.W9)(s,"lonLatEnvelope"))t.lonLatEnvelope=Y(s);else if((0,F.W9)(s,"rangeSet")){const e=W(s);t.rangeSet=e.rangeSet,i=e.bandNames;const r=e.rangeSet[0].nullValues;r?.length&&(n=U(r))}else(0,F.W9)(s,"domainSet")&&(t.domainSet=J(s))}const r=j(t.supportedInterpolations),{name:s,description:a,label:o,lonLatEnvelope:l,supportedFormats:u}=t,{spatialDomain:c}=t.domainSet,p={x:Math.abs(c.offset.x),y:Math.abs(c.offset.y)},d=function(e){if(!e.temporalDomain)return null;const{begin:t,end:n,values:i,units:r,resolution:s}=e.temporalDomain,a={variables:[{name:"default",description:"",dimensions:[{name:"StdTime",description:"",unit:"ISO8601",values:i?.map((e=>e.getTime())),hasRegularIntervals:!i,interval:s,intervalUnit:r,extent:[t.getTime(),n.getTime()]}]}]};return Z(a),a}(t.domainSet),f=new V.Z({width:c.columns,height:c.rows,pixelSize:p,pixelType:"unknown",extent:c.envelope,spatialReference:c.envelope.spatialReference,bandCount:i.length||1,noDataValue:n,multidimensionalInfo:d});return{id:s,title:t.name,description:a||o,lonLatEnvelope:l,rasterInfo:f,bandNames:i,supportedFormats:u,supportedInterpolations:r,coverageDescription:t,version:"1.0.0",useEPSGAxis:!1}}function K(e,t){const n=[],i=(0,F.$3)(e,"Field");let r,s=[];for(let e=0;e<i.length;e++){const a=(0,F.Y)(i[e],"Identifier"),o=(0,F.Y)(i[e],"Description"),l=(0,F.Y)(i[e],"Definition"),u=(0,F.Y)(i[e],"Abstract"),c=(0,F.Y)(i[e],"Title"),p=z(i[e],"NullValue"),d=(0,F.sb)(i[e],"AllowedValues"),f=d?H(d):null,m=M(i[e],"1.1.0"),h=[],g=(0,F.$3)(i[e],"Axis");for(let e=0;e<g.length;e++){const n=g[e].getAttribute("identifier"),i=(0,F.Y)(g[e],"UOM"),a=(0,F.Y)(g[e],"DataType"),o=(0,F.tz)(g[e],"Key");t&&!n.toLowerCase().includes("band")||(s=o,r=p),h.push({identifier:n,uom:i,dataType:a,values:o,bandNoDataValues:r})}n.push({identifier:a,description:o,definition:l,abstract:u,title:c,supportedInterpolations:m,axis:h,nullValues:p,statistics:f})}return{rangeSet:n,bandNames:s,bandNoDataValues:r,statistics:n[0].statistics}}function X(e){const t=(0,F.sb)(e,"SpatialDomain"),n=(0,F.sb)(t,"GridCRS"),i=(0,F.Y)(n,"GridBaseCRS"),r=(0,F.Y)(n,"GridOrigin")?.split(" ").map((e=>parseFloat(e)))??[0,0],s=(0,F.kH)(n,"GridOffsets"),a=(0,F.$3)(t,"BoundingBox");let o,l,u,c;for(let e=0;e<a.length;e++){const t=a[e].getAttribute("crs")?.toLowerCase();if(null!=t)if(t.includes("imagecrs")){const t=(0,F.kH)(a[e],"LowerCorner"),n=(0,F.kH)(a[e],"UpperCorner");o=n[0]-t[0]+1,l=n[1]-t[1]+1}else if(t.indexOf("epsg")>0){const n=t.split(":");u=parseInt(n[n.length-1],10);const i=(0,F.kH)(a[e],"LowerCorner"),r=(0,F.kH)(a[e],"UpperCorner");c=new _.Z({xmin:i[0],ymin:i[1],xmax:r[0],ymax:r[1],spatialReference:{wkid:u}})}}const p=o>l,d=c.xmax-c.xmin>c.ymax-c.ymin;let f=!1;(0,E.A)(u)&&(p===d?f=!1:(f=!0,c=new _.Z({xmin:c.ymin,ymin:c.xmin,xmax:c.ymax,ymax:c.xmax,spatialReference:{wkid:u}})));const m={columns:o,rows:l,origin:{x:r[0],y:r[1]},offset:{x:s[0],y:s[s.length-1]},gridBaseCRS:i,envelope:c,useEPSGAxis:f},h=(0,F.sb)(e,"temporalDomain")||(0,F.sb)(e,"TemporalDomain");return{spatialDomain:m,temporalDomain:h?q(h):null}}function ee(e,t){const n=[],i=[],r={supportedFormats:n,supportedCRSs:i,version:"1.1"};let s,a,o=[];for(let t=0;t<e.childNodes.length;t++){const l=e.childNodes[t];if(1!==l.nodeType)continue;const u=(0,F.ZB)(l).toLowerCase();switch(u){case"title":case"abstract":case"identifier":r[u]=(0,F.Y)(l);break;case"supportedformat":{const e=(0,F.Y)(l);n.includes(e)||n.push(e)}break;case"supportedcrs":{const e=(0,F.Y)(l);i.includes(e)||i.push(e)}break;case"range":{const e=K(l,!!r.domain?.temporalDomain);r.range=e.rangeSet,o=e.bandNames;const{bandNoDataValues:t}=e;t?.length&&(s=U(t)),a=e.statistics}break;case"domain":r.domain=X(l)}}const l=j(r.range[0].supportedInterpolations),{identifier:u,abstract:c,title:p,domain:d,range:f}=r,m={x:Math.abs(d.spatialDomain.offset.x),y:Math.abs(d.spatialDomain.offset.y)},h=function(e,t){if(!t.temporalDomain)return null;const n=e.filter((e=>!e.identifier.toLowerCase().includes("field_1")&&!e.axis.some((e=>e.identifier.includes("band"))))),i=[];if(n.length&&n.forEach((e=>{const t=e.axis.map((e=>{const t=e.values.map((t=>"ISO8601"===e.uom?(t=t.trim()).toLowerCase().includes("z")?new Date(t).getTime():new Date(t+"Z").getTime():parseFloat(t.trim()))),n=[Math.min.apply(null,t),Math.max.apply(null,t)];return{name:e.identifier.trim(),description:"",field:e.identifier.trim(),unit:e.uom?e.uom.trim():"",hasRegularIntervals:!1,values:t,extent:n}}));i.push({name:e.identifier.trim(),description:e.description?.trim()??"",unit:"",dimensions:t,statistics:e.statistics})})),t.temporalDomain){const{begin:e,end:n,values:r,units:s,resolution:a}=t.temporalDomain;i.some((e=>e.dimensions.some((e=>"stdtime"===e.name.toLowerCase()))))||i.forEach((t=>{t.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:r?.map((e=>e.getTime())),hasRegularIntervals:!r,interval:a,intervalUnit:s,extent:[e.getTime(),n.getTime()]})}))}if(i.length){const e={variables:i};return Z(e),e}return null}(f,d);h&&(s=f[0].nullValues,1===s?.length&&(s=s[0]));const g=new V.Z({width:d.spatialDomain.columns,height:d.spatialDomain.rows,pixelSize:m,pixelType:"unknown",extent:d.spatialDomain.envelope,spatialReference:d.spatialDomain.envelope.spatialReference,bandCount:o.length||1,noDataValue:s,statistics:a,multidimensionalInfo:h});return{id:u,title:r.title,description:c||p,bandNames:o,rasterInfo:g,supportedFormats:n,supportedInterpolations:l,coverageDescription:r,version:t,useEPSGAxis:d.spatialDomain.useEPSGAxis}}function te(e){const t=(0,F.sb)(e,"Envelope")||(0,F.sb)(e,"EnvelopeWithTimePeriod"),n=t.getAttribute("srsName"),i=n.slice(n.lastIndexOf("/")+1),r=t.getAttribute("axisLabels").split(" ").map((e=>e.trim())).filter((e=>""!==e.trim())),s=(0,F.kH)(t,"lowerCorner"),a=(0,F.kH)(t,"upperCorner"),o=!["y","lat","latitude","north","nor","n","b"].includes(r[0].toLowerCase());let l;const u=parseInt(i,10),c=isNaN(u)?null:{wkid:u};l=new _.Z(o?{xmin:s[0],ymin:s[1],xmax:a[0],ymax:a[1],spatialReference:c}:{xmin:s[1],ymin:s[0],xmax:a[1],ymax:a[0],spatialReference:c});const p={mins:s,maxs:a},d=t.getAttribute("uomLabels").trim().split(" ");let f,m;if((0,F.W9)(t,"EnvelopeWithTimePeriod")){f=new Date((0,F.Y)(e,"beginPosition")||(0,F.Y)(e,"BeginPosition")),m=new Date((0,F.Y)(e,"endPosition")||(0,F.Y)(e,"EndPosition"));const t=d?.findIndex((e=>"oledatetime"===e?.toLowerCase()));t>-1&&(d[t]="ISO8601")}return{envelope:l,axisLabels:r,uomLabels:d.length?d:null,envelopeAllDims:p,beginPosition:f,endPosition:m,isEastFirst:o}}function ne(e,t){const n=[],i=(0,F.$3)(e,"DataRecord"),r=[];let s,a=[];for(let e=0;e<i.length;e++){const o=(0,F.$3)(i[e],"field"),l=[];for(let e=0;e<o.length;e++){const n=o[e].getAttribute("name"),i=(0,F.Y)(o[e],"description")||"",u=(0,F.sb)(o[e],"uom")?.getAttribute("code")||"",c=(0,F.kH)(o[e],"interval"),p=z(o[e],"nilValue")?.[0];t&&!n.toLowerCase().includes("band")||(r.push(n),c?.length&&(s=s||[],s.push({min:c[0],max:c[1],avg:-1,stddev:-1})),a.push(p)),l.push({name:n,description:i,uom:u,allowedValues:c,nilValue:p})}n.push(l)}return a.some((e=>null!=e))||(a=null),{rangeType:n,bandNames:r,bandStats:s,bandNoDataValues:a}}function ie(e){let t=1,n="";const i=.01;return Math.abs(e-1/24)<1/24*i?n="Hours":Math.abs(e-1)<1*i?n="Days":e<1?(t=Math.round(24*e),n="Hours"):e>28-i&&e<31+i||Math.round(e/30)<12?n="Months":e>365-i&&e<366+i&&(n="Years"),{interval:t,intervalUnit:n}}function re(e,t){const n=(0,F.sb)(e,"RectifiedGrid"),i=(0,F.kH)(n,"low"),r=(0,F.kH)(n,"high"),s=[];for(let e=0;e<i.length;e++)s.push(r[e]-i[e]+1);const a=(0,F.Y)(n,"axisLabels").split(" "),o=(0,F.kH)(n,"origin/pos"),l=(0,F.$3)(n,"offsetVector"),u=[];for(let e=0;e<l.length;e++){const t=(0,F.kH)(l[e]),n=t.findIndex((e=>0!==e));u[n]=t[n]}let c=!1;t?.length&&a?.length&&(c=[...t].sort(((e,t)=>e<t?-1:1)).join(",")===[...a].sort(((e,t)=>e<t?-1:1)).join(","));let p,d,f;return["y","lat","latitude","north","nor","n","b"].includes((c?a:t)[0].toLowerCase())?(p=s[1],d=s[0],f={y:Math.abs(u[0]),x:Math.abs(u[1])}):(p=s[0],d=s[1],f={x:Math.abs(u[0]),y:Math.abs(u[1])}),{columns:p,rows:d,origin:o,offset:u,resolution:f,gridSamples:s,axisLabels:a,hasSameAxisLabelsAsBoundedBy:c}}function se(e){const t=(0,F.sb)(e,"EarthObservation");if(!t)return null;const n=(0,F.sb)(t,"phenomenonTime"),i=n?q(n):null,r=(0,F.sb)(t,"phenomenonTime"),s=r?q(r):null,a=(0,F.Y)(t,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList");let o=null;if(a){const e=a.split(" ").map((e=>e.trim())).filter((e=>null!=e&&""!==e)).map(Number);if(e.length){const t=[];for(let n=0;n<e.length/2;n+=2)t.push(e[n],e[n+1]);o=new O.Z({rings:[[t]]})}}return{observation:{phenomenonTime:i,resultTime:s,footprint:o,identifier:(0,F.Y)(e,"metaDataProperty/EarthObservationMetaData/identifier"),acquisitionType:(0,F.Y)(e,"metaDataProperty/EarthObservationMetaData/acquisitionType"),status:(0,F.Y)(e,"metaDataProperty/EarthObservationMetaData/status")}}}function ae(e){const t={version:"2.0"};let n,i,r=[];for(let s=0;s<e.childNodes.length;s++){const a=e.childNodes[s];if(1===a.nodeType)if((0,F.W9)(a,"coverageId"))t.coverageId=(0,F.Y)(a);else if((0,F.W9)(a,"ServiceParameters"))t.serviceParameters={supportedFormats:(0,F.tz)(a,"nativeFormat")};else if((0,F.W9)(a,"boundedBy"))t.boundedBy=te(a);else if((0,F.W9)(a,"rangeType")){const e=ne(a,t.boundedBy?.axisLabels.length>2||t.domainSet?.axisLabels.length>2);t.rangeType=e.rangeType,r=e.bandNames,n=e.bandStats;const{bandNoDataValues:s}=e;s?.length&&(i=U(s))}else if((0,F.W9)(a,"domainSet"))t.domainSet=re(a,t.boundedBy?.axisLabels);else if((0,F.W9)(a,"metadata")){const e=(0,F.sb)(a,"EOMetadata");t.eoMetadata=e?se(e):null}}const{coverageId:s,boundedBy:a,domainSet:o,rangeType:l,serviceParameters:u}=t,c=function(e,t,n){if(n.axisLabels.length<=2)return null;const i=[];for(let t=0;t<e.length;t++){const n=e[t];for(let e=0;e<n.length;e++)n[e].name.toLowerCase().includes("band")||i.push(n[e])}const r=[];if(i.length){const e=[];for(let i=2;i<n.axisLabels.length;i++){const r=t.uomLabels?.[i]?.trim()??"",s=n.axisLabels[i].toLowerCase().includes("time")||"iso8601"===r.toLowerCase()||"oledatetime"===r.toLowerCase();let a,o;if(s){const e=ie(n.offset[i]);a=e.interval,o=e.intervalUnit}else a=n.offset[i],o=r;const l=[];s?(l.push((0,N.de)(t.envelopeAllDims.mins[i])),l.push((0,N.de)(t.envelopeAllDims.maxs[i]))):(l.push(t.envelopeAllDims.mins[i]),l.push(t.envelopeAllDims.maxs[i])),e.push({name:n.axisLabels[i].trim(),description:n.axisLabels[i].trim(),unit:s?"ISO8601":r,hasRegularIntervals:!0,extent:l,interval:a,intervalUnit:o})}if(i.forEach((t=>{const{allowedValues:n}=t,i=2===n?.length?[{min:n[0],max:n[1],avg:-1,stddev:-1}]:null;r.push({name:t.name.trim(),description:t.description?.trim()??"",unit:t.uom.trim(),statistics:i,dimensions:[...e]})})),r.length){const e={variables:r};return Z(e),e}}return null}(l,a,o);return!n&&c&&(n=c?.variables[0].statistics),null!=c&&(i=l[0][0].nilValue),{id:s,title:s,description:s,bandNames:r,rasterInfo:new V.Z({width:o.columns,height:o.rows,pixelSize:o.resolution,pixelType:"unknown",extent:a.envelope,spatialReference:a.envelope.spatialReference,bandCount:r.length||1,statistics:n,noDataValue:i,multidimensionalInfo:c}),supportedFormats:u.supportedFormats,coverageDescription:t,version:"2.0.1",useEPSGAxis:!1}}async function oe(e,t){const{version:n,customParameters:i,signal:r}=t??{},s=n?.startsWith("1.0")?"version":"acceptVersions",o={service:"WCS",request:"GetCapabilities",[s]:n,...i};try{let{data:n}=await(0,k.Z)(e,{query:o,responseType:"xml",signal:r});return t?.version||function(e){let t=null;t="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e;const n=t.documentElement.getAttribute("version")?.slice(0,3);return null!=n&&n<"2.1"}(n)||(o[s]="2.0.1",({data:n}=await(0,k.Z)(e,{query:o,responseType:"xml",signal:r}))),R(n)}catch(e){if(!(0,l.D_)(e))throw new a.Z("wcslayer:open","wcs capabilities is not valid or supported");throw e}}async function le(e,t){const{coverageIds:n,version:i,customParameters:r,signal:s}=t,o=i.slice(0,3),u={service:"WCS",request:"DescribeCoverage",version:i,["1.0"===o?"coverage":"1.1"===o?"identifiers":"coverageId"]:n.join(","),...r};try{const{data:t}=await(0,k.Z)(e,{query:u,responseType:"xml",signal:s});return function(e,t){let n=null;if(n="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e,"1.0.0"===t)return(0,F.$3)(n,"CoverageOffering").map((e=>Q(e)));const i=(0,F.$3)(n,"CoverageDescription");return"1.1.0"===t||"1.1.1"===t||"1.1.2"===t?i.map((e=>ee(e,t))):i.map((e=>ae(e)))}(t,i)}catch(e){if(!(0,l.D_)(e))throw new a.Z("wcslayer:open","wcs coverage description is not valid or supported");throw e}}var ue=n(68004),ce=n(36129);function pe(e){const t=function(e){const t=e.getHeader?.("Content-Type")?.split(";");if(!t)return null;if(!(t[0].trim()??"").startsWith("multipart/"))return null;const n={boundary:"",start:"",type:""};for(let e=1;e<t.length;e++){const i=t[e].indexOf("=");if(i>0){const r=t[e].slice(0,i).trim(),s=t[e].slice(i+1).trim();n[r]=s.startsWith('"')?s.slice(1,-1):s}}return n}(e);return t?{isMultipart:!0,data:t.boundary?de(e.data,t,0):null}:{isMultipart:!1,data:null}}function de(e,t,n=0){const i="--"+t.boundary,r=[];for(let e=0;e<i.length;e++)r.push(i.charCodeAt(e));const s=[],a="\n--"+t.boundary+"--";for(let e=0;e<a.length;e++)s.push(a.charCodeAt(e));const o=[10],l=[13,10],u=[],c=r.length,p=new Uint8Array(e,n),d=p.length-c;let f=0,m=0;for(let e=0;e<d;e++){for(m=0;m<c&&p[e+m]===r[m];m++);if(m!==c)continue;let n=!1;if(f){const i=fe(p.subarray(f,e),t);u.push(i),n=!!i.isValidImage}if(e+=c-1,p[e+1]===o[0]?e+=1:p[e+1]===l[0]&&p[e+2]===l[1]&&(e+=2),f=e+1,n)break}const h=s.length;for(let e=p.length-h-10;e<p.length-h;e++){for(m=0;m<h&&p[e+m]===s[m];m++);if(m===h){u.push(fe(p.subarray(f,e),t));break}}return u}function fe(e,t){const n=String.fromCharCode.apply(null,e.subarray(0,Math.min(300,e.length))).split("\n"),i=Math.min(n.length,7),r={contentDisposition:"inline"};let s=0;for(let a=0;a<i;a++)if(n[a].length<4)s=s+n[a].length+1;else if("content"===n[a].slice(0,7).toLowerCase()){s=s+n[a].length+1;const e=n[a].indexOf(":");if(-1===e)continue;const t=n[a].slice(0,e).trim(),i=n[a].slice(e+1).trim();switch(t.toLowerCase()){case"content-type":r.contentType=i;break;case"content-description":r.contentDescription=i;break;case"content-transfer-encoding":r.contentTransferEncoding=i;break;case"content-id":r.contentID=i;break;case"content-disposition":r.contentDisposition=i;break;case"content-location":r.contentLocation=i}}else{if(r.contentDisposition.toLowerCase().includes("inline")&&n[a].length>=4&&r.contentType?.toLowerCase().indexOf("image")>-1){let t=!0,n=e.subarray(s,e.length);if(r.contentType.toLowerCase().indexOf("tif")>0){if("base64"===r.contentTransferEncoding){let e="";const t=n;for(let n=0;n<t.length;n+=65535){const i=t.subarray(n,n+65535>t.length-1?t.length-1:n+65535);e+=String.fromCharCode.apply(null,i)}const i=atob(e);n=new Uint8Array(i.length);for(let e=0;e<n.length;e++)n[e]=i.charCodeAt(e)}t=73===n[0]&&73===n[1]||77===n[0]&&77===n[1]}if(t){let t=n.buffer;"base64"!==r.contentTransferEncoding&&(t=new ArrayBuffer(e.length-s),n=new Uint8Array(t),n.set(e.subarray(s,e.length))),r.contentData=t,r.isValidImage=!0}break}if((""===t.start||r.contentID===t.start)&&r.contentType){if(r.contentType.includes("text")||r.contentType.includes("xml")){r.contentData=String.fromCharCode.apply(null,e.subarray(s,e.length));break}r.contentData=e.subarray(s,e.length)}}return r}var me=n(89014),he=n(91172);const ge=["nearest neighbor","bilinear","bicubic"],ye=["nearest","linear","cubic"],ve="response is not a supported multipart/related mediaType with inline tiff,  switching to compatibility mode",be=new Set(["1.0.0","1.1.0","1.1.1","1.1.2","2.0.1"]);let we=class extends ce.Z{constructor(){super(...arguments),this.datasetFormat="WCSServer",this.tileType="Raster"}get rasterId(){return`${this.url}-${this.coverageId}-${this.version}`}async fetchRawTile(e,t,n,i={}){if(this.isBlockOutside(e,t,n))return null;const{nativePixelSize:r,spatialReference:s}=this.rasterInfo,o=2**e,l=r.x*o,u=r.y*o,{blockWidth:c,blockHeight:p}=this.getBlockWidthHeight(e),{origin:d}=this.rasterInfo.storageInfo.tileInfo,f=this.getTileExtent({x:l,y:u},t,n,d,s,[c,p]),m=this.rasterInfo.extent,h=f.xmax>m.xmax,g=f.ymin<m.ymin,y=h||g;let v=f,b=c,w=p;if(y&&(v=f.clone().intersection(m),null!=v&&(h&&(b=Math.floor((v.xmax-v.xmin)/l),v.xmax=v.xmin+l*b),g&&(w=Math.floor((v.ymax-v.ymin)/u),v.ymin=v.ymax-u*w))),null==v||b<=1||w<=1)return null;const x=await this._getCoverage(v,b,w,o,i);if(!x)return null;const{coverageDescription:I}=this.coverageInfo,{noDataValue:C,multidimensionalInfo:S}=this.rasterInfo,{multidimensionalDefinition:T}=i;let _;if(null!=S&&null!=T&&T.length){const e=T[0].variableName;if("2.0"===I.version){_=I.rangeType[0].find((t=>t.name===e))?.nilValue}else if("1.1"===I.version){_=I.range.find((t=>t.identifier===e))?.nullValues}}const E=_??C,k=await this.decodePixelBlock(x,{width:b,height:w,planes:null,pixelType:null,tiffNoDataValue:Array.isArray(E)?E[0]:E,matchAllNoData:!0});if(null==k)return null;if(k&&(k.width!==b||k.height!==w))throw new a.Z("wcsraster-fetch",`the response has unexpected dimension width: ${k.width}, height: {pixelBlock.height}`);return y?(0,he.oq)(k,{x:0,y:0},{width:p,height:p}):k}async _open(e){const{customFetchParameters:t}=this.ioConfig,n=e?.signal,i=await oe(this.url,{version:t?.version??this.version,customParameters:t,signal:n});if(this.capabilities=i,!this.version){let e=i.version.slice(0,3);"2.0"===e||"1.1"===e||"1.0"===e?this.version=i.version:(e=i.supportedVersions.find((e=>"2.0.1"===e))||i.supportedVersions.find((e=>"2.0"===e.slice(0,3)))||i.supportedVersions.find((e=>"1.1"===e.slice(0,3)))||i.supportedVersions.find((e=>"1.0"===e.slice(0,3)))||"1.0.0",this.version=e)}const{version:r}=this;if(!be.has(r))throw new a.Z("wcsraster-open",`unsupported WCS version ${r}`);const{gridCoverages:s}=i;if(!s.length)throw new a.Z("wcsraster-open","cannot find rectified grid coverages");this.coverageId??=s[0].id;const{coverageId:o}=this,l=s.find((e=>e.id===o));if(null==l)throw new a.Z("wcsraster-open",`the coverageId ${o} does not exist in capabilities`);const u=await le(this.url,{coverageIds:[o],version:r,customParameters:t,signal:n});if(this.coverageInfo=u[0],"2.0"===r.slice(0,3)){const{coverageInfo:e}=this;e.lonLatEnvelope=l.lonLatEnvelope,e.supportedInterpolations=j(i.supportedInterpolations),this._patchDimensionValues201(o,n)}this.datasetName=this.coverageInfo.title;const{rasterInfo:c}=this.coverageInfo;if(this.createRemoteDatasetStorageInfo(c,512,512),this._set("rasterInfo",c),null==c.spatialReference)throw new a.Z("wcsraster-open",`coverage without spatial reference is not supported: ${o}`);const{pixelType:p,bandCount:d}=await this._getPixelTypeAndBandCount(n);c.pixelType=p,1===c.bandCount&&d>1&&(c.bandCount=d),this.updateTileInfo()}async _patchDimensionValues201(e,t){const{coverageInfo:n}=this,i=n.rasterInfo.multidimensionalInfo?.variables,r=be.has("1.1.2")?"1.1.2":be.has("1.1.1")?"1.1.1":be.has("1.1.0")?"1.1.0":null,{customFetchParameters:s}=this.ioConfig;if(i&&r)try{const n=this.url.includes("/ImageServer/"),a=e.length>8&&e.startsWith("Coverage")&&n?e.slice(8):e,o=(await le(this.url,{coverageIds:[a??e],version:r,customParameters:s,signal:t}).catch((()=>{if(a)return le(this.url,{coverageIds:[e],version:r,customParameters:s,signal:t})})))?.[0].rasterInfo.multidimensionalInfo?.variables;if(o)for(const e of i){const t=o.find((({name:t})=>t===e.name));if(t?.dimensions?.length)for(let i=e.dimensions.length-1;i>=0;i--){const r=e.dimensions[i],s=t.dimensions.find((({name:e})=>e===r.name));s?s.values&&s.extent?.join(",")===r.extent?.join(",")&&(e.dimensions[i]={...r,values:s.values}):n&&e.dimensions.splice(i,1)}}}catch{}}async _getPixelTypeAndBandCount(e){const{pixelSize:t,extent:n,multidimensionalInfo:i}=this.rasterInfo,r=n.center,s=new _.Z({xmin:r.x-t.x,xmax:r.x+t.x,ymin:r.y-t.y,ymax:r.y+t.y,spatialReference:n.spatialReference});let o=[];if(null!=i){const e=i.variables[0];o=[],e.dimensions.forEach((t=>{o.push(new ue.Z({variableName:e.name,dimensionName:t.name,values:t.hasRegularIntervals?t.extent?.[0]:t.values?.[0],isSlice:!0}))}))}const{coverageDescription:l}=this.coverageInfo,u={interpolation:"nearest",multidimensionalDefinition:o,signal:e},{version:c}=l,{ioConfig:d}=this,f="2.0"===c&&null==d.allowAnyMediaType||"1.1"===c&&null==d.use2GridOffsets;let m;try{m=await this._getCoverage(s,2,2,1,u,!0)}catch(e){if(!f)throw e;if("1.1"===c){if(!e.details?.isResolutionMismatch)throw e;d.use2GridOffsets=!0}}if(!m&&f&&("2.0"===c&&(d.allowAnyMediaType=!0),m=await this._getCoverage(s,2,2,1,u),m&&p.Z.getLogger(this).warn("wcsraster:getcoverage",ve)),!m)throw new a.Z("wcsraster-open","unable to determine pixel type");const h=await this.decodePixelBlock(m,{width:2,height:2,planes:null,pixelType:null});if(null==h)throw new a.Z("wcsraster-open","unable to determine pixel type");return{pixelType:h.pixelType,bandCount:h.getPlaneCount()??0}}async _getCoverage(e,t,n,i,r,s=!1){const{coverageDescription:o}=this.coverageInfo,{version:l}=o,u="2.0"===l?this._getCoverage201Parameters(e,t,n,i,r,o):"1.1"===l?this._getCoverage110Parameters(e,t,n,r,o):this._getCoverage100Parameters(e,t,n,r),c="2.0"===l?await this.request(this._constructWCS201Url(u),{signal:r.signal,responseType:"array-buffer"}):await this.request(this.url,{query:u,signal:r.signal,responseType:"array-buffer"});if("1.0"===l)return c.data;if("2.0"===l&&!1!==this.ioConfig.allowAnyMediaType&&"tiff"===(0,me.y)(c.data))return s&&(this.ioConfig.allowAnyMediaType=!0,p.Z.getLogger(this).warn("wcsraster:getcoverage",ve)),c.data;const d=pe(c);if(d.isMultipart&&d.data){const e=d.data.find((e=>e.isValidImage));return s&&"base64"===e?.contentTransferEncoding&&p.Z.getLogger(this).warn("wcsraster:getcoverage","response is base64 encoded which may impact layer display performance"),e?.contentData}const f=new Uint8Array(c.data,0,Math.min(c.data.byteLength,2e3)),m=String.fromCharCode.apply(null,f).toLowerCase().includes("exception"),h=m&&String.fromCharCode.apply(null,f).includes("A non-zero RESX/RESY or WIDTH/HEIGHT is required but neither was provided");if(m)throw new a.Z("wcsraster:getcoverage","server returns an exception",{isResolutionMismatch:h});throw new a.Z("wcsraster:getcoverage","response is not a supported multipart mediaType with inline tiff")}_getInterpolationIndex(e){return e&&this.coverageInfo.supportedInterpolations?.includes(e)?"nearest"===e?0:"bilinear"===e?1:"cubic"===e?2:0:0}_getCoverage100Parameters(e,t,n,i){const r=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`,s=e.spatialReference.wkid,a=(this.coverageInfo.supportedFormats||[]).find((e=>e.toLowerCase().includes("tiff")))||"GEOTIFF",{bandIds:o,interpolation:l}=i,u=this._getInterpolationIndex(l),c=o?o.map((e=>this.coverageInfo.bandNames[e])):null,p=ge[u],{multidimensionalDefinition:d}=i;let f;if(null!=d&&null!=this.rasterInfo.multidimensionalInfo){let e=d.find((e=>"StdTime"===e.dimensionName))?.values;e&&e.length>0&&(Array.isArray(e[0])&&(e=e[0]),f=e.map((e=>xe(e))).join(","))}return{service:"WCS",request:"GetCoverage",version:this.version,coverage:this.coverageId,format:a,crs:`EPSG:${s}`,bbox:r,width:t,height:n,time:f,interpolation:p,band:c?.join(",")}}_getCoverage110Parameters(e,t,n,i,r){const{multidimensionalDefinition:s,bandIds:a,interpolation:o}=i,l=e.spatialReference.wkid,u=`urn:ogc:def:crs:EPSG::${l}`,c=(this.coverageInfo.supportedFormats||[]).find((e=>e.toLowerCase().includes("tiff")))||"image/tiff",p=this._getInterpolationIndex(o),d=ye[p],f=null==o||0===this.coverageInfo.supportedInterpolations?.indexOf(o),m=r.domain.spatialDomain,h=m.origin.x<=m.envelope.xmin&&m.origin.y<=m.envelope.ymin,g=e.width/t,y=e.height/n*(h?1:-1),v=h?[e.xmin,e.ymin]:[e.xmin,e.ymax],b=m.useEPSGAxis&&(0,E.A)(l),w=b?`${v[1]},${v[0]}`:`${v[0]},${v[1]}`,x=this.ioConfig.use2GridOffsets,I=b?x?`${y},${g}`:`${y},0,0,${g}`:x?`${g},${y}`:`${g},0,0,${y}`,C=g/2,S=e.xmin+C,T=e.xmax-C,_=Math.abs(y)/2,k=e.ymin+_,F=e.ymax-_,A=b?`${k},${S},${F},${T},${u}`:`${S},${k},${T},${F},${u}`,$=r.range.find((e=>e.axis.some((e=>e.identifier.toLowerCase().includes("band")))));let D,P=$&&d&&a?f?`${$.identifier}[${$.axis[0].identifier}[${a.join(",")}]]`:`${$.identifier}:${d}[${$.axis[0].identifier}[${a.join(",")}]]`:null;if(null!=s&&s.length)for(let e=0;e<s.length;e++){let t=s[e].values;const n=s[e].dimensionName?.toLowerCase(),i=s[e].variableName?.toLowerCase(),a=r.range.find((e=>e.identifier.toLowerCase()===i));if(t.length>0)if(Array.isArray(t[0])&&(t=t[0]),"stdtime"===n)D=t.map((e=>xe(e))).join(",");else if(a){const e=a.axis.find((e=>e.identifier.toLowerCase()===n));e&&(P=f?a.identifier+"["+e.identifier+"["+t.join(",")+"]]":a.identifier+":"+d+"["+e.identifier+"["+t.join(",")+"]]")}e===s.length-1&&a&&!P&&(P=f?a.identifier:a.identifier+":"+d)}return{service:"WCS",request:"GetCoverage",version:this.version,identifier:this.coverageId,format:c,crs:`EPSG:${l}`,boundingbox:A,gridCS:"urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS",gridType:"urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs",gridOrigin:w,gridOffsets:I,gridBaseCRS:u,timeSequence:D,rangeSubset:P}}_getCoverage201Parameters(e,t,n,i,r,s){const{multidimensionalDefinition:a,interpolation:o}=r,l=this._getInterpolationIndex(o);let u=null;const{supportedInterpolations:c}=this.capabilities;if(c?.length)switch(l){case 0:u=c.find((e=>e.toLowerCase().includes("nearest")));break;case 1:u=c.find((e=>e.toLowerCase().includes("linear")));break;case 2:u=c.find((e=>e.toLowerCase().includes("cubic")||e.toLowerCase().includes("quadratic")))}const p=(this.coverageInfo.supportedFormats||[]).find((e=>e.toLowerCase().includes("tiff")))||"image/tiff",{bandNames:d}=this.coverageInfo,{boundedBy:f,domainSet:m,rangeType:h}=s,g=f.isEastFirst?0:1,y=1-g,{axisLabels:v}=f,b=v[g],w=v[y],x=`http://www.opengis.net/def/crs/EPSG/0/${e.spatialReference.wkid}`,I=x,C=[];C.push(`${b}(${e.xmin},${e.xmax})`),C.push(`${w}(${e.ymin},${e.ymax})`);const S=[];if(v.length>2)for(let e=2;e<v.length;e++){const t=m.origin[e];if(v[e].toLowerCase().includes("time")){let n=t.toString();f.uomLabels?.[e].toLowerCase().includes("ole")&&(S.push(v[e]),n=xe(t,!0)),C.push(v[e]+",http://www.opengis.net("+n+")")}else C.push(v[e]+",http://www.opengis.net("+t+")")}let T=null;if(null!=a&&a.length){const e=[];h.forEach((t=>t.forEach((t=>e.push(t.name)))));const t=[];for(let n=0;n<a.length;n++){const i=v.find((e=>e===a[n].dimensionName)),r=e.find((e=>e===a[n].variableName));if(t.includes(r)||t.push(r),i){let e=a[n].values;if(e.length>0){Array.isArray(e[0])&&(e=e[0]);let t="";t=i.toLowerCase().includes("time")?e.map((e=>xe(e))).join(","):e.join(",");const n=C.findIndex((e=>0===e.indexOf(i+",http://www.opengis.net")));-1===n&&C.push(i+",http://www.opengis.net("+t+")"),-1===n||C[n].includes("("+t+")")||C.splice(n,1,i+",http://www.opengis.net("+t+")")}}}t.length&&(T=t.join(","))}else d?.length>=2&&(T=(r.bandIds?r.bandIds.map((e=>d[e])):d).join(","));const _=C.join("&subset="),E=!s.domainSet.hasSameAxisLabelsAsBoundedBy&&!1!==this.ioConfig.allowScaleFactor,k=E?null:`${b}(${t}),${w}(${n})`,F=E?1/i:null;return{service:"WCS",request:"GetCoverage",version:this.version,coverageId:this.coverageId,rangesubset:T,interpolation:u,scaleSize:k,scaleFactor:F,subset:_,format:p,mediaType:this.ioConfig.allowAnyMediaType?null:"multipart/related",outputcrs:x,subsettingcrs:I}}_constructWCS201Url(e){const t={...this.ioConfig.customFetchParameters,...e},n=[];return Object.keys(t).forEach((e=>{const i=t[e];null!=i&&("subset"===e?"string"==typeof i&&i.split("&subset=").forEach((e=>{e&&n.push(`subset=${encodeURIComponent(e)}`)})):n.push(`${e}=${encodeURIComponent(i)}`))})),`${encodeURI(this.url)}?${n.join("&")}`}};function xe(e,t=!1){return(t?new Date((0,N.de)(e)):new Date(e)).toISOString()}(0,i._)([(0,c.Cb)({type:String,json:{write:!0}})],we.prototype,"datasetFormat",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],we.prototype,"tileType",void 0),(0,i._)([(0,c.Cb)({type:String,json:{write:!0}})],we.prototype,"version",void 0),(0,i._)([(0,c.Cb)({type:String,json:{write:!0}})],we.prototype,"coverageId",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],we.prototype,"rasterId",null),we=(0,i._)([(0,d.j)("esri.layers.support.rasterDatasets.WCSRaster")],we);var Ie=n(99382),Ce=n(3651);const Se=new Set(["milliseconds","seconds","minutes","hours","days","weeks","months","years","decades","centuries"]);let Te=class extends((0,m.h7)((0,x.M)((0,y.q)((0,v.I)((0,h.N)((0,g.r)((0,b.f)((0,I.n)((0,w.Q)((0,o.R)(s.Z.ClonableMixin(f.Z)))))))))))){constructor(...e){super(...e),this.coverageId=null,this.version=null,this.isReference=null,this.legendEnabled=!0,this.noData=0,this.operationalLayerType="WCS",this.type="wcs",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null,this._debouncedSaveOperations=(0,l.Ds)((async(e,t,i)=>{const{save:r,saveAs:s}=await n.e(58722).then(n.bind(n,58722));switch(e){case Ce.x.SAVE:return r(this,t);case Ce.x.SAVE_AS:return s(this,i,t)}}))}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WCS"]},e).catch(l.r9).then((()=>this._openRaster(t)))),Promise.resolve(this)}get coverageInfo(){return this.raster.coverageInfo}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){const e=[(0,T.Zp)("Pixel Value")],t=(this.raster?.rasterInfo??this.serviceRasterInfo)?.multidimensionalInfo;if(t){const n=(0,T.Mk)(t);e.push(...n)}return e}createPopupTemplate(e){return(0,Ie.eZ)({fields:this.rasterFields,title:this.title},e)}async save(e){return this._debouncedSaveOperations(Ce.x.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(Ce.x.SAVE_AS,t,e)}async _openRaster(e){const t=new we({url:this.url,version:this.version,coverageId:this.coverageId,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters}});if(await t.open({signal:e}),!t.rasterInfo)throw t.destroy(),new a.Z("wcs-layer:load","cannot load resources on "+this.url);const{rasterInfo:n}=t;null==n.noDataValue&&(n.noDataValue=this.noData),this._set("serviceRasterInfo",n),this._set("spatialReference",n.spatialReference),null==this.title&&this.setAtOrigin("title",t.datasetName,"service"),null==this.coverageId&&this.setAtOrigin("coverageId",t.coverageInfo.id,"service"),null==this.version&&t.version&&this.setAtOrigin("version",t.version,"service"),this.setAtOrigin("tileInfo",t.rasterInfo.storageInfo.tileInfo,"service");const{multidimensionalInfo:i}=n;if(null!=i){const e=i.variables[0].dimensions.find((({name:e})=>"StdTime"===e));if(e){let t=e.extent?.[0]??e.values[0];Array.isArray(t)&&(t=t[0]);let n=e.extent?.[1]??e.values[e.values.length-1];Array.isArray(n)&&(n=n[1]);const i=Se.has(e.intervalUnit?.toLowerCase())?e.intervalUnit?.toLowerCase():null;this.set("timeInfo",{startField:"StdTime",fullTimeExtent:{start:t,end:n},timeZone:null,interval:i?{value:e.interval,unit:i}:null})}}this.raster=t,this._configDefaultSettings(),this.addHandles((0,u.YP)((()=>this.customParameters),(e=>this.raster.ioConfig.customFetchParameters=e)))}};(0,i._)([(0,c.Cb)({type:String,nonNullable:!0,json:{name:"wcsInfo.coverageId",write:{isRequired:!0,ignoreOrigin:!0}}})],Te.prototype,"coverageId",void 0),(0,i._)([(0,c.Cb)()],Te.prototype,"coverageInfo",null),(0,i._)([(0,c.Cb)({type:["1.0.0","1.1.0","1.1.1","1.1.2","2.0.1"],nonNullable:!0,json:{name:"wcsInfo.version",write:{isRequired:!0,ignoreOrigin:!0}}})],Te.prototype,"version",void 0),(0,i._)([(0,c.Cb)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],Te.prototype,"isReference",void 0),(0,i._)([(0,c.Cb)({json:{read:!0,write:!0}})],Te.prototype,"blendMode",void 0),(0,i._)([(0,c.Cb)(C.rn)],Te.prototype,"legendEnabled",void 0),(0,i._)([(0,c.Cb)({type:["show","hide"]})],Te.prototype,"listMode",void 0),(0,i._)([(0,c.Cb)()],Te.prototype,"noData",void 0),(0,i._)([(0,c.Cb)({type:["WCS"]})],Te.prototype,"operationalLayerType",void 0),(0,i._)([(0,c.Cb)()],Te.prototype,"raster",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],Te.prototype,"type",void 0),(0,i._)([(0,c.Cb)(C.C_)],Te.prototype,"popupEnabled",void 0),(0,i._)([(0,c.Cb)({type:r.Z,json:{name:"popupInfo",write:!0}})],Te.prototype,"popupTemplate",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],Te.prototype,"defaultPopupTemplate",null),(0,i._)([(0,c.Cb)({readOnly:!0,type:[S.Z]})],Te.prototype,"fields",void 0),(0,i._)([(0,c.Cb)({readOnly:!0,type:[S.Z]})],Te.prototype,"rasterFields",null),Te=(0,i._)([(0,d.j)("esri.layers.WCSLayer")],Te);const _e=Te},615:function(e,t,n){n.d(t,{cW:function(){return l},ij:function(){return o},rM:function(){return u}});var i=n(88194),r=n(60123),s=n(13928),a=n(8971);function o(e,t,n){try{return function(e){if(!e||0===e.length)return null;if(function(e){const t=e[0];return!!t&&"scale"in t}(e)){const t=[];for(const n of e)t.push({scale:n.scale,value:u(n.value)});return t}return u(e)}(e)}catch(e){n?.messages?.push(e)}return null}function l(e,t,n,i){try{const i=function(e){const t=(0,s.Q)(e);return t?(0,a.Cb)(t)?t.map((e=>e.toJSON())):t.map((({scale:e,effects:t})=>({scale:e,value:t.map((e=>e.toJSON()))}))):null}(e);(0,r.RB)(n,i,t)}catch(e){i.messages&&i.messages.push(e)}}function u(e){if(!e?.length)return"";const t=[];for(const n of e){let e=[];switch(n.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":e=[c(n,"amount")];break;case"blur":e=[c(n,"radius","pt")];break;case"hue-rotate":e=[c(n,"angle","deg")];break;case"drop-shadow":e=[c(n,"xoffset","pt"),c(n,"yoffset","pt"),c(n,"blurRadius","pt"),p(n,"color")];break;case"bloom":e=[c(n,"strength"),c(n,"radius","pt"),c(n,"threshold")]}const i=`${n.type}(${e.filter(Boolean).join(" ")})`;(0,s.Q)(i),t.push(i)}return t.join(" ")}function c(e,t,n){if(null==e[t])throw new i.Z("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return n?e[t]+n:""+e[t]}function p(e,t){if(null==e[t])throw new i.Z("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const n=e[t];return`rgba(${n[0]||0}, ${n[1]||0}, ${n[2]||0}, ${n[3]/255||0})`}},13928:function(e,t,n){n.d(t,{Q:function(){return u}});var i=n(38461),r=n(88194),s=n(71480),a=n(8971);class o extends SyntaxError{constructor(e,t,n,i){super(e),this.expected=t,this.found=n,this.location=i,this.name="SyntaxError"}format(e){let t="Error: "+this.message;if(this.location){let n=null;const i=e.find((e=>e.source===this.location.source));i&&(n=i.text.split(/\r\n|\n|\r/g));const r=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(r):r,a=this.location.source+":"+s.line+":"+s.column;if(n){const e=this.location.end,i="".padEnd(s.line.toString().length," "),o=n[r.line-1],l=(r.line===e.line?e.column:o.length+1)-r.column||1;t+="\n --\x3e "+a+"\n"+i+" |\n"+s.line+" | "+o+"\n"+i+" | "+"".padEnd(r.column-1," ")+"".padEnd(l,"^")}else t+="\n at "+a}return t}static buildMessage(e,t){function n(e){return e.codePointAt(0).toString(16).toUpperCase()}const i=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function r(e){return i?e.replace(i,(e=>"\\u{"+n(e)+"}")):e}function s(e){return r(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+n(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+n(e))))}function a(e){return r(e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+n(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+n(e))))}const o={literal:e=>'"'+s(e.text)+'"',class(e){const t=e.parts.map((e=>Array.isArray(e)?a(e[0])+"-"+a(e[1]):a(e)));return"["+(e.inverted?"^":"")+t.join("")+"]"+(e.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:e=>e.description};function l(e){return o[e.type](e)}return"Expected "+function(e){const t=e.map(l);if(t.sort(),t.length>0){let e=1;for(let n=1;n<t.length;n++)t[n-1]!==t[n]&&(t[e]=t[n],e++);t.length=e}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(e)+" but "+function(e){return e?'"'+s(e)+'"':"end of input"}(t)+" found."}}function l(e,t){const n={},i=(t=void 0!==t?t:{}).grammarSource,r={start:le};let s=le;const a="none",l=",",u="grad",c="turn",p=/^[ \t\n\r]/,d=/^[a-z\-]/,f=/^[0-9a-fA-F]/,m=/^[+\-]/,h=/^[0-9]/,g=re("none"),y=ne("none",!1),v=ne(")",!1),b=ne(",",!1),w=ie([" ","\t","\n","\r"],!1,!1,!1),x=re("function"),I=ne("(",!1),C=re("identifier"),S=ie([["a","z"],"-"],!1,!1,!1),T=re("percentage"),_=ne("%",!1),E=re("length"),k=ne("px",!1),F=ne("cm",!1),A=ne("mm",!1),$=ne("in",!1),D=ne("pt",!1),P=ne("pc",!1),L=re("angle"),R=ne("deg",!1),O=ne("rad",!1),V=ne("grad",!1),N=ne("turn",!1),Z=re("number"),B=re("color"),M=ne("#",!1),j=ie([["0","9"],["a","f"],["A","F"]],!1,!1,!1),Y=ie(["+","-"],!1,!1,!1),z=ie([["0","9"]],!1,!1,!1),H=ne(".",!1),U=ne("e",!1);function W(e,t){return t.length>0?function(e,t,n){return[e].concat(function(e,t){return e.map((function(e){return e[t]}))}(t,n))}(e,t,3):[e]}let G=0|t.peg$currPos,q=G;const J=[{line:1,column:1}];let Q,K=G,X=t.peg$maxFailExpected||[],ee=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in r))throw new Error("Can't start parsing from rule \""+t.startRule+'".');s=r[t.startRule]}function te(){return e.substring(q,G)}function ne(e,t){return{type:"literal",text:e,ignoreCase:t}}function ie(e,t,n,i){return{type:"class",parts:e,inverted:t,ignoreCase:n,unicode:i}}function re(e){return{type:"other",description:e}}function se(t){let n,i=J[t];if(i)return i;if(t>=J.length)n=J.length-1;else for(n=t;!J[--n];);for(i=J[n],i={line:i.line,column:i.column};n<t;)10===e.charCodeAt(n)?(i.line++,i.column=1):i.column++,n++;return J[t]=i,i}function ae(e,t,n){const r=se(e),s=se(t);return{source:i,start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:s.line,column:s.column}}}function oe(e){G<K||(G>K&&(K=G,X=[]),X.push(e))}function le(){let e;return e=ue(),e===n&&(e=function(){let e,t;if(e=[],t=ce(),t!==n)for(;t!==n;)e.push(t),t=ce();else e=n;return e}()),e}function ue(){let t,i;return ee++,t=G,de(),e.substr(G,4)===a?(i=a,G+=4):(i=n,0===ee&&oe(y)),i!==n?(de(),q=t,t=[]):(G=t,t=n),ee--,t===n&&0===ee&&oe(g),t}function ce(){let t,i,r,s;return t=G,de(),i=function(){let t,i,r;return ee++,t=G,i=fe(),i!==n?(40===e.charCodeAt(G)?(r="(",G++):(r=n,0===ee&&oe(I)),r!==n?(q=t,t=i):(G=t,t=n)):(G=t,t=n),ee--,t===n&&(i=n,0===ee&&oe(x)),t}(),i!==n?(de(),r=function(){let t,i,r,s,a,o,u,c;if(t=G,i=pe(),i!==n){for(r=[],s=G,a=de(),44===e.charCodeAt(G)?(o=l,G++):(o=n,0===ee&&oe(b)),o===n&&(o=null),u=de(),c=pe(),c!==n?(a=[a,o,u,c],s=a):(G=s,s=n);s!==n;)r.push(s),s=G,a=de(),44===e.charCodeAt(G)?(o=l,G++):(o=n,0===ee&&oe(b)),o===n&&(o=null),u=de(),c=pe(),c!==n?(a=[a,o,u,c],s=a):(G=s,s=n);q=t,t=W(i,r)}else G=t,t=n;return t}(),r===n&&(r=null),de(),41===e.charCodeAt(G)?(s=")",G++):(s=n,0===ee&&oe(v)),s!==n?(de(),q=t,t=function(e,t){return{type:"function",name:e,parameters:t||[]}}(i,r)):(G=t,t=n)):(G=t,t=n),t}function pe(){let e,t;return e=G,t=me(),t===n&&(t=he(),t===n&&(t=ge(),t===n&&(t=function(){let e,t;return ee++,e=G,de(),t=ve(),t!==n?(q=e,e=function(e){return{value:e,unit:null}}(t)):(G=e,e=n),ee--,e===n&&0===ee&&oe(Z),e}()))),t!==n&&(q=e,t=function(e){return{type:"quantity",value:e.value,unit:e.unit}}(t)),e=t,e===n&&(e=G,t=ye(),t!==n&&(q=e,t=function(e){return{type:"color",colorType:e.type,value:e.value}}(t)),e=t),e}function de(){let t,i;for(ee++,t=[],i=e.charAt(G),p.test(i)?G++:(i=n,0===ee&&oe(w));i!==n;)t.push(i),i=e.charAt(G),p.test(i)?G++:(i=n,0===ee&&oe(w));return ee--,t}function fe(){let t,i,r;if(ee++,t=G,i=[],r=e.charAt(G),d.test(r)?G++:(r=n,0===ee&&oe(S)),r!==n)for(;r!==n;)i.push(r),r=e.charAt(G),d.test(r)?G++:(r=n,0===ee&&oe(S));else i=n;return i!==n&&(q=t,i=te()),t=i,ee--,t===n&&(i=n,0===ee&&oe(C)),t}function me(){let t,i,r;return ee++,t=G,de(),i=ve(),i!==n?(37===e.charCodeAt(G)?(r="%",G++):(r=n,0===ee&&oe(_)),r!==n?(q=t,t=function(e){return{value:e,unit:"%"}}(i)):(G=t,t=n)):(G=t,t=n),ee--,t===n&&0===ee&&oe(T),t}function he(){let t,i,r;return ee++,t=G,de(),i=ve(),i!==n?("px"===e.substr(G,2)?(r="px",G+=2):(r=n,0===ee&&oe(k)),r!==n?(q=t,t=function(e){return{value:e,unit:"px"}}(i)):(G=t,t=n)):(G=t,t=n),t===n&&(t=G,de(),i=ve(),i!==n?("cm"===e.substr(G,2)?(r="cm",G+=2):(r=n,0===ee&&oe(F)),r!==n?(q=t,t=function(e){return{value:e,unit:"cm"}}(i)):(G=t,t=n)):(G=t,t=n),t===n&&(t=G,de(),i=ve(),i!==n?("mm"===e.substr(G,2)?(r="mm",G+=2):(r=n,0===ee&&oe(A)),r!==n?(q=t,t=function(e){return{value:e,unit:"mm"}}(i)):(G=t,t=n)):(G=t,t=n),t===n&&(t=G,de(),i=ve(),i!==n?("in"===e.substr(G,2)?(r="in",G+=2):(r=n,0===ee&&oe($)),r!==n?(q=t,t=function(e){return{value:e,unit:"in"}}(i)):(G=t,t=n)):(G=t,t=n),t===n&&(t=G,de(),i=ve(),i!==n?("pt"===e.substr(G,2)?(r="pt",G+=2):(r=n,0===ee&&oe(D)),r!==n?(q=t,t=function(e){return{value:e,unit:"pt"}}(i)):(G=t,t=n)):(G=t,t=n),t===n&&(t=G,de(),i=ve(),i!==n?("pc"===e.substr(G,2)?(r="pc",G+=2):(r=n,0===ee&&oe(P)),r!==n?(q=t,t=function(e){return{value:e,unit:"pc"}}(i)):(G=t,t=n)):(G=t,t=n)))))),ee--,t===n&&0===ee&&oe(E),t}function ge(){let t,i,r;return ee++,t=G,i=ve(),i!==n?("deg"===e.substr(G,3)?(r="deg",G+=3):(r=n,0===ee&&oe(R)),r!==n?(q=t,t=function(e){return{value:e,unit:"deg"}}(i)):(G=t,t=n)):(G=t,t=n),t===n&&(t=G,i=ve(),i!==n?("rad"===e.substr(G,3)?(r="rad",G+=3):(r=n,0===ee&&oe(O)),r!==n?(q=t,t=function(e){return{value:e,unit:"rad"}}(i)):(G=t,t=n)):(G=t,t=n),t===n&&(t=G,i=ve(),i!==n?(e.substr(G,4)===u?(r=u,G+=4):(r=n,0===ee&&oe(V)),r!==n?(q=t,t=function(e){return{value:e,unit:"grad"}}(i)):(G=t,t=n)):(G=t,t=n),t===n&&(t=G,i=ve(),i!==n?(e.substr(G,4)===c?(r=c,G+=4):(r=n,0===ee&&oe(N)),r!==n?(q=t,t=function(e){return{value:e,unit:"turn"}}(i)):(G=t,t=n)):(G=t,t=n)))),ee--,t===n&&(i=n,0===ee&&oe(L)),t}function ye(){let t,i,r,s;if(ee++,t=G,35===e.charCodeAt(G)?(i="#",G++):(i=n,0===ee&&oe(M)),i!==n){if(r=[],s=e.charAt(G),f.test(s)?G++:(s=n,0===ee&&oe(j)),s!==n)for(;s!==n;)r.push(s),s=e.charAt(G),f.test(s)?G++:(s=n,0===ee&&oe(j));else r=n;r!==n?(q=t,t={type:"hex",value:te()}):(G=t,t=n)}else G=t,t=n;return t===n&&(t=G,i=ce(),i!==n&&(q=t,i=function(e){return{type:"function",value:e}}(i)),t=i,t===n&&(t=G,i=fe(),i!==n&&(q=t,i={type:"named",value:te()}),t=i)),ee--,t===n&&(i=n,0===ee&&oe(B)),t}function ve(){let t,i,r,s,a,o,l,u;for(t=G,i=e.charAt(G),m.test(i)?G++:(i=n,0===ee&&oe(Y)),i===n&&(i=null),r=G,s=[],a=e.charAt(G),h.test(a)?G++:(a=n,0===ee&&oe(z));a!==n;)s.push(a),a=e.charAt(G),h.test(a)?G++:(a=n,0===ee&&oe(z));if(46===e.charCodeAt(G)?(a=".",G++):(a=n,0===ee&&oe(H)),a!==n){if(o=[],l=e.charAt(G),h.test(l)?G++:(l=n,0===ee&&oe(z)),l!==n)for(;l!==n;)o.push(l),l=e.charAt(G),h.test(l)?G++:(l=n,0===ee&&oe(z));else o=n;o!==n?(s=[s,a,o],r=s):(G=r,r=n)}else G=r,r=n;if(r===n)if(r=[],s=e.charAt(G),h.test(s)?G++:(s=n,0===ee&&oe(z)),s!==n)for(;s!==n;)r.push(s),s=e.charAt(G),h.test(s)?G++:(s=n,0===ee&&oe(z));else r=n;if(r!==n){if(s=G,101===e.charCodeAt(G)?(a="e",G++):(a=n,0===ee&&oe(U)),a!==n){if(o=e.charAt(G),m.test(o)?G++:(o=n,0===ee&&oe(Y)),o===n&&(o=null),l=[],u=e.charAt(G),h.test(u)?G++:(u=n,0===ee&&oe(z)),u!==n)for(;u!==n;)l.push(u),u=e.charAt(G),h.test(u)?G++:(u=n,0===ee&&oe(z));else l=n;l!==n?(a=[a,o,l],s=a):(G=s,s=n)}else G=s,s=n;s===n&&(s=null),q=t,t=parseFloat(te())}else G=t,t=n;return t}Q=s();const be=Q!==n&&G===e.length;function we(){throw Q!==n&&G<e.length&&oe({type:"end"}),function(e,t,n){return new o(o.buildMessage(e,t),e,t,n)}(X,K<e.length?function(t=G){const n=e.codePointAt(t);return void 0===n?"":String.fromCodePoint(n)}(K):null,K<e.length?ae(K,K+1):ae(K,K))}return t.peg$library?{peg$result:Q,peg$currPos:G,peg$FAILED:n,peg$maxFailExpected:X,peg$maxFailPos:K,peg$success:be,peg$throw:be?void 0:we}:be?Q:void we()}function u(e){if(!e||0===e.length)return null;if("string"==typeof e){const t=c(e);return t&&0!==t.length?t:null}const t=e.map((e=>{if(!Number.isFinite(e.scale)||e.scale<=0)throw new r.Z("effect:invalid-scale","scale must be finite and greater than 0",{stop:e});return{scale:e.scale,effects:c(e.value)}}));t.sort(((e,t)=>t.effects.length-e.effects.length));for(let e=0;e<t.length-1;e++){if(!(0,a.AS)(t[e].effects,t[e+1].effects))throw new r.Z("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[e].effects,b:t[e+1].effects});(0,a.uF)(t[e].effects,t[e+1].effects)}return t.sort(((e,t)=>t.scale-e.scale)),t}function c(e){let t;if(!e)return[];try{t=l(e)}catch(t){throw new r.Z("effect:invalid-syntax","Invalid effect syntax",{value:e,error:t})}return t.map((e=>function(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(e){let t=1;return p(e.parameters,1),1===e.parameters.length&&(t=g(e.parameters[0])),new s.GI(e.name,t)}(e);case"opacity":return function(e){let t=1;return p(e.parameters,1),1===e.parameters.length&&(t=g(e.parameters[0])),new s.Zx(t)}(e);case"hue-rotate":return function(e){let t=0;return p(e.parameters,1),1===e.parameters.length&&(t=function(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=m[e.unit]))throw new r.Z("effect:type-error",`Expected <angle>, Actual: ${d(e)}`,{term:e})}(e),e.value*m[e.unit]||0}(e.parameters[0])),new s.Tq(t)}(e);case"blur":return function(e){let t=0;return p(e.parameters,1),1===e.parameters.length&&(t=v(e.parameters[0]),f(t,e.parameters[0])),new s.Tj(t)}(e);case"drop-shadow":return function(e){const t=[];let n=null;for(const i of e.parameters)if("color"===i.type){if(t.length&&Object.freeze(t),n)throw new r.Z("effect:type-error","Accepts only one color",{});n=b(i)}else{const e=v(i);if(Object.isFrozen(t))throw new r.Z("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(e),3===t.length&&f(e,i)}if(t.length<2||t.length>3)throw new r.Z("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new s.CE(t[0],t[1],t[2]||0,n||w("black"))}(e);case"bloom":return function(e){let t=1,n=0,i=0;return p(e.parameters,3),e.parameters[0]&&(t=g(e.parameters[0])),e.parameters[1]&&(n=v(e.parameters[1]),f(n,e.parameters[1])),e.parameters[2]&&(i=g(e.parameters[2])),new s.rk(t,n,i)}(e)}}catch(t){throw t.details.filter=e,t}throw new r.Z("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}(e)))}function p(e,t){if(e.length>t)throw new r.Z("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function d(e){if("color"===e.type)return"<color>";if(e.unit){if(e.unit in h)return"<length>";if(e.unit in m)return"<angle>";if("%"===e.unit)return"<percentage>"}return"<double>"}function f(e,t){if(e<0)throw new r.Z("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}const m={deg:1,grad:.9,rad:180/Math.PI,turn:360};const h={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function g(e){!function(e){if("quantity"!==e.type||null!==e.unit&&"%"!==e.unit)throw new r.Z("effect:type-error",`Expected <double> or <percentage>, Actual: ${d(e)}`,{term:e})}(e);const t=e.value;return f(t,e),"%"===e.unit?.01*t:t}function y(e){return function(e){if("quantity"!==e.type||null!==e.unit)throw new r.Z("effect:type-error",`Expected <double>, Actual: ${d(e)}`,{term:e})}(e),f(e.value,e),e.value}function v(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=h[e.unit]))throw new r.Z("effect:type-error",`Expected <length>, Actual: ${d(e)}`,{term:e})}(e),e.value*h[e.unit]||0}function b(e){switch(e.colorType){case"hex":return(0,i.a7)(e.value);case"named":return w(e.value);case"function":return function(e){if(p(e.parameters,4),x.test(e.name))return[g(e.parameters[0]),g(e.parameters[1]),g(e.parameters[2]),e.parameters[3]?g(e.parameters[3]):1];if(I.test(e.name))return(0,i.Y6)(y(e.parameters[0]),g(e.parameters[1]),g(e.parameters[2]),e.parameters[3]?g(e.parameters[3]):1);throw new r.Z("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}(e.value)}}function w(e){if(!(0,i.St)(e))throw new r.Z("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return(0,i.VL)(e)}const x=/^rgba?/i,I=/^hsla?/i},83263:function(e,t,n){n.d(t,{h7:function(){return p},nE:function(){return l},qu:function(){return c}});var i=n(73440),r=n(17155),s=(n(61432),n(96711),n(83850),n(48023)),a=n(71840),o=n(615);const l={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:{layerContainerTypes:a.C}},"portal-item":{read:!0,write:{layerContainerTypes:a.C}}}}},u={read:{reader:o.ij},write:{allowNull:!0,writer:o.cW,layerContainerTypes:a.C}},c={json:{read:!1,write:!1,origins:{"web-map":u,"portal-item":u}}},p=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return(0,i._)([(0,r.Cb)(l)],t.prototype,"blendMode",void 0),(0,i._)([(0,r.Cb)(c)],t.prototype,"effect",void 0),t=(0,i._)([(0,s.j)("esri.layers.mixins.BlendLayer")],t),t}},55591:function(e,t,n){n.d(t,{N:function(){return a}});var i=n(73440),r=n(17155),s=(n(61432),n(96711),n(83850),n(48023));const a=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return(0,i._)([(0,r.Cb)({type:Object,json:{write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0)})}}})],t.prototype,"customParameters",void 0),t=(0,i._)([(0,s.j)("esri.layers.mixins.CustomParametersMixin")],t),t}},27202:function(e,t,n){n.d(t,{I:function(){return I}});var i=n(73440),r=n(81001),s=n(10218),a=n(78619),o=n(29292),l=n(88194),u=n(96711),c=n(61100),p=n(93568),d=n(95490),f=n(17155),m=(n(61432),n(83850),n(1194)),h=n(48023),g=n(29884),y=n(75428),v=n(77601),b=n(96193),w=n(91525),x=n(47626);const I=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,c.SC)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,n){if(t.itemId)return new b.default({id:t.itemId,portal:n?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem?.id)try{const{load:i}=await n.e(64975).then(n.bind(n,64975));return(0,p.k_)(t),await i({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData,layerModuleTypeMap:e.layerModuleTypeMap,populateGroupLayer:e.populateGroupLayer},t)}catch(e){throw(0,p.D_)(e)||u.Z.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${e}`),e}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(e).catch((e=>((0,p.r9)(e),!0))))}async setUserPrivileges(e,t){if(!r.default.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(t);if(this.url)try{const{features:{edit:n,fullEdit:i},content:{updateItem:r}}=await this._fetchUserPrivileges(e,t);this._set("userHasEditingPrivileges",n),this._set("userHasFullEditingPrivileges",i),this._set("userHasUpdateItemPrivileges",r)}catch(e){(0,p.r9)(e)}}async _fetchUserPrivileges(e,t){let n=this.portalItem;if(!e||!n||!n.loaded||n.sourceUrl)return this._fetchFallbackUserPrivileges(t);const i=!s.id?.findCredential(this.url),r=e===n.id;if(r&&n.portal.user)return this._getUserPrivileges(n,i);let a,o;if(r)a=n.portal.url;else try{a=await(0,y.oP)(this.url,t)}catch(e){(0,p.r9)(e)}if(!a||!(0,d.Zo)(a,n.portal.url))return this._fetchFallbackUserPrivileges(t);try{const e=null!=t?t.signal:null;o=await(s.id?.getCredential(`${a}/sharing`,{prompt:!1,signal:e}))}catch(e){(0,p.r9)(e)}if(!o)return{features:{edit:true,fullEdit:false},content:{updateItem:false}};try{if(r?await n.reload():(n=new b.default({id:e,portal:{url:a}}),await n.load(t)),n.portal.user)return this._getUserPrivileges(n,i)}catch(e){(0,p.r9)(e)}return{features:{edit:true,fullEdit:false},content:{updateItem:false}}}_getUserPrivileges(e,t){const n=(0,x.Ss)(e);return t&&(n.features.edit=!0),n}async _fetchFallbackUserPrivileges(e){let t=!0;try{t=await this._fetchUserHasEditingPrivileges(e)}catch(e){(0,p.r9)(e)}return{features:{edit:t,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(e){const t=this.url?s.id?.findCredential(this.url):null;if(!t)return!0;const n=C.credential===t?C.user:await this._fetchEditingUser(e);return C.credential=t,C.user=n,null==n?.privileges||n.privileges.includes("features:user:edit")}async _fetchEditingUser(e){const t=this.portalItem?.portal?.user;if(t)return t;const n=s.id?.findServerInfo(this.url??"");if(!n?.owningSystemUrl)return null;const i=`${n.owningSystemUrl}/sharing/rest`,r=v.Z.getDefault();if(r&&r.loaded&&(0,d.Fv)(r.restUrl)===(0,d.Fv)(i))return r.user;const l=`${i}/community/self`,u=null!=e?e.signal:null,c=await(0,o.q6)((0,a.Z)(l,{authMode:"no-prompt",query:{f:"json"},signal:u}));return c.ok?w.Z.fromJSON(c.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const n=t?.portal,i=this.portalItem?.id&&(this.portalItem.portal||v.Z.getDefault());return n&&i&&!(0,d.tm)(i.restUrl,n.restUrl)?(t.messages&&t.messages.push(new l.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return(0,i._)([(0,f.Cb)({type:b.default})],t.prototype,"portalItem",null),(0,i._)([(0,m.r)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),(0,i._)([(0,g.c)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),(0,i._)([(0,f.Cb)({clonable:!1})],t.prototype,"resourceReferences",void 0),(0,i._)([(0,f.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),(0,i._)([(0,f.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasFullEditingPrivileges",void 0),(0,i._)([(0,f.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasUpdateItemPrivileges",void 0),t=(0,i._)([(0,h.j)("esri.layers.mixins.PortalLayer")],t),t},C={credential:null,user:null}},19306:function(e,t,n){n.d(t,{Q:function(){return x},d:function(){return w}});var i=n(73440),r=(n(61432),n(96711)),s=n(93568),a=n(17155),o=n(90775),l=(n(83850),n(48023)),u=n(71840),c=n(43254),p=n(90403),d=n(21260);const f=new c.Z,m=new WeakMap;function h(e){return null!=e&&"object"==typeof e&&"refreshInterval"in e&&"refresh"in e}function g(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:g(t,e%t):0}let y=0,v=0;function b(){const e=Date.now();let t=!1;for(const n of f){const i=n.deref();i?i.refreshInterval&&e-(m.get(i)??0)+5>=6e4*i.refreshInterval&&(m.set(i,e),i.refresh(e)):t=!0}if(t)for(let e=f.length-1;e>=0;e--)f.at(e).deref()||f.removeAt(e)}(0,d.EH)((()=>{const e=Date.now();let t=0;for(const n of f){const i=n.deref();i&&(t=g(Math.round(6e4*i.refreshInterval),t),i.refreshInterval?m.get(i)||m.set(i,e):m.delete(i))}if(t!==v){if(v=t,clearInterval(y),0===v)return void(y=0);y=setInterval(b,v)}}),p.Z_);function w(e){return null!=e&&"object"==typeof e&&"refreshTimestamp"in e&&"refresh"in e}const x=e=>{let t=class extends e{constructor(...e){super(...e),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,s.Ds)((()=>this.hasDataChanged())),this.when().then((()=>{this.destroyed||function(e){h(e)&&f.push(new WeakRef(e))}(this)}),(()=>{}))}destroy(){!function(e){const t=f.find((t=>t.deref()===e));t&&f.remove(t)}(this)}castRefreshInterval(e){return e>=.1?e:e<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(e=Date.now()){(0,s.R8)(this._debounceHasDataChanged()).then((t=>{t&&this._set("refreshTimestamp",e),this.emit("refresh",{dataChanged:t})}),(e=>{r.Z.getLogger(this).error(e),this.emit("refresh",{dataChanged:!1,error:e})}))}async hasDataChanged(){return!0}get test(){}};return(0,i._)([(0,a.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:u.C}}}}})],t.prototype,"refreshInterval",void 0),(0,i._)([(0,o.p)("refreshInterval")],t.prototype,"castRefreshInterval",null),(0,i._)([(0,a.Cb)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),(0,i._)([(0,a.Cb)({readOnly:!0})],t.prototype,"refreshParameters",null),t=(0,i._)([(0,l.j)("esri.layers.mixins.RefreshableLayer")],t),t}},3752:function(e,t,n){n.d(t,{M:function(){return a}});var i=n(73440),r=n(17155),s=(n(61432),n(96711),n(83850),n(48023));const a=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const e={minScale:this.minScale,maxScale:this.maxScale},t=this.parent;t&&"effectiveScaleRange"in t&&function(e,t){e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale}(e,t.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===e.minScale&&n.maxScale===e.maxScale?n:e}};return(0,i._)([(0,r.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),(0,i._)([(0,r.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=(0,i._)([(0,s.j)("esri.layers.mixins.ScaleRangeLayer")],t),t}},99671:function(e,t,n){n.d(t,{I:function(){return f},n:function(){return m}});var i=n(73440),r=n(17155),s=(n(61432),n(96711),n(83850),n(1194)),a=n(48023),o=n(71840),l=n(76554),u=n(83918),c=n(24009),p=n(85913),d=n(62920);const f={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:o.C}}},m=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const n=t.timeInfo.exportOptions;if(!n)return null;const i=n.timeOffset,r=c.v.fromJSON(n.timeOffsetUnits);return i&&r?new d.T({value:i,unit:r}):null}set timeInfo(e){(0,l.UF)(e,this.fieldsIndex),this._set("timeInfo",e)}};return(0,i._)([(0,r.Cb)({type:p.T,json:{write:!1}})],t.prototype,"timeExtent",void 0),(0,i._)([(0,r.Cb)({type:d.T})],t.prototype,"timeOffset",void 0),(0,i._)([(0,s.r)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),(0,i._)([(0,r.Cb)({value:null,type:u.Z,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),(0,i._)([(0,r.Cb)(f)],t.prototype,"useViewTime",void 0),t=(0,i._)([(0,a.j)("esri.layers.mixins.TemporalLayer")],t),t}},62065:function(e,t,n){n.d(t,{A:function(){return r}});const i=[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]];function r(e){return null!=e&&i.some((([t,n])=>e>=t&&e<=n))}},83918:function(e,t,n){n.d(t,{Z:function(){return m}});var i=n(73440),r=n(89314),s=n(63255),a=n(17155),o=(n(61432),n(96711),n(83850),n(1194)),l=n(48023),u=n(29884),c=n(85913),p=n(62920),d=n(88097);function f(e,t){return p.T.fromJSON({value:e,unit:t})}let m=class extends(r.Z.ClonableMixin(s.Z)){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,t){return t.timeExtent&&Array.isArray(t.timeExtent)&&2===t.timeExtent.length?c.T.fromArray(t.timeExtent):null}writeFullTimeExtent(e,t){null!=e?.start&&null!=e.end?t.timeExtent=e.toArray():t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?f(t.timeInterval,t.timeIntervalUnits):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?f(t.defaultTimeInterval,t.defaultTimeIntervalUnits):null}writeInterval(e,t){t.timeInterval=e?.toJSON().value??null,t.timeIntervalUnits=e?.toJSON().unit??null}};(0,i._)([(0,a.Cb)({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],m.prototype,"cumulative",void 0),(0,i._)([(0,a.Cb)({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],m.prototype,"endField",void 0),(0,i._)([(0,a.Cb)({type:c.T,json:{write:{enabled:!0,allowNull:!0}}})],m.prototype,"fullTimeExtent",void 0),(0,i._)([(0,o.r)("fullTimeExtent",["timeExtent"])],m.prototype,"readFullTimeExtent",null),(0,i._)([(0,u.c)("fullTimeExtent")],m.prototype,"writeFullTimeExtent",null),(0,i._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"hasLiveData",void 0),(0,i._)([(0,a.Cb)({type:p.T,json:{write:{enabled:!0,allowNull:!0}}})],m.prototype,"interval",void 0),(0,i._)([(0,o.r)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],m.prototype,"readInterval",null),(0,i._)([(0,u.c)("interval")],m.prototype,"writeInterval",null),(0,i._)([(0,a.Cb)({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],m.prototype,"startField",void 0),(0,i._)([(0,a.Cb)((0,d.mi)("timeReference",!0))],m.prototype,"timeZone",void 0),(0,i._)([(0,a.Cb)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],m.prototype,"trackIdField",void 0),(0,i._)([(0,a.Cb)({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],m.prototype,"useTime",void 0),(0,i._)([(0,a.Cb)({type:[Date],json:{read:!1}})],m.prototype,"stops",void 0),m=(0,i._)([(0,l.j)("esri.layers.support.TimeInfo")],m)},22225:function(e,t,n){n.d(t,{Z:function(){return E}});var i,r=n(73440),s=n(41773),a=n(28947),o=n(96711),l=n(17155),u=n(90775),c=n(79775),p=n(1194),d=n(48023),f=n(29884),m=n(95226),h=n(76554),g=n(69258),y=n(23298),v=n(58968),b=n(31186),w=n(29032),x=n(3411),I=n(68578);const C="percent-of-total",S="field",T=new s.X({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:C,esriNormalizeByField:S}),_=(0,m.se)(v.Z);let E=i=class extends((0,y.W)(g.Z)){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,n){if(!Array.isArray(e))return;let i=t.minValue;return e.map((e=>{const t=new v.Z;return t.read(e,n),null==t.minValue&&(t.minValue=i),null==t.maxValue&&(t.maxValue=t.minValue),i=t.maxValue,t}))}writeClassBreakInfos(e,t,n,i){const r=e.map((e=>e.write({},i)));this._areClassBreaksConsecutive()&&r.forEach((e=>delete e.classMinValue)),t[n]=r}castField(e){return null==e?e:"function"==typeof e?(o.Z.getLogger(this).error(".field: field must be a string value"),null):(0,m.Zs)(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,n=null!=this.normalizationTotal;return t||n?(e=t&&S||n&&C||null,t&&n&&o.Z.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==S&&e!==C||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,n){let i=null;i="number"==typeof e?new v.Z({minValue:e,maxValue:t,symbol:(0,I.se)(n)}):_((0,a.d9)(e)),this.classBreakInfos.push(i),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const n=this.classBreakInfos.length;for(let i=0;i<n;i++){const n=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(n[0]===e&&n[1]===t){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(e,t){return this.valueExpression&&null==t?.arcade&&o.Z.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let n=t;this.valueExpression&&null==t?.arcade&&(n={...n,arcade:await(0,x.L)()});const i=this.getBreakIndex(e,n);return-1!==i?this.classBreakInfos[i]:null}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void o.Z.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const n=this.getBreakIndex(e,t);return n>-1?this.classBreakInfos[n].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let n=t;if(this.valueExpression&&null==t?.arcade){const e=await(0,x.L)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),n={...n,arcade:e}}const i=this.getBreakIndex(e,n);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}get symbols(){const e=[];return this.classBreakInfos.forEach((t=>{t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),n=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${n}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new i({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:(0,a.d9)(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:(0,a.d9)(this.visualVariables),legendOptions:(0,a.d9)(this.legendOptions),authoringInfo:(0,a.d9)(this.authoringInfo)})}async collectRequiredFields(e,t){const n=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(n)}async collectSymbolFields(e,t){const n=[...this.symbols.map((n=>n.collectRequiredFields(e,t))),(0,h.io)(e,t,this.valueExpression)];(0,h.AB)(e,t,this.field),(0,h.AB)(e,t,this.normalizationField),await Promise.all(n)}_getBreakIndexForExpression(e,t){const{viewingMode:n,scale:i,spatialReference:r,arcade:s,timeZone:a}=t??{},{valueExpression:o}=this;let l=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const u=s.arcadeUtils;if(!l){const e=u.createSyntaxTree(o);l=u.createFunction(e),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=o;const c=u.executeFunction(l,u.createExecContext(e,u.getViewInfo({viewingMode:n,scale:i,spatialReference:r}),a));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(e){const t=this.field,n=e.attributes,i=this.normalizationType;let r=parseFloat(n[t]);if(i){const e=this.normalizationTotal,t=parseFloat(this.normalizationField?n[this.normalizationField]:void 0);if("log"===i)r=Math.log(r)*Math.LOG10E;else if(i!==C||null==e||isNaN(e)){if(i===S&&!isNaN(t)){if(isNaN(r)||isNaN(t))return-1;r/=t}}else r=r/e*100}return this._getBreakIndexfromInfos(r)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let n=0;n<this.classBreakInfos.length;n++){const i=[this.classBreakInfos[n].minValue,this.classBreakInfos[n].maxValue];if(i[0]<=e&&(t?e<=i[1]:e<i[1]))return n}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let n=1;n<t;n++)if(e[n-1].maxValue!==e[n].minValue)return!1;return!0}};(0,r._)([(0,l.Cb)(b.KK)],E.prototype,"backgroundFillSymbol",void 0),(0,r._)([(0,l.Cb)({type:[v.Z],json:{write:{isRequired:!0}}})],E.prototype,"classBreakInfos",void 0),(0,r._)([(0,p.r)("classBreakInfos")],E.prototype,"readClassBreakInfos",null),(0,r._)([(0,f.c)("classBreakInfos")],E.prototype,"writeClassBreakInfos",null),(0,r._)([(0,l.Cb)({type:String,json:{write:!0}})],E.prototype,"defaultLabel",void 0),(0,r._)([(0,l.Cb)(b.Gn)],E.prototype,"defaultSymbol",void 0),(0,r._)([(0,l.Cb)({type:String,json:{write:!0}})],E.prototype,"field",void 0),(0,r._)([(0,u.p)("field")],E.prototype,"castField",null),(0,r._)([(0,l.Cb)({type:Boolean})],E.prototype,"isMaxInclusive",void 0),(0,r._)([(0,l.Cb)({type:w.Z,json:{write:!0}})],E.prototype,"legendOptions",void 0),(0,r._)([(0,l.Cb)({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],E.prototype,"minValue",null),(0,r._)([(0,l.Cb)({type:String,json:{write:!0}})],E.prototype,"normalizationField",void 0),(0,r._)([(0,l.Cb)({type:Number,json:{write:!0}})],E.prototype,"normalizationTotal",void 0),(0,r._)([(0,l.Cb)({type:T.apiValues,value:null,json:{type:T.jsonValues,read:T.read,write:T.write}})],E.prototype,"normalizationType",null),(0,r._)([(0,c.J)({classBreaks:"class-breaks"})],E.prototype,"type",void 0),(0,r._)([(0,l.Cb)({type:String,json:{write:!0}})],E.prototype,"valueExpression",void 0),(0,r._)([(0,l.Cb)({type:String,json:{write:!0}})],E.prototype,"valueExpressionTitle",void 0),E=i=(0,r._)([(0,d.j)("esri.renderers.ClassBreaksRenderer")],E)},58968:function(e,t,n){n.d(t,{Z:function(){return u}});var i,r=n(73440),s=n(63255),a=n(17155),o=(n(61432),n(96711),n(83850),n(48023)),l=n(31186);let u=i=class extends s.Z{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new i({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],u.prototype,"description",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],u.prototype,"label",void 0),(0,r._)([(0,a.Cb)({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],u.prototype,"minValue",void 0),(0,r._)([(0,a.Cb)({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],u.prototype,"maxValue",void 0),(0,r._)([(0,a.Cb)(l.EW)],u.prototype,"symbol",void 0),u=i=(0,r._)([(0,o.j)("esri.renderers.support.ClassBreakInfo")],u)},99382:function(e,t,n){n.d(t,{eZ:function(){return u}});var i=n(997),r=n(76554),s=n(45497),a=(n(48864),n(62905),n(80730),n(92628)),o=(n(40062),n(22271),n(17956),n(10677),n(60415)),l=n(79074);function u({displayField:e,editFieldsInfo:t,fields:n,objectIdField:o,title:l},u){if(!n)return null;const c=d({editFieldsInfo:t,fields:n,objectIdField:o},u);if(!c.length)return null;const p=function(e){const t=(0,r.O5)(e),{titleBase:n}=e;return t?`${n}: {${t.trim()}}`:n??""}({titleBase:l,fields:n,displayField:e}),f=[new a.Z,new s.Z];return new i.Z({title:p,content:f,fieldInfos:c})}const c=(e,t)=>t.visibleFieldNames?t.visibleFieldNames.has(e.name):(0,r.Fv)(e,t);function p(e,t){return"oid"===e.type?-1:"oid"===t.type?1:m(e)?-1:m(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function d(e,t){const n=t?.visibleFieldNames;return function({fields:e,ignoreFieldTypes:t,sortDisabled:n}){const i=e;return t&&(e=e.filter((e=>!t.includes(e.type)))),e===i&&(e=e.slice()),!0!==n&&e.sort(p),e}({fields:e.fields??[],ignoreFieldTypes:t?.ignoreFieldTypes||h,sortDisabled:t?.sortDisabled}).map((t=>new o.Z({fieldName:t.name,isEditable:(0,r.Hp)(t,e),label:t.alias,format:f(t),visible:c(t,{...e,visibleFieldNames:n})})))}function f(e){switch(e.type){case"small-integer":case"integer":case"single":return new l.Z({digitSeparator:!0,places:0});case"double":return new l.Z({digitSeparator:!0,places:2});case"string":return(0,r.Ec)(e.name)?new l.Z({digitSeparator:!0,places:0}):void 0;default:return}}function m(e){if("name"===(e.name&&e.name.toLowerCase()))return!0;const t=e.alias?.toLowerCase();return"name"===t}const h=["geometry","blob","raster","guid","xml"]}}]);