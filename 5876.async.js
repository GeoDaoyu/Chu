"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[5876],{25176:function(t,e,n){n.d(e,{jF:function(){return l},lQ:function(){return f},o1:function(){return F}});var r=n(73440),i=n(87833),s=n(28947),o=n(93568),u=n(17155),d=(n(61432),n(96711),n(48023)),a=n(12218);const c=new i.Z.EventEmitter;function l(t,e,n=null,r=!1){const i=(0,o.hh)();return r=null==e||r,c.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:n,mayReceiveServiceEdits:r,result:i.promise}),i}const h=Symbol();function f(t){return null!=t&&"object"==typeof t&&h in t}function m(t){return null!=t&&"object"==typeof t&&"gdbVersion"in t}function p(t,e,n){const r=new URL(t).host,i=a.Jp.get(r),s=t=>!t||t===i;return s(e)&&s(n)||e===n}const F=t=>{var e;let n=class extends t{static{e=h}constructor(...t){super(...t),this[e]=!0,this._applyEditsHandler=t=>{const{serviceUrl:e,layerId:n,gdbVersion:r,mayReceiveServiceEdits:i,result:o}=t,u=e===this.url,d=null!=n&&null!=this.layerId&&n===this.layerId,a=m(this),c=m(this)&&p(e,r,this.gdbVersion);if(!u||a&&!c||!d&&!i)return;const l=o.then((t=>{if(this.lastEditsEventDate=new Date,d&&(t.addedFeatures.length||t.updatedFeatures.length||t.deletedFeatures.length||t.addedAttachments.length||t.updatedAttachments.length||t.deletedAttachments.length))return this.emit("edits",(0,s.d9)(t)),t;const n=t.editedFeatures?.find((({layerId:t})=>t===this.layerId));if(n){const{adds:e,updates:r,deletes:i}=n.editedFeatures,o={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:e?e.map((({attributes:t})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}))):[],deletedFeatures:i?i.map((({attributes:t})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}))):[],updatedFeatures:r?r.map((({current:{attributes:t}})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}))):[],editedFeatures:(0,s.d9)(t.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.d9)(t.historicMoment)};return this.emit("edits",o),o}const i={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,s.d9)(t.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.d9)(t.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(e,r,i.historicMoment)&&this.emit("edits",i),i})).then((t=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(e,r,t.historicMoment)&&(this.historicMoment=t.historicMoment),t)));this.emit("apply-edits",{result:l})},this._updateMomentHandler=t=>{const{serviceUrl:e,gdbVersion:n,moment:r}=t,i=e===this.url,s=m(this),o=m(this)&&p(e,n,this.gdbVersion),u=m(this)&&!p(e,this.gdbVersion,null);i&&s&&o&&u&&"historicMoment"in this&&this.historicMoment!==r&&(this.historicMoment=r)},this.when().then((()=>{this.addHandles(function(t){return c.on("apply-edits",new WeakRef(t))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function(t){return c.on("update-moment",new WeakRef(t))}(this._updateMomentHandler))}),(()=>{}))}_shouldUpdateHistoricMoment(t,e,n){return"historicMoment"in this&&this.historicMoment!==n&&(0,a.JV)(t,e)}};return(0,r._)([(0,u.Cb)()],n.prototype,"lastEditsEventDate",void 0),n=(0,r._)([(0,d.j)("esri.layers.mixins.EditBusLayer")],n),n}},60419:function(t,e,n){n.d(e,{$6:function(){return I},$z:function(){return s},F7:function(){return i},S0:function(){return o},Si:function(){return m},Wr:function(){return F},X4:function(){return l},Zq:function(){return h},d1:function(){return d},dm:function(){return a},eP:function(){return c},fe:function(){return f},sg:function(){return p}});const r=[["binary","application/octet-stream","bin",""]];function i(t,e){return null!=g(e.name,t?.supportedFormats??[])}function s(t,e){if(!t)return!1;const n=a(e,t.supportedFormats??[]);return null!=n&&t.editFormats.includes(n)}function o(t,e){return y(function(t,e){const n=t.toLowerCase();return b(e).find((t=>M(t)===n))}(t,e))}function u(t,e){return y(g(t,e))}function d(t,e){return M(function(t,e){return b(e).find((e=>y(e)===t))}(t,e))}function a(t,e){return u(t.name,e)??o(t.type,e)}function c(t,e,n){return o(t,n)??u(e,n)}function l({supportedFormats:t}){return c("model/gltf-binary","glb",t)}function h(t){const e=l(t);return null!=e&&t.editFormats.includes(e)}function f({supportedFormats:t}){return c("model/gltf+json","gltf",t)}function m(t){if(!t)return null;const e=l(t),n=f(t);let r=null;for(const i of t.queryFormats){if(i===e)return i;i===n&&(r=i)}return r}function p({supportedFormats:t}){return c("application/esri3do-SR_world","wld",t)}function F({supportedFormats:t}){return c("application/esri3do-SR_prj","prj",t)}function b(t){return[...r,...t]}function g(t,e){const n=t.toLowerCase();return b(e).find((t=>w(t).some((t=>n.endsWith(t)))))}function y(t){return t?.[0]}function M(t){return t?.[1].toLowerCase()}function w(t){return t?.[2].split(",").map((t=>t.toLowerCase()))??[]}function I(t){return t.tables?.find((t=>"assetMaps"===t.role))}},12218:function(t,e,n){n.d(e,{JV:function(){return a},Jp:function(){return s},Px:function(){return d},U8:function(){return i},r9:function(){return u}});var r=n(78619);const i=(0,n(18764).dG)(),s=new Map,o=new Map;new Map;async function u(t,e,n){if(!t||!n)return!1;if(!e)return!0;const i=new URL(t).host;let o=s.get(i);if(!o){const e=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");o=(await(0,r.Z)(e,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return o===e}async function d(t,e,r=!1){if(!t||!e)return!0;const s=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),u=o.get(s)?.entries();if(u)for(const[t,o]of u)if(o.name===e){const e=!o.stack?.hasForwardEdits();if(!e&&r){const[{deleteForwardEdits:e},{default:r}]=await Promise.all([n.e(76867).then(n.bind(n,76867)),n.e(82242).then(n.bind(n,82242))]),u=await e(s,t,new r({sessionId:i,moment:o.moment}));return u.success&&o.stack?.clearForwardEdits(),u.success}return e}return!0}function a(t,e){if(!t)return!1;const n=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=o.get(n)?.entries();if(r)for(const[t,n]of r)if(n.name===e)return"edit"===n.lockType;return!1}}}]);