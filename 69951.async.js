"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[69951],{84060:function(e,t,n){n.d(t,{R:function(){return f},w:function(){return C}});var i=n(73440),r=n(70880),o=n(78298),s=n(28947),a=n(66951);class l{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(a.v8),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const t=new l,n=this._originStores[a.s3.DEFAULTS];n&&n.forEach(((e,n)=>{t.set(n,(0,s.d9)(e),a.s3.DEFAULTS)}));for(let n=a.s3.SERVICE;n<a.v8;n++){const i=this._originStores[n];i&&i.forEach(((i,r)=>{e&&e.has(r)||t.set(r,(0,s.d9)(i),n)}))}return t}get(e,t){const n=void 0===t?this._values:this._originStores[t];return n?n.get(e):void 0}keys(e){const t=null==e?this._values:this._originStores[e];return t?[...t.keys()]:[]}set(e,t,n=a.s3.USER){let i=this._originStores[n];if(i||(i=new Map,this._originStores[n]=i),i.set(e,t),!this._values.has(e)||this._propertyOriginMap.get(e)<=n){const i=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,n),i!==t}return!1}delete(e,t=a.s3.USER){const n=this._originStores[t];if(!n)return;const i=n.get(e);if(n.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(let n=t-1;n>=0;n--){const t=this._originStores[n];if(t&&t.has(e)){this._values.set(e,t.get(e)),this._propertyOriginMap.set(e,n);break}}}return i}has(e,t){const n=void 0===t?this._values:this._originStores[t];return!!n&&n.has(e)}revert(e,t){for(;t>0&&!this.has(e,t);)--t;const n=this._originStores[t]?.get(e),i=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,t),i!==n}originOf(e){return this._propertyOriginMap.get(e)||a.s3.DEFAULTS}isAtOrigin(e,t){return this.has(e,t)&&this.originOf(e)===t}isBelowOrigin(e,t){return!this.has(e)||this.originOf(e)<t}forEach(e){this._values.forEach(e)}}var p=n(66245),c=n(22018),d=n(48023);const h=e=>{let t=class extends e{constructor(...e){super(...e);const t=(0,c.vw)(this),n=t.store,i=new l;t.store=i,(0,o.M)(t,n,i)}read(e,t){(0,p.i)(this,e,t)}getAtOrigin(e,t){const n=u(this),i=(0,a.M9)(t);if("string"==typeof e)return n.get(e,i);const r={};return e.forEach((e=>{r[e]=n.get(e,i)})),r}originOf(e){return(0,a.x3)(this.originIdOf(e))}originIdOf(e){return u(this).originOf(e)}revert(e,t){const n=u(this),i=(0,a.M9)(t),r=(0,c.vw)(this);let o;o="string"==typeof e?"*"===e?n.keys(i):[e]:e,o.forEach((e=>{r.invalidate(e),n.revert(e,i),r.commit(e)}))}};return t=(0,i._)([(0,d.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function u(e){return(0,c.vw)(e).store}let _=class extends(h(r.Z)){};_=(0,i._)([(0,d.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],_);var g=n(57947),y=n(79564);const v=e=>{let t=class extends e{constructor(...e){super(...e)}clear(e,t="user"){(0,c.vw)(this).clearOrigin(e,(0,a.M9)(t))}write(e,t){return(0,y.c)(this,e=e||{},t),e}setAtOrigin(e,t,n){(0,c.vw)(this).setAtOrigin(e,t,(0,a.M9)(n))}removeOrigin(e){const t=m(this),n=(0,a.M9)(e),i=t.keys(n);for(const e of i)t.originOf(e)===n&&t.set(e,t.get(e,n),a.s3.USER)}updateOrigin(e,t){const n=m(this),i=(0,a.M9)(t),r=(0,g.U2)(this,e);for(let t=i+1;t<a.v8;++t)n.delete(e,t);n.set(e,r,i)}toJSON(e){return this.write({},e)}};return t=(0,i._)([(0,d.j)("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function m(e){return(0,c.vw)(e).store}const f=e=>{let t=class extends(v(h(e))){constructor(...e){super(...e)}};return t=(0,i._)([(0,d.j)("esri.core.MultiOriginJSONSupport")],t),t};let C=class extends(f(r.Z)){};C=(0,i._)([(0,d.j)("esri.core.MultiOriginJSONSupport")],C)},31004:function(e,t,n){n.r(t),n.d(t,{ManipulatedObject3DMediaElement:function(){return x}});var i=n(73440),r=n(87833),o=n(50702),s=n(90403),a=n(17155),l=(n(61432),n(96711),n(83850),n(48023)),p=n(70880),c=n(3480),d=n(60147),h=n(60508),u=n(67764),_=n(13132),g=n(77523),y=n(61722);let v=class extends p.Z{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(e){super(e),this._updatingHandles=new d.R}initialize(){this.addHandles([(0,o.ed)(this._updatingHandles),this._updatingHandles.add((()=>{const e=this.element.georeference;return"control-points"===e?.type?e.controlPoints:null}),(e=>this._elementControlPointsChanged(e)),s.nn)])}_elementControlPointsChanged(e){const t=e?.map((({mapPoint:e})=>e)).filter(c.pC),n=this.view.spatialReference;this._updatingHandles.addPromise(this._whenProjected(t,n,(e=>{if(!e)return void this._replaceOperations(null);const{_operations:t}=this,i=e.map((({x:e,y:t})=>[e,t]));i.push(i[0].slice());const r=new u.Z({rings:[i],spatialReference:n});if(t?.trySetGeometry(r))return void this.onModifiedExternally();const o=this.view.state.viewingMode;this._replaceOperations(new g.X(y.XE.fromGeometry(r,o),o,(e=>this._operationsGeometryChanged(e))))})))}_operationsGeometryChanged(e){const{element:{georeference:t},_operations:n}=this;if(!n||!t||"control-points"!==t.type||!t.controlPoints)return;const i=n.data.geometry,r=t.controlPoints.map((({mapPoint:e})=>e)).filter(c.pC),o=n.data.components[0].isClosed()?1:0;if(i.rings[0]?.length-o!==r.length)return;const s=i.rings[0].map((([e,t])=>new h.Z({x:e,y:t,spatialReference:i.spatialReference})));s.length-=o;const a=r.map((({spatialReference:e})=>e));this._updatingHandles.addPromise(this._whenProjected(s,a,(t=>this._updateElementControlPoints(t,e))))}_updateElementControlPoints(e,t){const{georeference:n}=this.element;if(!n||!e||"control-points"!==n.type||n.controlPoints?.length!==e?.length)return;const i=n.controlPoints;if(i?.length===e.length)for(let r=0;r<i.length;r++)t&&(i[r].sourcePoint=n.toSource(e[r])),i[r].mapPoint=e[r]}async _whenProjected(e,t,n){if(!e)return void n(e);const{_operations:i,element:{georeference:r}}=this,o=e.map((({spatialReference:e})=>e)),s=Array.isArray(t)?t:new Array(o.length).fill(t);await(0,_.initializeProjection)(Array.from(o).map(((e,t)=>({source:e,dest:s[t]}))));const a=e.map(((e,t)=>(0,_.project)(e,s[t])));i===this._operations&&r===this.element.georeference&&n(a)}_replaceOperations(e){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e}};(0,i._)([(0,a.Cb)({constructOnly:!0})],v.prototype,"view",void 0),(0,i._)([(0,a.Cb)({constructOnly:!0})],v.prototype,"layer",void 0),(0,i._)([(0,a.Cb)({constructOnly:!0})],v.prototype,"element",void 0),(0,i._)([(0,a.Cb)({constructOnly:!0})],v.prototype,"onModifiedExternally",void 0),(0,i._)([(0,a.Cb)()],v.prototype,"_operations",void 0),(0,i._)([(0,a.Cb)()],v.prototype,"operations",null),(0,i._)([(0,a.Cb)()],v.prototype,"updating",null),v=(0,i._)([(0,l.j)("esri.views.3d.interactive.editingTools.media.MediaElementControllerControlPoints")],v);var m=n(18208);let f=class extends p.Z{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(e){super(e),this._updatingHandles=new d.R}initialize(){this.addHandles([(0,o.ed)(this._updatingHandles),this._updatingHandles.add((()=>this.element.georeference?.coords),(e=>this._elementCoordinatesChanged(e)),s.nn)])}_elementCoordinatesChanged(e){this._updatedElementCoordinates!==e&&this._updatingHandles.addPromise(this._whenProjected(e,this.view.spatialReference,(e=>{if(!e)return void this._replaceOperations(null);const{_operations:t}=this;t?.trySetGeometry(e)?this.onModifiedExternally():this._replaceOperations(m.c.fromGeometry(e,this.view.state.viewingMode))})))}_operationsGeometryChanged(){const{element:{georeference:e},_operations:t}=this;if(!t||!e)return;const n=t.data.geometry;if(!e.coords)return void this._updateElementCoordinates(n);const i=e.coords.spatialReference;this._updatingHandles.addPromise(this._whenProjected(n,i,(e=>this._updateElementCoordinates(e))))}_updateElementCoordinates(e){const{georeference:t}=this.element;t&&(t.coords=e,this._updatedElementCoordinates=t.coords)}async _whenProjected(e,t,n){if(!e)return void n(e);const{_operations:i,element:{georeference:r}}=this,o=await(0,_.projectWithZConversion)(e,t);i===this._operations&&r===this.element.georeference&&n(o)}_replaceOperations(e){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e,e&&this.addHandles(e.data.on("change",(()=>this._operationsGeometryChanged())),e),this.onModifiedExternally()}};(0,i._)([(0,a.Cb)({constructOnly:!0})],f.prototype,"view",void 0),(0,i._)([(0,a.Cb)({constructOnly:!0})],f.prototype,"layer",void 0),(0,i._)([(0,a.Cb)({constructOnly:!0})],f.prototype,"element",void 0),(0,i._)([(0,a.Cb)({constructOnly:!0})],f.prototype,"onModifiedExternally",void 0),(0,i._)([(0,a.Cb)()],f.prototype,"_operations",void 0),(0,i._)([(0,a.Cb)()],f.prototype,"operations",null),(0,i._)([(0,a.Cb)()],f.prototype,"updating",null),f=(0,i._)([(0,l.j)("esri.views.3d.interactive.editingTools.media.MediaElementControllerShape")],f);var C=n(24910),w=n(82846),O=n(6961),b=n(96928),M=n(67118);function E(e,t,n){return S(e.allLayerViews.find((e=>e.layer===t)),n)}function S(e,t){if(!e||"media-3d"!==e.type||e.suspended)return!1;const n=e.layer.source;return!!n&&(n instanceof b.Z||n instanceof M.Z?n===t:"hasElement"in n&&n.hasElement(t))}let P=class extends p.Z{grabbableForEvent(){return!0}constructor(e){super(e),this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.grabbing=!1,this.dragging=!1,this.hovering=!0,this.selected=!1,this.cursor=null,this.consumesClicks=!0,this.events=new r.Z.EventEmitter,this.addHandles((0,s.YP)((()=>this.selected),(e=>this.events.emit("select-changed",{action:e?"select":"deselect"})),s.Z_))}destroy(){this._set("view",null)}intersectionDistance(e){const{view:t,layer:n,element:i}=this;if(!E(t,n,i))return null;const r=t.toMap(e,{include:{layer:n,element:i}});return r&&(0,O.K)(r,j,t.renderSpatialReference)?(0,C.j)(j,t.state.camera.eye):null}onElevationChange(){}onViewChange(){}};(0,i._)([(0,a.Cb)({constructOnly:!0,nonNullable:!0})],P.prototype,"element",void 0),(0,i._)([(0,a.Cb)({constructOnly:!0,nonNullable:!0})],P.prototype,"layer",void 0),(0,i._)([(0,a.Cb)({constructOnly:!0,nonNullable:!0})],P.prototype,"view",void 0),(0,i._)([(0,a.Cb)()],P.prototype,"interactive",void 0),(0,i._)([(0,a.Cb)()],P.prototype,"selectable",void 0),(0,i._)([(0,a.Cb)()],P.prototype,"grabbable",void 0),(0,i._)([(0,a.Cb)()],P.prototype,"grabbing",void 0),(0,i._)([(0,a.Cb)()],P.prototype,"dragging",void 0),(0,i._)([(0,a.Cb)()],P.prototype,"hovering",void 0),(0,i._)([(0,a.Cb)()],P.prototype,"selected",void 0),(0,i._)([(0,a.Cb)()],P.prototype,"cursor",void 0),P=(0,i._)([(0,l.j)("esri.views.3d.interactive.editingTools.media.MediaElementManipulator3D")],P);const j=(0,w.Ue)(),H=Symbol();let x=class extends r.Z.EventedAccessor{get operations(){return this._controller?.operations}get elevationInfo(){return{mode:"on-the-ground",offset:0}}get _layerView(){const e=this.view.allLayerViews.find((e=>e.layer===this.layer));return"media-3d"===e?.type?e:null}get visible(){return S(this._layerView,this.element)}get isDraped(){return!0}get origin(){return null}get updating(){return!!this._controller?.updating}get _controllerClass(){return"transform"===this.tool||"control-points"!==this.element.georeference?.type?f:v}constructor(e){super(e),this.tool="transform"}initialize(){this.addHandles([(0,s.YP)((()=>this._controllerClass),(e=>this._updateController(e)),s.tX),(0,s.on)((()=>this._layerView),"element-render-changed",(({element:e})=>{this.element===e&&this.emit("committed")}))])}toMap(e){const{layer:t,element:n}=this;return this.view.toMap(e,{include:{layer:t,element:n}})}createManipulator(e){const{view:t,layer:n,element:i}=this;return new P({view:t,layer:n,element:i,...e})}_updateController(e){if(this._controller&&this._controller instanceof e)return;this.removeHandles(H);const{view:t,layer:n,element:i}=this,r=()=>{this.emit("modified-externally")};this._controller=new e({view:t,layer:n,element:i,onModifiedExternally:r}),r(),this.addHandles((0,o.ed)(this._controller),H)}};(0,i._)([(0,a.Cb)({constructOnly:!0})],x.prototype,"view",void 0),(0,i._)([(0,a.Cb)({constructOnly:!0})],x.prototype,"layer",void 0),(0,i._)([(0,a.Cb)({constructOnly:!0})],x.prototype,"element",void 0),(0,i._)([(0,a.Cb)()],x.prototype,"tool",void 0),(0,i._)([(0,a.Cb)()],x.prototype,"_controller",void 0),(0,i._)([(0,a.Cb)()],x.prototype,"elevationInfo",null),(0,i._)([(0,a.Cb)()],x.prototype,"_layerView",null),(0,i._)([(0,a.Cb)()],x.prototype,"visible",null),(0,i._)([(0,a.Cb)()],x.prototype,"updating",null),(0,i._)([(0,a.Cb)()],x.prototype,"_controllerClass",null),x=(0,i._)([(0,l.j)("esri.views.3d.interactive.editingTools.ManipulatedObject3DMediaElement")],x)}}]);