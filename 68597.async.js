"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[68597],{15307:function(e,t,n){n.d(t,{Z:function(){return m}});var i=n(73440),s=n(89013),a=n(89314),o=n(95437),r=n(63255),l=n(61100),c=n(17155),u=n(90775),d=(n(61432),n(83850),n(48023)),p=n(95226),h=n(60508);let m=class extends(r.Z.JSONSupportMixin(a.Z)){constructor(e){super(e),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=s.n.Direct,this.offset=0,this.orientation=0}get valid(){return null!=this.startPoint&&null!=this.endPoint}equals(e){return this===e||(0,l._W)(this.startPoint,e.startPoint)&&(0,l._W)(this.endPoint,e.endPoint)&&this.measureType===e.measureType&&this.offset===e.offset&&this.orientation===e.orientation}};(0,i._)([(0,c.Cb)({type:["length"],json:{write:{isRequired:!0}}})],m.prototype,"type",void 0),(0,i._)([(0,c.Cb)({type:h.Z,json:{write:{isRequired:!0}}})],m.prototype,"startPoint",void 0),(0,i._)([(0,c.Cb)({type:h.Z,json:{write:{isRequired:!0}}})],m.prototype,"endPoint",void 0),(0,i._)([(0,c.Cb)({type:s.V,nonNullable:!0,json:{write:{isRequired:!0}}})],m.prototype,"measureType",void 0),(0,i._)([(0,c.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],m.prototype,"offset",void 0),(0,i._)([(0,c.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,u.p)((e=>o.BV.normalize((0,p.q9)(e),0,!0)))],m.prototype,"orientation",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],m.prototype,"valid",null),m=(0,i._)([(0,d.j)("esri.analysis.LengthDimension")],m)},89013:function(e,t,n){var i;n.d(t,{V:function(){return s},n:function(){return i}}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(i||(i={}));const s=[i.Horizontal,i.Vertical,i.Direct]},93191:function(e,t,n){n.d(t,{I:function(){return y},a:function(){return _},b:function(){return v}});var i=n(41044),s=n(27349),a=n(2679),o=n(68647),r=n(7086),l=n(13743),c=n(96541),u=n(85119),d=n(48857),p=n(34709),h=n(52061),m=n(75047),g=n(74826),f=n(15150);class _ extends g.K{}function v(e){const t=new f.kG,{vertex:n,fragment:g,varyings:_}=t,{output:v,perspectiveInterpolation:y}=e;return(0,c.Sv)(n,e),t.include(a.w,e),t.include(r.H,e),t.fragment.include(s.f5,e),t.include(o.R,e),t.include(m.j,e),t.attributes.add(h.T.POSITION,"vec3"),t.attributes.add(h.T.UV0,"vec2"),y&&t.attributes.add(h.T.PERSPECTIVEDIVIDE,"float"),n.main.add(d.H`
    vpos = position;
    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    vTexCoord = uv0;
    gl_Position = transformPosition(proj, view, vpos);
    ${(0,d.If)(y,"gl_Position *= perspectiveDivide;")}`),_.add("vpos","vec3",{invariant:!0}),_.add("vTexCoord","vec2"),g.include(l.Y),g.uniforms.add(new u.p("opacity",(e=>e.opacity)),new p.A("tex",(e=>e.glTexture))).main.add(d.H`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${(0,d.If)(v===i.H_.ObjectAndLayerIdColor,"fragColor = vec4(0, 0, 0, 1); return;")}
    vec4 finalColor = texture(tex, vTexCoord) * opacity;
    outputColorHighlightOID(finalColor, vpos, finalColor.rgb);`),t}const y=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:_,build:v},Symbol.toStringTag,{value:"Module"}))},68597:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ft}});var i=n(73440),s=n(70880),a=n(50702),o=(n(61432),n(96711)),r=n(83986),l=n(61100),c=n(17155),u=(n(83850),n(48023)),d=n(11674),p=n(89013),h=n(90403),m=n(26636),g=n(5826),f=n(99574),_=n(1925),v=n(95226),y=n(31865),M=n(10934),S=n(24910),P=n(82846),w=n(60508),b=n(93070),C=n(69811),D=n(60856),O=n(74774),T=n(16374),x=n(49510),A=n(10618);class I{constructor(e,t,n,i,s,a){this.elevationAlignedStartPoint=e,this.elevationAlignedEndPoint=t,this.directSegment=n,this.dimensionSegment=i,this.primaryOffsetAxis=s,this.spatialReference=a}}const R=(0,v.se)(w.Z);function z(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,dimension:{offset:i,measureType:s,orientation:a}}=e;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,offset:i,measureType:s,orientation:a}}function H({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,offset:n,measureType:i,orientation:s},a,o=null){if(null==e||null==t)return null;const r=k(o?.directSegment??new T.y,{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t},a),l=o?.primaryOffsetAxis??(0,P.Ue)();U(l,{measureType:i,elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,directSegment:r,orientation:s,renderCoordsHelper:a});const c=o?.dimensionSegment??new T.y;return V({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t})&&i===p.n.Vertical?((0,S.c)(c.startRenderSpace,r.startRenderSpace),(0,S.c)(c.endRenderSpace,r.endRenderSpace)):W(c,l,n,r,a),new I(e,t,r,c,l,a.spatialReference)}function G(e,t,n,i){return t===E.Start?((0,S.c)(e.startRenderSpace,n.startRenderSpace),(0,S.c)(e.endRenderSpace,i.startRenderSpace)):((0,S.c)(e.startRenderSpace,n.endRenderSpace),(0,S.c)(e.endRenderSpace,i.endRenderSpace)),e}var E;function L(e,t,n,i){switch(t){case p.n.Direct:return k(e,n,i);case p.n.Horizontal:case p.n.Vertical:{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:a,dimension:o,geometry:r}=n;let l;o.measureType===p.n.Direct?(l=function(e,t){const n=e.directSegment.eval(.5,C.WM.get()),i=t.worldUpAtPosition(n,C.WM.get()),s=e.dimensionSegment.eval(.5,C.WM.get()),a=(0,S.a)(C.WM.get(),s,n);return!(0,S.G)(a,P.AG)&&(0,S.e)(a,i)>0}(r,i)===s.z>a.z,t===p.n.Horizontal&&(l=!l)):l=!function(e){const{startRenderSpace:t,endRenderSpace:n}=e.dimensionSegment,{startRenderSpace:i,endRenderSpace:s}=e.directSegment;return(0,S.x)(i,t)<(0,S.x)(s,n)}(r);const[c,u]=l?[s,a]:[a,s],d=(0,O.WG)(u,N);return t===p.n.Horizontal?d.z=c.z:(d.x=c.x,d.y=c.y),i.toRenderCoords(c,e.startRenderSpace),i.toRenderCoords(d,e.endRenderSpace),e}}}function k(e,t,n){return n.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),n.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(E||(E={}));const N=(0,D.T)(0,0,0,null);const j=new T.y;function U(e,t){const{measureType:n,elevationAlignedStartPoint:i,elevationAlignedEndPoint:s,directSegment:{startRenderSpace:a,endRenderSpace:o},directSegment:r,renderCoordsHelper:l}=t,c=r.eval(.5,C.WM.get()),u=l.worldUpAtPosition(c,C.WM.get()),d=l.worldBasisAtPosition(c,b.R.Y,C.WM.get());switch(n){case p.n.Horizontal:(0,S.c)(e,u);break;case p.n.Vertical:(0,S.e)(a,u)<(0,S.e)(o,u)?(0,S.a)(e,o,a):(0,S.a)(e,a,o),(0,S.h)(e,e,u),(0,S.h)(e,e,u);break;case p.n.Direct:{const n=t.orientation??0;if(V({elevationAlignedStartPoint:i,elevationAlignedEndPoint:s}))(0,y.Us)(Z,-(0,f.Vl)(n),u),(0,S.t)(e,d,Z);else{const t=(0,S.a)(C.WM.get(),o,a),i=(0,S.h)(C.WM.get(),t,u);(0,S.h)(i,i,t),(0,y.Us)(Z,(0,f.Vl)(n),t),(0,S.t)(e,i,Z)}break}}return(0,S.G)(e,P.AG)?(0,S.c)(e,d):(0,S.n)(e,e)}const Z=(0,M.Ue)();function V({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}){return null!=e&&null!=t&&e.x===t.x&&e.y===t.y}function W(e,t,n,i,s){const{startRenderSpace:a,endRenderSpace:o}=i,r=n/s.unitInMeters,[l,c]=function(e,t,n,i=0){const s=(0,S.e)(t,n),a=(0,S.e)(e,n),o=Math.abs(s-a)+i;return s>a?[o,i]:[i,o]}(a,o,t,r);return(0,S.b)(e.startRenderSpace,i.startRenderSpace,t,l),(0,S.b)(e.endRenderSpace,i.endRenderSpace,t,c),e}function Y(e,t,n){const i=t.directSegment.eval(.5,C.WM.get());return n.worldUpAtPosition(i,e)}function F(e,t){const{startRenderSpace:n,endRenderSpace:i}=t.directSegment;return(0,S.a)(e,i,n)}function B(e,t,n={invert:!1}){const{startRenderSpace:i,endRenderSpace:s}=t.dimensionSegment;return n.invert?(0,S.a)(e,i,s):(0,S.a)(e,s,i)}function X(e,t){const n=e.directSegment.eval(.5,C.WM.get());return t.headingAtPosition(n,e.primaryOffsetAxis)}const q=(0,P.Ue)();function Q(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n}=e;if(null==t||null==n)return!1;const i=(0,x.Z1)(t,n);return null!=i&&(0,_.nn)(i,"meters").value>A.Yo}function $(e){return null!=e.geometry}let J=class extends s.Z{constructor(e){super(e)}initialize(){const e=(0,r.w)((()=>this.analysisViewData.computations),(({computation:e})=>this._watchComputation(e)));this.addHandles((0,a.ed)(e))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,g.R)(this.view)}_watchComputation(e){return(0,h.YP)((()=>z(e)),(t=>{const{measureType:n}=t;if(Q(t)&&n!==p.n.Direct){const t=Math.round((0,m.En)(A.Yo,"meters","kilometers"));return o.Z.getLogger(this).warnOnce(`A ${n} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${t} km. Update the measureType of the affected dimension to "direct" to display it.`),void(e.geometry=null)}const i=H(t,this.view.renderCoordsHelper,e.geometry);e.geometry=i,e.result.length=function(e,t,n,i){if(null==e)return null;let s;if(t===p.n.Horizontal)s=i.autoDistanceBetweenPoints2D(R(e.elevationAlignedStartPoint),R(e.elevationAlignedEndPoint));else{const{startRenderSpace:t,endRenderSpace:n}=e.dimensionSegment;s=(0,x.FN)(t,n,e.spatialReference)}if(null==s)return null;const a=t===p.n.Vertical?(0,m.yv)(s.value,s.unit,n):(0,m.wd)(s.value,s.unit,n);return(0,_.nn)(s,a)}(i,n,this._defaultUnit,this.automaticLengthMeasurementUtils)}),h.tX)}};(0,i._)([(0,c.Cb)({constructOnly:!0})],J.prototype,"analysisViewData",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0})],J.prototype,"view",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0})],J.prototype,"automaticLengthMeasurementUtils",void 0),(0,i._)([(0,c.Cb)()],J.prototype,"analysis",null),(0,i._)([(0,c.Cb)()],J.prototype,"_defaultUnit",null),J=(0,i._)([(0,u.j)("esri.views.3d.analysis.Dimension.DimensionController")],J);var K=n(26411),ee=n(53147),te=n(95437),ne=n(96094),ie=n(27583),se=n(77773),ae=n(92643);function oe(e){return(0,ae.G)(e.accentColor,.5)}function re(e){return(0,ae.mj)(e.accentColor)}const le=new ee.Z([127,127,127,.5]);var ce=n(3682),ue=n(77811),de=n(23496),pe=n(23857),he=n(35567),me=n(81749),ge=n(25952),fe=n(86026),_e=n(19596),ve=n(52061),ye=n(19843),Me=n(69880),Se=n(55541);class Pe{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find((t=>this.hasOwnProperty(t)&&e===this[t]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of p.V)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case p.n.Direct:return this.direct;case p.n.Horizontal:return this.horizontal;case p.n.Vertical:return this.vertical}}}class we extends ce.Z{constructor(e,t){const n=(0,ue.EA)(ee.Z.toUnitRGBA(oe(e.effectiveTheme))),i=[new de.r((0,fe.PI)(n,1,32,32),je)];super({view:e,renderObjects:i,metadata:t.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,h.YP)((()=>({color:ee.Z.toUnitRGBA(oe(e.effectiveTheme))})),(e=>n.setParameters(e)))}destroy(){this._themeHandle.remove(),super.destroy()}}class be extends ce.Z{constructor(e,{lineSizePt:t,material:n,metadata:i}){super({view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:i}),this._options={calloutColor:(0,ie.Ue)(),lineSizePt:t,material:n},this._themeHandle=(0,h.YP)((()=>ee.Z.toUnitRGBA(oe(e.effectiveTheme))),(e=>{this._options.calloutColor=e,Ne(this,Ce({...this._options,metadata:this.metadata}))}),h.nn)}update({lineSizePt:e,material:t}){this._options.lineSizePt=e,this._options.material=t,Ne(this,Ce({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function Ce({calloutColor:e,lineSizePt:t,material:n,metadata:i}){return{calloutLength:.25*he.M_*.8*(0,ne.F2)(t)+18,calloutColor:e,calloutWidth:2,customStateMask:je,discScale:.3,focusMultiplier:2,material:n,metadata:i}}function De(e,{computation:t,view:n}){return[(0,Me.Xd)(e,((e,i,s)=>{Oe({cancel:s,computation:t,settingHeading:!1,steps:i,view:n})})),e.events.on("immediate-click",(e=>{!function(e,t,n){const{dimension:i,geometry:s}=t;if(90===i.orientation||270===i.orientation)return i.orientation=0,void e.stopPropagation();if(null==s)return;const{renderCoordsHelper:a}=n,o=H({...z(t),orientation:90},a),r=H({...z(t),orientation:270},a);if(null==o||null==r)return;const l=X(o,a),c=X(r,a),u=Ae(s,n),d=te.BV.shortestSignedDiff(u,l),p=te.BV.shortestSignedDiff(u,c);i.orientation=Math.abs(d)<Math.abs(p)?90:270,e.stopPropagation()}(e,t,n)}))]}function Oe(e){const{cancel:t,computation:n,settingHeading:i,steps:s,view:a}=e;if(!$(n))return;const{renderCoordsHelper:o}=a,{dimension:r,geometry:l}=n,c=(0,P.Ue)(),u=He((0,P.Ue)(),l,l.directSegment,o),d=Ge(C.WM.get(),{forHeading:i,geometry:l,renderCoordsHelper:o}),p=(0,se.Yq)(u,d,(0,se.Ue)()),h=i?r.orientation??X(l,a.renderCoordsHelper):r.orientation??0;s.next((0,pe._N)(a,p)).next((e=>{"start"===e.action&&(0,S.c)(c,e.renderStart);const t=(0,se.st)(p),n=(0,ue.Gd)(c,e.renderEnd,u,t);let s=h-(0,f.BV)(n);i||(s=function(e){const t=te.BV.normalize(e)%90;return t<5?e-t:90-t<5?e+(90-t):e}(s)),r.orientation=s})),t.next((0,Me.di)(r,["orientation"]))}function Te(e,{computation:t,manipulatorMeasureType:n,view:i}){let s=p.n.Direct,a=0,o=0;return[e.events.on("grab-changed",(r=>{if("start"!==r.action||!$(t))return;const{dimension:l,geometry:c}=t;s=l.measureType,a=l.offset,o=l.orientation;const u=(0,S.c)(C.WM.get(),e.renderLocation);l.measureType=n,l.offset=function(e,t,n,i){const{directSegment:s}=n,a=U(C.WM.get(),{measureType:t,directSegment:s,renderCoordsHelper:i}),o=W(j,a,0,s,i).eval(.5,C.WM.get()),r=(0,S.a)(C.WM.get(),e,o);return(0,S.e)(r,a)*i.unitInMeters}(u,n,c,i.renderCoordsHelper),l.orientation=0})),(0,Me.Xd)(e,((e,r,l)=>{if(!$(t))return;const{geometry:c,dimension:u}=t,{renderCoordsHelper:d}=i,p=L(We,n,t,d),h=U(C.WM.get(),{measureType:n,directSegment:c.directSegment,renderCoordsHelper:d}),m=(0,pe.J4)(e);r.next(m).next(xe(i,u,p,h)),l.next(m).next((e=>(u.measureType=s,u.offset=a,u.orientation=o,e)))}))]}function xe(e,t,n,i){const s=(0,S.d)(C.WM.get(),n.endRenderSpace,n.startRenderSpace);(0,S.h)(s,s,i);const a=(0,se.Yq)(n.startRenderSpace,s,(0,se.Ue)()),o=(0,se.Yq)(n.startRenderSpace,i,(0,se.Ue)()),r=t.offset;let l,c=0;const u=new Me.hM;return u.next((0,pe._N)(e,a)).next((n=>{"start"===n.action&&(c=(0,se.jH)(o,n.renderStart));const i=((0,se.jH)(o,n.renderEnd)-c)*e.renderCoordsHelper.unitInMeters;t.offset=r+i,l=n})),e=>(u.execute(e),l)}function Ae(e,t){const{directSegment:n}=e,{renderCoordsHelper:i}=t,s=Y(C.WM.get(),e,i),a=F(C.WM.get(),e),o=(0,S.h)(C.WM.get(),a,s),{viewForward:r}=t.state.camera;(0,S.e)(o,r)>0&&(0,S.g)(o,o,-1);const l=n.eval(.5,C.WM.get());return i.headingAtPosition(l,o)}function Ie(e,t,n,{forHeading:i}){const{dimension:s,geometry:a}=t,{primaryOffsetAxis:o}=a,r=(0,S.g)(Re,o,s.offset>=0?1:-1),l=Ge(ze,{forHeading:i,geometry:a,renderCoordsHelper:n});(0,S.h)(l,l,r);const c=(0,ue.Aq)(r,l,P.AG,Ve);e.modelTransform=c,e.renderLocation=He(Ue,a,a.dimensionSegment,n)}const Re=(0,P.Ue)(),ze=(0,P.Ue)();function He(e,t,n,i){const{startRenderSpace:s,endRenderSpace:a}=n,o=function(e,t){const n=F(Ee,e),i=Y(Le,e,t);return(0,S.e)(n,i)>0}(t,i)?s:a;return(0,S.c)(e,o)}function Ge(e,{forHeading:t,geometry:n,renderCoordsHelper:i}){return t?Y(e,n,i):B(e,n,{invert:!0})}const Ee=(0,P.Ue)(),Le=(0,P.Ue)();function ke(e){return(0,ne.F2)(e)+6}function Ne(e,t){const n=t.material,i=t.focusMultiplier??ue.rotateManipulatorDefaults.focusMultiplier,s=t.calloutLength??ue.rotateManipulatorDefaults.calloutLength,a=ue.rotateManipulatorDefaults.discRadius*(t.discScale??1),o=a*i,r=(e,t)=>{const n=[0,1,2,2,3,0];return new ge.Z(t,[[ve.T.POSITION,new me.a([s-e,-e,0,s+e,-e,0,s+e,e,0,s-e,e,0],n,3,!0)],[ve.T.UV0,new me.a([0,0,1,0,1,1,0,1],n,2,!0)]])},l=t.calloutWidth??ue.rotateManipulatorDefaults.calloutWidth,c=new ye.U({width:l,color:t.calloutColor,renderOccluded:_e.yD.OccludeAndTransparent,isDecoration:!0}),u=(0,fe.rh)(c,[[0,0,0],[s-a,0,0]]),d=(0,fe.rh)(c,[[0,0,0],[s-o,0,0]]),p=t.customStateMask??Se.jg.None;e.collisionType={type:"disc",direction:[0,0,1],offset:[s,0,0]},e.focusMultiplier=i,e.metadata=t.metadata,e.radius=a,e.renderObjects=[new de.r(r(a,n),Se.Q9.Unfocused|p),new de.r(u,Se.Q9.Unfocused|p),new de.r(r(o,n),Se.Q9.Focused|p),new de.r(d,Se.Q9.Focused|p)]}const je=Se.jg.Custom1,Ue=(0,P.Ue)(),Ze=(0,P.Ue)(),Ve=(0,M.Ue)(),We=new T.y;var Ye,Fe=n(15307),Be=n(12818),Xe=n(28947),qe=n(30062),Qe=n(93568),$e=n(60147);function Je(e,t,n){const{constraint:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:a,unconstrainedGeometry:o,view:r}=n,{dimension:l,previousConstraint:c,preConstraintProperties:u}=e;if(null==s||null==a)return;const d=()=>{"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if(null==i)d(),null!=c&&null!=u&&(l.measureType=u.measureType,l.orientation=u.orientation);else switch(l.measureType=p.n.Direct,i){case Ye.Horizontal:if(i!==c&&(l.orientation=0),"startPoint"in t){const e=t.startPoint;null!=e&&(e.z=a.z),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.z=s.z),l.endPoint=e}break;case Ye.Vertical:if(i!==c&&(l.orientation=Ae(o,r)),"startPoint"in t){const e=t.startPoint;null!=e&&(e.x=a.x,e.y=a.y),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.x=s.x,e.y=s.y),l.endPoint=e}break;case Ye.Direct:i!==c&&null!=u&&(l.orientation=u.orientation),d()}e.previousConstraint=i,e.unconstrainedGeometry=o}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(Ye||(Ye={}));var Ke=n(11234),et=n(18036),tt=n(80075),nt=n(70503),it=n(3113),st=n(85590),at=n(16171),ot=n(61722),rt=n(18208),lt=n(39018),ct=n(23111),ut=n(42888),dt=n(76010),pt=n(29668);let ht=class extends s.Z{constructor(e){super(e),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new Be.Z,this._updatingHandles=new $e.R,this._getSnappingContext=(0,qe.H)((e=>new lt.N({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new rt.c(new ot.XE("point",(0,at.Y6)(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new et._})));const{view:t}=e;this._snappingManagerResult=(0,ut.u)(t),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,st.z5)(2)}),this._constraintSnappingIndicator=new tt.r({view:t,attached:!0,width:1,renderOccluded:_e.yD.OccludeAndTransparent,stipplePattern:(0,st.z5)(5),isDecoration:!0});const n=ee.Z.toUnitRGBA(le);this._stagedStartIndicator=new nt.j({view:t,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,color:n,size:10,outlineSize:0,renderOccluded:_e.yD.OccludeAndTransparent,isDecoration:!0})}initialize(){const{view:e}=this;this._snappingOperation=new dt.y({view:e});const t=oe(e.effectiveTheme),n=re(e.effectiveTheme),i=!e.stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this._textureHandle=(0,Ke.O)(e.stage.textures,{accentColor:t,contrastColor:n,preMultiplyAlpha:i}),this._orientationManipulatorMaterial=new it.j({draped:!1,texture:this._textureHandle.texture,writeDepth:!1,renderOccluded:_e.yD.Opaque,isDecoration:!0});const s=(0,r.w)((()=>this.analysisViewData.computations),(({computation:e})=>this._createManipulators(e)));this.addHandles([(0,h.YP)((()=>({accentColor:oe(e.effectiveTheme),contrastColor:re(e.effectiveTheme)})),(({accentColor:t,contrastColor:n})=>{const s=this._textureHandle;this._textureHandle=(0,Ke.O)(e.stage.textures,{accentColor:t,contrastColor:n,preMultiplyAlpha:i}),this._orientationManipulatorMaterial.setParameters({texture:this._textureHandle.texture}),s?.release();const a=ee.Z.toUnitRGBA(t);this._unfocusedOffsetManipulatorMaterial.setParameters({color:a}),this._focusedOffsetManipulatorMaterial.setParameters({color:a}),this._thinOffsetManipulatorMaterial.setParameters({color:a}),this._constraintSnappingIndicator.color=a}),h.nn),(0,a.ed)(s),(0,h.YP)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(({stagedPoint:e,stagedComputation:t})=>{if(null==t||null==e)return;const n=(0,O.WG)(e,new w.Z);this._applyPointUpdate(t,{endPoint:n})}),h.Z_),(0,h.YP)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((e,t)=>{const{stagedDimension:n,selectedComputation:i,firstGrabbedManipulator:s}=e;if(n===t?.stagedDimension&&s===t?.firstGrabbedManipulator){for(const n of[i,t?.selectedComputation])if(null!=n){const t=this._computationManipulators.get(n);null!=t&&this._updateManipulators(n,t,e)}}else for(const[t,n]of this._computationManipulators)this._updateManipulators(t,n,e)}),h.tX),(0,h.YP)((()=>this.analysis.style.lineSize),(e=>this._updateManipulatorStyle(e)),h.nn),(0,h.YP)((()=>this.view.state.camera),(()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,h.YP)((()=>{const e=this._stagedComputation;if(!e)return null;const t=e.elevationAlignedStartPoint,n=(0,P.Ue)();return null!=t&&this.view.renderCoordsHelper.toRenderCoords(t,n)?n:null}),(e=>{null!=e?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,pt.Ob)(this,(()=>{const e=this._activeComputation,t=this._stagedComputation;if(null==e||null!=t){const e=this.view.inputManager.latestPointerType??"mouse",t=this._getSnappingContext(e);this._updatingHandles.addPromise((0,Qe.R8)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,t)))}if(null!=e){const{start:t,end:n}=this._computationManipulators.get(e);if(t.grabbing||n.grabbing){!function(e,t,{constraint:n,view:i}){const{unconstrainedGeometry:s}=e;if(null==s)return;const{renderCoordsHelper:a,spatialReference:o}=i,{startRenderSpace:r,endRenderSpace:l}=s.directSegment,c=a.fromRenderCoords(r,new w.Z({spatialReference:o})),u=a.fromRenderCoords(l,new w.Z({spatialReference:o}));let d;d="start"===t?{startPoint:c}:{endPoint:u},Je(e,d,{constraint:n,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,unconstrainedGeometry:s,view:i})}(e,t.grabbing?"start":"end",{constraint:this._computeConstraint(e),view:this.view})}}}))}destroy(){this._textureHandle=(0,l.RY)(this._textureHandle),this._snappingOperation=(0,l.SC)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:e}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=e?e:null}get _stagedComputation(){const e=this._stagedDimension,t=this.analysisViewData.computations.at(-1)?.computation;return null==e||null==t||t.dimension!==e?null:t}get _constraintHandles(){return[(0,h.gx)((()=>this.analysisViewData.selectedComputation),(e=>{e.previousConstraint=this._computeConstraint(e)}),{...h.tX,equals:Xe.fS}),(0,h.YP)((()=>{const e=this._activeComputation;if(null==e)return null;const{measureType:t,orientation:n}=e.dimension;return{measureType:t,orientation:n,computation:e}}),((e,t)=>{if(null!=e&&null==t){const{measureType:t,orientation:n,computation:i}=e;switch(i.previousConstraint){case Ye.Horizontal:i.preConstraintProperties={measureType:p.n.Horizontal,orientation:0};break;case Ye.Vertical:i.preConstraintProperties={measureType:p.n.Vertical,orientation:0};break;case Ye.Direct:i.preConstraintProperties={measureType:p.n.Direct,orientation:n};break;default:i.preConstraintProperties={measureType:t,orientation:n}}}null==e&&null!=t&&(t.computation.preConstraintProperties=null)}),h.Z_)]}get _snappingIndicatorHandles(){const e="snapping-indicator-event-handles";return[(0,h.YP)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(({stagedComputation:t,activeComputation:n})=>{const i=this._constraintSnappingIndicator;if(this.removeHandles(e),null!=n)if(n===t)i.attached=!0;else{const{start:t,end:s}=this._computationManipulators.get(n),a=()=>{i.attached=t.grabbing||s.grabbing};a(),this.addHandles([t.events.on("grab-changed",a),s.events.on("grab-changed",a)],e)}else i.attached=!1})),(0,h.YP)((()=>{const e=this._activeComputation;return null!=e?{geometry:e.geometry,constraint:e.previousConstraint}:{}}),(({geometry:e,constraint:t})=>{const n=this._constraintSnappingIndicator;null!=e&&null!=t&&t!==Ye.Direct?(n.visible=!0,n.setGeometryFromSegment(e.directSegment)):n.visible=!1}))]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(e){const{_stagedDimension:t}=this;if(null==t){const t=this._onUnstagedClick(e);return this.analysis.dimensions.add(t),null}return this._onStagedClick(e),t}onPointerMove({mapPoint:e,pointerType:t}){if("touch"===t)return;const n=this._getSnappingContext(t);this._updatingHandles.addPromise((0,Qe.R8)(this._snappingOperation.snap({point:e},this._snappingManager,n)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick({mapPoint:e,pointerType:t}){let n=e;if("mouse"===t){const i=this._getSnappingContext(t);n=this._snappingManager.update({point:e,context:i})}const i=new Fe.Z({startPoint:(0,O.WG)(n,new w.Z),endPoint:null,measureType:p.n.Horizontal});return this._stagedDimension=i,this._resetSnappingState(),i}_onStagedClick({mapPoint:e,pointerType:t}){const n=this._stagedComputation;if(null==n)return;let i=e;if("mouse"===t){const n=this._getSnappingContext(t);i=this._snappingManager.update({point:e,context:n})}const s=(0,O.WG)(i,new w.Z);this._applyPointUpdate(n,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(e){const t=this._setupPointManipulator(e,{isStart:!0}),n=this._setupPointManipulator(e,{isStart:!1}),i=this._setupOffsetManipulator(e),s=this._setupHeadingManipulator(e),o=this._setupRotationManipulator(e),r=this._setupMeasureTypeManipulator(e,p.n.Direct),l=this._setupMeasureTypeManipulator(e,p.n.Horizontal),c=this._setupMeasureTypeManipulator(e,p.n.Vertical),u=new Pe({start:t,end:n,offset:i,heading:s,rotation:o,direct:r,horizontal:l,vertical:c});this._setupComputationToManipulatorsSync(e,u),this._computationManipulators.set(e,u),this.manipulators.addMany(u.values());const d=(0,a.AL)(u.values().map((e=>e.events.on("focus-changed",(()=>{u.values().some((e=>e.focused))&&this._resetSnappingState()})))));return{manipulators:u,remove:()=>{d.remove(),this._computationHandles.remove(e),this._computationManipulators.delete(e);for(const e of u.values())this.manipulators.remove(e)}}}_setupComputationToManipulatorsSync(e,t){this._computationHandles.add([(0,h.YP)((()=>e.geometry),(()=>this._updateManipulators(e,t)),{...h.tX,equals:Xe.fS})],e)}_setupPointManipulator(e,t){const{view:n}=this,{dimension:i}=e,s=new we(n,{metadata:i}),a=function(e,{isStart:t,createSnappingPipelineStep:n,dimension:i,onUpdate:s,view:a}){const o=t?"startPoint":"endPoint",r=(0,Me.Xd)(e,((e,t,r,l)=>{const c=(0,pe.J4)(e),{snappingStep:u,cancelSnapping:d}=n(l);r=r.next(c).next((0,Me.di)(i,[o,"measureType","orientation"])).next(d),t.next(c).next((0,pe.gv)(a)).next(...u).next((e=>{const t=(0,O.WG)(e.mapEnd,new w.Z);s("startPoint"===o?{startPoint:t}:{endPoint:t})}))}));return[r]}(s,{isStart:t.isStart,createSnappingPipelineStep:e=>(0,ct.W)({snappingContext:this._getSnappingContext(e),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:i,onUpdate:t=>this._applyPointUpdate(e,t),view:n});return this._computationHandles.add(a,e),s}_setupOffsetManipulator(e){const{view:t}=this,n=function(e,t){const n=[(0,P.al)(-.5,0,0),(0,P.al)(.5,0,0)],i=(0,fe.rh)(t.unfocusedMaterial,n.map((e=>(0,S.g)((0,P.Ue)(),e,.5)))),s=i.instantiate({material:t.focusedMaterial});return new ce.Z({view:e,renderObjects:[new de.r(i,Se.Q9.Unfocused|Se.Q9.Selected|je),new de.r(s,Se.Q9.Focused|je)],collisionType:{type:"line",paths:[n]},radius:ke(t.lineSizePt)/2,metadata:t.metadata,available:!1,...ue.X9})}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),i=function(e,{computation:t,view:n}){return[(0,Me.Xd)(e,((e,i,s)=>{if(!$(t)||!e.selected)return;const{geometry:a,dimension:o}=t,r=(0,pe.J4)(e);i.next(r).next(xe(n,o,a.dimensionSegment,a.primaryOffsetAxis)),s.next(r).next((0,Me.di)(o,["offset"]))}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupHeadingManipulator(e){const{view:t}=this,n=new be(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=function(e,{computation:t,view:n}){return[(0,Me.Xd)(e,((e,i,s)=>{Oe({cancel:s,computation:t,settingHeading:!0,steps:i,view:n})}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupRotationManipulator(e){const{view:t}=this,n=new be(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=De(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupMeasureTypeManipulator(e,t){const{view:n}=this,i=function(e,t){const n=[(0,P.al)(-.5,0,0),(0,P.al)(.5,0,0)],i=(0,fe.rh)(t.thinOffsetManipulatorMaterial,n),s=(0,fe.rh)(t.unfocusedMaterial,n.map((e=>(0,S.g)((0,P.Ue)(),e,.5)))),a=s.instantiate({material:t.focusedMaterial});return new ce.Z({view:e,renderObjects:[new de.r(s,Se.Q9.Unfocused|je),new de.r(a,Se.Q9.Focused|je),new de.r(i,je)],collisionType:{type:"line",paths:[n]},radius:ke(t.lineSizePt)/2,available:!1,metadata:t.metadata,...ue.X9})}(n,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),s=Te(i,{computation:e,manipulatorMeasureType:t,view:n});return this._computationHandles.add(s,e),i}_updateManipulators(e,t,n={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:i,selectedComputation:s,firstGrabbedManipulator:a}=n,{start:o,end:r,offset:l,heading:c,rotation:u}=t,d=s===e,h=$(e),{dimension:m}=e;for(const e of t.values()){const t=h&&null==i&&(null==a||e===a);e===l?(e.available=t,e.selected=d):e.available=t&&d}if(!h)return;null!=this._computeConstraint(e)?t.forEachMeasureTypeManipulator((e=>e.available=!1)):t.manipulatorForMeasureType(m.measureType).available=!1;for(const e of[c,u])m.measureType===p.n.Direct&&0!==m.offset||(e.available=!1);V(e)?u.available=!1:c.available=!1;const{geometry:g}=e;o.renderLocation=g.directSegment.startRenderSpace,r.renderLocation=g.directSegment.endRenderSpace;const{renderCoordsHelper:f}=this.view;(function(e,t,n){const{dimensionSegment:i,primaryOffsetAxis:s}=t,a=B(Ue,t),o=(0,S.q)(a,P.AG)?(0,y.yR)(Ve):(0,ue.Aq)(a,s,P.AG,Ve),r=Math.max((0,S.l)(a),.1/n.unitInMeters);(0,y.bA)(o,o,(0,S.i)(Ue,r,r,r)),e.modelTransform=o,e.renderLocation=i.eval(.5,Ue)})(l,g,f),c.available&&function(e,t,n){Ie(e,t,n,{forHeading:!0})}(c,e,f),u.available&&function(e,t,n){Ie(e,t,n,{forHeading:!1})}(u,e,f),t.forEachMeasureTypeManipulator(((t,n)=>{t.available&&function(e,t,n,i){const{geometry:s}=t,a=L(We,n,t,i),o=U(Ue,{measureType:n,directSegment:s.directSegment,renderCoordsHelper:i}),r=(0,S.a)(Ze,a.endRenderSpace,a.startRenderSpace),l=(0,ue.Aq)(r,o,P.AG,Ve),c=(0,S.l)(r);(0,y.bA)(l,l,(0,S.i)(Ze,c,c,c)),e.modelTransform=l,e.renderLocation=a.eval(.5,Ze)}(t,e,n,f)}))}_updateManipulatorStyle(e){const t=function(e){return(0,ne.F2)(e)+4}(e),n=ke(e),i={lineSizePt:e,material:this._orientationManipulatorMaterial};for(const{offset:e,heading:t,rotation:s}of this._computationManipulators.values())e.radius=n/2,t.update(i),s.update(i);this._unfocusedOffsetManipulatorMaterial.setParameters({width:t}),this._focusedOffsetManipulatorMaterial.setParameters({width:n})}_applyPointUpdate(e,t){const{view:n}=this,i=z(e);"startPoint"in t&&(i.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(i.elevationAlignedEndPoint=t.endPoint);const s=H(i,n.renderCoordsHelper);if(null==s)return;const a=this._computeConstraint({...i,geometry:s});Je(e,t,{...i,constraint:a,unconstrainedGeometry:s,view:n}),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}_updateStagedDimensionOffset(e){if(null==e.geometry)return;e.geometry.directSegment.eval(.5,mt);const{state:t,renderCoordsHelper:n}=this.view,i=t.camera.computeScreenPixelSizeAt(mt);e.dimension.offset=50*i*n.unitInMeters}_computeConstraint(e){return function(e,t){if(Q(e))return Ye.Direct;if(!e.enabled)return null;const{geometry:n}=e;if(null==n||(0,S.q)(n.directSegment.startRenderSpace,n.directSegment.endRenderSpace))return null;const{camera:i}=t.state,s=Y(C.WM.get(),n,t.renderCoordsHelper),a=F(C.WM.get(),n),o=(0,S.g)(C.WM.get(),s,(0,S.e)(a,s)),r=(0,S.d)(C.WM.get(),a,o),l=(0,S.k)(r),c=(0,S.k)(o),{startRenderSpace:u,endRenderSpace:d}=n.directSegment,p=Math.max(10*i.computeScreenPixelSizeAt(u),10*i.computeScreenPixelSizeAt(d))**2;return l<p?Ye.Vertical:c<p?Ye.Horizontal:null}(function(e,t){return{enabled:t.effectiveFeatureEnabled,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,geometry:e.geometry}}(e,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new ye.U({width:1,renderOccluded:_e.yD.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get test(){}};(0,i._)([(0,c.Cb)({constructOnly:!0})],ht.prototype,"analysis",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0})],ht.prototype,"analysisViewData",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0})],ht.prototype,"manipulators",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0})],ht.prototype,"parentTool",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],ht.prototype,"view",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],ht.prototype,"updating",null),(0,i._)([(0,c.Cb)()],ht.prototype,"firstGrabbedManipulator",null),(0,i._)([(0,c.Cb)()],ht.prototype,"hasGrabbedManipulators",null),(0,i._)([(0,c.Cb)()],ht.prototype,"snappingOptions",null),(0,i._)([(0,c.Cb)()],ht.prototype,"_stagedDimension",void 0),(0,i._)([(0,c.Cb)()],ht.prototype,"_activeComputation",null),(0,i._)([(0,c.Cb)()],ht.prototype,"_stagedComputation",null),ht=(0,i._)([(0,u.j)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],ht);const mt=(0,P.Ue)();var gt,ft=n(86227),_t=n(18753),vt=n(21498),yt=n(70134);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(gt||(gt={}));let Mt=class extends ft.f{constructor(e){super(e),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._placementMode=St,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,vt.w)(this.view.state.viewingMode),this._lengthDimensionSubTool=new ht({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,a.ed)(this._lengthDimensionSubTool),(0,a.kB)((()=>this._clearPointerMoveTimeout())),(0,h.gx)((()=>this.state===gt.Created),(()=>this.finishToolCreation()),h.tX),(0,h.gx)((()=>this.firstGrabbedManipulator),(e=>{this.selectedDimension=e.metadata}),h.tX),(0,h.YP)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),h.tX)])}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?null!=this._activeSubTool?gt.Creating:gt.Created:gt.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(e){this.analysisViewData.selectedDimension=e}place(e){this.selectedDimension=null,this._placementMode=e}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":this._keyDownHandler(e)}}onActivate(){this._placementMode=St,this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){this._activeSubTool?.onDeactivate(),this._activeSubTool=null}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(e){if(this.hasFocusedManipulators)return void e.stopPropagation();if(null==this._activeSubTool)return;const t=this._intersectScreen(e);null!=t&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),this.selectedDimension&&"single"===this._placementMode&&(this.view.activeTool=null),e.stopPropagation())}_doubleClickHandler(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);null!=t&&this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}_keyDownHandler(e){_t.Sn.cancel===e.key?(this._activeSubTool?.removeStaged()&&"multiple"===this._placementMode&&e.stopPropagation(),this.active||(this.selectedDimension=null)):_t.Sn.delete.includes(e.key)&&(this._activeSubTool?.removeStaged(),this._removeSelected())}_intersectScreen(e){const t=(0,yt.Sj)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const n=this._intersector.results.min,i=C.WM.get();return n.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,new w.Z({spatialReference:this.view.spatialReference})):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((e=>e.manipulator.state|=je)),this._prevPointerMoveTimeout=K.m.setTimeout((()=>{this.manipulators.forEach((e=>e.manipulator.state&=~je))}),this._pointerMoveTimerMs)}get test(){}};(0,i._)([(0,c.Cb)({constructOnly:!0})],Mt.prototype,"view",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0})],Mt.prototype,"analysis",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],Mt.prototype,"state",null),(0,i._)([(0,c.Cb)({readOnly:!0})],Mt.prototype,"updating",null),(0,i._)([(0,c.Cb)({readOnly:!0})],Mt.prototype,"cursor",null),(0,i._)([(0,c.Cb)({constructOnly:!0})],Mt.prototype,"analysisViewData",void 0),(0,i._)([(0,c.Cb)()],Mt.prototype,"selectedDimension",null),(0,i._)([(0,c.Cb)()],Mt.prototype,"automaticManipulatorSelection",void 0),(0,i._)([(0,c.Cb)()],Mt.prototype,"_activeSubTool",void 0),(0,i._)([(0,c.Cb)()],Mt.prototype,"_lengthDimensionSubTool",void 0),(0,i._)([(0,c.Cb)()],Mt.prototype,"_placementMode",void 0),Mt=(0,i._)([(0,u.j)("esri.views.3d.analysis.Dimension.DimensionTool")],Mt);const St="multiple";n(55214);var Pt=n(55430),wt=n(36158),bt=n(43280),Ct=n(49102),Dt=n(55277),Ot=n(94759);class Tt extends Ct._{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=_e.yD.OccludeAndTransparent,this._width=1,this._color=(0,bt.al)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=t,this._hasExternalMaterial=null!=t,this.applyProperties(e)}setGeometryFromSegment(e,t){const n=e.endRenderSpace;this.transform=(0,y.vc)(xt,n),this._normal=t;const{points:i}=e.createRenderGeometry(n,this.view.renderCoordsHelper);this.geometry=[i]}get renderOccluded(){return this._material?.parameters.renderOccluded??this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,this._material?.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return this._material?.parameters.width??this._width}set width(e){this._width=e,this._material?.setParameters({width:e})}get color(){return this._material?.parameters.color??this._color}set color(e){this._color=(0,bt.d9)(e),this._material?.setParameters({color:this._color})}get placement(){return this._material?.parameters.placement??this._placement}set placement(e){this._placement=e,this._material?.setParameters({placement:this._placement})}get markerPrimitive(){return this._material?.parameters.markerPrimitive??this._markerPrimitive}set markerPrimitive(e){this._markerPrimitive=e,this._material?.setParameters({markerPrimitive:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new Ot.X({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of(0,Dt.c)(this.geometry,this.normal)){const n=(0,Dt.Y)(this._material,t);e.addGeometry(n)}}forEachMaterial(e){this._hasExternalMaterial||e(this._material)}}const xt=(0,M.Ue)();class At{set visible(e){for(const t of this._visualElements.values())t.attached=e}constructor(e){this.destroyed=!1,this._handles=new Be.Z,this._messages=null,this._labelSegment=new T.y;const{analysis:t,computation:n,view:i,messages:s,isDecoration:a}=e;this.analysis=t,this.computation=n,this.view=i,this._messages=s;const o=e.visible,r={view:i,attached:o,isDecoration:a},{fontSize:l,textColor:c,textBackgroundColor:u}=t.style;this._visualElements=new Ht({marker:new Tt(r,e.markerMaterial),dimension:new tt.r(r,e.dimensionLineMaterial),startOffset:new tt.r(r,e.offsetLineMaterial),endOffset:new tt.r(r,e.offsetLineMaterial),dimensionSmall:new tt.r(r,e.smallDimensionLineMaterial),startOffsetSmall:new tt.r(r,e.smallOffsetLineMaterial),endOffsetSmall:new tt.r(r,e.smallOffsetLineMaterial),label:new wt.K({view:i,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,ne.F2)(l),textColor:c.clone(),backgroundColor:u.clone(),isDecoration:a})}),this._handles.add([(0,h.YP)((()=>n.geometry),(e=>{this.updateCameraDependentElements(i.state.camera,e,t.style),null!=n.geometry&&this._updateLines(n.geometry)}),{...h.nn,equals:Xe.fS}),(0,h.YP)((()=>n.length),(e=>this._updateLabelContent(e)),h.nn)])}destroy(){this.destroyed=!0,this._handles=(0,l.SC)(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){}_updateLines(e){const t=G(It,E.Start,e.directSegment,e.dimensionSegment),n=G(Rt,E.End,e.directSegment,e.dimensionSegment),i=this._visualElements;i.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),i.dimension.setGeometryFromSegment(e.dimensionSegment),i.startOffset.setGeometryFromSegment(t),i.endOffset.setGeometryFromSegment(n),i.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),i.startOffsetSmall.setGeometryFromSegment(t),i.endOffsetSmall.setGeometryFromSegment(n)}updateCameraDependentElements(e,t,n){const i=this._visualElements;if(null==t){for(const e of i.values())e.visible=!1;return}const s=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,zt)),a=function(e,t){return(0,S.k)(B(q,e))/t**2}(t,s),o=a<(2*(0,ne.F2)(n.lineSize))**2,r=!o;i.marker.visible=r,i.dimension.visible=r,i.startOffset.visible=r,i.endOffset.visible=r,i.dimensionSmall.visible=o,i.startOffsetSmall.visible=o,i.endOffsetSmall.visible=o;const l=5*(0,ne.F2)(n.fontSize),{label:c}=i;if(c.visible=a>=l**2,!c.visible)return;const{dimensionSegment:u,primaryOffsetAxis:d}=t,{offset:p}=this.computation.dimension,h=(Math.sign(p)>=0?1:-1)*function(e){return 1.5*(0,ne.F2)(e.fontSize)+20+(0,ne.F2)(e.lineSize/2)}(n)*s;(function(e,t,n,i){(0,S.b)(e.startRenderSpace,t.startRenderSpace,n,i),(0,S.b)(e.endRenderSpace,t.endRenderSpace,n,i)})(this._labelSegment,u,d,h),c.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=(0,ne.F2)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;null!=e&&null!=this._messages?t.text=(0,Pt.VG)(this._messages,e,e.unit):t.text=""}}const It=new T.y,Rt=new T.y,zt=(0,P.Ue)();class Ht{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var Gt=n(25727),Et=n(74765),Lt=n(12816);let kt=class extends s.Z{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(e){super(e),this.loadingMessages=!1,this._messages=null}initialize(){const e=this.isDecoration;this._markerMaterial=new Ot.X({width:1,anchor:Gt.i5.Tip,color:ie.AG,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:_e.yD.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:e}),this._dimensionLineMaterial=new ye.U({width:1,color:ie.AG,renderOccluded:_e.yD.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:e}),this._offsetLineMaterial=new ye.U({width:1,color:ie.AG,renderOccluded:_e.yD.OccludeAndTransparent,stipplePattern:(0,st.z5)(5),isDecoration:e}),this._smallDimensionLineMaterial=new ye.U({width:1,color:ie.AG,renderOccluded:_e.yD.OccludeAndTransparent,isDecoration:e}),this._smallOffsetLineMaterial=new ye.U({width:1,color:ie.AG,renderOccluded:_e.yD.OccludeAndTransparent,stipplePattern:(0,st.z5)(5),isDecoration:e});const t=(0,r.w)((()=>this.analysisViewData.computations),(({computation:e})=>this._createVisualization(e)));this._dimensionVisualizations=t,this.addHandles([(0,a.ed)(t),(0,h.YP)((()=>ee.Z.toUnitRGBA(this.analysis.style.color)),(e=>{for(const t of this._lineMaterials())t.setParameters({color:e})}),h.tX),(0,h.YP)((()=>this.analysis.style.lineSize),(e=>{const t=(0,ne.F2)(e);this._markerMaterial.setParameters({width:.8*t}),this._dimensionLineMaterial.setParameters({width:t,markerParameters:this._markerMaterial.parameters});const n=Math.max(.25*t,1);this._offsetLineMaterial.setParameters({width:n})}),h.tX),(0,h.YP)((()=>({camera:this.view.state.camera,style:Nt(this.analysis)})),(({camera:e,style:t})=>{for(const{visualization:n}of this._dimensionVisualizations)n.updateCameraDependentElements(e,n.computation.geometry,t),n.updateLabelStyle(t)})),(0,h.YP)((()=>this.visible),(e=>{for(const{visualization:t}of this._dimensionVisualizations)t.visible=e}))]),this.addHandles([(0,Et.qe)((()=>this._updateMessageBundle())),(0,h.gx)((()=>!this.loadingMessages),(()=>{for(const{visualization:e}of this._dimensionVisualizations)e.updateUnitsMessages(this._messages)}),h.Z_)]),this._updateMessageBundle()}get testInfo(){}_createVisualization(e){const t=new At({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:t,remove:()=>t.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,Lt.ME)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function Nt(e){const{fontSize:t,lineSize:n,textColor:i,textBackgroundColor:s}=e.style;return{fontSize:t,lineSize:n,textBackgroundColor:s.clone(),textColor:i.clone()}}(0,i._)([(0,c.Cb)({constructOnly:!0})],kt.prototype,"analysisViewData",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],kt.prototype,"view",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0})],kt.prototype,"isDecoration",void 0),(0,i._)([(0,c.Cb)()],kt.prototype,"analysis",null),(0,i._)([(0,c.Cb)()],kt.prototype,"visible",null),(0,i._)([(0,c.Cb)()],kt.prototype,"loadingMessages",void 0),kt=(0,i._)([(0,u.j)("esri.views.3d.analysis.Dimension.DimensionVisualization")],kt);let jt=class extends s.Z{constructor(e){super(e),this.dimension=null,this.length=null}};(0,i._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],jt.prototype,"dimension",void 0),(0,i._)([(0,c.Cb)()],jt.prototype,"length",void 0),jt=(0,i._)([(0,u.j)("esri.views.analysis.LengthDimensionResult")],jt);let Ut=class extends s.Z{constructor(e){super(e),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(e){const{dimension:t,...n}=e;return{result:new jt({dimension:t}),...n}}initialize(){this.addHandles([(0,h.YP)((()=>this.dimension.startPoint),(e=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(e)),h.tX),(0,h.YP)((()=>this.dimension.endPoint),(e=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(e)),h.tX)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,i._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Ut.prototype,"result",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Ut.prototype,"projectAndAlignPoint",void 0),(0,i._)([(0,c.Cb)()],Ut.prototype,"dimension",null),(0,i._)([(0,c.Cb)()],Ut.prototype,"length",null),(0,i._)([(0,c.Cb)()],Ut.prototype,"geometry",void 0),(0,i._)([(0,c.Cb)()],Ut.prototype,"unconstrainedGeometry",void 0),(0,i._)([(0,c.Cb)()],Ut.prototype,"elevationAlignedStartPoint",void 0),(0,i._)([(0,c.Cb)()],Ut.prototype,"elevationAlignedEndPoint",void 0),(0,i._)([(0,c.Cb)()],Ut.prototype,"preConstraintProperties",void 0),(0,i._)([(0,c.Cb)()],Ut.prototype,"previousConstraint",void 0),Ut=(0,i._)([(0,u.j)("esri.views.3d.analysis.Dimension.LengthDimensionComputation")],Ut);var Zt=n(1505),Vt=n(24468),Wt=n(8316);let Yt=class extends((0,d.p)(s.Z)){constructor(e){super(e),this.type="dimension-view-3d",this.analysis=null,this.tool=null,this.selectedDimension=null,this.userOperation=null,this._dimensionsToComputations=new Map,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if(null==e)return null;const{spatialReference:t,elevationProvider:n}=this.view,i=(0,Zt.G)(e,t,n);return null==i&&(0,Zt.e)(this.analysis,e.spatialReference,o.Z.getLogger(this)),i};const e=(0,r.w)((()=>this.analysis.dimensions),(e=>this._createComputation(e)));this.computations=e,this.addHandles([(0,Vt.Lp)(this,Mt),(0,a.ed)(e)]),this._analysisVisualization=new kt({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this.addResolvingPromise((0,Wt.U)().then((e=>{this._analysisController=new J({analysisViewData:this,view:this.view,automaticLengthMeasurementUtils:e})})))}destroy(){this.userOperation=(0,l.IM)(this.userOperation),(0,Vt.Yq)(this),this._analysisVisualization=(0,l.SC)(this._analysisVisualization)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToComputations.get(e).result))}get selectedComputation(){const{selectedDimension:e}=this;return null==e?null:this._dimensionsToComputations.get(e)}get testInfo(){}async createLengthDimensions(e){this.selectedDimension=null,await(0,Vt.tq)(this,{placementOptions:e,onToolActivated:e=>e.place("multiple")})}place(e){return this.selectedDimension=null,(0,Vt.tq)(this,{placementOptions:e,onToolActivated:e=>e.place("single")})}_createComputation(e){const{_dimensionsToComputations:t}=this,n=new Ut({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});return t.set(e,n),{computation:n,remove:()=>this._removeComputation(n)}}_removeComputation(e){const{dimension:t}=e;t===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(t),e.destroy()}};(0,i._)([(0,c.Cb)({readOnly:!0})],Yt.prototype,"type",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Yt.prototype,"analysis",void 0),(0,i._)([(0,c.Cb)()],Yt.prototype,"tool",void 0),(0,i._)([(0,c.Cb)()],Yt.prototype,"updating",null),(0,i._)([(0,c.Cb)({readOnly:!0})],Yt.prototype,"results",null),(0,i._)([(0,c.Cb)()],Yt.prototype,"computations",void 0),(0,i._)([(0,c.Cb)()],Yt.prototype,"selectedDimension",void 0),(0,i._)([(0,c.Cb)()],Yt.prototype,"selectedComputation",null),(0,i._)([(0,c.Cb)()],Yt.prototype,"userOperation",void 0),(0,i._)([(0,c.Cb)()],Yt.prototype,"_analysisVisualization",void 0),(0,i._)([(0,c.Cb)()],Yt.prototype,"_analysisController",void 0),(0,i._)([(0,c.Cb)()],Yt.prototype,"_dimensionsToComputations",void 0),Yt=(0,i._)([(0,u.j)("esri.views.3d.analysis.DimensionAnalysisView3D")],Yt);const Ft=Yt},11234:function(e,t,n){n.d(t,{O:function(){return o},s:function(){return r}});function i(e,t){return function(e,t){const n=new Image(t,t);return n.src=e,n}(function(e){const t=(new XMLSerializer).serializeToString(e);return`data:image/svg+xml;base64,${btoa(t)}`}(s(function(e){const t=e.split(",")[1],n=atob(t);return(new DOMParser).parseFromString(n,"image/svg+xml")}(e),t)),t.size)}function s(e,{accentColor:t,contrastColor:n}){const i=t.toHex(),s=t.a,a=n.toHex(),o=n.a,r=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem("theme-style");return r&&(r.innerHTML=`\n      .contrast-fill { fill: ${a}; fill-opacity: ${o}; }\n      .contrast-stroke { stroke: ${a}; stroke-opacity: ${o};  }\n      .accent-fill { fill: ${i}; fill-opacity: ${s}; }\n      .accent-stroke { stroke: ${i}; stroke-opacity:  ${s}; }`),e}var a=n(28751);function o(e,t){const{accentColor:n,contrastColor:s,preMultiplyAlpha:o}=t;return e.fromData(`heading-rotate:[accent:${n},contrast:${s},size:64]`,(()=>new a.x(i("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==",{accentColor:n,contrastColor:s,size:64}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:o})))}function r(e,t){const{accentColor:n,contrastColor:s,preMultiplyAlpha:o}=t;return e.fromData(`tilt-rotate:[accent:${n},contrast:${s},size:64]`,(()=>new a.x(i("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxjaXJjbGUgY3g9IjM5LjQ3OCIgY3k9IjMuMDc4IiByPSIyOCIgY2xhc3M9ImFjY2VudC1maWxsIiB0cmFuc2Zvcm09InJvdGF0ZSg0MC41NDIpIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI1IiBkPSJtNy4wNzQgMzAuMDUzIDI5LjM5NyAxMS45ODUtMy42NzMtMzMuNDkzIiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSIyLjk5NiIgZD0iTTI0LjUwNCAyMy4yMDdhMTEuOTggMTEuOTggMCAwIDAtOS44IDcuNTA3IiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIGNvbnRyYXN0LWZpbGwiLz48cGF0aCBkPSJtMjkuODE4IDIyLjgwOC02LjE4NCA0LjYtLjU0MS04LjM2NHoiIGNsYXNzPSJjb250cmFzdC1maWxsIi8+PC9zdmc+",{accentColor:n,contrastColor:s,size:64}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:o})))}},70503:function(e,t,n){n.d(t,{j:function(){return g}});var i=n(24910),s=n(82846),a=n(73749),o=n(27583),r=n(49102),l=n(94290),c=n(60199),u=n(90210);var d=n(32420),p=n(86026),h=n(19596),m=n(86886);class g extends r._{constructor(e){super(e),this.view=null,this._renderOccluded=h.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,o.nI)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,o.nI)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,a.a)(e,this._color)||((0,a.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,a.a)(e,this._outlineColor)||((0,a.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const t=function(e,t,n,i,s){const a=(0,c.bg)(3*e.length),o=(0,c.bg)(a.length);e.forEach(((e,t)=>{a[3*t]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));const r=(0,u.rR)(a,t,0,o,0,a,0,a.length/3,n,i,s),l=null!=r;return{numVertices:e.length,position:a,mapPositions:o,projectionSuccess:l,sampledElevation:r}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,l.o.fromElevationInfo(this.elevationInfo)),n=[],s=t.numVertices,a=t.position;for(let e=0;e<s;++e){const t=(0,i.i)(f,a[3*e],a[3*e+1],a[3*e+2]),s=_(this._vertexMaterial,.5,t),o=_(this._vertexOutlineMaterial,.5,t);n.push({vertexGeometry:s,vertexOutlineGeometry:o})}return n}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:n,vertexOutlineGeometry:i}of t)e.addGeometry(n),e.addGeometry(i)}createExternalResources(){this._vertexMaterial=new m.Q({...this._vertexMaterialParameters,writeDepth:!0,cullFace:d.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new m.Q({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:d.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const f=(0,s.Ue)();function _(e,t,n){return(0,p.PI)(e,t,16,16,{offset:n})}},3113:function(e,t,n){n.d(t,{j:function(){return I}});var i=n(81342),s=n(41044),a=n(32420),o=n(59797),r=n(71356),l=n(19596),c=n(61536),u=n(948),d=n(61719),p=n(52061),h=n(29296),m=n(36121),g=n(42266),f=n(92991),_=n(58257),v=n(29107),y=n(33610),M=n(26041),S=n(93191),P=n(51135);class w extends v.A{constructor(e,t){super(e,t,new _.J(S.I,(()=>n.e(67160).then(n.bind(n,67160)))),b)}_getPipelineState(e,t){const{oitPass:n,output:i,hasOccludees:a,cullFace:o}=e,r=n===y.M.NONE;return(0,P.sm)({blending:(0,s.c1)(i)?r?P.Zo:(0,c.j7)(n):null,culling:(0,P.zp)(o),depthTest:{func:(0,c.Bh)(n)},depthWrite:(0,c.W$)(e),drawBuffers:(0,c.u_)(n,i),colorWrite:P.gf,stencilWrite:a?M.s3:null,stencilTest:a?t?M.eD:M.RY:null,polygonOffset:(0,c.eZ)(e)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}}const b=new Map([[p.T.POSITION,0],[p.T.UV0,2],[p.T.PERSPECTIVEDIVIDE,3]]);var C=n(73440),D=n(31839),O=n(34479),T=n(83046),x=n(91041);class A extends x.W{constructor(e){super(),this.draped=e,this.cullFace=a.Vr.None,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=D.I.None,this.emissionSource=O.jo.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1,this.snowCover=!1}}(0,C._)([(0,T.o)({count:a.Vr.COUNT})],A.prototype,"cullFace",void 0),(0,C._)([(0,T.o)()],A.prototype,"enableOffset",void 0),(0,C._)([(0,T.o)()],A.prototype,"writeDepth",void 0),(0,C._)([(0,T.o)()],A.prototype,"hasOccludees",void 0),(0,C._)([(0,T.o)()],A.prototype,"terrainDepthTest",void 0),(0,C._)([(0,T.o)()],A.prototype,"cullAboveTerrain",void 0),(0,C._)([(0,T.o)()],A.prototype,"perspectiveInterpolation",void 0);class I extends g.c{constructor(e){super(e,H),this.vertexAttributeLocations=b,this.supportsEdges=!0,this.produces=new Map([[u.r.OPAQUE_MATERIAL,e=>(0,s.Gy)(e)],[u.r.TRANSPARENT_MATERIAL,e=>(0,s.D5)(e)&&this.parameters.writeDepth],[u.r.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,s.D5)(e)&&!this.parameters.writeDepth],[u.r.DRAPED_MATERIAL,e=>(0,s.D5)(e)||(0,s.Gy)(e)]]),this._configuration=new A(e.draped)}dispose(){this.setParameters({texture:void 0})}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<c.ve,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new R(e)}createBufferWriter(){let e=m.qj;return this.parameters.perspectiveInterpolation&&(e=e.clone().f32(p.T.PERSPECTIVEDIVIDE)),new z(e)}}class R extends o.Z{constructor(e){super({...e,...e.material.parameters}),this.parameters=e;const t=this._material.parameters.texture;(0,r.f)(t)&&e.textures.updater.add(t)}dispose(){this.parameters.textures.updater.remove(this._material.parameters.texture)}beginSlot(e){return this.getTechnique(w,e)}}class z extends h.G{write(e,t,n,s,a,o){for(const s of this.vertexBufferLayout.fields.keys()){const r=n.get(s);if(r)if(s===p.T.PERSPECTIVEDIVIDE){(0,d.hu)(1===r.size);const e=a.getField(s,i.ly);e&&(0,f.XW)(r,e,o)}else(0,f.i9)(s,r,e,t,a,o)}return null}}class H extends l.Mt{constructor(e,t){super(),this.texture=e,this.draped=t,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=a.Vr.None,this.opacity=1,this.perspectiveInterpolation=!1}get glTexture(){return this.texture.glTexture}}},21498:function(e,t,n){n.d(t,{w:function(){return a}});var i=n(92490),s=n(61442);function a(e){const t=new i.r(e);return t.options.store=s.e.MIN,t.options.excludeLabels=!0,t}},76010:function(e,t,n){n.d(t,{y:function(){return u}});var i=n(73440),s=n(70880),a=n(61100),o=n(93568),r=n(17155),l=(n(61432),n(96711),n(83850),n(48023)),c=n(50399);let u=class extends s.Z{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,o.Ds)((async(e,t,n,i)=>{const s=this._frameTask;if(null==s)return;const a=await s.schedule((()=>t.snap({...e,context:n,signal:i})),i);a.valid&&await s.schedule((()=>{this.stagedPoint=a.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))}),i)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=e?e.registerTask(c.T8.SNAPPING):c.sq}destroy(){this._abortController=(0,a.IM)(this._abortController),this._frameTask=(0,a.hw)(this._frameTask)}update(e,t,n){this._snapPoints=e;const{point:i,scenePoint:s}=e,a=t.update({point:i,scenePoint:s,context:n});return this.stagedPoint=a,a}async snap(e,t,n){const{point:i,scenePoint:s}=e;return this.stagedPoint=t.update({point:i,scenePoint:s,context:n}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,a.IM)(this._abortController),this._snapPoints=null}};(0,i._)([(0,r.Cb)({constructOnly:!0})],u.prototype,"view",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"stagedPoint",null),(0,i._)([(0,r.Cb)()],u.prototype,"constrainResult",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"_stagedPoint",void 0),u=(0,i._)([(0,l.j)("esri.views.interactive.snapping.SnappingOperation")],u)},8316:function(e,t,n){n.d(t,{U:function(){return o}});var i=n(82846),s=n(49510),a=n(55274);async function o(){return e=await(0,a.H)(),{autoLength2D:t=>e.geodesicLength(t)??(0,s.Sx)(t),autoDistanceBetweenPoints2D:(t,n)=>e.geodesicDistanceBetweenPoints(t,n)??(0,s.xI)(t,n),autoDistance2D:(t,n,i)=>(r[0]=t[0],r[1]=t[1],r[2]=3===t.length?t[2]:0,l[0]=n[0],l[1]=n[1],l[2]=3===n.length?n[2]:0,e.geodesicDistance(r,l,i)??(0,s.qj)(r,l,i))};var e}const r=(0,i.Ue)(),l=(0,i.Ue)()}}]);