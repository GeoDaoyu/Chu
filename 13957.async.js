"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[13957],{2875:function(t,e,i){i.d(e,{a:function(){return c},b:function(){return o},c:function(){return a},d:function(){return s},e:function(){return f},f:function(){return u},l:function(){return l},n:function(){return d},t:function(){return r}});var n=i(38461);i(61432),i(96711);function s(t,e,i){r(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function r(t,e,i,n=3,s=n){if(t.length/n!==Math.ceil(e.length/s))return t;const r=t.length/n,a=i[0],o=i[1],h=i[2],l=i[4],u=i[5],c=i[6],f=i[8],d=i[9],_=i[10],m=i[12],g=i[13],x=i[14];let p=0,y=0;for(let i=0;i<r;i++){const i=e[p],r=e[p+1],w=e[p+2];t[y]=a*i+l*r+f*w+m,t[y+1]=o*i+u*r+d*w+g,t[y+2]=h*i+c*r+_*w+x,p+=s,y+=n}return t}function a(t,e,i){o(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function o(t,e,i,n=3,s=n){if(t.length/n!==Math.ceil(e.length/s))return;const r=t.length/n,a=i[0],o=i[1],h=i[2],l=i[3],u=i[4],c=i[5],f=i[6],d=i[7],_=i[8];let m=0,g=0;for(let i=0;i<r;i++){const i=e[m],r=e[m+1],x=e[m+2];t[g]=a*i+l*r+f*x,t[g+1]=o*i+u*r+d*x,t[g+2]=h*i+c*r+_*x,m+=s,g+=n}}function h(t,e,i,n=3,s=n){const r=Math.min(t.length/n,e.length/s);let a=0,o=0;for(let h=0;h<r;h++)t[o]=i*e[a],t[o+1]=i*e[a+1],t[o+2]=i*e[a+2],a+=s,o+=n;return t}function l(t,e,i,n){u(t.typedBuffer,e.typedBuffer,i,n,t.typedBufferStride,e.typedBufferStride)}function u(t,e,i,s,r=3,a=r){const o=Math.min(t.length/r,e.length/a);let h=0,l=0;const u=1/n.jm;for(let n=0;n<o;n++)t[l]=s*(i*e[h])**u,t[l+1]=s*(i*e[h+1])**u,t[l+2]=s*(i*e[h+2])**u,h+=a,l+=r}function c(t,e,i,n=3,s=n){const r=t.length/n;if(r!==Math.ceil(e.length/s))return t;let a=0,o=0;for(let h=0;h<r;h++)t[o]=e[a]+i[0],t[o+1]=e[a+1]+i[1],t[o+2]=e[a+2]+i[2],a+=s,o+=n;return t}function f(t,e){d(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function d(t,e,i=3,n=i){const s=Math.min(t.length/i,e.length/n);let r=0,a=0;for(let o=0;o<s;o++){const s=e[r],o=e[r+1],h=e[r+2],l=s*s+o*o+h*h;if(l>0){const e=1/Math.sqrt(l);t[a]=e*s,t[a+1]=e*o,t[a+2]=e*h}r+=n,a+=i}}Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:u,linearToSRGBView:l,normalize:d,normalizeView:f,scale:h,scaleView:function(t,e,i){h(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)},shiftRight:function(t,e,i){const n=Math.min(t.count,e.count),s=t.typedBuffer,r=t.typedBufferStride,a=e.typedBuffer,o=e.typedBufferStride;let h=0,l=0;for(let t=0;t<n;t++)s[l]=a[h]>>i,s[l+1]=a[h+1]>>i,s[l+2]=a[h+2]>>i,h+=o,l+=r},transformMat3:o,transformMat3View:a,transformMat4:r,transformMat4View:s,translate:c},Symbol.toStringTag,{value:"Module"}))},88890:function(t,e,i){i.d(e,{em:function(){return s},hZ:function(){return u},mx:function(){return l}});var n=i(81001);const s="arial-unicode-ms",r="woff2",a=new Map,o=new Set;class h{constructor(t,e){this.fontFace=t,this.promise=e}}async function l(t){const e=d(t),i=f(t),s=a.get(e);if(s)return s.promise;const l=new FontFace(t.family,`url('${n.default.fontsUrl}/woff2/${i}.${r}') format('${r}')`,{style:t.style,weight:t.weight}),u=document.fonts;if(u.has(l)&&"loading"===l.status)return l.loaded;const c=l.load().then((()=>(u.add(l),l)));return a.set(e,new h(l,c)),o.add(l),c}function u(t){return o.has(t)}function c(t){if(!t)return s;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function f(t){const e=_(t)+m(t);return c(t.family)+(e.length>0?e:"-regular")}function d(t){const e=_(t)+m(t);return(t.family||s)+(e.length>0?e:"-regular")}function _(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function m(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}},35236:function(t,e,i){i.d(e,{Jl:function(){return c},n$:function(){return d},r7:function(){return u}});var n=i(78619),s=i(88194),r=i(93568),a=i(95490),o=i(90230);let h=null,l=!0;function u(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(t,e)}catch(t){l=!1}return f(t,e,i)}function c(t,e,i,n){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(t,e,i)}catch(t){l=!1}const s=f(e,i,n);return s.data.set(t,0),s}function f(t,e,i){return i||(h||(h=document.createElement("canvas"),h.width=1,h.height=1),i=h),i.getContext("2d").createImageData(t,e)}async function d(t,e){const{arrayBuffer:h,mediaType:l}=await async function(t,e){const i=(0,a.sJ)(t);if(i?.isBase64)return{arrayBuffer:(0,o.R)(i.data),mediaType:i.mediaType};const s=await(0,n.Z)(t,{responseType:"array-buffer",...e});return{arrayBuffer:s.data,mediaType:s.getHeader?.("Content-Type")??""}}(t,e),u="image/png"===l;if("image/gif"===l){const{isAnimatedGIF:t,parseGif:n}=await i.e(20256).then(i.bind(i,20256));if(t(h))return n(h,e)}if(u){const{isAnimatedPNG:t,parseApng:n}=await i.e(98333).then(i.bind(i,98333));if(t(h))return n(h,e)}return async function(t,e){const i=window.URL.createObjectURL(t);try{const{data:t}=await(0,n.Z)(i,{...e,responseType:"image"});return t}catch(t){if(!(0,r.D_)(t))throw new s.Z("invalid-image",`Could not fetch requested image at ${i}`);throw t}finally{window.URL.revokeObjectURL(i)}}(new Blob([h],{type:l}),e)}},75307:function(t,e,i){i.d(e,{J:function(){return s}});var n=i(59384);function s(t){return t<=n.c8?new Array(t):new Int16Array(t)}},82394:function(t,e,i){i.d(e,{E9:function(){return r},I6:function(){return h},Vl:function(){return n},bN:function(){return o}});var n,s;!function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"}(n||(n={}));class r{constructor(t,e){this.x=t,this.y=e}static fromArray(t){return new r(t[0],t[1])}clone(){return new r(this.x,this.y)}equals(t,e){return t===this.x&&e===this.y}isEqual(t){return t.x===this.x&&t.y===this.y}setCoords(t,e){return this.x=t,this.y=e,this}normalize(){const t=this.x,e=this.y,i=Math.sqrt(t*t+e*e);return this.x/=i,this.y/=i,this}rightPerpendicular(){const t=this.x;return this.x=this.y,this.y=-t,this}leftPerpendicular(){const t=this.x;return this.x=-this.y,this.y=t,this}move(t,e){return this.x+=t,this.y+=e,this}assign(t){return this.x=t.x,this.y=t.y,this}assignAdd(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}assignSub(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}rotate(t,e){const i=this.x,n=this.y;return this.x=i*t-n*e,this.y=i*e+n*t,this}rotateReverse(t,e){const i=this.x,n=this.y;return this.x=i*t+n*e,this.y=-i*e+n*t,this}scale(t){return this.x*=t,this.y*=t,this}length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}sub(t){return this.x-=t.x,this.y-=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}static distance(t,e){const i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)}static add(t,e){return new r(t.x+e.x,t.y+e.y)}static sub(t,e){return new r(t.x-e.x,t.y-e.y)}}class a{constructor(t,e,i){this.ratio=t,this.x=e,this.y=i}}class o{constructor(t,e,i,n=8,s=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=n,this._pixelMargin=s,this._tileSize=512*n,this._dz=t,this._yPos=e,this._xPos=i}setPixelMargin(t){t!==this._pixelMargin&&(this._pixelMargin=t,this.setExtent(this._extent))}setExtent(t){this._extent=t,this._finalRatio=this._tileSize/t*(1<<this._dz);let e=this._pixelRatio*this._pixelMargin;e/=this._finalRatio;const i=t>>this._dz;e>i&&(e=i),this._margin=e,this._xmin=i*this._xPos-e,this._ymin=i*this._yPos-e,this._xmax=this._xmin+i+2*e,this._ymax=this._ymin+i+2*e}reset(t){this._type=t,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(t,e){this._pushLine(),this._prevIsIn=this._isIn(t,e),this._moveTo(t,e,this._prevIsIn),this._prevPt=new r(t,e),this._firstPt=new r(t,e),this._dist=0}lineTo(t,e){const i=this._isIn(t,e),n=new r(t,e),s=r.distance(this._prevPt,n);let o,h,l,u,c,f,d,_;if(i)this._prevIsIn?this._lineTo(t,e,!0):(o=this._prevPt,h=n,l=this._intersect(h,o),this._start=this._dist+s*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(h.x,h.y,!0));else if(this._prevIsIn)h=this._prevPt,o=n,l=this._intersect(h,o),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!1);else{const t=this._prevPt,e=n;if(t.x<=this._xmin&&e.x<=this._xmin||t.x>=this._xmax&&e.x>=this._xmax||t.y<=this._ymin&&e.y<=this._ymin||t.y>=this._ymax&&e.y>=this._ymax)this._lineTo(e.x,e.y,!1);else{const i=[];if((t.x<this._xmin&&e.x>this._xmin||t.x>this._xmin&&e.x<this._xmin)&&(u=(this._xmin-t.x)/(e.x-t.x),_=t.y+u*(e.y-t.y),_<=this._ymin?f=!1:_>=this._ymax?f=!0:i.push(new a(u,this._xmin,_))),(t.x<this._xmax&&e.x>this._xmax||t.x>this._xmax&&e.x<this._xmax)&&(u=(this._xmax-t.x)/(e.x-t.x),_=t.y+u*(e.y-t.y),_<=this._ymin?f=!1:_>=this._ymax?f=!0:i.push(new a(u,this._xmax,_))),(t.y<this._ymin&&e.y>this._ymin||t.y>this._ymin&&e.y<this._ymin)&&(u=(this._ymin-t.y)/(e.y-t.y),d=t.x+u*(e.x-t.x),d<=this._xmin?c=!1:d>=this._xmax?c=!0:i.push(new a(u,d,this._ymin))),(t.y<this._ymax&&e.y>this._ymax||t.y>this._ymax&&e.y<this._ymax)&&(u=(this._ymax-t.y)/(e.y-t.y),d=t.x+u*(e.x-t.x),d<=this._xmin?c=!1:d>=this._xmax?c=!0:i.push(new a(u,d,this._ymax))),0===i.length)c?f?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):f?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(i.length>1&&i[0].ratio>i[1].ratio)this._start=this._dist+s*i[1].ratio,this._lineTo(i[1].x,i[1].y,!0),this._lineTo(i[0].x,i[0].y,!0);else{this._start=this._dist+s*i[0].ratio;for(let t=0;t<i.length;t++)this._lineTo(i[t].x,i[t].y,!0)}this._lineTo(e.x,e.y,!1)}}this._dist+=s,this._prevIsIn=i,this._prevPt=n}close(){if(this._line.length>2){const t=this._firstPt,e=this._prevPt;t.x===e.x&&t.y===e.y||this.lineTo(t.x,t.y);const i=this._line;let n=i.length;for(;n>=4&&(i[0].x===i[1].x&&i[0].x===i[n-2].x||i[0].y===i[1].y&&i[0].y===i[n-2].y);)i.pop(),i[0].x=i[n-2].x,i[0].y=i[n-2].y,--n}}result(t=!0){return this._pushLine(),0===this._lines.length?null:(this._type===n.Polygon&&t&&l.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==n.LineString)throw new Error("Only valid for lines");this._pushLine();const t=this._lines,e=t.length;if(0===e)return null;const i=[];for(let n=0;n<e;n++)i.push({line:t[n],start:this._starts[n]||0});return i}_isIn(t,e){return t>=this._xmin&&t<=this._xmax&&e>=this._ymin&&e<=this._ymax}_intersect(t,e){let i,n,s;if(e.x>=this._xmin&&e.x<=this._xmax)n=e.y<=this._ymin?this._ymin:this._ymax,s=(n-t.y)/(e.y-t.y),i=t.x+s*(e.x-t.x);else if(e.y>=this._ymin&&e.y<=this._ymax)i=e.x<=this._xmin?this._xmin:this._xmax,s=(i-t.x)/(e.x-t.x),n=t.y+s*(e.y-t.y);else{n=e.y<=this._ymin?this._ymin:this._ymax,i=e.x<=this._xmin?this._xmin:this._xmax;const r=(i-t.x)/(e.x-t.x),a=(n-t.y)/(e.y-t.y);r<a?(s=r,n=t.y+r*(e.y-t.y)):(s=a,i=t.x+a*(e.x-t.x))}return this._r=s,new r(i,n)}_pushLine(){this._line&&(this._type===n.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===n.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===n.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(t,e,i){this._type!==n.Polygon?i&&(t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),e=Math.round((e-(this._ymin+this._margin))*this._finalRatio),this._line.push(new r(t,e))):(i||(t<this._xmin&&(t=this._xmin),t>this._xmax&&(t=this._xmax),e<this._ymin&&(e=this._ymin),e>this._ymax&&(e=this._ymax)),t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),e=Math.round((e-(this._ymin+this._margin))*this._finalRatio),this._line.push(new r(t,e)),this._isH=!1,this._isV=!1)}_lineTo(t,e,i){let s,a;if(this._type!==n.Polygon)if(i){if(t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),e=Math.round((e-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(t,e)))return;this._line.push(new r(t,e))}else this._line&&this._line.length>0&&this._pushLine();else if(i||(t<this._xmin&&(t=this._xmin),t>this._xmax&&(t=this._xmax),e<this._ymin&&(e=this._ymin),e>this._ymax&&(e=this._ymax)),t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),e=Math.round((e-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const i=s.x===t,n=s.y===e;if(i&&n)return;this._isH&&i||this._isV&&n?(s.x=t,s.y=e,a=this._line[this._line.length-2],a.x===t&&a.y===e?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(a=this._line[this._line.length-2],this._isH=a.x===t,this._isV=a.y===e)):(this._isH=a.x===t,this._isV=a.y===e)):(this._line.push(new r(t,e)),this._isH=i,this._isV=n)}else this._line.push(new r(t,e))}}class h{setExtent(t){this._ratio=4096===t?1:4096/t}get validateTessellation(){return this._ratio<1}reset(t){this._lines=[],this._line=null}moveTo(t,e){this._line&&this._lines.push(this._line),this._line=[];const i=this._ratio;this._line.push(new r(t*i,e*i))}lineTo(t,e){const i=this._ratio;this._line.push(new r(t*i,e*i))}close(){const t=this._line;t&&!t[0].isEqual(t[t.length-1])&&t.push(t[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}!function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"}(s||(s={}));class l{static simplify(t,e,i){if(!i)return;const n=-e,r=t+e,a=-e,o=t+e,h=[],u=[],c=i.length;for(let t=0;t<c;++t){const e=i[t];if(!e||e.length<2)continue;let l,c=e[0];const f=e.length;for(let i=1;i<f;++i)l=e[i],c.x===l.x&&(c.x<=n&&(c.y>l.y?(h.push(t),h.push(i),h.push(s.sideLeft),h.push(-1)):(u.push(t),u.push(i),u.push(s.sideLeft),u.push(-1))),c.x>=r&&(c.y<l.y?(h.push(t),h.push(i),h.push(s.sideRight),h.push(-1)):(u.push(t),u.push(i),u.push(s.sideRight),u.push(-1)))),c.y===l.y&&(c.y<=a&&(c.x<l.x?(h.push(t),h.push(i),h.push(s.sideTop),h.push(-1)):(u.push(t),u.push(i),u.push(s.sideTop),u.push(-1))),c.y>=o&&(c.x>l.x?(h.push(t),h.push(i),h.push(s.sideBottom),h.push(-1)):(u.push(t),u.push(i),u.push(s.sideBottom),u.push(-1)))),c=l}if(0===h.length||0===u.length)return;l.fillParent(i,u,h),l.fillParent(i,h,u);const f=[];l.calcDeltas(f,u,h),l.calcDeltas(f,h,u),l.addDeltas(f,i)}static fillParent(t,e,i){const n=i.length,r=e.length;for(let a=0;a<r;a+=4){const r=e[a],o=e[a+1],h=e[a+2],l=t[r][o-1],c=t[r][o];let f=8092,d=-1;for(let e=0;e<n;e+=4){if(i[e+2]!==h)continue;const n=i[e],r=i[e+1],a=t[n][r-1],o=t[n][r];switch(h){case s.sideLeft:case s.sideRight:if(u(l.y,a.y,o.y)&&u(c.y,a.y,o.y)){const t=Math.abs(o.y-a.y);t<f&&(f=t,d=e)}break;case s.sideTop:case s.sideBottom:if(u(l.x,a.x,o.x)&&u(c.x,a.x,o.x)){const t=Math.abs(o.x-a.x);t<f&&(f=t,d=e)}}}e[a+3]=d}}static calcDeltas(t,e,i){const n=e.length;for(let s=0;s<n;s+=4){const n=[],r=l.calcDelta(s,e,i,n);t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]),t.push(r)}}static calcDelta(t,e,i,n){const s=e[t+3];if(-1===s)return 0;const r=n.length;return r>1&&n[r-2]===s?0:(n.push(s),l.calcDelta(s,i,e,n)+1)}static addDeltas(t,e){const i=t.length;let n=0;for(let e=0;e<i;e+=4){const i=t[e+3];i>n&&(n=i)}for(let r=0;r<i;r+=4){const i=e[t[r]],a=t[r+1],o=n-t[r+3];switch(t[r+2]){case s.sideLeft:i[a-1].x-=o,i[a].x-=o,1===a&&(i[i.length-1].x-=o),a===i.length-1&&(i[0].x-=o);break;case s.sideRight:i[a-1].x+=o,i[a].x+=o,1===a&&(i[i.length-1].x+=o),a===i.length-1&&(i[0].x+=o);break;case s.sideTop:i[a-1].y-=o,i[a].y-=o,1===a&&(i[i.length-1].y-=o),a===i.length-1&&(i[0].y-=o);break;case s.sideBottom:i[a-1].y+=o,i[a].y+=o,1===a&&(i[i.length-1].y+=o),a===i.length-1&&(i[0].y+=o)}}}}const u=(t,e,i)=>t>=e&&t<=i||t>=i&&t<=e},99719:function(t,e,i){i.d(e,{DQ:function(){return c},FM:function(){return r},KU:function(){return g},Of:function(){return x},Or:function(){return f},Px:function(){return y},RD:function(){return a},Wg:function(){return v},Z0:function(){return p},k3:function(){return _},nF:function(){return l},pK:function(){return w},s5:function(){return d},sX:function(){return m},yF:function(){return o}});var n=i(28931),s=i(82394);const r=Number.POSITIVE_INFINITY,a=Math.PI,o=2*a,h=128/a,l=a/180,u=1/Math.LN2;function c(t,e){return(t%=e)>=0?t:t+e}function f(t){return c(t*h,256)}function d(t){return c(.7111111111111111*t,256)}function _(t){return Math.log(t)*u}function m(t,e,i){return t*(1-i)+e*i}function g(t){return 8+Math.max(16*(t-14),0)}function x(t,e,i){let n,s,r,a=0;for(const o of i){n=o.length;for(let i=1;i<n;++i)s=o[i-1],r=o[i],s.y>e!=r.y>e&&((r.x-s.x)*(e-s.y)-(r.y-s.y)*(t-s.x)>0?a++:a--)}return 0!==a}function p(t,e,i,s){let r,a,o,h;const l=s*s;for(const s of i){const i=s.length;if(!(i<2)){r=s[0].x,a=s[0].y;for(let u=1;u<i;++u){if(o=s[u].x,h=s[u].y,(0,n.Hu)(t,e,r,a,o,h)<l)return!0;r=o,a=h}}}return!1}function y(t,e,i,n,s,r,a){const o=Math.max(n,Math.min(e,r))-e,h=Math.max(s,Math.min(i,a))-i;return o*o+h*h<=t*t}function w(t,e){if(0===e||Number.isNaN(e))return t;const i=[],n=new s.E9(0,0),r=new s.E9(0,0),a=new s.E9(0,0);for(let o=0;o<t.length;o++){const h=t[o],l=[];for(let t=0;t<h.length;t++){const i=h[t-1],o=h[t],u=h[t+1];0===t?n.setCoords(0,0):n.assignSub(o,i).normalize().rightPerpendicular(),t===h.length-1?r.setCoords(0,0):r.assignSub(u,o).normalize().rightPerpendicular(),a.assignAdd(n,r).normalize();const c=a.x*r.x+a.y*r.y;0!==c&&a.scale(1/c),l.push(s.E9.add(o,a.scale(e)))}i.push(l)}return i}function v(t,e,i,n){const r=new s.E9(t[0],t[1]);if(r.scale(n),"viewport"===e){const t=-i*(Math.PI/180),e=Math.cos(t),n=Math.sin(t);r.rotate(e,n)}return r}},30393:function(t,e,i){i.d(e,{A5:function(){return w},IZ:function(){return h},JS:function(){return x},KA:function(){return p},NT:function(){return v},Vo:function(){return _},_8:function(){return y},_E:function(){return d},aV:function(){return g},dD:function(){return f},do:function(){return c},g3:function(){return l},gj:function(){return a},i9:function(){return n},iD:function(){return r},kU:function(){return u},s4:function(){return m},uk:function(){return s},wi:function(){return o}});const n=512,s=29,r=24,a=4;var o;!function(t){t[t.FilterFlags=0]="FilterFlags",t[t.Animation=1]="Animation",t[t.GPGPU=2]="GPGPU",t[t.VV=3]="VV",t[t.DD0=4]="DD0",t[t.DD1=5]="DD1",t[t.DD2=6]="DD2",t[t.LocalTimeOrigin=7]="LocalTimeOrigin"}(o||(o={}));const h=6,l=1<<h,u=l<<1,c=1.05,f=5,d=6,_=1.15,m=4,g=1,x=10,p=1024,y=256,w=32,v=512},95631:function(t,e,i){i.d(e,{C:function(){return h}});var n=i(78619),s=i(29292),r=i(88194),a=i(93568),o=i(95490);class h{constructor(t){this._streamDataRequester=t}async loadJSON(t,e){return this._load("json",t,e)}async loadBinary(t,e){return(0,o.HK)(t)?((0,a.k_)(e),(0,o.AH)(t)):this._load("binary",t,e)}async loadImage(t,e){return this._load("image",t,e)}async _load(t,e,i){if(null==this._streamDataRequester)return(await(0,n.Z)(e,{responseType:l[t]})).data;const o=await(0,s.q6)(this._streamDataRequester.request(e,t,i));if(!0===o.ok)return o.value;throw(0,a.r9)(o.error),new r.Z("glt-loader-request-error",`Request for resource failed: ${o.error}`)}}const l={image:"image",binary:"array-buffer",json:"json","image+type":void 0}},91896:function(t,e,i){i.d(e,{U:function(){return o},a:function(){return a}});var n=i(41788),s=i(82846),r=i(27583);class a{constructor(t,e="center",i=!1,a=(0,n.Ue)(),o=(0,r.al)(0,0,0,-1),h="world",l=(0,s.Ue)(),u=0){this.verticalOffset=t,this.anchor=e,this.hasLabelVerticalOffset=i,this.screenOffset=a,this.centerOffset=o,this.centerOffsetUnits=h,this.translation=l,this.elevationOffset=u}}class o{constructor(t,e="center",i="center",s=null,r=(0,n.Ue)(),a=!0){this.placement=t,this.horizontalPlacement=e,this.verticalPlacement=i,this.text=s,this.displaySize=r,this.isFocused=a}}},29989:function(t,e,i){i.d(e,{$A:function(){return a},EP:function(){return u},QW:function(){return c},c4:function(){return d},j1:function(){return f},mq:function(){return h},yY:function(){return o},zi:function(){return l}});var n=i(26821),s=i(41788),r=i(84262);const a=Object.freeze({left:0,center:.5,right:1}),o=Object.freeze({"bottom-left":(0,s.al)(0,0),bottom:(0,s.al)(.5,0),"bottom-right":(0,s.al)(1,0),left:(0,s.al)(0,.5),center:(0,s.al)(.5,.5),right:(0,s.al)(1,.5),"top-left":(0,s.al)(0,1),top:(0,s.al)(.5,1),"top-right":(0,s.al)(1,1)});function h(t){switch(t){case"left":return r.vU.Left;case"right":return r.vU.Right;default:return r.vU.Center}}function l(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function u(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function c(t,e){switch(e){case"bottom":return"left"===t?"bottom-left":"right"===t?"bottom-right":"bottom";case"center":return t;case"top":return"left"===t?"top-left":"right"===t?"top-right":"top"}}function f(t){return"middle"===t?"center":t}function d(t,e){switch(t){case"top":return(0,n.t8)(e,0,r.Wg);case"bottom":return(0,n.t8)(e,0,-1);default:return(0,n.JG)(e,s.AG)}}},58744:function(t,e,i){i.d(e,{p2:function(){return S},zD:function(){return T}});var n=i(78619),s=i(29292),r=i(88194),a=i(96711),o=i(85881),h=i(61544),l=i(93568),u=i(15322),c=i(82846),f=i(16447),d=i(38766),_=i(51880),m=i(81749),g=i(32420),x=i(25952),p=i(28751),y=i(52061),w=i(35720),v=i(65650);const b=()=>a.Z.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");class R{constructor(t,e,i){this.resource=t,this.textures=e,this.cachedMemory=i}}async function T(t,e){const i=await async function(t,e){const i=e?.streamDataRequester;if(i)return async function(t,e,i){const n=await(0,s.q6)(e.request(t,"json",i));if(!0===n.ok)return n.value;(0,l.r9)(n.error),M(n.error.details.url)}(t,i,e);const r=await(0,s.q6)((0,n.Z)(t,e));if(!0===r.ok)return r.value.data;(0,l.r9)(r.error),M(r.error)}(t,e),r=await async function(t,e){const i=new Array;for(const n in t){const s=t[n],r=s.images[0].data;if(!r){b().warn("Externally referenced texture data is not yet supported");continue}const a=s.encoding+";base64,"+r,o="/textureDefinitions/"+n,h="rgba"===s.channels?s.alphaChannelUsage||"transparency":"none",l={noUnpackFlip:!0,wrap:{s:v.e8.REPEAT,t:v.e8.REPEAT},preMultiplyAlpha:A(h)!==g.JJ.Opaque},u=e?.disableTextures?Promise.resolve(null):(0,_.t)(a,e);i.push(u.then((t=>({refId:o,image:t,parameters:l,alphaChannelUsage:h}))))}const n=await Promise.all(i),s={};for(const t of n)s[t.refId]=t;return s}(i.textureDefinitions??{},e);let a=0;for(const t in r)if(r.hasOwnProperty(t)){const e=r[t];a+=e?.image?e.image.width*e.image.height*4:0}return new R(i,r,a+(0,o.kk)(i))}function M(t){throw new r.Z("",`Request for object resource failed: ${t}`)}function P(t){const e=t.params,i=e.topology;let n=!0;switch(e.vertexAttributes||(b().warn("Geometry must specify vertex attributes"),n=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const t=e.faces;if(t){if(e.vertexAttributes)for(const i in e.vertexAttributes){const e=t[i];e?.values?(null!=e.valueType&&"UInt32"!==e.valueType&&(b().warn(`Unsupported indexed geometry indices type '${e.valueType}', only UInt32 is currently supported`),n=!1),null!=e.valuesPerElement&&1!==e.valuesPerElement&&(b().warn(`Unsupported indexed geometry values per element '${e.valuesPerElement}', only 1 is currently supported`),n=!1)):(b().warn(`Indexed geometry does not specify face indices for '${i}' attribute`),n=!1)}}else b().warn("Indexed geometries must specify faces"),n=!1;break}default:b().warn(`Unsupported topology '${i}'`),n=!1}t.params.material||(b().warn("Geometry requires material"),n=!1);const s=t.params.vertexAttributes;for(const t in s)s[t].values||(b().warn("Geometries with externally defined attributes are not yet supported"),n=!1);return n}function S(t,e){const i=new Array,n=new Array,s=new Array,r=new h.r,a=t.resource,o=u.G.parse(a.version||"1.0","wosr");z.validate(o);const l=a.model.name,f=a.model.geometries,_=a.materialDefinitions??{},v=t.textures;let b=0;const R=new Map;for(let t=0;t<f.length;t++){const a=f[t];if(!P(a))continue;const o=L(a),h=a.params.vertexAttributes,l=[],u=t=>{if("PerAttributeArray"===a.params.topology)return null;const e=a.params.faces;for(const i in e)if(i===t)return e[i].values;return null},T=h[y.T.POSITION],M=T.values.length/T.valuesPerElement;for(const t in h){const e=h[t],i=e.values,n=u(t)??(0,d.KF)(M);l.push([t,new m.a(i,n,e.valuesPerElement,!0)])}const S=o.texture,k=v&&v[S];if(k&&!R.has(S)){const{image:t,parameters:e}=k,i=new p.x(t,e);n.push(i),R.set(S,i)}const z=R.get(S),U=z?z.id:void 0,B=o.material;let D=r.get(B,S);if(null==D){const t=_[B.slice(B.lastIndexOf("/")+1)].params;1===t.transparency&&(t.transparency=0);const i=k?A(k.alphaChannelUsage):void 0,n={ambient:(0,c.nI)(t.diffuse),diffuse:(0,c.nI)(t.diffuse),opacity:1-(t.transparency||0),textureAlphaMode:i,textureAlphaCutoff:.33,textureId:U,doubleSided:!0,cullFace:g.Vr.None,colorMixMode:t.externalColorMixMode||"tint",textureAlphaPremultiplied:k?.parameters.preMultiplyAlpha??!1};e?.materialParameters&&Object.assign(n,e.materialParameters),D=new w.Gp(n,e),r.set(B,S,D)}s.push(D);const O=new x.Z(D,l);b+=l.find((t=>t[0]===y.T.POSITION))?.[1]?.indices.length??0,i.push(O)}return{engineResources:[{name:l,stageResources:{textures:n,materials:s,geometries:i},pivotOffset:a.model.pivotOffset,numberOfVertices:b,lodThreshold:null}],referenceBoundingBox:k(i)}}function k(t){const e=(0,f.cS)();return t.forEach((t=>{const i=t.boundingInfo;null!=i&&((0,f.pp)(e,i.bbMin),(0,f.pp)(e,i.bbMax))})),e}function A(t){switch(t){case"mask":return g.JJ.Mask;case"maskAndTransparency":return g.JJ.MaskBlend;case"none":return g.JJ.Opaque;default:return g.JJ.Blend}}function L(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const z=new u.G(1,2,"wosr")},13212:function(t,e,i){i.d(e,{n:function(){return s}});var n=i(48857);function s(t,e){e.spherical?t.vertex.code.add(n.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(n.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(n.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(n.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},65001:function(t,e,i){i.d(e,{P:function(){return n}});class n{constructor(t=1/0,e=-1/0){this.near=t,this.far=e}set(t,e){this.near=t,this.far=e}union(t){null!=t&&(this.near=Math.min(this.near,t.near),this.far=Math.max(this.far,t.far))}within(t){return this.near<=t&&t<=this.far}equals(t){return this.near===t.near&&this.far===t.far}static{this.zero=new n(0,0)}static{this.infinite=new n}}},24956:function(t,e,i){i.d(e,{U:function(){return s}});var n=i(40420);function s(t){const{size:e}=t.definition,i=t.fontString(e);let s=r.get(i);if(!s){const l=(0,n.G)(o,0,0).getContext("2d");t.setFontProperties(l,e);const u=l.measureText(h);s=new a(u.actualBoundingBoxAscent,u.actualBoundingBoxDescent),r.set(i,s)}return s}const r=new Map;class a{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(t,e){this.maxAscent=t,this.maxDescent=e}}const o={canvas:null},h=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})()},55003:function(t,e,i){i.d(e,{p:function(){return s}});var n=i(32420);class s{constructor(t,e){this._material=t,this._repository=e,this._map=new Map}dispose(){this._map.forEach(((t,e)=>{null!=t&&this._repository.release(this._material,e)}))}load(t,e,i){if(!this._material.produces.get(e)?.(i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,e,i));const s=this._map.get(i);if(s){if(s.ensureResources(t)===n.Rw.LOADED)return s;this._repository.requestRender()}return null}}},72913:function(t,e,i){i.d(e,{Pj:function(){return l},hd:function(){return o},nG:function(){return h},rc:function(){return u}});var n=i(99574),s=i(24910),r=i(82846),a=(i(39909),i(75307));function o(t,e,i,n,s,r=2){const a=1/(Math.abs(i)+Math.abs(n)+Math.abs(s)),o=i*a,h=n*a,l=s<=0?(o>=0?1:-1)*(1-Math.abs(h)):o,u=s<=0?(h>=0?1:-1)*(1-Math.abs(o)):h,f=e*r;t[f]=c(l),t[f+1]=c(u)}function h(t){const e=t.length/3,i=(0,a.J)(2*e);let n=0;for(let s=0;s<e;++s)o(i,s,t[n++],t[n++],t[n++]);return i}function l(t,e){const i=t.length/3,n=new Int16Array(2*i);let a=0;const h=(0,r.Ue)();for(let r=0;r<i;++r)h[0]=t[a++],h[1]=t[a++],h[2]=t[a++],(0,s.o)(h,h,e),o(n,r,h[0],h[1],h[2]);return n}function u(t,e,i,n=2){const r=i*n,a=f(e[r]),o=f(e[r+1]),h=1-Math.abs(a)-Math.abs(o);return t[2]=h,h<0?(t[0]=(a>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(a))):(t[0]=a,t[1]=o),(0,s.n)(t,t)}function c(t){return(0,n.uZ)(Math.round(32767*t),-32767,32767)}function f(t){return(0,n.uZ)(t/32767,-1,1)}},40420:function(t,e,i){function n(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}i.d(e,{G:function(){return n}})},53412:function(t,e,i){i.d(e,{V:function(){return h}});var n=i(53147),s=i(88890),r=i(96711),a=i(96094),o=i(27583);class h{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=l(t.color),this.haloStyle=function(t){return`rgb(${t.slice(0,3).map((t=>Math.floor(255*t))).toString()})`}(t.halo.color),this.backgroundStyle=0!==t.background.color[3]?l(t.background.color):null}fontString(t){const e=this.definition.font;return`${e.style} ${e.weight} ${t}px ${e.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(t,e){t.font=this.fontString(e),t.textAlign="left",t.textBaseline="alphabetic"}static async fromSymbol(t,e){const i=t?.material?.color,l=n.Z.toUnitRGBA(i)??o.AG,c=null!=t.size?(0,a.F2)(t.size):12,f=t.lineHeight,d=null!=t.background?n.Z.toUnitRGBA(t.background.color):o.AG,_={family:t.font?.family??"sans-serif",decoration:t.font?.decoration??"none",weight:t.font?.weight??"normal",style:t.font?.style??"normal"},m=t.halo,g=null!=m?.color&&m.size>0?{size:(0,a.F2)(m.size),color:n.Z.toUnitRGBA(m.color)}:{size:0,color:o.AG},x=new h({color:l,size:c,background:{color:d,padding:null!=t.background?[.65*c,.5*c]:[0,0],borderRadius:null!=t.background?c*(6/16):0},lineSpacingFactor:f,font:_,halo:g,pixelRatio:e});if(t.font){let e=!1;const i=x.fontString(c);try{e=(await document.fonts.load(i)).some((t=>!(0,s.hZ)(t)))}catch(t){r.Z.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${i}'. Some text symbology may be rendered using the default browser font.`)}if(!e&&!u.has(t.font.family))try{await(0,s.mx)(t.font)}catch(t){}}return x}}function l(t){return`rgba(${t.slice(0,3).map((t=>Math.floor(255*t))).toString()},${t[3]})`}const u=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"])},84262:function(t,e,i){i.d(e,{Wg:function(){return o},tV:function(){return h},vU:function(){return u}});var n=i(99574),s=i(27762),r=i(24956),a=i(40420);const o=1;class h{constructor(t,e,i,n){this.text=t,this._alignment=e,this._parameters=i,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${t}--${this._parameters.key}-${this._alignment}`,this._lines=t.replaceAll(" ","Â ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let t=this._metrics.firstLineAscent;for(let e=0;e<this._lines.length-1;e++)t+=this._lineSpacing;return t+=this._metrics.lastLineDescent,Math.ceil(t+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const t=(0,a.G)(f,_,_).getContext("2d"),e=this._parameters.definition.pixelRatio,i=this._fontSize*e;this._parameters.setFontProperties(t,i);let n=2*this._haloSize;const s=this._parameters.definition.font;"italic"!==s.style&&"oblique"!==s.style&&"bold"!==s.weight&&"bolder"!==s.weight||(n+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,h=0,l=0,u=0,c=0;this._lines.forEach(((i,s)=>{const r=t.measureText(i),a=r.width/e,f=a+n;this._textWidths.push(a),this._lineWidths.push(f),o=Math.max(o,f),u=Math.max(u,r.actualBoundingBoxAscent/e),c=Math.max(c,r.actualBoundingBoxDescent/e),0===s&&(h=r.actualBoundingBoxAscent/e),s===this._lines.length-1&&(l=r.actualBoundingBoxDescent/e)}));const d=(0,r.U)(this._parameters),m=Math.max(u,d.maxAscent),x=Math.max(c,d.maxDescent),p=h,y="underline"===this._parameters.definition.font.decoration?x:l,w=o;this._metricsCached=new g(p,y,m,x,w)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*d}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,o)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(null==this._renderPixelRatio){const t=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(t,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case u.Left:return this._horizontalPadding;case u.Center:return(this.displayWidth-this._lineWidths[t])/2;case u.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[t]}}render(t,e,i){t.save();const n=e/=this.renderPixelRatio,r=i/=this.renderPixelRatio,a=this._haloSize,o=this._firstLineYOffset+this._metrics.firstLineAscent;e+=a,i+=o;const h=this._haloSize>0;h&&this._renderHalo(t,n,r,a,o),this._parameters.setFontProperties(t,this._renderedFontSize);for(let n=0;n<this._lines.length;++n){const s=this._lines[n],r=this._getLineXOffset(n);h&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,s,e+r,i),this._renderLineDecoration(t,e+r,i,this._textWidths[n])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,s,e+this._getLineXOffset(n),i),this._renderLineDecoration(t,e+r,i,this._textWidths[n]),i+=this._lineSpacing}if(s.h.TEXT_SHOW_BASELINE){t.strokeStyle=m,t.setLineDash([2,2]),t.lineWidth=1;let e=r+o;for(let i=0;i<this._lines.length;++i)this._drawLine(t,[n,e],[n+this.displayWidth,e]),e+=this._lineSpacing}if(s.h.TEXT_SHOW_BORDER&&(t.strokeStyle=m,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[n,r],[this.displayWidth,this.displayHeight])),this._hasBackground){const e=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,n,r,e),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,e,i,n,s=!1){if("none"===this._parameters.definition.font.decoration||0===n)return;const r=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":i+=2*r;break;case"line-through":i-=.33*this._midLineAscent}const a=s?this._haloSize:0;t.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(r+2*a),t.beginPath(),t.moveTo(this._toRenderUnit(e-a),this._toRenderUnit(i)),t.lineTo(this._toRenderUnit(e+n+a),this._toRenderUnit(i)),t.stroke()}_roundedRect(t,e,i,s){e=this._toRenderUnit(e),i=this._toRenderUnit(i);const r=this.renderedWidth,a=this.renderedHeight;0!==s?(s=(0,n.uZ)(s,0,Math.floor(a/2)),t.beginPath(),t.moveTo(e,i+s),t.arcTo(e,i,e+s,i,s),t.lineTo(e+r-s,i),t.arcTo(e+r,i,e+r,i+s,s),t.lineTo(e+r,i+a-s),t.arcTo(e+r,i+a,e+r-s,i+a,s),t.lineTo(e+s,i+a),t.arcTo(e,i+a,e,i+a-s,s),t.closePath()):t.rect(e,i,r,a)}_renderHalo(t,e,i,n,s){const r=this.renderedWidth,o=this.renderedHeight,h=(0,a.G)(f,Math.max(r,_),Math.max(o,_)),l=h.getContext("2d");l.clearRect(0,0,r,o),this._parameters.setFontProperties(l,this._renderedFontSize),l.fillStyle=this._parameters.haloStyle,l.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;l.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(l,n,s):this._renderHaloNative(l,n,s);let c=s;for(let t=0;t<this._lines.length;++t){const e=this._getLineXOffset(t);this._renderLineDecoration(l,n+e,c,this._textWidths[t],!0),c+=this._lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(h,0,0,r,o,this._toRenderUnit(e),this._toRenderUnit(i),r,o),t.globalAlpha=1}_renderHaloEmulated(t,e,i){for(let n=0;n<this._lines.length;++n){const s=this._lines[n],r=this._getLineXOffset(n);for(const[n,a]of l)this._fillText(t,s,e+r+this._haloSize*n,i+this._haloSize*a);i+=this._lineSpacing}}_renderHaloNative(t,e,i){const n=2*this._haloSize;for(let s=0;s<this._lines.length;++s){const r=this._lines[s],a=this._getLineXOffset(s),o=5,h=.1;for(let s=0;s<o;s++){const l=1-(o-1)*h+s*h;t.lineWidth=this._toRenderUnit(l*n),this._strokeText(t,r,e+a,i)}i+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,e,i,n){t.fillText(e,this._toRenderUnit(i),this._toRenderUnit(n))}_strokeText(t,e,i,n){t.strokeText(e,this._toRenderUnit(i),this._toRenderUnit(n))}_drawLine(t,e,i){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(e[0])+.5,this._toRoundedRenderUnit(e[1])+.5),t.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.stroke()}_drawBox(t,e,i){const n=this._toRenderUnit(e[0]),s=this._toRenderUnit(e[1]),r=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),o=Math.floor(n)+.5,h=Math.ceil(n+r)-.5,l=Math.floor(s)+.5,u=Math.ceil(s+a)-.5;t.beginPath(),t.moveTo(o,l),t.lineTo(h,l),t.lineTo(h,u),t.lineTo(o,u),t.lineTo(o,l),t.stroke()}}const l=[];{const t=16;for(let e=0;e<360;e+=360/t)l.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}var u,c;(c=u||(u={}))[c.Left=0]="Left",c[c.Center=1]="Center",c[c.Right=2]="Right";const f={canvas:null},d=.2,_=512,m="rgb(255, 0, 255, 0.5)";class g{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(t,e,i,n,s){this.firstLineAscent=t,this.lastLineDescent=e,this.maxLineAscent=i,this.maxLineDescent=n,this.displayWidth=s}}},4664:function(t,e,i){i.d(e,{U:function(){return w}});var n=i(73440),s=i(70880),r=i(87833),a=(i(61432),i(61100)),o=i(67908),h=i(17155),l=(i(96711),i(83850),i(48023)),u=i(73749),c=i(27583),f=i(21243),d=i(51440),_=i(50399),m=i(78891),g=i(65650),x=i(8158),p=i(35928);const y=4096;let w=class extends s.Z{constructor(t){super(t),this.id=(0,o.D)(),this.events=new r.Z,this._glTexture=null,this._atlas=new T(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._uvCallbacks=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view.stage,this._stage.addTexture(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=(0,a.M2)(this._glTexture),this._frameWorker=(0,a.hw)(this._frameWorker),this.updating=!1,this.events.emit("unloaded")}get loaded(){return null!=this._glTexture}get glTexture(){return this._glTexture}static get maxSize(){return P=f.y.stableRendering?v:0,[y-v-P,y-v-P-b]}load(t){if(this._glTexture)return this._glTexture;const e=new p.X;return e.wrapMode=g.e8.CLAMP_TO_EDGE,e.samplingMode=g.cw.LINEAR_MIPMAP_LINEAR,e.hasMipmap=!0,e.preMultiplyAlpha=!0,e.maxAnisotropy=t.parameters.maxMaxAnisotropy,this._glTexture=new x.x(t,e,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(_.T8.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=(0,a.hw)(this._frameWorker),this._glTexture&&(this._stage.removeTexture(this),this._glTexture=(0,a.M2)(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(t){this._canvas.width=t.width,this._canvas.height=t.height}_resizeAtlas(t,e){const{width:i,height:n}=this._atlas;i===t&&n===e||(this._atlas.width=t,this._atlas.height=e,this._glTexture?.resize(t,e),this._glTexture?.updateData(0,0,0,i,n,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach((t=>this._uvCallbacks.get(t.textRenderer.key)?.forEach((e=>e(t.uv))))),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(t,e,i,n){const s=this._atlas;if(s.width<i||s.height<n)return!1;let r=s.cursors.get(n);if(!r){if(s.height<s.nextY+n)return!1;r=[new M(s.nextY)],s.cursors.set(n,r),s.nextY+=n}let a=r.find((t=>s.width>=t.x+i));if(null==a){if(s.height<s.nextY+n)return!1;a=new M(s.nextY),s.nextY+=n,r.push(a)}return t.setNewPosition(a),this._elements.set(e,t),this._elementsToRender.set(e,t),a.x+=i,!0}_ensureCallbacks(t){const e=this._uvCallbacks.get(t);if(e)return e;const i=new Set;return this._uvCallbacks.set(t,i),i}_addCallback(t,e){this._ensureCallbacks(t).add(e)}_removeCallback(t,e){const i=this._uvCallbacks.get(t);return!(!i?.delete(e)||0!==i.size||(this._uvCallbacks.delete(t),0))}_processAddition(t){const e=t.textRenderer.key;if(this._needsRepack)return void this._elements.set(e,t);const i=this._atlas,n=t.textRenderer.renderedWidth,s=t.textRenderer.renderedHeight,r=n+v,a=s+v+b;if(!this._addAtlasElement(t,e,r,a)){if(this._canRepack)this._reset();else if(i.width<r){const t=(0,d.gu)(Math.max(r,1.5*i.width),y);this._resizeAtlas(t,i.height)}else{const t=i.nextY+a,e=(0,d.gu)(Math.max(t,1.5*i.height),y);if(e>i.height)this._resizeAtlas(i.width,e);else if(i.width<y){const t=(0,d.gu)(1.5*i.width,y);this._resizeAtlas(t,i.height)}}this._elements.set(e,t)}}_renderElement(t){const e=t.commitNewPosition(),i=t.textRenderer;this._ctx.clearRect(e[0]-v,e[1]-v,i.renderedWidth+2*v,i.renderedHeight+2*v),i.render(this._ctx,e[0],e[1]),this._uvCallbacks.get(i.key)?.forEach((e=>e(t.uv)))}get running(){return this.updating}runTask(t){if(null==this._glTexture)return m.J;for(;this._needsRepack&&(this._canRepack||this._atlas.height<y&&this._atlas.height<y);){this._canRepack=this._needsRepack=!1;const e=this._elements;this._elements=new Map,e.forEach((t=>this._processAddition(t))),t.madeProgress()}if(this._elementsToRender.size>0){for(const[e,i]of this._elementsToRender){if(t.done)break;this._renderElement(i),this._elementsToRender.delete(e),t.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addText(t,e){const i=t.key;this._addCallback(i,e);let n=this._elements.get(i);return n?(0,u.a)(n.uv,c.AG)||e(n.uv):(n=new R(t),this._processAddition(n),this.setDirty()),{remove:()=>this._removeText(t,e)}}_removeText(t,e){const i=t.key;this._elements.get(i)&&this._removeCallback(i,e)&&(this._elements.delete(i),this._elementsToRender.delete(i),this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};(0,n._)([(0,h.Cb)({constructOnly:!0})],w.prototype,"view",void 0),(0,n._)([(0,h.Cb)({type:Boolean})],w.prototype,"updating",void 0),w=(0,n._)([(0,l.j)("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],w);const v=2,b=2;class R{constructor(t){this.textRenderer=t,this._uv=(0,c.Ue)(),this._newPosition=[0,0]}get uv(){if(null==this._xOffset||null==this._yOffset)return c.AG;const{renderedWidth:t,renderedHeight:e}=this.textRenderer;return(0,u.s)(this._uv,this._xOffset,this._yOffset+e,this._xOffset+t,this._yOffset)}setNewPosition(t){this._newPosition[0]=t.x,this._newPosition[1]=t.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}}class T{constructor(t,e){this.width=t,this.height=e,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=P}}class M{constructor(t){this.y=t,this.x=P}}let P=0}}]);