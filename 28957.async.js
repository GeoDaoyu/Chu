"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[28957],{10813:function(e,t,s){s.d(t,{B:function(){return m},J:function(){return p}});var r=s(88194),o=s(96711),i=s(48797),n=s(60646),l=s(40030),h=s(56575),c=s(76554),a=s(48837),u=s(15065),f=s(82377);const d=()=>o.Z.getLogger("esri.layers.support.labelFormatUtils"),_={type:"simple",evaluate:()=>null},g={getAttribute:(e,t)=>e.field(t)};async function p(e,t,s){if(!e||!e.symbol||!t)return _;const o=e.where,n=(0,a.hV)(e);let l;if("arcade"===n.type){const e=(0,f.b)(n.expression),o=t.get(e);if(o&&((0,c.Vo)(o)||(0,c.H7)(o)||(0,c.qN)(o)))l={type:"simple",evaluate(e){const t="attributes"in e?e.attributes?.[o.name]:e.field(o.name);return null==t?"":t.toString()}};else{const e=await(0,u.WW)(n.expression,s);if(null==e)return _;l={type:"arcade",evaluate(s,o){try{const r="attributes"in s?e.repurposeFeature(s,t):s;r.contextTimeZone=o??null;const i=e.evaluate(r,{$view:{timeZone:o}});if(null!=i)return i.toString()}catch(e){d().error(new r.Z("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:e,feature:s,expression:n}))}return null},needsHydrationToEvaluate:()=>null==(0,a.el)(n.expression)}}}else l={type:"simple",evaluate:e=>n.expression.replaceAll(/{[^}]*}/g,(s=>{const r=s.slice(1,-1),o=t.get(r);if(!o)return s;let i=null;return i="attributes"in e?e?.attributes?.[o.name]:e.field(o.name),null==i?"":m(i,o)}))};if(o){let e;try{e=await(0,i.EP)(o,t)}catch(e){return d().error(new r.Z("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:o,error:e})),_}const s=l.evaluate;l.evaluate=(t,i)=>{const n="attributes"in t?void 0:g;try{if(e.testFeature(t,n))return s(t,i)}catch(e){d().error(new r.Z("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:o,feature:t,error:e}))}return null}}return l}function m(e,t){if(null==e)return"";const s=t.domain;if(s)if("codedValue"===s.type||"coded-value"===s.type){const t=e;for(const e of s.codedValues)if(e.code===t)return e.name}else if("range"===s.type){const{max:r,min:o}=(0,h.D3)(t),i=+e;if(null!=o&&null!=r&&o<=i&&i<=r)return s.name}let r=e;return(0,c.y2)(t)?r=(0,n.p6)(r,(0,n.Ze)("short-date")):(0,c.H7)(t)&&(r=(0,l.uf)(+r)),r||""}},65244:function(e,t,s){s.d(t,{Z:function(){return i}});var r=s(77450),o=s(64544);class i{constructor(){this.spans=[]}static{this.pool=new r.Z(i)}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:t,colFrom:s,colTo:r}of this.spans)for(let i=s;i<=r;i++){const s=e.getWorldForColumn(i);yield new o.Z(e.level,t,e.normalizeCol(i),s)}}forEach(e,t){const{spans:s,lodInfo:r}=this,{level:o}=r;if(0!==s.length)for(const{row:i,colFrom:n,colTo:l}of s)for(let s=n;s<=l;s++)e.call(t,o,i,r.normalizeCol(s),r.getWorldForColumn(s))}}},71090:function(e,t,s){s.d(t,{Z:function(){return _}});var r=s(8554),o=s(64544);function i(e,t){return[e,t]}function n(e,t,s){return e[0]=t,e[1]=s,e}const l=new o.Z("0/0/0/0");class h{static create(e,t,s=null){const o=(0,r.C5)(e.spatialReference),l=t.origin||i(e.origin.x,e.origin.y),c=i(e.size[0]*t.resolution,e.size[1]*t.resolution),a=i(-1/0,-1/0),u=i(1/0,1/0),f=i(1/0,1/0);null!=s&&(n(a,Math.max(0,Math.floor((s.xmin-l[0])/c[0])),Math.max(0,Math.floor((l[1]-s.ymax)/c[1]))),n(u,Math.max(0,Math.floor((s.xmax-l[0])/c[0])),Math.max(0,Math.floor((l[1]-s.ymin)/c[1]))),n(f,u[0]-a[0]+1,u[1]-a[1]+1));const{cols:d,rows:_}=t;let g,p,m,y;return!s&&d&&_&&(n(a,d[0],_[0]),n(u,d[1],_[1]),n(f,d[1]-d[0]+1,_[1]-_[0]+1)),e.isWrappable?(g=i(Math.ceil(Math.round((o.valid[1]-o.valid[0])/t.resolution)/e.size[0]),f[1]),p=!0,m=o.origin,y=o.valid):(g=f,p=!1),new h(t.level,t.resolution,t.scale,l,a,u,f,c,g,p,m,y)}constructor(e,t,s,r,o,i,n,l,h,c,a,u){this.level=e,this.resolution=t,this.scale=s,this.origin=r,this.first=o,this.last=i,this.size=n,this.norm=l,this.worldSize=h,this.wrap=c,this._spatialReferenceOrigin=a,this._spatialReferenceValid=u}normalizeCol(e){if(!this.wrap)return e;const t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t}normalizeKey(e){if(!this.wrap)return;const t=this.worldSize[0],s=e.col;s<0?(e.col=s+t,e.world-=1):s>=t&&(e.col=s-t,e.world+=1)}denormalizeCol(e,t){return this.wrap?this.worldSize[0]*t+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){const t=this.origin[0]+e*this.norm[0],s=this._spatialReferenceOrigin,r=this._spatialReferenceValid;return this.wrap&&s&&r?t===s[0]?r[0]:this.origin[0]===s[0]&&e===this.worldSize[0]?r[1]:t:t}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,t,s=!1){l.set(t);const r=s?l.col:this.denormalizeCol(l.col,l.world),o=l.row;return function(e,t,s,r,o){e[0]=t,e[1]=s,e[2]=r,e[3]=o}(e,this.getXForColumn(r),this.getYForRow(o+1),this.getXForColumn(r+1),this.getYForRow(o)),e}getTileCoords(e,t,s=!1){l.set(t);const r=s?l.col:this.denormalizeCol(l.col,l.world);return Array.isArray(e)?n(e,this.getXForColumn(r),this.getYForRow(l.row)):(e.x=this.getXForColumn(r),e.y=this.getYForRow(l.row)),e}}var c=s(65244);class a{constructor(e,t,s){this.row=e,this.colFrom=t,this.colTo=s}}const u=new o.Z("0/0/0/0");class f{static create(e,t){e[1]>t[1]&&([e,t]=[t,e]);const[s,r]=e,[o,i]=t,n=o-s,l=i-r,h=0!==l?n/l:0,c=(Math.ceil(r)-r)*h,a=(Math.floor(r)-r)*h;return new f(s,Math.floor(r),Math.ceil(i),h,n<0?c:a,n<0?a:c,n<0?o:s,n<0?s:o)}constructor(e,t,s,r,o,i,n,l){this.x=e,this.ymin=t,this.ymax=s,this.invM=r,this.leftAdjust=o,this.rightAdjust=i,this.leftBound=n,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const d=[[0,0],[0,0],[0,0],[0,0]];class _{constructor(e,t=null,s=e.lods[0].level,r=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=t,this.scales=[],this._infoByScale={},this._infoByLevel={};const o=e.lods.filter((e=>e.level>=s&&e.level<=r));this.minScale=o[0].scale,this.maxScale=o[o.length-1].scale;const i=this._lodInfos=o.map((s=>h.create(e,s,t)));o.forEach(((e,t)=>{this._infoByLevel[e.level]=i[t],this._infoByScale[e.scale]=i[t],this.scales[t]=e.scale}),this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"==typeof e?e:e.level]}getTileBounds(e,t,s=!1){u.set(t);const r=this._infoByLevel[u.level];return r?r.getTileBounds(e,u,s):e}getTileCoords(e,t,s=!1){u.set(t);const r=this._infoByLevel[u.level];return r?r.getTileCoords(e,u,s):e}getTileCoverage(e,t=192,s=!0,r="closest"){if(!s&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const o="closest"===r?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),i=c.Z.pool.acquire(o),n=this._wrap;let l,h,u,_=1/0,g=-1/0;const p=i.spans;d[0][0]=d[0][1]=d[1][1]=d[3][0]=-t,d[1][0]=d[2][0]=e.size[0]+t,d[2][1]=d[3][1]=e.size[1]+t;for(const t of d)e.toMap(t,t),t[0]=o.getColumnForX(t[0]),t[1]=o.getRowForY(t[1]);const m=[];let y=3;for(let e=0;e<4;e++){if(d[e][1]===d[y][1]){y=e;continue}const t=f.create(d[e],d[y]);_=Math.min(t.ymin,_),g=Math.max(t.ymax,g),void 0===m[t.ymin]&&(m[t.ymin]=[]),m[t.ymin].push(t),y=e}if(null==_||null==g||g-_>100)return null;let w=[];for(l=_;l<g;){null!=m[l]&&(w=w.concat(m[l])),h=1/0,u=-1/0;for(let e=w.length-1;e>=0;e--){const t=w[e];h=Math.min(h,t.getLeftCol()),u=Math.max(u,t.getRightCol())}if(h=Math.floor(h),u=Math.floor(u),l>=o.first[1]&&l<=o.last[1])if(n)if(o.size[0]<o.worldSize[0]){const e=Math.floor(u/o.worldSize[0]);for(let t=Math.floor(h/o.worldSize[0]);t<=e;t++)p.push(new a(l,Math.max(o.getFirstColumnForWorld(t),h),Math.min(o.getLastColumnForWorld(t),u)))}else p.push(new a(l,h,u));else h>o.last[0]||u<o.first[0]||(h=Math.max(h,o.first[0]),u=Math.min(u,o.last[0]),p.push(new a(l,h,u)));l+=1;for(let e=w.length-1;e>=0;e--){const t=w[e];t.ymax>=l?t.incrRow():w.splice(e,1)}}return i}getTileParentId(e){u.set(e);const t=this._infoByLevel[u.level],s=this._lodInfos.indexOf(t)-1;return s<0?null:(this._getTileIdAtLOD(u,this._lodInfos[s],u),u.id)}getTileResolution(e){const t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1}getTileScale(e){const t=this._infoByLevel[e.level];return t?t.scale:-1}intersects(e,t){u.set(t);const s=this._infoByLevel[u.level],r=e.lodInfo;if(r.resolution>s.resolution){this._getTileIdAtLOD(u,r,u);const t=r.denormalizeCol(u.col,u.world);for(const s of e.spans)if(s.row===u.row&&s.colFrom<=t&&s.colTo>=t)return!0}if(r.resolution<s.resolution){const[t,o,i,n]=e.spans.reduce(((e,t)=>(e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e)),[1/0,-1/0,1/0,-1/0]),l=s.denormalizeCol(u.col,u.world),h=r.getColumnForX(s.getXForColumn(l)),c=r.getRowForY(s.getYForRow(u.row)),a=r.getColumnForX(s.getXForColumn(l+1))-1,f=r.getRowForY(s.getYForRow(u.row+1))-1;return!(h>n||a<i||c>o||f<t)}const o=r.denormalizeCol(u.col,u.world);return e.spans.some((e=>e.row===u.row&&e.colFrom<=o&&e.colTo>=o))}normalizeBounds(e,t,s){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){const t=(0,r.C5)(this.tileInfo.spatialReference),o=-s*(t.valid[1]-t.valid[0]);e[0]+=o,e[2]+=o}return e}getSmallestInfoForScale(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(let s=1;s<t.length-1;s++)if(e>t[s]+1e-6)return this._infoByScale[t[s-1]];return this._infoByScale[t[t.length-1]]}getClosestInfoForScale(e){const t=this.scales;return this._infoByScale[e]||(e=t.reduce(((t,s)=>Math.abs(s-e)<Math.abs(t-e)?s:t),t[0])),this._infoByScale[e]}scaleToLevel(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let s=t.length-1;s>=0;s--)if(e<t[s])return s===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[s]].level+(t[s]-e)/(t[s]-t[s+1]);return this._infoByScale[t[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,t,s){const r=this._infoByLevel[s.level];return e.set(s),t.resolution<r.resolution?null:(t.resolution===r.resolution||(e.level=t.level,e.col=Math.floor(s.col*r.resolution/t.resolution+.01),e.row=Math.floor(s.row*r.resolution/t.resolution+.01)),e)}}},48153:function(e,t,s){var r=s(73440),o=s(70880),i=s(79577),n=s(61100),l=s(74355),h=s(17155),c=(s(61432),s(96711),s(83850),s(48023)),a=s(26821),u=s(93568),f=s(92462),d=s(87422),_=s(99153),g=s(39355);class p{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class m{constructor(e){this._schedule=null,this._task=null,this._deferreds=new d.Z,this._controllers=new d.Z,this._processingItems=new d.Z,this._pausedSignal=(0,g.t)(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new f.Z(e.peeker),this.process=e.process;const t=e.scheduler;e.priority&&t&&(this._task=t.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=(0,n.hw)(this._schedule),this._task=(0,n.hw)(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach((t=>e.push(t))),this._controllers.clear(),e.forEach((e=>e.abort())),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach(((t,s)=>e(s)))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){const s=this.get(e);if(s)return s;const r=new AbortController;let o=null;t&&(o=(0,u.fu)(t,(()=>r.abort())));const i=()=>{n.remove(),null!=o&&o.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},n=(0,u.$F)(r.signal,(()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),i(),l.reject((0,u.zE)())})),l=(0,u.hh)();return this._deferreds.set(e,l),this._controllers.set(e,r),l.promise.then(i,i),this._queue.push(e),this._scheduleNext(),l.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject((0,u.zE)()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=(0,_.Os)((()=>{this._schedule=null,this._next()})))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(null==e)return;let t;const s=new AbortController,r=new p(e,s);this._processingItems.set(e,r);try{t=this.process(e,s.signal)}catch(e){this._processError(r,e)}(0,u.y8)(t)?(r.promise=t,t.then((e=>this._processResult(r,e)),(e=>this._processError(r,e)))):this._processResult(r,t)}get test(){}}const y=[0,0];let w=class extends o.Z{constructor(e){super(e),this._keyToItem=new Map,this._tilesByScale=new Map,this.concurrency=6}initialize(){const{concurrency:e,process:t,scheduler:s,priority:r}=this;this._queue=new m({concurrency:e,scheduler:s,priority:r,process:(e,s)=>{const r=this._keyToItem.get(e);return t(r,{signal:s})},peeker:e=>this._peek(e)})}destroy(){this.clear(),this._queue=(0,n.SC)(this._queue)}get length(){return this._queue?this._queue.length:0}abort(e){const t="string"==typeof e?e:e.id;this._queue.abort(t)}clear(){this._queue.clear(),this._keyToItem.clear(),this._tilesByScale.clear()}has(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}pause(){this._queue.pause()}push(e){const t=e.key.id;if(this._queue.has(t))return this._queue.get(t);const s=this._queue.push(t),r=this.tileInfoView.getTileScale(e.key),o=(0,i.s1)(this._tilesByScale,r,(()=>new Set)),n=()=>{o.delete(e.key),0===o.size&&this._tilesByScale.delete(r),this._keyToItem.delete(t)};return o.add(e.key),this._keyToItem.set(t,e),s.then(n,n),s}reset(){this._queue.reset()}resume(){this._queue.resume()}_peek(e){if(!this.state)return e.values().next().value;const t=new Set;for(const s of e)t.add(this._keyToItem.get(s).key);const s=this.state.scale;let r,o=Number.POSITIVE_INFINITY;for(const[e,i]of this._tilesByScale)if((0,l.fn)(i,(e=>t.has(e)))){const t=Math.abs(e-s);t<o&&(r=i,o=t)}return this._getClosestTileKey(r,e).id}_getClosestTileKey(e,t){const s=this.tileInfoView,r=this.state.center;let o,i=Number.POSITIVE_INFINITY;for(const n of e)if(t.has(n.id)){s.getTileCoords(y,n);const e=(0,a.TE)(y,r);e<i&&(i=e,o=n)}return o}};(0,r._)([(0,h.Cb)({constructOnly:!0})],w.prototype,"concurrency",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],w.prototype,"priority",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],w.prototype,"process",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],w.prototype,"scheduler",void 0),(0,r._)([(0,h.Cb)()],w.prototype,"state",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],w.prototype,"tileInfoView",void 0),w=(0,r._)([(0,c.j)("esri.views.2d.tiling.TileQueue")],w)},13772:function(e,t,s){s(47566),s(26821);s(65244);new(s(64544).Z)(0,0,0,0),new Map}}]);