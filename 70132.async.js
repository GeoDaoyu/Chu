"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[70132],{43033:function(e,t,r){r.d(t,{fE:function(){return k},AX:function(){return F},jR:function(){return O}});var n,i=r(78619),s=r(88194),a=r(79577),o=(r(64246),r(20722)),l=r(45213);class c{constructor(){this.version="",this.queryResult=new u}}class u{constructor(){this.featureResult=new d}}class d{constructor(){this.objectIdFieldName="",this.uniqueIdField=new p,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new h,this.geometryType=null,this.spatialReference=new l.Z,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new y,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}}class p{constructor(){this.name="",this.isSystemMaintained=!1}}class h{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}}class y{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new f,this.translate=new m}}class f{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}}class m{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}}class g{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}}class b{constructor(){this.attributes=[],this.compressedGeometry=new _,this.centroid=new _,this.aggregateGeometries=[]}}class _{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}}!function(e){e.ELEMENTUID="ELEMENTUID",e.TYPENAME="TYPENAME"}(n||(n={}));const T=[n.ELEMENTUID,n.TYPENAME];var v,I;!function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"}(v||(v={})),function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"}(I||(I={}));var E,w,S,L,C=r(48633),R=r(7878);function M(e){const t=new _;t.geometryType=R.Ks[e.geometry_type.value];const r=[],n=[];for(let t=0;t<e.lengths.length;t++)r.push(e.lengths[t]);for(let t=0;t<e.coords.length;t++)n.push(e.coords[t]);return t.lengths=r,t.coords=n,t}function N(e){const t=new g;return t.name=e.name,t.alias=e.alias,t.fieldType=R.jC[e.field_type.value],t.sqlType=S[e.sql_type.value],t.domain=e.domain,t.defaultValue=e.default_value,t}function A(e){const t=N(e);return t.geometryType=R.Ks[e.geometry_type.value],t}function x(e){const t=new y;t.quantizeOriginPosition=w[e.quantizeOriginPosition.value];const r=t.scale,n=e.scale;r.xScale=n.xScale,r.yScale=n.yScale,r.mScale=n.mScale,r.zScale=n.zScale;const i=t.translate,s=e.translate;return i.xTranslate=s.xTranslate,i.yTranslate=s.yTranslate,i.mTranslate=s.mTranslate,i.zTranslate=s.zTranslate,t}async function k(e,t){t??=!1;const r={generateAllSublayers:t,namedTypeDefinitions:new Map};return await async function(e){const t=await(0,i.Z)(e,{responseType:"array-buffer"}),r=await t.data;return async function(e){const t=new((await(0,C.$G)()).MapOfObjectIdentifierSetsDecoder),r=t.decode(new Uint8Array(e)),n=new Map;if(0!==r.error_code)throw new s.Z("knowledge-graph:layer-support-utils",r.error_message);const i=t.get_map_of_identifier_sets(),a=i.keys,o=a.size();for(let e=0;e<o;e++){const t=a.get(e),r=i.query_identifier_set(t),o=[];if(r.id_array_type.value===L.GLOBALID_ARRAY){const e=r.get_globalid_array(),t=e.count();for(let r=0;r<t;r++)o.push(e.get_globalid_at(r))}else if(r.id_array_type.value===L.IDENTIFIER_ARRAY){const e=r.get_identifier_array(),t=e.count();for(let r=0;r<t;r++)o.push(e.get_identifier_at(r).toString())}else if(r.id_array_type.value===L.STRING_ARRAY){const e=r.get_string_array(),t=e.count();for(let r=0;r<t;r++)o.push(e.get_string_at(r))}else{if(r.id_array_type.value!==L.OID_ARRAY)throw new s.Z("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const e=r.get_oid_array(),t=e.count();for(let r=0;r<t;r++)o.push(e.get_objectid_at(r).toString())}}n.set(t,o)}return t.delete(),n}(new Uint8Array(r))}(e).then((e=>{!function(e,t){for(const[r,n]of e){const e=(0,a.s1)(t.namedTypeDefinitions,r,(()=>({useAllData:!1,members:new Map})));for(const t of n)e.members.has(t)||e.members.set(t,{id:t})}}(e,r)})),r}async function O(e){const t=await(0,C.$G)(),r=new t.MapOfObjectIdentifierSets;!function(e,t,r){for(const[n,i]of r.namedTypeDefinitions){if(!i.members||i.useAllData)continue;const r=i.members.keys();let s=!1,a=!0;const o=new t.ObjectIdArray,l=new t.StringArray,c=new t.GlobalIdArray,u=new t.IdentifierArray,d=new t.ObjectIdentifierSet;for(const e of r)a&&(s=!isNaN(Number(e)),a=!1),s?o.add_objectid(Number(e)):(l.add_string(e),c.add_globalid(e)),u.add_identifier(e);d.set_oid_array(o),d.set_string_array(l),d.set_globalid_array(c),d.set_identifier_array(u),o.delete(),l.delete(),c.delete(),u.delete(),e.put_identifier_set(n,d),d.delete()}}(r,t,e);const n=new t.MapOfObjectIdentifierSetsEncoder;try{n.set_map_of_identifier_sets(r),n.encode();const e=n.get_encoding_result();if(0!==e.error.error_code)throw new s.Z("knowledge-graph:layer-support-utils",e.error.error_message);const t=structuredClone(e.get_byte_buffer());return n.delete(),t}finally{r.delete()}}async function D(e){const t=await(0,i.Z)(e,{responseType:"array-buffer"});return async function(e){const t=new((await(0,C.$G)()).FeatureCollectionDecoder),r=t.decode(new Uint8Array(e));if(0!==r.error_code)throw new s.Z("knowledge-graph:layer-support-utils",r.error_message);const n=t.get_feature_collection(),i=function(e){const t=new c;t.version=e.version;const r=e.get_query_result();if(0!==r.results_type.value)throw new Error("Got a non-feature collection type");const n=r.get_feature_result(),i=t.queryResult.featureResult;i.objectIdFieldName=n.objectid_field_name,i.exceededTransferLimit=n.exceeded_transfer_limit,i.hasM=n.has_m,i.hasZ=n.has_z,i.geometryType=R.Ks[n.geometry_type.value],i.globalIdFieldName=n.globalid_field_name,i.geohashFieldName=n.geohash_field_name;const s=i.uniqueIdField,a=n.unique_id_field;s.name=a.name,s.isSystemMaintained=a.isSystemMaintained;const o=i.geometryProperties,l=n.geometry_properties;o.shapeAreaFieldName=l.shapeAreaFieldName,o.shapeLengthFieldName=l.shapeLengthFieldName,o.units=l.units;const u=i.spatialReference,d=n.spatial_reference;u.wkid=d.wkid,u.latestWkid=d.latestWkid,u.vcsWkid=d.vcsWkid,u.latestVcsWkid=d.latestVcsWkid,u.wkt=d.wkt,i.transform=x(n.transform);const p=i.fields,h=i.fieldNameToAttributeIndexMap,y=n.fields,f=y.size();for(let e=0;e<f;e++){const t=y.get(e),r=N(t);p.push(r),h[r.name]=e,t.delete()}y.delete();const m=i.values,g=n.values_count();for(let e=0;e<g;e++)m.push(n.get_value_at(e));const _=i.features,v=n.features,I=v.size();if(I>0)for(const e of T)if(void 0===h[e])throw new Error(`Feature collection missing required attribute: ${e}`);for(let e=0;e<I;e++){const t=new b,r=v.get(e),n=t.attributes,i=r.attributes_count();for(let e=0;e<i;e++)n.push(r.get_attribute_at(e));const s=r.get_compressed_geometry();s&&(t.compressedGeometry=M(s),t.centroid=M(r.get_centroid()));const a=t.aggregateGeometries,o=r.aggregate_geometries,l=o.size();for(let e=0;e<l;e++){const t=o.get(e),r=M(t);a.push(r),t.delete()}o.delete(),_.push(t),r.delete()}v.delete();const E=i.geometryFields,w=n.geometry_fields,S=w.size();for(let e=0;e<S;e++){const t=w.get(e),r=A(t);E.push(r),t.delete()}return w.delete(),t}(n);return t.delete(),i}(await t.data)}function j(e,t){if(!e?.queryResult?.featureResult)return t;const r=e.queryResult.featureResult.fieldNameToAttributeIndexMap;for(const i of e.queryResult.featureResult.features){const e=i.attributes[r[n.TYPENAME]],s=(0,a.s1)(t.namedTypeDefinitions,e,(()=>({useAllData:!1,members:new Map}))),l=i.attributes[r[n.ELEMENTUID]];if(i.compressedGeometry?.coords?.length>0){let e=i.compressedGeometry.lengths;"esriGeometryPoint"===i.compressedGeometry.geometryType&&(e=[]),s.members.set(l,{id:l,linkChartLocation:new o.Z(e,i.compressedGeometry.coords)})}else s.members.set(l,{id:l})}return t}!function(e){e[e.featureResult=0]="featureResult",e[e.countResult=1]="countResult",e[e.idsResult=2]="idsResult"}(E||(E={})),function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"}(w||(w={})),function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"}(S||(S={})),function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(L||(L={}));const F={fetchAndConvertSerializedLinkChart:e=>async function(e){const t=[],r={generateAllSublayers:!1,namedTypeDefinitions:new Map};return e.entitiesUrl&&t.push(D(e.entitiesUrl).then((e=>{j(e,r)}))),e.relationshipsUrl&&t.push(D(e.relationshipsUrl).then((e=>{j(e,r)}))),await Promise.all(t),r}(e)}},45415:function(e,t,r){function n(e,t,r,n,s){i(e,t,r||0,n||e.length-1,s||a)}function i(e,t,r,n,a){for(;n>r;){if(n-r>600){var o=n-r+1,l=t-r+1,c=Math.log(o),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(o-u)/o)*(l-o/2<0?-1:1);i(e,t,Math.max(r,Math.floor(t-l*u/o+d)),Math.min(n,Math.floor(t+(o-l)*u/o+d)),a)}var p=e[t],h=r,y=n;for(s(e,r,t),a(e[n],p)>0&&s(e,r,n);h<y;){for(s(e,h,y),h++,y--;a(e[h],p)<0;)h++;for(;a(e[y],p)>0;)y--}0===a(e[r],p)?s(e,r,y):s(e,++y,n),y<=t&&(r=y+1),t<=y&&(n=y-1)}}function s(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function a(e,t){return e<t?-1:e>t?1:0}r.d(t,{q:function(){return n}})},96946:function(e,t,r){r.d(t,{Q:function(){return o},b:function(){return S}});var n=r(3480),i=r(79487),s=(r(61432),r(63974)),a=r(45415);class o{constructor(e=9,t){this._compareMinX=p,this._compareMinY=h,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),v.prune(),I.prune(),E.prune(),w.prune()}all(e){l(this._data,e)}search(e,t){let r=this._data;const n=this._toBBox;if(_(e,r))for(v.clear();r;){for(let i=0,s=r.children.length;i<s;i++){const s=r.children[i],a=r.leaf?n(s):s;_(e,a)&&(r.leaf?t(s):b(e,a)?l(s,t):v.push(s))}r=v.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!_(e,t))return!1;for(v.clear();t;){for(let n=0,i=t.children.length;n<i;n++){const i=t.children[n],s=t.leaf?r(i):i;if(_(e,s)){if(t.leaf||b(e,s))return!0;v.push(i)}}t=v.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new C([]),this}remove(e){if(!e)return this;let t,r=this._data,s=null,a=0,o=!1;const l=this._toBBox(e);for(E.clear(),w.clear();r||E.length>0;){if(r||(r=E.pop(),s=E.data[E.length-1],a=w.pop()??0,o=!0),r.leaf&&(t=(0,n.cq)(r.children,(0,i.CY)(e),r.children.length,r.indexHint),-1!==t))return r.children.splice(t,1),E.push(r),this._condense(E),this;o||r.leaf||!b(r,l)?s?(a++,r=s.children[a],o=!1):r=null:(E.push(r),w.push(a),a=0,s=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,n){const i=r-t+1;let s=this._maxEntries;if(i<=s){const n=new C(e.slice(t,r+1));return c(n,this._toBBox),n}n||(n=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/s**(n-1)));const a=new R([]);a.height=n;const o=Math.ceil(i/s),l=o*Math.ceil(Math.sqrt(s));T(e,t,r,l,this._compareMinX);for(let i=t;i<=r;i+=l){const t=Math.min(i+l-1,r);T(e,i,t,o,this._compareMinY);for(let r=i;r<=t;r+=o){const i=Math.min(r+o-1,t);a.children.push(this._build(e,r,i,n-1))}}return c(a,this._toBBox),a}_insert(e,t,r){const n=this._toBBox,i=r?e:n(e);E.clear();const s=function(e,t,r,n){for(;n.push(t),!0!==t.leaf&&n.length-1!==r;){let r,n=1/0,i=1/0;for(let s=0,a=t.children.length;s<a;s++){const a=t.children[s],o=y(a),l=m(e,a)-o;l<i?(i=l,n=o<n?o:n,r=a):l===i&&o<n&&(n=o,r=a)}t=r||t.children[0]}return t}(i,this._data,t,E);for(s.children.push(e),d(s,i);t>=0&&E.data[t].children.length>this._maxEntries;)this._split(E,t),t--;!function(e,t,r){for(let n=r;n>=0;n--)d(t.data[n],e)}(i,E,t)}_split(e,t){const r=e.data[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);const s=this._chooseSplitIndex(r,i,n);if(!s)return;const a=r.children.splice(s,r.children.length-s),o=r.leaf?new C(a):new R(a);o.height=r.height,c(r,this._toBBox),c(o,this._toBBox),t?e.data[t-1].children.push(o):this._splitRoot(r,o)}_splitRoot(e,t){this._data=new R([e,t]),this._data.height=e.height+1,c(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let n,i,s;n=i=1/0;for(let a=t;a<=r-t;a++){const t=u(e,0,a,this._toBBox),o=u(e,a,r,this._toBBox),l=g(t,o),c=y(t)+y(o);l<n?(n=l,s=a,i=c<i?c:i):l===n&&c<i&&(i=c,s=a)}return s}_chooseSplitAxis(e,t,r){const n=e.leaf?this._compareMinX:p,i=e.leaf?this._compareMinY:h;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)}_allDistMargin(e,t,r,n){e.children.sort(n);const i=this._toBBox,s=u(e,0,t,i),a=u(e,r-t,r,i);let o=f(s)+f(a);for(let n=t;n<r-t;n++){const t=e.children[n];d(s,e.leaf?i(t):t),o+=f(s)}for(let n=r-t-1;n>=t;n--){const t=e.children[n];d(a,e.leaf?i(t):t),o+=f(a)}return o}_condense(e){for(let t=e.length-1;t>=0;t--){const r=e.data[t];if(0===r.children.length)if(t>0){const i=e.data[t-1],s=i.children;s.splice((0,n.cq)(s,r,s.length,i.indexHint),1)}else this.clear();else c(r,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function l(e,t){let r=e;for(I.clear();r;){if(!0===r.leaf)for(const e of r.children)t((0,i.CY)(e));else I.pushArray(r.children);r=I.pop()??null}}function c(e,t){u(e,0,e.children.length,t,e)}function u(e,t,r,n,i){i||(i=new C([])),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s,a=t;a<r;a++)s=e.children[a],d(i,e.leaf?n(s):s);return i}function d(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function p(e,t){return e.minX-t.minX}function h(e,t){return e.minY-t.minY}function y(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function g(e,t){const r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,s-n)}function b(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function _(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function T(e,t,r,n,i){const s=[t,r];for(;s.length;){const t=s.pop(),r=s.pop();if(t-r<=n)continue;const o=r+Math.ceil((t-r)/n/2)*n;(0,a.q)(e,o,r,t,i),s.push(r,o,o,t)}}const v=new s.Z,I=new s.Z,E=new s.Z,w=new s.Z({deallocator:void 0});class S{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class L extends S{constructor(){super(...arguments),this.height=1,this.indexHint=new n.SO}}class C extends L{constructor(e){super(),this.children=e,this.leaf=!0}}class R extends L{constructor(e){super(),this.children=e,this.leaf=!1}}},96610:function(e,t,r){r.d(t,{G6:function(){return N},IN:function(){return a},Ie:function(){return M},J9:function(){return C},Jd:function(){return s},Kq:function(){return S},RF:function(){return w},U1:function(){return R},oh:function(){return i},s9:function(){return L},vY:function(){return n}});r(90756);function n(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null}function i(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:n}=e,i=r[0]??1,s=r[1]??1;return{originPosition:"lowerLeft",scale:[i,"lowerLeft"===t?s:-s,r[2]??1,r[3]??1],translate:[n[0]??0,n[1]??0,n[2]??0,n[3]??0]}}function s({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function a({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function o({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}function l({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}function c(e,t){return e&&t?h:e&&!t?d:!e&&t?p:u}const u=(e,t)=>{const r=[];if(!t.length)return null;const n=t[0];let i=s(e,n[0]),o=a(e,n[1]);r.push([i,o]);for(let n=1;n<t.length;n++){const[l,c]=t[n],u=s(e,l),d=a(e,c);u===i&&d===o||r.push([u-i,d-o]),i=u,o=d}return r},d=(e,t)=>{const r=[];if(!t.length)return null;const n=t[0];let i=s(e,n[0]),l=a(e,n[1]),c=o(e,n[2]);r.push([i,l,c]);for(let n=1;n<t.length;n++){const[u,d,p]=t[n],h=s(e,u),y=a(e,d),f=o(e,p);h===i&&y===l&&f===c||r.push([h-i,y-l,f]),i=h,l=y,c=f}return r},p=(e,t)=>{const r=[];if(!t.length)return null;const n=t[0];let i=s(e,n[0]),o=a(e,n[1]),c=l(e,n[2]);r.push([i,o,c]);for(let n=1;n<t.length;n++){const[u,d,p]=t[n],h=s(e,u),y=a(e,d),f=l(e,p);h===i&&y===o&&f===c||r.push([h-i,y-o,f]),i=h,o=y,c=f}return r},h=(e,t)=>{const r=[];if(!t.length)return null;const n=t[0];let i=s(e,n[0]),c=a(e,n[1]),u=o(e,n[2]),d=l(e,n[3]);r.push([i,c,u,d]);for(let n=1;n<t.length;n++){const[p,h,y,f]=t[n],m=s(e,p),g=a(e,h),b=o(e,y),_=l(e,f);m===i&&g===c&&b===u&&_===d||r.push([m-i,g-c,b,_]),i=m,c=g,u=b,d=_}return r};function y({scale:e,translate:t},r){return r*e[0]+t[0]}function f({scale:e,translate:t},r){return r*e[1]+t[1]}function m({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function g({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function b(e,t){return e&&t?I:e&&!t?T:!e&&t?v:_}const _=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=y(e,n[0]),s=f(e,n[1]);r[0]=[i,s];const{scale:a,originPosition:o}=e,l=a[0],c="lowerLeft"===o?a[1]:-a[1];for(let e=1;e<t.length;e++){const[n,a]=t[e];i+=l*n,s+=c*a,r[e]=[i,s]}return r},T=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=y(e,n[0]),s=f(e,n[1]);r[0]=[i,s,m(e,n[2])];const{scale:a,originPosition:o}=e,l=a[0],c="lowerLeft"===o?a[1]:-a[1];for(let n=1;n<t.length;n++){const[a,o,u]=t[n];i+=l*a,s+=c*o,r[n]=[i,s,m(e,u)]}return r},v=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=y(e,n[0]),s=f(e,n[1]);r[0]=[i,s,g(e,n[2])];const{scale:a,originPosition:o}=e,l=a[0],c="lowerLeft"===o?a[1]:-a[1];for(let n=1;n<t.length;n++){const[a,o,u]=t[n];i+=l*a,s+=c*o,r[n]=[i,s,g(e,u)]}return r},I=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=y(e,n[0]),s=f(e,n[1]);r[0]=[i,s,m(e,n[2]),g(e,n[3])];const{scale:a,originPosition:o}=e,l=a[0],c="lowerLeft"===o?a[1]:-a[1];for(let n=1;n<t.length;n++){const[a,o,u,d]=t[n];i+=l*a,s+=c*o,r[n]=[i,s,m(e,u),g(e,d)]}return r};function E(e,t,r){const n=new Array(r.length);for(let i=0;i<r.length;i++)n[i]=t(e,r[i]);return n}function w(e,t,r){const n=i(e);return t.x=s(n,r.x),t.y=a(n,r.y),null!=r.z&&(t.z=o(n,r.z)),null!=r.m&&(t.m=l(n,r.m)),t}function S(e,t,r){const n=function(e,t,r,n){const i=[],s=c(r,n);for(let r=0;r<t.length;r++){const n=s(e,t[r]);n&&n.length>=3&&i.push(n)}return i.length?i:null}(i(e),r.rings,r.hasZ,r.hasM);return n?(t.rings=n,t.hasZ=r.hasZ??!1,t.hasM=r.hasM??!1,t):null}function L(e,t,r){const n=function(e,t,r,n){const i=[],s=c(r,n);for(let r=0;r<t.length;r++){const n=s(e,t[r]);n&&n.length>=2&&i.push(n)}return i.length?i:null}(i(e),r.paths,r.hasZ,r.hasM);return n?(t.paths=n,t.hasZ=r.hasZ??!1,t.hasM=r.hasM??!1,t):null}function C(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const a=i(e);t.points=b(n,s)(a,r.points),t.hasZ=n,t.hasM=s}return t}function R(e,t,r,n=null!=r?.z,s=null!=r?.m){if(null==r)return t;const a=i(e);return t.x=y(a,r.x),t.y=f(a,r.y),n&&(t.z=m(a,r.z)),s&&(t.m=g(a,r.m)),t}function M(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const a=i(e);t.rings=E(a,b(n,s),r.rings),t.hasZ=n,t.hasM=s}return t}function N(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const a=i(e);t.paths=E(a,b(n,s),r.paths),t.hasZ=n,t.hasM=s}return t}},53447:function(e,t,r){r.d(t,{Z:function(){return p}});var n=r(73440),i=r(17155),s=(r(61432),r(96711),r(83850),r(48023)),a=r(34415),o=r(38209),l=r(83263),c=r(3752),u=r(53866),d=r(13689);let p=class extends((0,l.h7)((0,c.M)(o.Z))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new u.J,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,n._)([(0,i.Cb)({type:d.Z})],p.prototype,"elevationInfo",void 0),(0,n._)([(0,i.Cb)((0,a.z)(u.J,"graphics"))],p.prototype,"graphics",void 0),(0,n._)([(0,i.Cb)({type:["show","hide"]})],p.prototype,"listMode",void 0),(0,n._)([(0,i.Cb)()],p.prototype,"screenSizePerspectiveEnabled",void 0),(0,n._)([(0,i.Cb)({readOnly:!0})],p.prototype,"type",void 0),(0,n._)([(0,i.Cb)({constructOnly:!0})],p.prototype,"internal",void 0),p=(0,n._)([(0,s.j)("esri.layers.GraphicsLayer")],p)},80613:function(e,t,r){r.d(t,{n:function(){return i}});var n=r(24564);const i={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new n.u_(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>e.ensureCentroid(t)}},73967:function(e,t,r){r.d(t,{Dm:function(){return u},Hq:function(){return p},MS:function(){return h},bU:function(){return o}});var n=r(61432),i=r(28947),s=r(17749),a=r(54914);function o(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?a.I4:"esriGeometryPolyline"===e?a.ET:a.lF}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let c=1;function u(e,t){if((0,n.Z)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this${d(t)} = null;`;for(const t in e)r+=`this${d(t)} = ${JSON.stringify(e[t])};`;const n=new Function(`\n      return class AttributesClass$${c++} {\n        constructor() {\n          ${r};\n        }\n      }\n    `)();return()=>new n}catch(r){return()=>({[t]:null,...e})}}function d(e){return l.test(e)?`.${e}`:`["${e}"]`}function p(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,i.d9)(e)}}]}function h(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:s.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:s.e,editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},86494:function(e,t,r){r.d(t,{Q:function(){return I}});var n=r(73440),i=r(70880),s=r(88194),a=r(96711),o=r(79577),l=r(93568),c=r(48797),u=r(17155),d=(r(61432),r(83850),r(48023)),p=r(71354),h=r(67764),y=r(13132),f=r(8554),m=r(3849),g=r(78694),b=r(41305),_=r(61861),T=r(42167),v=r(29191);let I=class extends i.Z{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach((r=>{r.name&&(t.set(r.name,"entity"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(r.name),r.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(r.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((r=>{r.name&&(t.set(r.name,"relationship"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(r.name),r.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(r.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((r,n)=>{if("entity"===t.get(n))this.entityTypeNames.add(n);else{if("relationship"!==t.get(n))return a.Z.getLogger(this).warn(`A named type, ${n}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(n);this.relationshipTypeNames.add(n)}const i=new Map;r.members?.forEach((e=>{(0,o.s1)(this.memberIdTypeLookup,e.id,(()=>new Set)).add(n);const t=this.getById(e.id);t&&i.set(e.id,t)})),this.sublayerCaches.set(n,i)}))}addToLayer(e){e.forEach((({typeName:e,id:t})=>{if(!this.inclusionModeDefinition)throw new s.Z("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){const r=this.inclusionModeDefinition.namedTypeDefinitions.get(e);r.members||(r.members=new Map),r.members.set(t,{id:t}),(0,o.s1)(this.memberIdTypeLookup,t,(()=>new Set)).add(e)}}else{const r=new Map;r.set(t,{id:t}),this.inclusionModeDefinition.namedTypeDefinitions.set(e,{useAllData:!1,members:r}),(0,o.s1)(this.memberIdTypeLookup,t,(()=>new Set)).add(e)}}))}getById(e){return g.Z.getInstance().readFromStoreById(e)}async getData(e,t,r){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let n;if(n=e||new v.Z({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){const e=t.parentCompositeLayer,r=this._processingCacheUpdatesLookup.get(t.objectType.name??""),i=n.outFields;i&&1===i.length&&i[0]===m.mR&&"1=1"===n.where||await Promise.all(r??[]);const s=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],a=[];return s.forEach((r=>{if(this.relationshipTypeNames.has(t.objectType.name)){r.geometry=e.relationshipLinkChartDiagramLookup.get(r.attributes[t.objectIdField]);const n=this.memberIdTypeLookup.get(r.attributes[m.TY]),i=this.memberIdTypeLookup.get(r.attributes[m.l6]),s=this._isEndEntitySpatial(n,r,m.TY),a=this._isEndEntitySpatial(i,r,m.l6);r.attributes[m._k]=Number(s&&a)}else{r.geometry=e.entityLinkChartDiagramLookup.get(r.attributes[t.objectIdField]);const n=this.geographicLookup.get(t.objectType.name);n&&r.attributes[n.name]?r.attributes[m._k]=1:r.attributes[m._k]=0}r.attributes[m.xD]=r.geometry,a.push(r)})),a}return this.retrieveDataFromService(n,t,r)}async getConnectedRecordIds(e,t,r){const n=[];let i="";const s=this._getNamedTypeIdMapFromNodeIds(e);if(t&&0!==t?.length){for(const e of t)i=i+e+"|";i=i.slice(0,-1)}const a={},o=[];for(const[e,r]of s){const n=`${e}_ids`;a[n]=r,t&&0!==t?.length?o.push(`MATCH (n:${e}) WHERE id(n) IN $${n} WITH n MATCH (n)-[r:${i}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`):o.push(`MATCH (n:${e}) WHERE id(n) IN $${n} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`)}if(!o.length)return n;const l=o.join(" UNION "),c=(await(0,_.executeQueryStreaming)(this.knowledgeGraph,new T.Z({openCypherQuery:l,bindParameters:a}),{signal:r?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await c.read();if(e)break;for(let e=0;e<t.length;e++){const r=t[e];n.push({id:r[0],typeName:r[1]}),n.push({id:r[2],typeName:r[3]})}}return n}async getRelationshipsBetweenNodes(e,t,r){const n=this._getNamedTypeIdMapFromNodeIds(e);if(0===n.size)return[];const i={relationshipExclusionIds:t,possibleConnectionEntityIds:e},s=[];for(const[e,t]of n.entries()){const r=`${e}_ids`;i[r]=t,s.push(`MATCH (n:${e}) WHERE id(n) IN $${r} WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const a=s.join(" UNION "),o=[],l=(await(0,_.executeQueryStreaming)(this.knowledgeGraph,new T.Z({openCypherQuery:a,bindParameters:i}),{signal:r?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await l.read();if(e)break;for(let e=0;e<t.length;e++){const r=t[e];o.push({id:r[0],typeName:r[1]})}}return o}async getRelationshipsFromNodes(e,t,r,n){const i=this._getNamedTypeIdMapFromNodeIds(e);if(0===i.size||0===t.length)return[];const s={relationshipExclusionIds:r,possibleConnectionEntityIds:t},a=[];for(const[e,t]of i.entries()){const r=`${e}_ids`;s[r]=t,a.push(`MATCH (n:${e}) WHERE id(n) IN $${r} WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const o=a.join(" UNION "),l=new Map,c=(await(0,_.executeQueryStreaming)(this.knowledgeGraph,new T.Z({openCypherQuery:o,bindParameters:s}),{signal:n?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await c.read();if(e)break;for(let e=0;e<t.length;e++){const r=t[e];let n=l.get(r[1]);n||(n=new Set,l.set(r[1],n)),n.add(r[0])}}const u=[];for(const[e,t]of l)for(const r of t)u.push({id:r,typeName:e});return u}async refreshCacheContent(e,t,r,n=!0,i){const a=g.Z.getInstance(),c=[],u=new Map,d=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&d.set(e.name,e)})),this.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&d.set(e.name,e)})),e||this.inclusionModeDefinition?e?e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const t of this.memberIdTypeLookup.get(e))u.has(t)?u.get(t)?.push(e):u.set(t,[e])})):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{e.useAllData?u.set(t,null):e.members&&e.members.forEach((e=>{u.has(t)&&null!==u.get(t)?u.get(t)?.push(e.id):u.set(t,[e.id])}))})):(this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&u.set(e.name,null)})),this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&u.set(e.name,null)})));for(const[e,l]of u){const u=new Set(l),p=new Promise(((c,p)=>{(async()=>{const c=new Set,p=[];let h,y="",f=!1;if(t||d.get(e)?.properties?.forEach((e=>{e.name&&c.add(e.name)})),r&&this.geographicLookup.has(e)){const t=this.geographicLookup.get(e)?.name;t&&c.add(t)}if(this.entityTypeNames.has(e))y=`MATCH (n:${e}) ${l?"WHERE id(n) IN $ids ":""}return ID(n)`,c.forEach((e=>{y+=`, n.${e}`,p.push(e)}));else{if(!this.relationshipTypeNames.has(e))throw new s.Z("knowledge-graph:layer-data-manager",`The graph type of ${e} could not be determined. Was this type set in the KG data model and inclusion definition?`);f=!0,y=`MATCH ()-[n:${e}]->() ${l?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,c.forEach((e=>{y+=`, n.${e}`,p.push(e)}))}h=new T.Z(l?{openCypherQuery:y,bindParameters:{ids:l}}:{openCypherQuery:y});const g=(await(0,_.executeQueryStreaming)(this.knowledgeGraph,h,{signal:i?.signal})).resultRowsStream.getReader();for(;;){const{done:t,value:r}=await g.read();if(t)break;const i=[];for(let e=0;e<r.length;e++){const t=r[e];let n=0,s=0;const a={properties:{}};for(a.id=t[n],n++,s++,f&&(a.originId=t[n],n++,s++,a.destinationId=t[n],n++,s++,(0,o.s1)(this.nodeConnectionsLookup,a.originId,(()=>new Set)).add(a.id),(0,o.s1)(this.nodeConnectionsLookup,a.destinationId,(()=>new Set)).add(a.id),(0,o.s1)(this.relationshipConnectionsLookup,a.id,(()=>[a.originId,a.destinationId])));n<t.length;n++)a.properties[p[n-s]]=t[n];u.delete(a.id),i.push(a)}const s=a.writeToStore(i,m.mR,this.geographicLookup.get(e)?.name);this.sublayerCaches.has(e)||this.sublayerCaches.set(e,new Map),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(e)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(e,{useAllData:!1,members:new Map}),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(e).members=new Map);const l=this.sublayerCaches.get(e);s.forEach((t=>{l?.set(t.attributes[m.mR],t),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members.has(t.attributes[m.mR])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members.set(t.attributes[m.mR],{id:t.attributes[m.mR]}),(0,o.s1)(this.memberIdTypeLookup,t.attributes[m.mR],(()=>new Set)).add(e))}))}const b=this.inclusionModeDefinition?.namedTypeDefinitions.get(e);if(b)for(const e of u)b.members?.delete(e)})().then((()=>{c(null)})).catch((e=>{"AbortError"===e.name?c(null):p(e)}))}));c.push(p),this._processingCacheUpdatesLookup.get(e)?.push(p)}if(await Promise.all(c),i?.signal?.aborted)throw(0,l.zE)()}removeFromLayer(e){const t=new Set,r=new Set(e.map((e=>e.id)));for(const r of e)t.add(r.typeName),1===this.memberIdTypeLookup.get(r.id)?.size?this.memberIdTypeLookup.delete(r.id):this.memberIdTypeLookup.get(r.id)?.delete(r.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{t===r.typeName&&e.members?.has(r.id)&&e.members.delete(r.id)}));t.forEach((e=>{this.sublayerCaches.get(e)?.forEach(((t,n)=>{r.has(n)&&this.sublayerCaches.get(e)?.delete(n)}))}))}async retrieveDataFromService(e,t,r){const n=g.Z.getInstance(),i=new Set,a=[];let o,l="",u=[];const d="relationship"===t.graphType,v=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,I=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let E=!v&&I?Array.from(I).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(E=e.objectIds);else if(null!=e.objectIds&&E&&E.length>0){const t=e.objectIds;e.objectIds=E.filter((e=>t.includes(e)))}else if(null!=e.objectIds)E=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=E}if(null!=e.outFields){const r=e.outFields;r.includes("*")?t.fields.forEach((e=>{i.add(e.name)})):r.forEach((e=>{e!==m.mR&&e!==t.geometryFieldName&&i.add(e)}))}if(null!=e.geometry){const r=e.geometry;let n;const u=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,m=u?.spatialReference,g=u?.serviceCapabilities?.geometryCapabilities;let _=g?.geometryMaxBoundingRectangleSizeX,v=g?.geometryMaxBoundingRectangleSizeY;if("point"===r.type){let e=r;e.spatialReference?.isWGS84||(await(0,y.initializeProjection)(e.spatialReference,f.YU),e=(0,y.project)(e,f.YU)),n=new p.Z({spatialReference:f.YU,xmin:e.x-1e-4,ymin:e.y-1e-4,xmax:e.x+1e-4,ymax:e.y+1e-4})}else r?.extent?.spatialReference&&!r.spatialReference?.isWGS84?(await(0,y.initializeProjection)(r.extent.spatialReference,f.YU),n=(0,y.project)(r.extent,f.YU)):n=r.extent;if(_&&v&&m){if(4326!==m.wkid){const e=new p.Z({spatialReference:m,xmax:_,ymax:v}),t=(0,y.project)(e,f.YU);_=t.xmax,v=t.ymax}if(n.xmax-n.xmin>_)throw new s.Z("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${_}° latitude, limit exceeded`);if(n.ymax-n.ymin>v)throw new s.Z("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${v}° longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){const r=await(0,c.EP)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach((e=>{r.fieldNames.includes(e.name)&&i.add(e.name)}))}l=d?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&i.add(t.geometryFieldName),i.forEach((e=>{l+=`, n.${e}`,a.push(e)})),o=new T.Z({openCypherQuery:l,bindParameters:{param_filter_geom:new h.Z({rings:(0,b.YD)(n)})}})}else{let r="";if(null!=e.where&&"1=1"!==e.where){const n=await(0,c.EP)(e.where,t.fieldsIndex);t.fields.forEach((e=>{n.fieldNames.includes(e.name)&&i.add(e.name)}));const s=new Set(["column-reference","string","number","binary-expression"]),a=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let o=!1;const l=e=>{if("column-reference"===e.type)return`n.${e.column}`;if("string"===e.type)return`'${e.value}'`;if("number"===e.type)return`${e.value}`;if("binary-expression"===e.type&&s.has(e.left.type)&&s.has(e.right.type)&&a.has(e.operator))return`${l(e.left)} ${e.operator} ${l(e.right)}`;if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+=`lower(n.${e.left.args.value[0].column})`;else{if("column-reference"!==e.left.type)return o=!0,"";t+=`lower(n.${e.left.column})`}if(t+=" CONTAINS (","string"!==e.right.type)return o=!0,"";{let r=e.right.value;"%"===r.charAt(0)&&(r=r.slice(1)),"%"===r.charAt(r.length-1)&&(r=r.slice(0,-1)),t+=`'${r.toLowerCase()}')`}return t}return o=!0,""};r=l(n.parseTree),o&&(r="")}let n="";n=d?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let s=!1;E&&(s=!0,n+=" WHERE ID(n) IN $ids"),r&&(n+=s?" AND":" WHERE",n+=` ${r}`),n+=" return ID(n)",d&&(n+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&i.add(t.geometryFieldName),i.forEach((e=>{n+=`, n.${e}`,a.push(e)})),o=new T.Z(E?{openCypherQuery:n,bindParameters:{ids:E}}:{openCypherQuery:n})}const w=(await(0,_.executeQueryStreaming)(t.parentCompositeLayer.dataManager.knowledgeGraph,o,r)).resultRowsStream.getReader();for(;;){const{done:e,value:r}=await w.read();if(e)break;const i=[];for(let e=0;e<r.length;e++){const t=r[e];let n=0,s=0;const o={properties:{}};for(o.id=t[n],n++,s++,d&&(o.originId=t[n],n++,s++,o.destinationId=t[n],n++,s++);n<t.length;n++)o.properties[a[n-s]]=t[n];i.push(o)}u=u.concat(n.writeToStore(i,m.mR,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return u}_isEndEntitySpatial(e,t,r){for(const n of e??[])if(this.entityTypeNames.has(n)){const e=this.geographicLookup.get(n),i=e&&this.sublayerCaches.get(n)?.get(t.attributes[r]);if(e&&i?.attributes[e.name])return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){const t=new Map;return e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const r of this.memberIdTypeLookup.get(e)){if(!this.entityTypeNames.has(r))return;t.has(r)?t.get(r)?.push(e):t.set(r,[e])}})),t}};(0,n._)([(0,u.Cb)()],I.prototype,"knowledgeGraph",void 0),(0,n._)([(0,u.Cb)()],I.prototype,"inclusionModeDefinition",void 0),(0,n._)([(0,u.Cb)()],I.prototype,"entityTypeNames",void 0),(0,n._)([(0,u.Cb)()],I.prototype,"relationshipTypeNames",void 0),(0,n._)([(0,u.Cb)()],I.prototype,"geographicLookup",void 0),(0,n._)([(0,u.Cb)()],I.prototype,"sublayerCaches",void 0),(0,n._)([(0,u.Cb)()],I.prototype,"nodeConnectionsLookup",void 0),(0,n._)([(0,u.Cb)()],I.prototype,"relationshipConnectionsLookup",void 0),(0,n._)([(0,u.Cb)()],I.prototype,"memberIdTypeLookup",void 0),I=(0,n._)([(0,d.j)("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],I)},30176:function(e,t,r){r.d(t,{Z:function(){return re}});var n=r(73440),i=r(997),s=r(28947),a=r(96711),o=r(84060),l=(r(82592),r(17155)),c=(r(61432),r(48023)),u=r(29884),d=r(66951),p=r(71354),h=r(60508),y=r(67764),f=r(62197),m=r(13132),g=r(45213),b=r(8554),_=r(98842),T=r(38209),v=r(95014),I=r(33235),E=r(73967),w=r(3849);r(83850);const S=(0,r(13545).v)(),L=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,n._)([(0,l.Cb)(S.fields)],t.prototype,"fields",void 0),(0,n._)([(0,l.Cb)(S.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,n._)([(0,c.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t),t};var C=r(81766),R=r(83263),M=r(7150),N=r(15303),A=r(88920),x=r(90833),k=r(19306),O=r(3752),D=r(99671),j=r(93295),F=r(18739),U=r(49651),P=r(76554),G=r(89428),Z=r(80862),B=r(83918),q=r(43957),V=r(84799),Y=r(60541),$=r(13878),H=r(29191),Q=r(99382),W=r(30903),z=r(20222);function J(e){if(!e.json)return e;e.json.write=X(e.json.write);const t=e.json.origins;if(!t)return e;let r;for(r in t){const e=t[r];e&&(e.write=X(e.write))}return e}function X(e){return"object"==typeof e&&e?(!1!==e.enabled&&(e.overridePolicy=function(e){const{target:t,writer:r,overridePolicy:n,...i}=e;return function(e,t){const r=ee.call(this,e,t);return r.enabled?{...i,...r}:r}}(e)),e):!0===e?K():e}function K(){return{overridePolicy:ee}}function ee(e,t){const r=!!this.geometryType;let n={enabled:r};return r&&(n={...n,...te.call(this,e,t)}),n}function te(e,t){return{ignoreOrigin:this.originIdOf(t)>d.s3.DEFAULTS}}let re=class extends(L((0,M.tM)((0,A.M)((0,N.b)((0,R.h7)((0,x.c_)((0,D.n)((0,O.M)((0,k.Q)((0,o.R)(T.Z))))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=(0,E.MS)(!1,!0),this.charts=null,this.definitionExpression=null,this.displayField="",this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=w.mR,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then((()=>{const e=new MessageChannel;return new z.Z(e.port1,{channel:e,client:{queryFeatures:(e,t={})=>{const r=H.Z.fromJSON(e);return this.queryFeaturesJSON(r,t)}}}),[e.port2]}))},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get userHasUpdateItemPrivileges(){return!!this.parent?.userHasUpdateItemPrivileges}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){const e=[];return this.objectType?.properties?.forEach((t=>{const r="esriFieldTypeOID"===t.fieldType?"esriFieldTypeInteger":t.fieldType;e.push(U.Z.fromJSON({name:t.name,type:r,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))})),e.push(U.Z.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),U.Z.fromJSON({name:w._P,type:"esriFieldTypeInteger",alias:w._P,editable:!1}),U.Z.fromJSON({name:w._k,type:"esriFieldTypeInteger",alias:w._k,editable:!1})),e}get geometryType(){if("link-chart"===this.parentCompositeLayer?.type)return"relationship"===this.graphType?"polyline":"point";const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&"esriGeometryNull"!==t?_.Mk.fromJSON(t):null}get geometryFieldName(){if("link-chart"===this.parentCompositeLayer?.type)return w.xD;const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name);return e?.name??null}get graphTypeName(){return this.objectType?.name}get hasM(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name;return(t?this.objectType?.properties?.[t]:null)?.hasM??!1}get hasZ(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name;return(t?this.objectType?.properties?.[t]:null)?.hasZ??!1}set labelingInfo(e){this._set("labelingInfo",e)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");if(!this.objectType||!this.parentCompositeLayer||!this.graphTypeName)return null;const e=this.objectType.properties?(0,C.wn)(this.objectType.properties):"ESRI__ID";return"link-chart"===this.parentCompositeLayer.type?(0,C.fC)(this.graphType,this.graphTypeName,e):(0,C.R4)(this.graphTypeName,this.geometryType,e)}set renderer(e){(0,P.YN)(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){if(this._isOverridden("renderer"))return this._get("renderer");const e=this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel,t=[...e?.entityTypes??[],...e?.relationshipTypes??[]].map((e=>e.name)).indexOf(this.graphTypeName),r=(0,C.Jr)(t);if("link-chart"===this.parentCompositeLayer?.type){if("relationship"===this.graphType)return new q.Z({type:"simple",symbol:(0,C.I)(r)});const e=(0,V.i)((0,E.bU)(_.Mk.toJSON("point")).renderer);return(0,W.tb)(e.symbol,r),e}const n=(0,V.i)((0,E.bU)(_.Mk.toJSON(this.geometryType)).renderer);return(0,W.tb)(n.symbol,r),n}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??g.Z.WGS84}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return(0,Q.eZ)(this,e)}createQuery(){return new H.Z({where:"1=1",outFields:["*"]})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return null}async queryFeatures(e,t){await this.load();const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e),i=$.Z.fromJSON(await n.executeQuery(r.toJSON(),t?.signal));return i.features.forEach((e=>{e.sourceLayer=this})),i}async queryFeaturesJSON(e,t){await this.load();const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e);return await n.executeQuery(r.toJSON(),t?.signal)}async queryFeatureCount(e,t){await this.load();const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e);return n.executeQueryForCount(r.toJSON(),t?.signal)}async queryExtent(e={},t){await this.load();const r={...e,returnGeometry:!0},{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(r),s=await i.executeQueryForExtent(n.toJSON(),t?.signal);let a;return a=null!=s.extent?.xmin&&null!=s.extent?.xmax&&null!=s.extent?.ymin&&null!=s.extent?.ymax?new p.Z(s.extent):new p.Z,{count:s.count,extent:a}}async queryObjectIds(e,t){await this.load();const r=H.Z.from(e);let n;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)n=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(r,this,t);n=this.loadQueryEngine(e)}return await n.executeQueryForIds(r.toJSON(),t?.signal)}loadQueryEngine(e){const t=new v.Z({geometryType:_.Mk.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),r=new I.qq({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:_.Mk.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,featureIdInfo:{type:"object-id",fieldName:this.objectIdField},spatialReference:this.spatialReference.toJSON(),timeInfo:this.timeInfo?.toJSON(),featureStore:t});return r.featureStore.addMany(e),r}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new H.Z({where:"1=1",outFields:[w.mR]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}load(e){return this.addResolvingPromise(this.parent.load(e).then((()=>(0,P.UF)(this.timeInfo,this.fieldsIndex)))),Promise.resolve(this)}async _setupQueryObjects(e,t){const r=H.Z.from(e),n=r.geometry;if(n&&!n.spatialReference?.isWGS84&&(await(0,m.initializeProjection)(n.spatialReference,b.YU),r.geometry=(0,m.project)(n instanceof y.Z||n instanceof f.Z||n instanceof h.Z?n:n.extent,b.YU)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)return{resolvedQuery:r,queryEngine:this._cachedQueryEngine};const i=await this.parentCompositeLayer.dataManager.getData(r,this,t);return{resolvedQuery:r,queryEngine:this.loadQueryEngine(i)}}};(0,n._)([(0,l.Cb)(J((0,s.d9)(R.nE)))],re.prototype,"blendMode",void 0),(0,n._)([(0,l.Cb)()],re.prototype,"capabilities",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],re.prototype,"userHasUpdateItemPrivileges",null),(0,n._)([(0,l.Cb)({json:{origins:{"web-scene":{write:!1}},write:K()}})],re.prototype,"charts",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],re.prototype,"defaultPopupTemplate",null),(0,n._)([(0,l.Cb)({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],re.prototype,"definitionExpression",void 0),(0,n._)([(0,l.Cb)()],re.prototype,"displayField",void 0),(0,n._)([(0,l.Cb)(J((0,s.d9)(M.jp)))],re.prototype,"displayFilterEnabled",void 0),(0,n._)([(0,l.Cb)(J((0,s.d9)(M.ey)))],re.prototype,"displayFilterInfo",void 0),(0,n._)([(0,l.Cb)(J((0,s.d9)(R.qu)))],re.prototype,"effect",void 0),(0,n._)([(0,l.Cb)()],re.prototype,"elevationInfo",void 0),(0,n._)([(0,l.Cb)(J((0,s.d9)(N.d)))],re.prototype,"featureEffect",void 0),(0,n._)([(0,l.Cb)(J((0,s.d9)(F.d)))],re.prototype,"featureReduction",null),(0,n._)([(0,l.Cb)()],re.prototype,"fields",null),(0,n._)([(0,l.Cb)()],re.prototype,"geometryType",null),(0,n._)([(0,l.Cb)()],re.prototype,"geometryFieldName",null),(0,n._)([(0,l.Cb)({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],re.prototype,"graphType",void 0),(0,n._)([(0,l.Cb)({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],re.prototype,"graphTypeName",null),(0,n._)([(0,l.Cb)()],re.prototype,"hasM",null),(0,n._)([(0,l.Cb)()],re.prototype,"hasZ",null),(0,n._)([(0,l.Cb)({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],re.prototype,"id",void 0),(0,n._)([(0,l.Cb)({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],re.prototype,"labelsVisible",void 0),(0,n._)([(0,l.Cb)({type:[G.Z],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:function(e,t,r){const n=[["ESRI__AGGREGATION_COUNT",w._P],["ESRI__ORIGIN_ID",w.TY],["ESRI__DESTINATION_ID",w.l6],["ESRI__LAYOUT_GEOMETRY",w.xD]];try{for(const t of e)for(const[e,r]of n)t.labelExpression=t.labelExpression?.replaceAll(e,r),t.labelExpressionInfo?.expression&&(t.labelExpressionInfo.expression=t.labelExpressionInfo.expression.replaceAll(e,r))}catch(e){a.Z.getLogger(this).warn("Error updating labelingInfo",e)}return(0,Z.r)(e,t,r)},write:K()}})],re.prototype,"labelingInfo",null),(0,n._)([(0,l.Cb)({readOnly:!0,json:{read:!1,write:{writer(e,t){switch(this.parentCompositeLayer?.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],re.prototype,"layerType",void 0),(0,n._)([(0,l.Cb)(J((0,s.d9)(j.rn)))],re.prototype,"legendEnabled",void 0),(0,n._)([(0,l.Cb)(J((0,s.d9)(j.u1)))],re.prototype,"maxScale",void 0),(0,n._)([(0,l.Cb)(J((0,s.d9)(j.rO)))],re.prototype,"minScale",void 0),(0,n._)([(0,l.Cb)()],re.prototype,"objectIdField",void 0),(0,n._)([(0,l.Cb)()],re.prototype,"objectType",void 0),(0,n._)([(0,l.Cb)(J((0,s.d9)(j.Oh)))],re.prototype,"opacity",void 0),(0,n._)([(0,l.Cb)(J((0,s.d9)(x.lD)))],re.prototype,"orderBy",void 0),(0,n._)([(0,l.Cb)({clonable:!1})],re.prototype,"parent",void 0),(0,n._)([(0,l.Cb)()],re.prototype,"parentCompositeLayer",void 0),(0,n._)([(0,l.Cb)(J((0,s.d9)(j.C_)))],re.prototype,"popupEnabled",void 0),(0,n._)([(0,l.Cb)({type:i.Z,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],re.prototype,"popupTemplate",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:{overridePolicy:te}}})],re.prototype,"refreshInterval",void 0),(0,n._)([(0,l.Cb)({types:Y.Av,json:{name:"layerDefinition.drawingInfo.renderer",write:K()}})],re.prototype,"renderer",null),(0,n._)([(0,l.Cb)()],re.prototype,"source",void 0),(0,n._)([(0,l.Cb)()],re.prototype,"spatialReference",null),(0,n._)([(0,l.Cb)({type:B.Z,json:{name:"layerDefinition.timeInfo",write:!0,origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:!0},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:!0}}}})],re.prototype,"timeInfo",null),(0,n._)([(0,l.Cb)({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],re.prototype,"title",null),(0,n._)([(0,u.c)("title")],re.prototype,"writeTitle",null),(0,n._)([(0,l.Cb)({json:{read:!1}})],re.prototype,"type",void 0),(0,n._)([(0,l.Cb)(J((0,s.d9)(D.I)))],re.prototype,"useViewTime",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{name:"visibility",write:K()}})],re.prototype,"visible",void 0),re=(0,n._)([(0,c.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],re)},78694:function(e,t,r){r.d(t,{Z:function(){return o}});var n=r(90756),i=r(64246),s=r(24564),a=r(3849);class o{constructor(){this._featureLookup=new Map}static getInstance(){return o.instance||(o.instance=new o),o.instance}static resetInstance(){o.instance&&(o.instance=null)}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const t=[];return e.forEach((e=>{const r=this.readFromStoreById(e);r&&t.push(r)})),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,t,r){const o=[];return e.forEach((e=>{if(!e?.id)return;e.properties||(e.properties=[]);let l,c=null;if(r&&e.properties[r]&&(c=(0,i.GH)(e.properties[r])),"originId"in e&&"destinationId"in e&&(e.properties[a.TY]=e.originId,e.properties[a.l6]=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const i=this._featureLookup.get(e.id),a=JSON.parse(JSON.stringify(Object.assign(i.attributes,e.properties)));r&&e.properties[r]&&(a[r]=(0,n.im)(e.properties[r])),l=new s.u_(c?JSON.parse(JSON.stringify(c)):i?.geometry?JSON.parse(JSON.stringify(i.geometry)):null,a,null,e.properties[t])}else l=new s.u_(c?JSON.parse(JSON.stringify(c)):null,e.properties,null,e.properties[t]);this._featureLookup.set(`${e.typeName?`${e.typeName}__${e.id}`:e.id}`,l),o.push(l)})),o}}},81766:function(e,t,r){r.d(t,{I:function(){return y},Jr:function(){return h},R4:function(){return g},fC:function(){return m},wn:function(){return f},xk:function(){return d}});var n=r(53147),i=r(89428),s=r(18011),a=r(61861),o=r(44783),l=r(45433);const c=async(e,t,r)=>{if(t||(t=[...e.layers,...e.tables].map((e=>e.graphTypeName))),0===t?.length)return;const n=new Map;for(const r of t)n.set(r,u(e,r));const i=await(0,a.fetchClientDataAtKeys)(e.dataManager.knowledgeGraph,Array.from(n.values()),{requestOptions:{signal:r?.signal}});for(const t of[...e.layers,...e.tables]){const r=t.objectType.name;if(null==r)continue;const n=i.get(u(e,r));if(n){const e=JSON.parse(n);null===e||"object"!=typeof e||e.hasOwnProperty("showLabels")||(e.showLabels=!1),t.read(e,{origin:"service"})}}},u=(e,t)=>"knowledge-graph"===e.type?`${t}/Map`:`${t}/LinkChart/LinkChartSubLayer`;async function d(e,t,r){return c(e,t,r)}const p=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"];function h(e){return e<0||e>=p.length?new n.Z("#8f8f82"):new n.Z(p[e])}function y(e){const t=e.toArray();return new o.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:t},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}]}]}}})}function f(e){let t="ESRI__ID",r=4;for(const n of e)if(n.name){if("name"===n.name.toLowerCase()){t=n.name;break}n.name.toLowerCase().includes("name")?(t=n.name,r=2):"esriFieldTypeString"===n.fieldType&&r>3&&(t=n.name,r=3)}return t}function m(e,t,r){const n={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},a=new i.Z({labelExpressionInfo:new s.Z({expression:"ESRI__ID"===r?`${t}`:`$feature.${r}`}),labelPlacement:"above-center",symbol:new l.Z(n)}),o=new i.Z({labelExpressionInfo:new s.Z({expression:`'${t}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new l.Z({...n,yoffset:"12px"})});return"entity"===e?[a]:[o]}function g(e,t,r){const n={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},a="ESRI__ID"===r?`${e}`:`$feature.${r}`;return"point"===t?[new i.Z({labelExpressionInfo:new s.Z({expression:a}),labelPlacement:"above-center",symbol:new l.Z(n)})]:"polyline"===t?[new i.Z({labelExpressionInfo:new s.Z({expression:a}),labelPlacement:"center-along",repeatLabel:!0,symbol:new l.Z(n)})]:"polygon"===t?[new i.Z({labelExpressionInfo:new s.Z({expression:a}),labelPlacement:"always-horizontal",symbol:new l.Z(n)})]:null}},41305:function(e,t,r){r.d(t,{no:function(){return u},bv:function(){return c},YD:function(){return d}});r(46451);var n=r(88194),i=(r(60508),r(67764),r(62197),r(53447),r(78694),r(71276),r(41773));(0,i.w)()({none:"none",startAndEnd:"start-and-end",startOnly:"start-only"}),(0,i.w)()({absoluteValue:"absolute-value",multiplier:"multiplier"});const s=new Map([["basic-grid","basic-grid"],["geographic-organic-standard","geographic-organic-standard"],["hierarchical-bottom-to-top","hierarchical-bottom-to-top"],["hierarchical-top-to-bottom","hierarchical-bottom-to-top"],["organic-community","organic-community"],["organic-fusiform","organic-standard"],["organic-leaf-circle","organic-standard"],["organic-standard","organic-standard"],["radial-node-centric","radial-root-centric"],["radial-root-centric","radial-root-centric"],["tree-bottom-to-top","tree-left-to-right"],["tree-left-to-right","tree-left-to-right"],["tree-right-to-left","tree-left-to-right"],["tree-top-to-bottom","tree-left-to-right"],["chronological-mono-timeline","chronological-mono-timeline"],["chronological-multi-timeline","chronological-multi-timeline"]]);var a=r(61861),o=r(42167);r(44783),r(89636),r(45433);function l(e,t){const r=new Map;if(t.dataModel?.relationshipTypes)for(const e of t.dataModel.relationshipTypes)e.name&&r.set(e.name,[]);for(const t of e)r.has(t.typeName)&&r.get(t.typeName)?.push(t.id);return r}async function c(e,t,r){const n=[],i=l(e,t),s={},c=[];for(const[e,t]of i){if(t.length<1)continue;const r=`${e}_ids`;s[r]=t,c.push(`MATCH (n)-[r:${e}]->(m) WHERE id(r) in $${r} RETURN id(n), labels(n)[0], id(m), labels(m)[0]`)}if(0===c.length)return[];const u=c.join(" UNION "),d=new o.Z({openCypherQuery:u,bindParameters:s}),p=(await(0,a.executeQueryStreaming)(t,d,r?.requestOptions)).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await p.read();if(e)break;for(const e of t)n.push({id:e[0],typeName:e[1]}),n.push({id:e[2],typeName:e[3]})}return n}const u=e=>s.get(e)??"radial-root-centric";function d(e){if(!e.spatialReference.isWGS84)throw new n.Z("knowledge-graph:layer-support-utils","The utilsExtentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}},83263:function(e,t,r){r.d(t,{h7:function(){return d},nE:function(){return l},qu:function(){return u}});var n=r(73440),i=r(17155),s=(r(61432),r(96711),r(83850),r(48023)),a=r(71840),o=r(615);const l={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:{layerContainerTypes:a.C}},"portal-item":{read:!0,write:{layerContainerTypes:a.C}}}}},c={read:{reader:o.ij},write:{allowNull:!0,writer:o.cW,layerContainerTypes:a.C}},u={json:{read:!1,write:!1,origins:{"web-map":c,"portal-item":c}}},d=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return(0,n._)([(0,i.Cb)(l)],t.prototype,"blendMode",void 0),(0,n._)([(0,i.Cb)(u)],t.prototype,"effect",void 0),t=(0,n._)([(0,s.j)("esri.layers.mixins.BlendLayer")],t),t}},7150:function(e,t,r){r.d(t,{tM:function(){return b},jp:function(){return _},ey:function(){return T}});var n=r(73440),i=r(60123),s=r(17155),a=(r(61432),r(96711),r(83850),r(48023)),o=r(71840),l=r(89314),c=r(43254),u=r(63255),d=r(29884),p=r(4469),h=r(18764);const y={write:{overridePolicy:(e,t,r)=>({enabled:!r||"scale"===r.filterMode})}};let f=class extends(l.Z.ClonableMixin(u.Z)){constructor(e){super(e),this.id=(0,h.DO)(),this.maxScale=0,this.minScale=0,this.title="",this.where=null}};(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],f.prototype,"id",void 0),(0,n._)([(0,s.Cb)({type:Number,json:y})],f.prototype,"maxScale",void 0),(0,n._)([(0,s.Cb)({type:Number,json:y})],f.prototype,"minScale",void 0),(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],f.prototype,"title",void 0),(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],f.prototype,"where",void 0),f=(0,n._)([(0,a.j)("esri.layers.support.DisplayFilter")],f);var m=r(78279);let g=class extends(l.Z.ClonableMixin(u.Z)){constructor(e){super(e),this.activeFilterId=null,this.filters=new(c.Z.ofType(f)),this.mode="manual"}writeFilters(e,t,r,n){const i=e.toArray();"scale"===this.mode&&i.sort(((e,t)=>{const r=(0,p.Nf)(t.minScale,e.minScale),n=e.maxScale-t.maxScale;return 0===r?n:r})),t[r]=i.map((e=>e.toJSON(n)))}write(e,t){return super.write(e,(0,m.Ee)(this,t))}};(0,n._)([(0,s.Cb)({type:String,json:{write:{overridePolicy:(e,t,r)=>({enabled:"manual"===r.filterMode,isRequired:!0})}}})],g.prototype,"activeFilterId",void 0),(0,n._)([(0,s.Cb)({type:c.Z.ofType(f),nonNullable:!0,json:{write:!0}})],g.prototype,"filters",void 0),(0,n._)([(0,d.c)("filters")],g.prototype,"writeFilters",null),(0,n._)([(0,s.Cb)({type:["manual","scale"],nonNullable:!0,json:{name:"filterMode",write:!0}})],g.prototype,"mode",void 0),g=(0,n._)([(0,a.j)("esri.layers.support.DisplayFilterInfo")],g);const b=e=>{let t=class extends e{constructor(){super(...arguments),this.displayFilterEnabled=!0,this.displayFilterInfo=null}};return(0,n._)([(0,s.Cb)(_)],t.prototype,"displayFilterEnabled",void 0),(0,n._)([(0,s.Cb)(T)],t.prototype,"displayFilterInfo",void 0),t=(0,n._)([(0,a.j)("esri.layers.mixins.DisplayFilteredLayer")],t),t},_={type:Boolean,json:{name:"layerDefinition.disableDisplayFilter",read:{reader:e=>!e},write:{layerContainerTypes:o.C,writer(e,t,r){(0,i.RB)(r,!e,t)}},origins:{"web-scene":{write:!1,read:!1}}}},T={type:g,json:{name:"layerDefinition.displayFilterInfo",write:{enabled:!0,allowNull:!0,layerContainerTypes:o.C},origins:{"web-scene":{write:!1,read:!1}}}}},90833:function(e,t,r){r.d(t,{Ax:function(){return l},c_:function(){return u},lD:function(){return c}});var n=r(73440),i=r(60123),s=r(17155),a=(r(61432),r(96711),r(83850),r(48023)),o=r(72917);function l(e,t,r){if(!e)return null;const n=e.find((e=>!!e.field));if(!n)return null;const i=new o.Z;return i.read(n,r),[i]}const c={type:[o.Z],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:l},write:{writer:function(e,t,r,n){const s=e.find((e=>!!e.field));s&&(0,i.RB)(r,[s.toJSON()],t)}}}},u=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return(0,n._)([(0,s.Cb)(c)],t.prototype,"orderBy",void 0),t=(0,n._)([(0,a.j)("esri.layers.mixins.OrderedLayer")],t),t}},19306:function(e,t,r){r.d(t,{Q:function(){return v},d:function(){return T}});var n=r(73440),i=(r(61432),r(96711)),s=r(93568),a=r(17155),o=r(90775),l=(r(83850),r(48023)),c=r(71840),u=r(43254),d=r(90403),p=r(21260);const h=new u.Z,y=new WeakMap;function f(e){return null!=e&&"object"==typeof e&&"refreshInterval"in e&&"refresh"in e}function m(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:m(t,e%t):0}let g=0,b=0;function _(){const e=Date.now();let t=!1;for(const r of h){const n=r.deref();n?n.refreshInterval&&e-(y.get(n)??0)+5>=6e4*n.refreshInterval&&(y.set(n,e),n.refresh(e)):t=!0}if(t)for(let e=h.length-1;e>=0;e--)h.at(e).deref()||h.removeAt(e)}(0,p.EH)((()=>{const e=Date.now();let t=0;for(const r of h){const n=r.deref();n&&(t=m(Math.round(6e4*n.refreshInterval),t),n.refreshInterval?y.get(n)||y.set(n,e):y.delete(n))}if(t!==b){if(b=t,clearInterval(g),0===b)return void(g=0);g=setInterval(_,b)}}),d.Z_);function T(e){return null!=e&&"object"==typeof e&&"refreshTimestamp"in e&&"refresh"in e}const v=e=>{let t=class extends e{constructor(...e){super(...e),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,s.Ds)((()=>this.hasDataChanged())),this.when().then((()=>{this.destroyed||function(e){f(e)&&h.push(new WeakRef(e))}(this)}),(()=>{}))}destroy(){!function(e){const t=h.find((t=>t.deref()===e));t&&h.remove(t)}(this)}castRefreshInterval(e){return e>=.1?e:e<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(e=Date.now()){(0,s.R8)(this._debounceHasDataChanged()).then((t=>{t&&this._set("refreshTimestamp",e),this.emit("refresh",{dataChanged:t})}),(e=>{i.Z.getLogger(this).error(e),this.emit("refresh",{dataChanged:!1,error:e})}))}async hasDataChanged(){return!0}get test(){}};return(0,n._)([(0,a.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:c.C}}}}})],t.prototype,"refreshInterval",void 0),(0,n._)([(0,o.p)("refreshInterval")],t.prototype,"castRefreshInterval",null),(0,n._)([(0,a.Cb)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],t.prototype,"refreshParameters",null),t=(0,n._)([(0,l.j)("esri.layers.mixins.RefreshableLayer")],t),t}},99671:function(e,t,r){r.d(t,{I:function(){return h},n:function(){return y}});var n=r(73440),i=r(17155),s=(r(61432),r(96711),r(83850),r(1194)),a=r(48023),o=r(71840),l=r(76554),c=r(83918),u=r(24009),d=r(85913),p=r(62920);const h={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:o.C}}},y=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const r=t.timeInfo.exportOptions;if(!r)return null;const n=r.timeOffset,i=u.v.fromJSON(r.timeOffsetUnits);return n&&i?new p.T({value:n,unit:i}):null}set timeInfo(e){(0,l.UF)(e,this.fieldsIndex),this._set("timeInfo",e)}};return(0,n._)([(0,i.Cb)({type:d.T,json:{write:!1}})],t.prototype,"timeExtent",void 0),(0,n._)([(0,i.Cb)({type:p.T})],t.prototype,"timeOffset",void 0),(0,n._)([(0,s.r)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),(0,n._)([(0,i.Cb)({value:null,type:c.Z,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),(0,n._)([(0,i.Cb)(h)],t.prototype,"useViewTime",void 0),t=(0,n._)([(0,a.j)("esri.layers.mixins.TemporalLayer")],t),t}},72917:function(e,t,r){r.d(t,{Z:function(){return u}});var n,i=r(73440),s=r(41773),a=r(63255),o=r(17155),l=(r(61432),r(96711),r(83850),r(48023));const c=new s.X({asc:"ascending",desc:"descending"});let u=class extends a.Z{static{n=this}constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new n({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,i._)([(0,o.Cb)({type:String,json:{write:!0}})],u.prototype,"field",void 0),(0,i._)([(0,o.Cb)({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],u.prototype,"valueExpression",void 0),(0,i._)([(0,o.Cb)({type:c.apiValues,json:{type:c.jsonValues,read:c.read,write:c.write}})],u.prototype,"order",void 0),u=n=(0,i._)([(0,l.j)("esri.layers.support.OrderByInfo")],u)},47641:function(e,t,r){r.d(t,{b:function(){return a}});var n=r(93568),i=r(39355),s=r(78891);class a{constructor(){this._tasks=new Array,this._numPendingTasks=(0,i.t)(0),this._running=(0,i.t)(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get running(){return this._running.value}_updateRunning(){this._running.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return s.J;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return new Promise(((n,i)=>{this._tasks.push(new o(n,i,e,t,r)),++this._numPendingTasks.value,this._updateRunning()})).finally((()=>--this._numPendingTasks.value))}unshift(e,t,r){return new Promise(((n,i)=>{this._tasks.unshift(new o(n,i,e,t,r)),++this._numPendingTasks.value,this._updateRunning()})).finally((()=>--this._numPendingTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();this._updateRunning();try{const r=(0,n.Hc)(t.signal);if(r&&!t.abortCallback)t.reject((0,n.zE)());else{const i=r?t.abortCallback?.((0,n.zE)()):t.callback(e);(0,n.y8)(i)?i.then(t.resolve,t.reject):t.resolve(i)}}catch(e){t.reject(e)}return!0}cancelAll(){const e=(0,n.zE)();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0,this._updateRunning()}}class o{constructor(e,t,r,n,i){this.resolve=e,this.reject=t,this.callback=r,this.signal=n,this.abortCallback=i}}},83918:function(e,t,r){r.d(t,{Z:function(){return y}});var n=r(73440),i=r(89314),s=r(63255),a=r(17155),o=(r(61432),r(96711),r(83850),r(1194)),l=r(48023),c=r(29884),u=r(85913),d=r(62920),p=r(88097);function h(e,t){return d.T.fromJSON({value:e,unit:t})}let y=class extends(i.Z.ClonableMixin(s.Z)){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,t){return t.timeExtent&&Array.isArray(t.timeExtent)&&2===t.timeExtent.length?u.T.fromArray(t.timeExtent):null}writeFullTimeExtent(e,t){null!=e?.start&&null!=e.end?t.timeExtent=e.toArray():t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?h(t.timeInterval,t.timeIntervalUnits):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?h(t.defaultTimeInterval,t.defaultTimeIntervalUnits):null}writeInterval(e,t){t.timeInterval=e?.toJSON().value??null,t.timeIntervalUnits=e?.toJSON().unit??null}};(0,n._)([(0,a.Cb)({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],y.prototype,"cumulative",void 0),(0,n._)([(0,a.Cb)({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],y.prototype,"endField",void 0),(0,n._)([(0,a.Cb)({type:u.T,json:{write:{enabled:!0,allowNull:!0}}})],y.prototype,"fullTimeExtent",void 0),(0,n._)([(0,o.r)("fullTimeExtent",["timeExtent"])],y.prototype,"readFullTimeExtent",null),(0,n._)([(0,c.c)("fullTimeExtent")],y.prototype,"writeFullTimeExtent",null),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],y.prototype,"hasLiveData",void 0),(0,n._)([(0,a.Cb)({type:d.T,json:{write:{enabled:!0,allowNull:!0}}})],y.prototype,"interval",void 0),(0,n._)([(0,o.r)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],y.prototype,"readInterval",null),(0,n._)([(0,c.c)("interval")],y.prototype,"writeInterval",null),(0,n._)([(0,a.Cb)({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],y.prototype,"startField",void 0),(0,n._)([(0,a.Cb)((0,p.mi)("timeReference",!0))],y.prototype,"timeZone",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],y.prototype,"trackIdField",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],y.prototype,"useTime",void 0),(0,n._)([(0,a.Cb)({type:[Date],json:{read:!1}})],y.prototype,"stops",void 0),y=(0,n._)([(0,l.j)("esri.layers.support.TimeInfo")],y)},13545:function(e,t,r){r.d(t,{v:function(){return l}});var n=r(61432),i=r(96711),s=r(49651),a=r(299),o=r(76554);function l(){return{fields:{type:[s.Z],value:null,set:function(e){if(e&&(0,n.Z)("big-integer-warning-enabled")){const t=e.filter((e=>"big-integer"===e.type||"oid"===e.type&&(e.length||0)>=8));if(t.length){const e=t.map((e=>`'${e.name}'`)).join(", ");i.Z.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${e}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",e)}},fieldsIndex:{readOnly:!0,get(){return a.Z.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e?.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e){const r=this.fieldsIndex?.has(t);r||i.Z.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e})}return(0,o.Q0)(this.fieldsIndex,e)}}}}},71276:function(e,t,r){r.d(t,{BI:function(){return y},Bc:function(){return g},Dx:function(){return T},L2:function(){return f},Un:function(){return c},Yw:function(){return _},cu:function(){return m},gQ:function(){return l},iz:function(){return o},uc:function(){return b},zD:function(){return a}});var n=r(1800);let i,s=null;function a(){return i||(i=r.e(15649).then(r.bind(r,15649)).then((e=>e.l)).then((({default:e})=>e({locateFile:e=>(0,n.V)(`esri/libs/linkchartlayout/${e}`)}))).then((e=>{!function(e){s=e}(e)})),i)}var o,l,c,u;!function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot",e[e.IsOld=8]="IsOld"}(o||(o={})),function(e){e[e.Success=0]="Success",e[e.Error=1]="Error",e[e.Canceled=2]="Canceled"}(l||(l={})),function(e){e[e.Regular=0]="Regular",e[e.Curved=1]="Curved",e[e.Recursive=2]="Recursive"}(c||(c={})),function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom"}(u||(u={}));const d={none:0,"start-only":1,"start-and-end":2};function p(e){const t={timeDirection:"right",timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:"start-and-end",showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0,...e?.toJSON()??{},eventsTicksVisualization:e?.eventsTicksVisualization??"start-and-end"};return{...t,timeDirection:{value:u[t.timeDirection]??u.right},eventsTicksVisualization:{value:d[t.eventsTicksVisualization]??d["start-and-end"]}}}function h(e,t,r,n,i,a){const o=r.length,c=i.length,u=Float64Array.BYTES_PER_ELEMENT,d=Uint32Array.BYTES_PER_ELEMENT,p=Uint8Array.BYTES_PER_ELEMENT,h=16+o*(p+2*u)+c*(2*d),y=s._malloc(h);try{const p=y+16-y%16,h=p+o*u,f=h+o*u,m=f+c*d,g=m+c*d,b=()=>[s.HEAPF64.subarray(p>>3,(p>>3)+o),s.HEAPF64.subarray(h>>3,(h>>3)+o),s.HEAPU32.subarray(f>>2,(f>>2)+c),s.HEAPU32.subarray(m>>2,(m>>2)+c),s.HEAPU8.subarray(g,g+o)],[_,T,v,I,E]=b();_.set(r),T.set(n),v.set(i),I.set(a),E.set(t);const w=e(o,g,p,h,c,f,m);let S=null,L=null;if(w.value===l.Success){const e=s.getLayoutLinksTypes(),t=s.getLayoutLinksVerticesEndIndices(),r=s.getLayoutLinksVertices(),n=s.countLayoutLinksVertices();!c||e&&t?n&&!r?w.value=l.Error:(S={types:new Uint8Array(s.HEAPU8.subarray(e,e+c)),vertexEndIndex:new Uint32Array(s.HEAPU32.subarray(t>>2,(t>>2)+c)),vertices:new Float64Array(s.HEAPF64.subarray(r>>3,(r>>3)+2*n))},L=s.getAuxiliaryGraphicElements()):w.value=l.Error}const[C,R,M,N,A]=b();return r.set(C),n.set(R),i.set(M),a.set(N),t.set(A),{status:w.value,links:S,graphics:L}}finally{s._free(y),s.cleanupLayout()}}var y,f,m,g,b,_,T,v,I;!function(e){e.getMinIdealEdgeLength=function(){return s.getMinIdealEdgeLength()},e.apply=function(e,t,r,n,i,a,o=2,l=1,c=-1){return h(((t,r,n,i,a,u,d)=>s.applyForceDirectedLayout(e,t,r,n,i,a,u,d,o,l,c)),t,r,n,i,a)}}(y||(y={})),function(e){e.apply=function(e,t,r,n,i,a,o=2,l=1,c=-1){return h(((t,r,n,i,a,u,d)=>s.applyCommunityLayout(e,t,r,n,i,a,u,d,o,l,c)),t,r,n,i,a)}}(f||(f={})),function(e){e.apply=function(e,t,r,n,i,a){return h(((t,r,n,i,a,o,l)=>s.applySimpleLayout(e,t,r,n,i,a,o,l)),t,r,n,i,a)}}(m||(m={})),function(e){e.apply=function(e,t,r,n,i,a){return h(((t,r,n,i,a,o,l)=>s.applyHierarchicalLayout(e,t,r,n,i,a,o,l)),t,r,n,i,a)}}(g||(g={})),function(e){e.apply=function(e,t,r,n,i,a){return h(((t,r,n,i,a,o,l)=>s.applyRadialTreeLayout(e,t,r,n,i,a,o,l)),t,r,n,i,a)}}(b||(b={})),function(e){e.apply=function(e,t,r,n,i,a){return h(((t,r,n,i,a,o,l)=>s.applySmartTreeLayout(e,t,r,n,i,a,o,l)),t,r,n,i,a)}}(_||(_={})),function(e){e.apply=function(e,t,r,n,i,a,o,c,u,d,y,f){return h(((t,r,n,o,c,h,m)=>{if(i.length!==t)return{value:l.Error};if(a.length!==t)return{value:l.Error};if(u.length!==c)return{value:l.Error};if(d.length!==c)return{value:l.Error};const g=Float64Array.BYTES_PER_ELEMENT,b=16,_=s._malloc(b+t*g),T=s._malloc(b+t*g),v=s._malloc(b+c*g),I=s._malloc(b+c*g),E=_+b-_%b,w=T+b-T%b,S=v+b-v%b,L=I+b-I%b;try{return s.HEAPF64.subarray(E>>3,(E>>3)+t).set(i),s.HEAPF64.subarray(w>>3,(w>>3)+t).set(a),s.HEAPF64.subarray(S>>3,(S>>3)+c).set(u),s.HEAPF64.subarray(L>>3,(L>>3)+c).set(d),s.applyChronologicalLayout(e,t,r,n,o,E,w,c,h,m,S,L,y,p(f))}finally{s._free(_),s._free(T),s._free(v),s._free(I)}}),t,r,n,o,c)}}(T||(T={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(v||(v={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(I||(I={}))},93333:function(e,t,r){r.d(t,{F:function(){return i},o:function(){return s}});var n=r(90756);function i(e){return{geometryType:(0,n.Ji)(e[0]),geometries:e.map((e=>e.toJSON()))}}function s(e,t,r){const i=(0,n.q9)(t);return e.map((e=>{const t=i.fromJSON(e);return t.spatialReference=r,t}))}},46024:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(73440),i=r(17155),s=(r(61432),r(96711),r(83850),r(48023)),a=r(60508),o=r(28074);let l=class extends o.Z{constructor(e){super(e),this.layoutGeometry=null}};(0,n._)([(0,i.Cb)({type:a.Z,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,n._)([(0,s.j)("esri.rest.knowledgeGraph.Entity")],l)},28074:function(e,t,r){r.d(t,{Z:function(){return o}});var n=r(73440),i=r(17155),s=(r(61432),r(96711),r(83850),r(48023)),a=r(72869);let o=class extends a.Z{constructor(e){super(e),this.typeName=null,this.id=null}};(0,n._)([(0,i.Cb)({type:String,json:{write:!0}})],o.prototype,"typeName",void 0),(0,n._)([(0,i.Cb)({type:String,json:{write:!0}})],o.prototype,"id",void 0),o=(0,n._)([(0,s.j)("esri.rest.knowledgeGraph.GraphNamedObject")],o)},72869:function(e,t,r){r.d(t,{Z:function(){return o}});var n=r(73440),i=r(63255),s=r(17155),a=(r(61432),r(96711),r(83850),r(48023));let o=class extends i.Z{constructor(e){super(e),this.properties=null}};(0,n._)([(0,s.Cb)({json:{write:!0}})],o.prototype,"properties",void 0),o=(0,n._)([(0,a.j)("esri.rest.knowledgeGraph.GraphObject")],o)},42167:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(73440),i=r(17155),s=(r(61432),r(96711),r(83850),r(48023)),a=r(45213),o=r(70880);let l=class extends o.Z{constructor(e){super(e),this.openCypherQuery=""}};(0,n._)([(0,i.Cb)()],l.prototype,"openCypherQuery",void 0),l=(0,n._)([(0,s.j)("esri.rest.knowledgeGraph.GraphQuery")],l);let c=class extends l{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};(0,n._)([(0,i.Cb)()],c.prototype,"bindParameters",void 0),(0,n._)([(0,i.Cb)()],c.prototype,"bindGeometryQuantizationParameters",void 0),(0,n._)([(0,i.Cb)()],c.prototype,"outputQuantizationParameters",void 0),(0,n._)([(0,i.Cb)({type:a.Z})],c.prototype,"outputSpatialReference",void 0),(0,n._)([(0,i.Cb)()],c.prototype,"provenanceBehavior",void 0),c=(0,n._)([(0,s.j)("esri.rest.knowledgeGraph.GraphQueryStreaming")],c)},27065:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(73440),i=(r(96711),r(61432),r(83850),r(88194),r(48023)),s=r(72869);let a=class extends s.Z{constructor(e){super(e)}};a=(0,n._)([(0,i.j)("esri.rest.knowledgeGraph.ObjectValue")],a)},51337:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(73440),i=r(63255),s=r(17155),a=(r(61432),r(96711),r(83850),r(48023)),o=r(72869);let l=class extends i.Z{constructor(e){super(e),this.path=[]}};(0,n._)([(0,s.Cb)({type:[o.Z],json:{write:!0}})],l.prototype,"path",void 0),l=(0,n._)([(0,a.j)("esri.rest.knowledgeGraph.Path")],l)},26790:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(73440),i=r(17155),s=(r(61432),r(96711),r(83850),r(48023)),a=r(62197),o=r(28074);let l=class extends o.Z{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,n._)([(0,i.Cb)({type:String,json:{write:!0}})],l.prototype,"originId",void 0),(0,n._)([(0,i.Cb)({type:String,json:{write:!0}})],l.prototype,"destinationId",void 0),(0,n._)([(0,i.Cb)({type:a.Z,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,n._)([(0,s.j)("esri.rest.knowledgeGraph.Relationship")],l)},56545:function(e,t,r){r.d(t,{LP:function(){return d},cv:function(){return u},en:function(){return c},lA:function(){return l}});var n=r(81001),i=r(10218),s=r(28947),a=r(95490),o=r(82674);function l(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function c(e){return"string"==typeof e?(0,a.mN)(e):(0,s.d9)(e)}function u(e,t,r){const n={};for(const i in e){if("declaredClass"===i)continue;const s=e[i];if(null!=s&&"function"!=typeof s)if(Array.isArray(s))n[i]=s.map((e=>u(e)));else if("object"==typeof s)if(s.toJSON){const e=s.toJSON(r?.[i]);n[i]=t?e:JSON.stringify(e)}else n[i]=t?s:JSON.stringify(s);else n[i]=s}return n}async function d(e,t,s){const a=function(e,t){return e?t&&(0,o.rU)(e)?t:(0,o.Pi)(e)??i.id?.findCredential(e)?.token:null}(e,t);if(a)return a;!i.id&&n.default.request.useIdentity&&await r.e(39428).then(r.bind(r,39428));return(await i.id.getCredential(e,s))?.token}},26334:function(e,t,r){r.d(t,{g:function(){return s},s:function(){return a}});var n=r(1800),i=r(12816);async function s(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,r=await(0,i.ME)("esri/t9n/basemaps");return r[e]||r[t]}const a={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return(0,n.V)("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]}}},18177:function(e,t,r){r.d(t,{Qs:function(){return S},RH:function(){return E},Us:function(){return p},wZ:function(){return l},zb:function(){return u},zw:function(){return g}});var n=r(43254),i=r(61100),s=r(95490),a=r(8971),o=r(26334);function l(e,t){return e.allLayerViews.find((e=>e.uid===t))?.layer.parent===e.map?.basemap}let c;function u(e){return!!e?.baseLayers.concat(e.referenceLayers).some(d)}function d(e){if(y(e.url))return!0;if("vector-tile"===e.type)for(const t in e.sourceNameToSource){if(y(e.sourceNameToSource[t]?.sourceUrl))return!0}return!1}function p(e,t){if(null==t||null==e)return{spatialReference:null,updating:!1};if("not-loaded"===t.loadStatus)return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(0===t.baseLayers.length)return{spatialReference:null,updating:!1};const r=t.baseLayers.at(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const n=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?r.tileInfo?.spatialReference:r.spatialReference]).filter(Boolean),i=e.spatialReference;return i?{spatialReference:n.find((e=>i.equals(e)))??n[0]??null,updating:!1}:{spatialReference:n[0],updating:!1}}const h=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function y(e){if(!e)return!1;const t=new s.R9((0,s.hF)(e));return!!t.authority&&h.test(t.authority)}function f(e){return e?!e.loaded&&e.resourceInfo?_(e.resourceInfo.data):{baseLayers:m(e.baseLayers),referenceLayers:m(e.referenceLayers)}:null}function m(e){return(n.Z.isCollection(e)?e.toArray():e).map(g)}function g(e){return{type:e.type,effect:"effect"in e?e.effect:void 0,url:w("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:"map-image"!==e.type&&"wms"!==e.type||null==e.sublayers?void 0:e.sublayers?.map((e=>({id:e.id,visible:e.visible}))),activeLayerId:"wmts"===e.type?e.activeLayer?.id:void 0}}function b(e){return e.isReference||"ArcGISSceneServiceLayer"===e.layerType}function _(e){return e?{baseLayers:T((e.baseMapLayers??[]).filter((e=>!b(e)))),referenceLayers:T((e.baseMapLayers??[]).filter((e=>b(e))))}:null}function T(e){return e.map((e=>function(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;case"ArcGISSceneServiceLayer":t="scene";break;default:t="unknown"}return{type:t,effect:e.effect,url:w(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}(e)))}function v(e,t,r){return null!=e!=(null!=t)?"not-equal":e&&t?I(e.baseLayers,t.baseLayers)?I(e.referenceLayers,t.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function I(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!E(e[r],t[r]))return!1;return!0}function E(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(!(0,a.yQ)(e.effect,t.effect))return!1;if(null!=e.activeLayerId||null!=t.activeLayerId)return e.activeLayerId===t.activeLayerId;if(null!=e.sublayers||null!=t.sublayers){if(null==e.sublayers||null==t.sublayers||e.sublayers.length!==t.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const n=e.sublayers.at(r),i=t.sublayers.at(r);if(n?.id!==i?.id||n?.visible!==i?.visible)return!1}}return!0}function w(e){return e?(0,s.Fv)(e).replace(/^\s*https?:/i,"").toLowerCase():""}function S(e){if(!e)return null;const{thumbnailUrl:t}=e;if(t)return t;const r=function(e){if(c)return c(e);let t=null;const r=f(e),n=!r?.baseLayers.length;for(const e in o.s){const i=v(r,_(o.s[e]),{mustMatchReferences:n});if("equal"===i){t=e;break}"base-layers-equal"===i&&(t=e)}return t}(e);return r?o.s[r].thumbnailUrl:(0,i.ei)(e.baseLayers,L)}function L(e){return"portalItem"in e?e.portalItem?.thumbnailUrl:void 0}},99734:function(e,t,r){var n;r.d(t,{n:function(){return n}}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(n||(n={}))},50399:function(e,t,r){r.d(t,{G5:function(){return C},S0:function(){return R},T8:function(){return n},sq:function(){return M},z4:function(){return g}});var n,i=r(12818),s=(r(61432),r(96711)),a=r(61100),o=r(24498),l=r(63974),c=r(93568),u=r(90403),d=r(39355),p=r(32555),h=r(47641),y=r(97332),f=r(99734),m=r(78891);function g(){return new S.Scheduler}!function(e){e.RESOURCE_CONTROLLER_IMMEDIATE="immediate",e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.LOD_RENDERER="LoD renderer",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.OVERLAY_RENDERER="overlay renderer",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="clouds generator",e.MAPVIEW_FETCH_QUEUE="mapview fetch queue",e.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",e.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",e[e.NONE=0]="NONE",e[e.TEST_PRIO=1]="TEST_PRIO"}(n||(n={}));const b=new Map([[n.RESOURCE_CONTROLLER_IMMEDIATE,0],[n.RESOURCE_CONTROLLER,4],[n.SLIDE,0],[n.STREAM_DATA_LOADER,0],[n.ELEVATION_QUERY,0],[n.TERRAIN_SURFACE,1],[n.SURFACE_GEOMETRY_UPDATES,1],[n.LOD_RENDERER,2],[n.GRAPHICS_CORE,2],[n.I3S_CONTROLLER,2],[n.POINT_CLOUD_LAYER,2],[n.FEATURE_TILE_FETCHER,2],[n.CLOUDS_GENERATOR,2],[n.OVERLAY,4],[n.OVERLAY_RENDERER,4],[n.STAGE,4],[n.GRAPHICS_DECONFLICTOR,4],[n.FILTER_VISIBILITY,4],[n.SCALE_VISIBILITY,4],[n.FRUSTUM_VISIBILITY,4],[n.POINT_OF_INTEREST_FREQUENT,6],[n.POINT_OF_INTEREST_INFREQUENT,30],[n.LABELER,8],[n.FEATURE_QUERY_ENGINE,8],[n.FEATURE_TILE_TREE,16],[n.FEATURE_TILE_TREE_ACTIVE,0],[n.ELEVATION_ALIGNMENT,12],[n.ELEVATION_ALIGNMENT_SCENE,14],[n.TEXT_TEXTURE_ATLAS,12],[n.TEXTURE_UNLOAD,12],[n.LINE_OF_SIGHT_TOOL,16],[n.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[n.SNAPPING,0],[n.SHADOW_ACCUMULATOR,30],[n.MAPVIEW_FETCH_QUEUE,0],[n.MAPVIEW_LAYERVIEW_UPDATE,2],[n.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function _(e){return b.has(e)?b.get(e):"number"==typeof e?e:1}const T=(0,p.HA)(6.5),v=(0,p.HA)(1),I=(0,p.HA)(30),E=(0,p.HA)(1e3/30),w=(0,p.HA)(100);var S,L;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,d.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new o.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=f.n.INTERACTING,this._tasks=new l.Z,this._runQueue=new l.Z,this._load=0,this._idleStateCallbacks=new l.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,u.YP)((()=>y.Z.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),u.nn);for(const e of Object.keys(n))this.performanceInfo.tasks.set(n[e],new o.Z(n[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,a.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())})))}registerTask(e,r){const n=new t(this,e,r);return this._tasks.push(n),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new o.Z(e)),n}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),this.state===f.n.IDLE&&this._idleUpdatesStartFired&&r.idleBegin();const n=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){n._idleUpdatesStartFired&&(r.idleEnd(),n._state===f.n.IDLE&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==f.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}frame(e){this._startFrameTaskTimes();const t=this._updateBudget(e);if(t){const e=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-e)}else this._recordFrameTaskTimes(0);return t}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=T,r=e.frameDuration,n=v;switch(this.state){case f.n.IDLE:t=(0,p.HA)(0),r=(0,p.HA)(Math.max(w,e.frameDuration)),n=I;break;case f.n.INTERACTING:r=(0,p.HA)(Math.max(E,e.frameDuration));case f.n.ANIMATING:}return r=(0,p.HA)(r-e.elapsedFrameTime-t),this.state!==f.n.IDLE&&r<v&&!this._forceTask?(this._forceTask=!0,!1):(r=(0,p.HA)(Math.max(r,n)),this._budget.reset(r),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case f.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case f.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset((0,p.HA)(0)),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return L.SCHEDULED;let t=L.IDLE;return this._tasks.forAll((r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t=L.READY:t!==L.READY&&(t=L.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((r=>{r.name===e&&(t+=r.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do{for(;this._runQueue.length>0;){const e=this._budget.now(),t=this._runQueue.pop();this._budget.resetProgress();try{t.task.runTask(this._budget)===m.J&&(t.blockFrame=this._frameNumber)}catch(e){s.Z.getLogger("esri.views.support.Scheduler").error(`Exception in task "${t.name}"`,e),t.blockFrame=this._frameNumber}!this._budget.hasProgressed&&t.blockFrame!==this._frameNumber&&t.needsUpdate&&(t.name,n.I3S_CONTROLLER,t.blockFrame=this._frameNumber),t.schedulePriority=t.basePriority;const r=this._budget.now()-e;if(t.runtime+=r,this._frameTaskTimes.set(t.priority,this._frameTaskTimes.get(t.priority)+r),this._budget.remaining<=0)return void this._updatingChanged()}}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const e of Object.keys(n))this._frameTaskTimes.set(n[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).push(e))),this.performanceInfo.total.push(e)}get test(){return this._test}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,r){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new h.b,this._handles=new i.Z,this._basePriority=_(t),this.schedulePriority=this._basePriority,this._task=(0,d.t)(null!=r?r:this._queue),this._handles.add((0,u.gx)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(C),this._scheduler.removeTask(this),this.schedule=M.schedule,this.reschedule=M.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=_(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class r{constructor(){this._begin=performance?.now()??0,this._budget=0,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e){this._begin=this.now(),this._budget=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=r}(S||(S={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(L||(L={}));const C=new S.Budget;function R(e){const t=new S.Budget;return t.reset(e),t}C.enabled=!1;const M=new class{remove(){}processQueue(){}schedule(e,t,r){try{if((0,c.Hc)(t)){const e=(0,c.zE)();return r?Promise.resolve(r(e)):Promise.reject(e)}return(0,c.gx)(e(C))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}}},78891:function(e,t,r){r.d(t,{J:function(){return n}});const n=Symbol("Yield")},97332:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(73440),i=r(70880),s=r(17155),a=(r(61432),r(96711),r(83850),r(48023));let o=class extends i.Z{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,n._)([(0,s.Cb)()],o.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,n._)([(0,s.Cb)()],o.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o=(0,n._)([(0,a.j)("esri.views.support.debugFlags")],o);const l=new o}}]);