"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[72623,71618],{90757:function(e,t,n){function i(e,t,n){return{objectId:e,target:t,distance:n,type:"vertex"}}function r(e,t,n,i,r,a=!1){return{objectId:e,target:t,distance:n,type:"edge",start:i,end:r,draped:a}}n.d(t,{p:function(){return r},u:function(){return i}})},56216:function(e,t,n){n.d(t,{Kb:function(){return o},o2:function(){return c},sV:function(){return l},xn:function(){return s}});var i=n(53147),r=n(47747),a=n(71618);function o(e,t){const n=function(e,t){if(null!=e.symbol)return e.symbol;const n=t?.renderer;return null!=n&&"dot-density"!==n.type?n.getSymbol(e,t):null}(e,t);if(null==n)return null;const i=t?.renderer,o=new r.E(i,n);if(null==i||!("visualVariables"in i)||!i.visualVariables)return o;const s=(0,a.getVisualVariableValues)(i,e,t)??[],l=["proportional","proportional","proportional"];for(const{variable:e,value:t}of s)if(null!=t||"size"===e.type&&e.useSymbolValue)switch(e.type){case"color":o.color=t?.toRgba();break;case"size":if("outline"===e.target)o.outlineSize=t;else{const n=e.axis,i=e.useSymbolValue?"symbol-value":t??"proportional";switch(n){case"width":l[0]=i;break;case"depth":l[1]=i;break;case"height":l[2]=i;break;case"width-and-depth":l[0]=l[1]=i;break;default:l[0]=l[1]=l[2]=i}}break;case"opacity":o.opacity=t;break;case"rotation":switch(e.axis){case"tilt":o.tilt=t;break;case"roll":o.roll=t;break;default:o.heading=t}}return"proportional"===l[0]&&"proportional"===l[1]&&"proportional"===l[2]||(o.size=l),o}async function s(e,t){const n=await async function(e,t){return null!=e.symbol?e.symbol:t?.renderer?.getSymbolAsync(e,t)??null}(e,t);if(!n)return null;const o=t?.renderer,s=new r.E(o,n);if(!o||!("visualVariables"in o)||!o.visualVariables)return s;const l=(0,a.getVisualVariableValues)(o,e,t)??[],c=["proportional","proportional","proportional"];for(const{variable:e,value:t}of l)if("color"===e.type)s.color=i.Z.toUnitRGBA(t);else if("size"===e.type)if("outline"===e.target)s.outlineSize=t;else{const n=e.axis,i=e.useSymbolValue?"symbol-value":t;"width"===n?c[0]=i:"depth"===n?c[1]=i:"height"===n?c[2]=i:c[0]=c[1]="width-and-depth"===n?i:c[2]=i}else"opacity"===e.type?s.opacity=t:"rotation"===e.type&&"tilt"===e.axis?s.tilt=t:"rotation"===e.type&&"roll"===e.axis?s.roll=t:"rotation"===e.type&&(s.heading=t);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(s.size=c),s}function l(e,t=0){const n=e[t];return"number"==typeof n&&isFinite(n)?n:null}function c(e){for(let t=0;t<3;t++){const n=e[t];if("number"==typeof n)return isFinite(n)?n:0}return 0}},18881:function(e,t,n){var i,r;function a(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function o(e){return null!=e&&!isNaN(e)&&isFinite(e)}function s(e){return e.valueExpression?i.Expression:e.field&&"string"==typeof e.field?i.Field:i.Unknown}function l(e,t){const n=t||s(e),a=e.valueUnit||"unknown";return n===i.Unknown?r.Constant:e.stops?r.Stops:null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?r.ClampedLinear:"unknown"===a?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?r.Proportional:r.Additive:r.Identity:r.RealWorldSize}n.d(t,{PS:function(){return s},QW:function(){return l},RY:function(){return i},hL:function(){return r},iY:function(){return a},qh:function(){return o}}),function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"}(i||(i={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(r||(r={}))},71618:function(e,t,n){n.r(t),n.d(t,{getAllSizes:function(){return R},getColor:function(){return g},getOpacity:function(){return b},getRotationAngle:function(){return m},getSize:function(){return y},getSizeForValue:function(){return w},getSizeFromNumberOrVariable:function(){return v},getSizeRangeAtScale:function(){return x},getVisualVariableValues:function(){return V},viewScaleRE:function(){return f}});var i=n(53147),r=n(46451),a=n(79487),o=n(96711),s=n(4207),l=n(18881);const c=()=>o.Z.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),u=e=>c().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),p=()=>c().error("Use of arcade expressions requires an arcade context"),h=new r.Z,d=Math.PI,f=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function g(e,t,n){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!r)return;if("esri.renderers.visualVariables.ColorVariable"!==r.declaredClass)return void u("ColorVariable");const a="number"==typeof t,o=a?null:t,s=o?.attributes;let c=a?t:null;const h=r.field,{ipData:d,hasExpression:f}=r.cache;let g=r.cache.compiledFunc;if(!h&&!f){const e=r.stops;return e&&e[0]&&e[0].color}if("number"!=typeof c)if(f){if(null==n?.arcade)return void p();const e={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},t=n.arcade.arcadeUtils,i=t.getViewInfo(e),a=t.createExecContext(o,i,n.timeZone);if(!g){const e=t.createSyntaxTree(r.valueExpression);g=t.createFunction(e),r.cache.compiledFunc=g}c=t.executeFunction(g,a)}else s&&(c=s[h]);const b=r.normalizationField,m=null!=s&&null!=b?parseFloat(s[b]):void 0;if(null!=c&&(!b||a||!isNaN(m)&&0!==m)){(0,l.qh)(m)&&!a&&(c/=m);const e=E(c,d);if(e){const t=e[0],a=e[1],o=t===a?r.stops[t].color:i.Z.blendColors(r.stops[t].color,r.stops[a].color,e[2],null!=n?n.color:void 0);return new i.Z(o)}}}function b(e,t,n){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.OpacityVariable"!==i.declaredClass)return void u("OpacityVariable");const r="number"==typeof t,a=r?null:t,o=a?.attributes;let s=r?t:null;const c=i.field,{ipData:h,hasExpression:d}=i.cache;let f=i.cache.compiledFunc;if(!c&&!d){const e=i.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof s)if(d){if(null==n?.arcade)return void p();const e={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},t=n.arcade.arcadeUtils,r=t.getViewInfo(e),o=t.createExecContext(a,r,n.timeZone);if(!f){const e=t.createSyntaxTree(i.valueExpression);f=t.createFunction(e),i.cache.compiledFunc=f}s=t.executeFunction(f,o)}else o&&(s=o[c]);const g=i.normalizationField,b=null!=o&&null!=g?parseFloat(o[g]):void 0;if(null!=s&&(!g||r||!isNaN(b)&&0!==b)){(0,l.qh)(b)&&!r&&(s/=b);const e=E(s,h);if(e){const t=e[0],n=e[1];if(t===n)return i.stops[t].opacity;{const r=i.stops[t].opacity;return r+(i.stops[n].opacity-r)*e[2]}}}}function m(e,t,n){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.RotationVariable"!==i.declaredClass)return void u("RotationVariable");const r=i.axis||"heading",a="heading"===r&&"arithmetic"===i.rotationType?90:0,o="heading"===r&&"arithmetic"===i.rotationType?-1:1,s="number"==typeof t?null:t,l=s?.attributes,c=i.field,{hasExpression:h}=i.cache;let d=i.cache.compiledFunc,f=null;if(!c&&!h)return f;if(h){if(null==n?.arcade)return void p();const e={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},t=n.arcade.arcadeUtils,r=t.getViewInfo(e),a=t.createExecContext(s,r,n.timeZone);if(!d){const e=t.createSyntaxTree(i.valueExpression);d=t.createFunction(e),i.cache.compiledFunc=d}f=t.executeFunction(d,a)}else l&&(f=l[c]);return f="number"!=typeof f||isNaN(f)?null:a+o*f,f}function y(e,t,n){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.SizeVariable"!==i.declaredClass)return void u("SizeVariable");const r=w(function(e,t,n){const i="number"==typeof t,r=i?null:t,a=r?.attributes;let o=i?t:null;const{isScaleDriven:s}=e.cache;let c=e.cache.compiledFunc;if(s){const t=null!=n?n.scale:void 0,i=null!=n?n.view:void 0;o=null==t||"3d"===i?function(e){let t=null,n=null;const i=e.stops;return i?(t=i[0].value,n=i[i.length-1].value):(t=e.minDataValue||0,n=e.maxDataValue||0),(t+n)/2}(e):t}else if(!i)switch(e.inputValueType){case l.RY.Expression:{if(null==n?.arcade)return void p();const t={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},i=n.arcade.arcadeUtils,a=i.getViewInfo(t),s=i.createExecContext(r,a,n.timeZone);if(!c){const t=i.createSyntaxTree(e.valueExpression);c=i.createFunction(t),e.cache.compiledFunc=c}o=i.executeFunction(c,s);break}case l.RY.Field:a&&(o=a[e.field]);break;case l.RY.Unknown:o=null}if(!(0,l.qh)(o))return null;if(i||!e.normalizationField)return o;const u=a?parseFloat(a[e.normalizationField]):null;return(0,l.qh)(u)&&0!==u?o/u:null}(i,t,n),i,t,n,i.cache.ipData);return null==r||isNaN(r)?void 0:r}function v(e,t,n){return null==e?null:(0,l.iY)(e)?y(e,t,n):(0,l.qh)(e)?e:null}function S(e,t,n){return(0,l.qh)(n)&&e>n?n:(0,l.qh)(t)&&e<t?t:e}function w(e,t,n,i,r){switch(t.transformationType){case l.hL.Additive:return function(e,t,n,i){const r=v(t.minSize,n,i)||t.minDataValue;return null==e&&null==r?null:(e??0)+(r??0)}(e,t,n,i);case l.hL.Constant:return function(e,t,n){const i=e.stops;let r=i?.length&&i[0].size;return null==r&&(r=e.minSize),v(r,t,n)}(t,n,i);case l.hL.ClampedLinear:return function(e,t,n,i){const r=v(t.minSize,n,i);if(null==e)return r;const{minDataValue:a,maxDataValue:o}=t;if(null==a||null==o)return null;const s=(e-a)/(o-a),l=v(t.maxSize,n,i),c=null!=i?i.shape:void 0;if(e<=a)return r;if(e>=o)return l;if(null==r||null==l)return null;if("area"===t.scaleBy&&c){const e="circle"===c,t=e?d*(r/2)**2:r*r,n=t+s*((e?d*(l/2)**2:l*l)-t);return e?2*Math.sqrt(n/d):Math.sqrt(n)}return r+s*(l-r)}(e,t,n,i);case l.hL.Proportional:return function(e,t,n,i){const r=v(t.minSize,n,i);if(null==e||null==r)return r;const a=null!=i?i.shape:void 0,{minDataValue:o}=t;if(null==o)return null;const s=e/o,l=v(t.maxSize,n,i);let c=null;return c="circle"===a?2*Math.sqrt(s*(r/2)**2):"square"===a||"diamond"===a||"image"===a?Math.sqrt(s*r**2):s*r,S(c,r,l)}(e,t,n,i);case l.hL.Stops:return function(e,t,n,i,r){if(null==e)return null;const[a,o,s]=E(e,r);if(a===o)return v(t.stops?.[a].size,n,i);{const e=v(t.stops?.[a].size,n,i),r=v(t.stops?.[o].size,n,i);return null==e||null==r?null:e+(r-e)*s}}(e,t,n,i,r);case l.hL.RealWorldSize:return function(e,t,n,i){const r=(i?.resolution??1)*s.a[t.valueUnit],a=v(t.minSize,n,i),o=v(t.maxSize,n,i),{valueRepresentation:l}=t;if(null==e)return a;let c=null;return c="area"===l?2*Math.sqrt(e/d)/r:"radius"===l||"distance"===l?2*e/r:e/r,S(c,a,o)}(e,t,n,i);case l.hL.Identity:return e;case l.hL.Unknown:return null}}function x(e,t,n){const{isScaleDriven:i}=e.cache;if(!(i&&"3d"===n||t))return null;const r={scale:t,view:n};let a=v(e.minSize,h,r),o=v(e.maxSize,h,r);if(null!=a||null!=o){if(a>o){const e=o;o=a,a=e}return{minSize:a,maxSize:o}}}function V(e,t,n){if(!e.visualVariables)return;const i=[],r=[],a=[],o=[],s=[];for(const t of e.visualVariables)switch(t.type){case"color":r.push(t);break;case"opacity":a.push(t);break;case"rotation":s.push(t);break;case"size":o.push(t)}return r.forEach((e=>{const r=g(e,t,n);i.push({variable:e,value:r})})),a.forEach((e=>{const r=b(e,t,n);i.push({variable:e,value:r})})),s.forEach((e=>{const r=m(e,t,n);i.push({variable:e,value:r})})),o.forEach((e=>{const r=y(e,t,n);i.push({variable:e,value:r})})),i}function E(e,t){if(!t)return;let n=0,i=t.length-1;return t.some(((t,r)=>e<t?(i=r,!0):(n=r,!1))),[n,i,(e-t[n])/(t[i]-t[n])]}function R(e,t,n){const i=["proportional","proportional","proportional"];for(const r of e){const e=r.useSymbolValue?"symbol-value":y(r,t,n)??"proportional";switch(r.axis){case"width":i[0]=e;break;case"depth":i[1]=e;break;case"height":i[2]=e;break;case"width-and-depth":i[0]=e,i[1]=e;break;case"all":case void 0:case null:i[0]=e,i[1]=e,i[2]=e;break;default:(0,a.Bg)(r.axis)}}return i}},25276:function(e,t,n){n.d(t,{A:function(){return W},m:function(){return j}});var i=n(53147),r=(n(61432),n(88194)),a=n(28947),o=n(26636),s=n(38874),l=n(96373),c=n(30748),u=n(31865),p=n(10934),h=n(24910),d=n(82846),f=n(27583),g=n(74238),b=n(16447),m=n(60199),y=n(38766),v=n(2875),S=n(90757),w=n(56216),x=n(88331),V=n(56172),E=n(90210),R=n(63082),T=n(33474),z=n(36027),C=n(80606),I=n(67169),_=n(80300),U=n(27762),O=n(90494),D=n(59894),F=n(57716),P=n(81749),A=n(32420),L=n(25952),M=n(95786),k=n(72913),N=n(26475),B=n(52061),Z=n(35720),q=n(52964);const G=["polygon","extent"];class j extends T.k{constructor(e,t,n,i){super(e,t,n,i,function(e){return 1===(e.material?.color?.a??1)}(t)),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=(0,z.bh)(this._getSymbolSize());if(e)throw new r.Z("graphics3dextrudesymbollayer:invalid-size",e)}const e=this.symbolLayer,t=e?.material,n=t?.color,i=this._getCombinedOpacityAndColor(n),a=(0,d.nI)(i),o=i[3],s=this.needsDrivenTransparentPass,l=t?.emissive,c={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:a,ambient:a,opacity:o,drivenOpacity:s,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:e.castShadows,emissiveStrength:l?.strength??0,emissiveSource:x.V6.Color,offsetTransparentBackfaces:!0,normalType:F.r.Compressed},u=new Z.Gp(c,this._context);u.setParameters({cullFace:u.transparent?A.Vr.None:A.Vr.Back});const p=new Z.Gp({...c,cullFace:A.Vr.Back},this._context);this._materials[ge.Main]=u,this._materials[ge.Bottom]=p}destroy(){super.destroy(),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,G,this.symbolLayer.type))return null;const n=this._getVertexOpacityAndColor(e.renderingInfo,this._getFallbackOpacityAndColor(),255),i=this.setGraphicElevationContext(t);return this._createAs3DShape(t,e.renderingInfo,n,i,t.uid)}layerOpacityChanged(e,t){const n=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(n);this._materials[ge.Main]?.setParameters({opacity:i}),this._materials[ge.Bottom]?.setParameters({opacity:i});const r=this._getLayerOpacity();e?.forEach((e=>t(e)?.layerOpacityChanged(r,this._context.isAsync)))}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,E.B5)}slicePlaneEnabledChanged(e,t){return this._materials[ge.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[ge.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e?.forEach((e=>{const n=t(e);null!=n&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[ge.Main]?.setParameters(e),this._materials[ge.Bottom]?.setParameters(e),!0}_getExtrusionSize(e){let t;return t=e.size&&this._drivenProperties.size?(0,w.sV)(e.size,2)??0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters,t}applyRendererDiff(e,t){return this._drivenPropertiesChanged(t)?C.W.RecreateSymbol:C.W.RecreateGraphics}async queryForSnapping(e,t,n,i){const r=this._getExtrusionSize(n)*this._context.renderCoordsHelper.unitInMeters/(0,o._R)(t),{objectId:s,target:l}=e,c=(0,a.d9)(l);switch(c.z=(c.z??0)+r,e.type){case"edge":{const{start:t,end:n}=e,i=(0,a.d9)(t),o=(0,a.d9)(n);return i.z=(i.z??0)+r,o.z=(o.z??0)+r,[(0,S.p)(s,c,1/0,i,o)]}case"vertex":return[(0,S.u)(s,c,1/0),(0,S.p)(s,l,1/0,l,c)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,t,n,i,r){const a=(0,I.Nu)(e.geometry);if(null==a)return null;if(0===a.rings.length||!a.rings.some((e=>e.length>0)))return this._logGeometryValidationWarnings(a.rings,"rings","ExtrudeSymbol3DLayer"),null;const o=(0,D.VP)(a,this._context.elevationProvider,this._context.renderCoordsHelper,i);this._logGeometryCreationWarnings(o,a.rings,"rings","ExtrudeSymbol3DLayer");const f=(0,z.zE)(a);if(null==f)return null;const S=new Array,w=new Array,x=(0,b.Ue)(),T=(0,p.Ue)(),C=(0,d.Ue)(),F=this._context.renderCoordsHelper.viewingMode===V.JY.Global;F||this._context.renderCoordsHelper.worldUpAtPosition(null,C),(0,g.B)(a.spatialReference,[f.x,f.y,0],T,this._context.renderCoordsHelper.spatialReference);const P=(0,p.Ue)();(0,u.U_)(P,T);const A=(0,c.Ue)();(0,l.XL)(A,P);const{polygons:L,mapPositions:Z,position:q}=o,G=new Map,j=this._materials[ge.Main];for(const e of L){const i=e.count;if(this._context.clippingExtent&&((0,b.FY)(e.mapPositions,x),!(0,b.Zp)(x,this._context.clippingExtent)))continue;const a=(0,s.e)(e.mapPositions,e.holeIndices,3);if(0===a.length)continue;const o=a.length,l=6*i,c=(0,y.$z)(l+o),u=(0,y.$z)(o),p=(0,m.bg)(3*l),h=(0,m.bg)(3*l),d=(0,m.bg)(3*l),f=(0,m.bg)(l);W(q,Z,a,e,p,d,h,f,c,u,this._getExtrusionSize(t),C,F),(0,v.t)(p,p,P);const g=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerViewUid:this._context.layerViewUid}),V=new me(p,d,(0,k.nG)(h),f),E=H(j,c,c.length-u.length,V,n,g),R=i,z=i,I=2*e.count,_=new ye(R,z,I,o/3);re(E,_,T),G.set(E,_),S.push(E,H(this._materials[ge.Bottom],u,0,V,n,g)),w.push(V.heights)}if(0===S.length)return null;const Y=new N.T({geometries:S,layerViewUid:this._context.layerViewUid,graphicUid:r,isElevationSource:!0});Y.transformation=T;const $=(0,_.hM)(this.symbolLayer,{opacity:this._getLayerOpacity()}),J=$?new R.n(this._materials[ge.Main],$,this._context.slicePlaneEnabled):null,K=new R.z(this,Y,null,((e,t,n,i,r)=>function(e,t,n,i,r,a,o){const s=e.stageObject,l=s.geometries,c=l.length,d="absolute-height"!==t.mode;let f=0;const g=s.transformation,b=(0,u.iS)((0,p.Ue)(),g);for(let e=0;e<c;e+=2){const t=l[e];if(!(0,M.T)(t))continue;const c=t.getMutableAttribute(B.T.POSITION).data,u=a[e/2],p=new O.sb(t.mapPositions),m=c.length/3;let y=!1,v=0;{let e=0;for(let t=0;t<m;t++){ie[0]=c[e],ie[1]=c[e+1],ie[2]=c[e+2],i(p,se),d&&(v+=se.sampledElevation),U.h.TESTS_DISABLE_OPTIMIZATIONS?((0,h.i)(ae,p.array[p.offset],p.array[p.offset+1],se.z+u[e/3]),null!=n&&r.toRenderCoords(ae,n,ae),(0,h.t)(ae,ae,b)):((0,h.i)(ae,c[e],c[e+1],c[e+2]),(0,h.t)(ae,ae,g),r.setAltitude(ae,se.z+u[e/3]),(0,h.t)(ae,ae,b)),c[e]=ae[0],c[e+1]=ae[1],c[e+2]=ae[2];const t=ue/r.unitInMeters;(Math.abs(ie[0]-c[e])>=t||Math.abs(ie[1]-c[e+1])>=t||Math.abs(ie[2]-c[e+2])>=t)&&(y=!0),p.offset+=3,e+=3}}if(y){const n=o.get(t);n&&re(t,n,g),s.geometryVertexAttributeUpdated(l[e],B.T.NORMALCOMPRESSED),t.invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(l[e],B.T.POSITION),l[e+1].invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(l[e+1],B.T.POSITION)}f+=v/m}return f/c}(e,t,n,i,r,w,G)),i,J);return K.alignedSampledElevation=o.sampledElevation,K.needsElevationUpdates=(0,E.B5)(i.mode),K}_getFallbackOpacityAndColor(){const e=this.symbolLayer?.material?.color;return i.Z.toUnitRGBA(e)??f.AG}}function H(e,t,n,i,r,a){const o=(0,y.LE)(t.length),s=[[B.T.POSITION,new P.a(i.positions,t,3,!0)],[B.T.NORMALCOMPRESSED,new P.a(i.normals,t,2,!0)],[B.T.COLOR,new P.a(r,o,4,!0)]];return new L.Z(e,s,i.elevation,q.V.Mesh,a,n)}function W(e,t,n,i,r,a,o,s,l,c,u,p,d){const f=n.length/3;let g=2*i.count;!function(e,t,n,i,r,a,o,s,l,c,u,p,d,f,g,b,m){(0,h.c)(oe,b),l??=[],c??=[],u??=[];const y=g>0?1:-1;let v=3*n,S=0,w=3*S,x=i,V=3*x;for(let n=0;n<i;++n){const n=e[v],i=e[v+1],r=e[v+2];m&&(oe[0]=n,oe[1]=i,oe[2]=r,(0,h.n)(oe,oe)),s[w+0]=n,s[w+1]=i,s[w+2]=r;const a=t[v+0],o=t[v+1],p=t[v+2];l[w+0]=a,l[w+1]=o,l[w+2]=p,c[w+0]=-y*oe[0],c[w+1]=-y*oe[1],c[w+2]=-y*oe[2],u[S]=0,s[V+0]=n+g*oe[0],s[V+1]=i+g*oe[1],s[V+2]=r+g*oe[2],l[V+0]=a,l[V+1]=o,l[V+2]=p,u[x]=g,w+=3,V+=3,v+=3,S+=1,x+=1}v=3*a,w=0,V=3*f;const E=g<0?ce:le,R=g<0?le:ce;for(let e=0;e<o;++e)d[w]=r[v+E[0]],d[w+1]=r[v+E[1]],d[w+2]=r[v+E[2]],p[V]=r[v+R[0]]+i,p[V+1]=r[v+R[1]]+i,p[V+2]=r[v+R[2]]+i,w+=3,V+=3,v+=3}(e,t,i.index,i.count,n,0,f,r,a,o,s,l,c,g,u,p,d);let b=0,m=2*i.count;g=0;const y=i.pathLengths[0];J(r,a,s,o,b,y,i.count,m,l,g,u),m+=4*y,g+=2*y,b+=y;for(let e=1;e<i.pathLengths.length;++e){const t=i.pathLengths[e];J(r,a,s,o,b,t,i.count,m,l,g,u),m+=4*t,g+=2*t,b+=t}}function Y(e,t,n,i,r,a,o){i[a]=i[o],o*=3,e[a*=3]=e[o],e[a+1]=e[o+1],e[a+2]=e[o+2],t[a]=t[o],t[a+1]=t[o+1],t[a+2]=t[o+2],n[a]=r[0],n[a+1]=r[1],n[a+2]=r[2]}const $=(0,d.Ue)();function J(e,t,n,i,r,a,o,s,l,c,u){t??=[],n??=[],i??=[];let p=r,h=r+1,d=r+o,f=r+o+1,g=s,b=s+1,m=s+2*a,y=s+2*a+1;u<0&&(p=r+o+1,f=r);let v=3*c;for(let s=0;s<a;++s)s===a-1&&(h=r,u>0?f=r+o:p=r+o),ne(e,p,h,d,$),Y(e,t,i,n,$,g,p),Y(e,t,i,n,$,b,h),Y(e,t,i,n,$,m,d),Y(e,t,i,n,$,y,f),l[v]=g,l[v+1]=m,l[v+2]=y,l[v+3]=g,l[v+4]=y,l[v+5]=b,v+=6,p++,h++,d++,f++,g+=2,b+=2,m+=2,y+=2}const K=(0,d.Ue)(),Q=(0,d.Ue)(),X=(0,d.Ue)(),ee=(0,d.Ue)(),te=(0,d.Ue)();function ne(e,t,n,i,r){t*=3,n*=3,i*=3,(0,h.i)(K,e[t++],e[t++],e[t++]),(0,h.i)(Q,e[n++],e[n++],e[n++]),(0,h.i)(X,e[i++],e[i++],e[i++]),(0,h.d)(ee,Q,K),(0,h.d)(te,X,K),(0,h.h)(r,te,ee),(0,h.n)(r,r)}const ie=(0,d.Ue)();function re(e,t,n){const i=e.getMutableAttribute(B.T.POSITION),r=e.getMutableAttribute(B.T.NORMALCOMPRESSED).data,{topVertexStart:a,topVertexCount:o,topFaceStart:s,topFaceCount:l}=t,c=i.data,u=o,p=e.attributes.get(B.T.POSITION).indices,d=s+l,f=a+o,g=(0,m.bg)(3*u);for(let e=0;e<u;++e){const t=3*e;g[t+0]=0,g[t+1]=0,g[t+2]=0}const b=pe,y=he,v=de,S=fe,w=oe;for(let e=s;e<d;++e){const t=3*e;for(let e=0;e<3;++e){const i=p[t+e];S[e]=i;const r=3*i;(0,h.i)(ae,c[r+0],c[r+1],c[r+2]),(0,h.t)(b[e],ae,n)}(0,h.a)(y,b[1],b[0]),(0,h.a)(v,b[2],b[0]),(0,h.h)(w,y,v),(0,h.n)(w,w);for(let e=0;e<3;++e){const t=3*(S[e]-a);g[t+0]+=w[0],g[t+1]+=w[1],g[t+2]+=w[2]}}for(let e=a;e<f;++e){const t=3*(e-a),n=g[t+0],i=g[t+1],o=g[t+2],s=Math.sqrt(n*n+i*i+o*o);(0,k.hd)(r,e,n/s,i/s,o/s)}}const ae=(0,d.Ue)(),oe=(0,d.Ue)(),se=new E.Lm,le=[0,2,1],ce=[0,1,2],ue=.01,pe=[(0,d.Ue)(),(0,d.Ue)(),(0,d.Ue)()],he=(0,d.Ue)(),de=(0,d.Ue)(),fe=[0,0,0];var ge,be;(be=ge||(ge={}))[be.Main=0]="Main",be[be.Bottom=1]="Bottom";class me{constructor(e,t,n,i){this.positions=e,this.elevation=t,this.normals=n,this.heights=i}}class ye{constructor(e,t,n,i){this.topVertexStart=e,this.topVertexCount=t,this.topFaceStart=n,this.topFaceCount=i}}},67169:function(e,t,n){n.d(t,{JJ:function(){return m},LN:function(){return d},Nu:function(){return b},dd:function(){return g},z:function(){return f}});var i=n(38874),r=n(71354),a=n(67764),o=n(93070),s=n(38766),l=n(18344),c=n(81749),u=n(25952),p=n(52061),h=n(52964);function d(e,t,n){const r=(t.length>0?t[0]:e.length/3)-1,a=(0,l.i)(e,r,n);if(a!==o.R.Z){e=e.slice();for(let t=0;t<e.length;t+=3)e[t+a]=e[t+2]}return(0,i.e)(e,t,3)}function f(e){const t=[[p.T.POSITION,new c.a(e.attributeData.position,e.indices,3,!0)]],n=(0,s.LE)(e.indices.length);return null!=e.attributeData.colorFeature?t.push([p.T.COLORFEATUREATTRIBUTE,new c.a([e.attributeData.colorFeature],n,1,!0)]):e.attributeData.color&&t.push([p.T.COLOR,new c.a(e.attributeData.color,n,4,!0)]),e.attributeData.uvMapSpace&&t.push([p.T.UVMAPSPACE,new c.a(e.attributeData.uvMapSpace,e.indices,4,!0)]),e.attributeData.boundingRect&&t.push([p.T.BOUNDINGRECT,new c.a(e.attributeData.boundingRect,e.indices,9,!0)]),new u.Z(e.material,t,e.mapPositions,h.V.Mesh,e.attributeData.objectAndLayerIdColor)}function g(e,t=null){const n=[[p.T.POSITION,new c.a(e.attributeData.position,e.indices,3,!0)],[p.T.UV0,new c.a(e.attributeData.uv0,e.indices,2,!0)]];return new u.Z(e.material,n,e.mapPositions,h.V.Mesh,t)}function b(e){switch(e.type){case"extent":if(e instanceof r.Z)return a.Z.fromExtent(e);break;case"polygon":return e}return null}class m{constructor(e,t,n){this.renderData=e,this.layerViewUid=t,this.graphicUid=n,this.outGeometries=new Array}}},55277:function(e,t,n){n.d(t,{Y:function(){return b},c:function(){return v}});var i=n(26821),r=n(41788),a=n(27583),o=n(47925),s=n(8008),l=n(60199),c=n(39909),u=n(38766),p=n(56172),h=n(81749),d=n(25952),f=n(52061),g=n(52964);function b(e,t,n=null){const r=[],b=t.mapPositions;!function(e,t){const{attributeData:{position:n},removeDuplicateStartEnd:i}=e,r=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(n)&&i,a=n.length/3-(r?1:0),o=new Array(2*(a-1)),s=r?n.slice(0,-3):n;let l=0;for(let e=0;e<a-1;e++)o[l++]=e,o[l++]=e+1;t.push([f.T.POSITION,new h.a(s,o,3,r)])}(t,r);const v=r[0][1].data,S=r[0][1].indices.length,w=(0,u.LE)(S);return function(e,t,n){if(null!=e.attributeData.colorFeature)return;const i=e.attributeData.color;t.push([f.T.COLOR,new h.a(i??a.hq,n,4)])}(t,r,w),function(e,t,n){null==e.attributeData.sizeFeature&&t.push([f.T.SIZE,new h.a([e.attributeData.size??1],n,1,!0)])}(t,r,w),function(e,t,n){e.attributeData.normal&&t.push([f.T.NORMAL,new h.a(e.attributeData.normal,n,3)])}(t,r,w),function(e,t,n){null!=e.attributeData.colorFeature&&t.push([f.T.COLORFEATUREATTRIBUTE,new h.a([e.attributeData.colorFeature],n,1,!0)])}(t,r,w),function(e,t,n){null!=e.attributeData.sizeFeature&&t.push([f.T.SIZEFEATUREATTRIBUTE,new h.a([e.attributeData.sizeFeature],n,1,!0)])}(t,r,w),function(e,t,n){null!=e.attributeData.opacityFeature&&t.push([f.T.OPACITYFEATUREATTRIBUTE,new h.a([e.attributeData.opacityFeature],n,1,!0)])}(t,r,w),function(e,t,n){if(null==e.overlayInfo||e.overlayInfo.renderCoordsHelper.viewingMode!==p.JY.Global||!e.overlayInfo.spatialReference.isGeographic)return;const r=(0,l.bg)(n.length),a=(0,o.Iu)(e.overlayInfo.spatialReference);for(let e=0;e<r.length;e+=3)(0,s.gH)(n,e,r,e,a);const u=n.length/3,d=(0,c.xx)(u+1);let g=m,b=y,v=0,S=0;(0,i.t8)(g,r[S++],r[S++]),S++,d[0]=0;for(let e=1;e<u+1;++e)e===u&&(S=0),(0,i.t8)(b,r[S++],r[S++]),S++,v+=(0,i.TK)(g,b),d[e]=v,[g,b]=[b,g];t.push([f.T.DISTANCETOSTART,new h.a(d,t[0][1].indices,1,!0)])}(t,r,v),new d.Z(e,r,b,g.V.Line,n)}const m=(0,r.Ue)(),y=(0,r.Ue)();function v(e,t){if(null==e||0===e.length)return[];const n=[];return e.forEach((e=>{const i=e.length,r=(0,l.bg)(3*i);e.forEach(((e,t)=>{r[3*t]=e[0],r[3*t+1]=e[1],r[3*t+2]=e[2]}));const a={attributeData:{position:r,normal:t},removeDuplicateStartEnd:!1};n.push(a)})),n}},61324:function(e,t,n){n.d(t,{V:function(){return l},r:function(){return c}});var i=n(30146),r=n(60199),a=n(53328),o=n(90210),s=n(61471);function l(e,t,n,i){const s="polygon"===e.type?a.ZI.CCW_IS_HOLE:a.ZI.NONE,l="polygon"===e.type?e.rings:e.paths,{position:c,outlines:p}=(0,a.Ni)(l,!!e.hasZ,s,e.spatialReference),h=(0,r.bg)(c.length),d=(0,o.rR)(c,e.spatialReference,0,h,0,c,0,c.length/3,t,n,i),f=null!=d;return{lines:f?u(p,c,h):[],projectionSuccess:f,sampledElevation:d}}function c(e,t){const n="polygon"===e.type?a.ZI.CCW_IS_HOLE:a.ZI.NONE,r="polygon"===e.type?e.rings:e.paths,{position:o,outlines:l}=(0,a.Ni)(r,!1,n),c=(0,i.projectBuffer)(o,e.spatialReference,0,o,t,0);for(let e=2;e<o.length;e+=3)o[e]=s.gi;return{lines:c?u(l,o):[],projectionSuccess:c}}function u(e,t,n=null){const i=new Array;for(const{index:a,count:o}of e){if(o<=1)continue;const e=3*a,s=3*o;i.push({position:(0,r.Rq)(t,3*a,3*o),mapPositions:null!=n?(0,r.Rq)(n,e,s):void 0})}return i}},59894:function(e,t,n){n.d(t,{VP:function(){return l},rm:function(){return c}});var i=n(30146),r=n(60199),a=n(53328),o=n(90210),s=n(61471);function l(e,t,n,i){const s=(0,a.Ni)(e.rings,!!e.hasZ&&"on-the-ground"!==i.mode,a.ZI.CCW_IS_HOLE,e.spatialReference),l=(0,r.bg)(s.position.length),c=(0,o.rR)(s.position,e.spatialReference,0,l,0,s.position,0,s.position.length/3,t,n,i),h=null!=c;return new b(s.position,l,p(s.polygons,s.position,l),u(s.outlines,s.position,l),h,c)}function c(e,t){const n=(0,a.Ni)(e.rings,!1,a.ZI.CCW_IS_HOLE),r=(0,i.projectBuffer)(n.position,e.spatialReference,0,n.position,t,0);for(let e=2;e<n.position.length;e+=3)n.position[e]=s.gi;return{position:n.position,polygons:p(n.polygons,n.position),outlines:u(n.outlines,n.position),projectionSuccess:r}}function u(e,t,n=null){return e.filter((({count:e})=>e>1)).map((({index:e,count:i})=>{const a=3*e,o=3*i;return null!=n?new d(e,i,(0,r.Rq)(t,a,o),(0,r.Rq)(n,a,o)):new h(e,i,(0,r.Rq)(t,a,o))}))}function p(e,t,n=null){const i=new Array;for(const{index:a,count:o,holeIndices:s,pathLengths:l}of e){if(o<=1)continue;const e=3*a,c=3*o,u=s.map((e=>e-a)),p=null!=n?new f(a,o,(0,r.Rq)(t,3*a,3*o),(0,r.Rq)(n,e,c),u,l):new g(a,o,(0,r.Rq)(t,3*a,3*o),u,l);i.push(p)}return i}class h{constructor(e,t,n){this.index=e,this.count=t,this.position=n}}class d extends h{constructor(e,t,n,i){super(e,t,n),this.mapPositions=i}}class f extends d{constructor(e,t,n,i,r,a){super(e,t,n,i),this.holeIndices=r,this.pathLengths=a}}class g extends h{constructor(e,t,n,i,r){super(e,t,n),this.holeIndices=i,this.pathLengths=r}}class b{constructor(e,t,n,i,r,a){this.position=e,this.mapPositions=t,this.polygons=n,this.outlines=i,this.projectionSuccess=r,this.sampledElevation=a}}}}]);