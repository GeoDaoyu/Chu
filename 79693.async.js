"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[79693,76873,81066,70885],{75621:function(e,t,r){r.d(t,{F:function(){return l},a:function(){return d},b:function(){return h}});var s=r(17904),n=r(48857),i=r(20431),o=r(34709),a=r(26294),u=r(74826),c=r(15150);class l extends u.K{constructor(){super(...arguments),this.effect=a.j.BRIGHT}}function h(){const e=new c.kG;return e.include(s.k),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new o.A("colorTexture",(e=>e.color)),new o.A("focusArea",(e=>e.focusArea)),new i._("focusAreaEffectMode",(e=>e.effect))).main.add(n.H`
      float mask = texture( focusArea, uv, 0.0 ).r;
      vec4 color = texture( colorTexture, uv, 0.0 );
      vec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);
      if (focusAreaEffectMode == ${n.H.int(a.j.BRIGHT)}) {
        fragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;
      } else {
        fragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);
      }
  `),e}const d=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:l,build:h},Symbol.toStringTag,{value:"Module"}))},75342:function(e,t,r){r.d(t,{F:function(){return d},a:function(){return _},b:function(){return f}});var s=r(31865),n=r(10934),i=r(82846),o=r(48857),a=r(18489),u=r(10146),c=r(52061),l=r(74826),h=r(15150);class d extends l.K{constructor(){super(...arguments),this.origin=i.AG}}function f(){const e=new h.kG;return e.attributes.add(c.T.POSITION,"vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new a.C("proj",(e=>e.camera.projectionMatrix)),new u.K("view",((e,t)=>(0,s.Iu)(p,t.camera.viewMatrix,e.origin)))).main.add(o.H`gl_Position = proj * view * vec4(position, 1.0);
gl_Position.z = min(gl_Position.z, gl_Position.w);`),e.fragment.main.add(o.H`fragColor = vec4(1., 0., 0., 0.);`),e}const p=(0,n.Ue)(),_=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskDrawParameters:d,build:f},Symbol.toStringTag,{value:"Module"}))},81066:function(e,t,r){r.d(t,{G:function(){return s},S:function(){return n}});class s{*[Symbol.iterator](){let e=this.next();for(;e;)yield e,e=this.next()}}class n extends s{constructor(e){super(),this.m_iGeom=-1,this.m_aGeoms=e?e.slice():[]}next(){if(this.m_iGeom<this.m_aGeoms.length-1){const e=this.m_aGeoms[++this.m_iGeom];return this.m_aGeoms[this.m_iGeom]=null,e}return null}tock(){return!1}getGeometryID(){return this.m_iGeom}getRank(){return 1}}},38874:function(e,t,r){function s(e,t,r){r=r||2;var s,i,a,u,c,l,d,f=t&&t.length,p=f?t[0]*r:e.length,_=n(e,0,p,r,!0),y=[];if(!_||_.next===_.prev)return y;if(f&&(_=h(e,t,_,r)),e.length>80*r){s=a=e[0],i=u=e[1];for(var m=r;m<p;m+=r)(c=e[m])<s&&(s=c),(l=e[m+1])<i&&(i=l),c>a&&(a=c),l>u&&(u=l);d=0!==(d=Math.max(a-s,u-i))?1/d:0}return o(_,y,r,s,i,d),y}function n(e,t,r,s,n){var i,o;if(n===S(e,t,r,s)>0)for(i=t;i<r;i+=s)o=M(i,e[i],e[i+1],o);else for(i=r-s;i>=t;i-=s)o=M(i,e[i],e[i+1],o);if(o&&R(o,o.next)){var a=o.next;O(o),o=a}return o}function i(e,t){if(!e)return e;t||(t=e);var r,s=e;do{if(r=!1,s.steiner||!R(s,s.next)&&0!==w(s.prev,s,s.next))s=s.next;else{var n=s.prev;if(O(s),(s=t=n)===s.next)break;r=!0}}while(r||s!==t);return t}function o(e,t,r,s,n,h,d){if(e){!d&&h&&y(e,s,n,h);for(var f,p,_=e;e.prev!==e.next;)if(f=e.prev,p=e.next,h?u(e,s,n,h):a(e))t.push(f.i/r),t.push(e.i/r),t.push(p.i/r),O(e),e=p.next,_=p.next;else if((e=p)===_){d?1===d?o(e=c(i(e),t,r),t,r,s,n,h,2):2===d&&l(e,t,r,s,n,h):o(i(e),t,r,s,n,h,1);break}}}function a(e){var t=e.prev,r=e,s=e.next;if(w(t,r,s)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(g(t.x,t.y,r.x,r.y,s.x,s.y,n.x,n.y)&&w(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function u(e,t,r,s){var n=e.prev,i=e,o=e.next;if(w(n,i,o)>=0)return!1;for(var a=n.x<i.x?n.x<o.x?n.x:o.x:i.x<o.x?i.x:o.x,u=n.y<i.y?n.y<o.y?n.y:o.y:i.y<o.y?i.y:o.y,c=n.x>i.x?n.x>o.x?n.x:o.x:i.x>o.x?i.x:o.x,l=n.y>i.y?n.y>o.y?n.y:o.y:i.y>o.y?i.y:o.y,h=m(a,u,t,r,s),d=m(c,l,t,r,s),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&g(n.x,n.y,i.x,i.y,o.x,o.y,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&g(n.x,n.y,i.x,i.y,o.x,o.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&g(n.x,n.y,i.x,i.y,o.x,o.y,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&g(n.x,n.y,i.x,i.y,o.x,o.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function c(e,t,r){var s=e;do{var n=s.prev,o=s.next.next;!R(n,o)&&b(n,s,s.next,o)&&E(n,o)&&E(o,n)&&(t.push(n.i/r),t.push(s.i/r),t.push(o.i/r),O(s),O(s.next),s=e=o),s=s.next}while(s!==e);return i(s)}function l(e,t,r,s,n,a){var u=e;do{for(var c=u.next.next;c!==u.prev;){if(u.i!==c.i&&v(u,c)){var l=G(u,c);return u=i(u,u.next),l=i(l,l.next),o(u,t,r,s,n,a),void o(l,t,r,s,n,a)}c=c.next}u=u.next}while(u!==e)}function h(e,t,r,s){var o,a,u,c=[];for(o=0,a=t.length;o<a;o++)(u=n(e,t[o]*s,o<a-1?t[o+1]*s:e.length,s,!1))===u.next&&(u.steiner=!0),c.push(x(u));for(c.sort(d),o=0;o<c.length;o++)r=i(r=p(c[o],r),r.next);return r}function d(e,t){return e.x-t.x}function f(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function p(e,t){var r=function(e,t){var r,s=t,n=e.x,i=e.y,o=-1/0;do{if(i<=s.y&&i>=s.next.y&&s.next.y!==s.y){var a=s.x+(i-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(a<=n&&a>o){if(o=a,a===n){if(i===s.y)return s;if(i===s.next.y)return s.next}r=s.x<s.next.x?s:s.next}}s=s.next}while(s!==t);if(!r)return null;if(n===o)return r;var u,c=r,l=r.x,h=r.y,d=1/0;s=r;do{n>=s.x&&s.x>=l&&n!==s.x&&g(i<h?n:o,i,l,h,i<h?o:n,i,s.x,s.y)&&(u=Math.abs(i-s.y)/(n-s.x),E(s,e)&&(u<d||u===d&&(s.x>r.x||s.x===r.x&&_(r,s)))&&(r=s,d=u)),s=s.next}while(s!==c);return r}(e,t);if(!r)return t;var s=G(r,e),n=i(r,r.next);let o=f(s);return i(o,o.next),n=f(n),f(t===r?n:t)}function _(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function y(e,t,r,s){var n=e;do{null===n.z&&(n.z=m(n.x,n.y,t,r,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,s,n,i,o,a,u,c=1;do{for(r=e,e=null,i=null,o=0;r;){for(o++,s=r,a=0,t=0;t<c&&(a++,s=s.nextZ);t++);for(u=c;a>0||u>0&&s;)0!==a&&(0===u||!s||r.z<=s.z)?(n=r,r=r.nextZ,a--):(n=s,s=s.nextZ,u--),i?i.nextZ=n:e=n,n.prevZ=i,i=n;r=s}i.nextZ=null,c*=2}while(o>1)}(n)}function m(e,t,r,s,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function x(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function g(e,t,r,s,n,i,o,a){return(n-o)*(t-a)-(e-o)*(i-a)>=0&&(e-o)*(s-a)-(r-o)*(t-a)>=0&&(r-o)*(i-a)-(n-o)*(s-a)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&b(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(E(e,t)&&E(t,e)&&function(e,t){var r=e,s=!1,n=(e.x+t.x)/2,i=(e.y+t.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&n<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(s=!s),r=r.next}while(r!==e);return s}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||R(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function R(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,r,s){var n=A(w(e,t,r)),i=A(w(e,t,s)),o=A(w(r,s,e)),a=A(w(r,s,t));return n!==i&&o!==a||!(0!==n||!C(e,r,t))||!(0!==i||!C(e,s,t))||!(0!==o||!C(r,e,s))||!(0!==a||!C(r,t,s))}function C(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function A(e){return e>0?1:e<0?-1:0}function E(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function G(e,t){var r=new P(e.i,e.x,e.y),s=new P(t.i,t.x,t.y),n=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,s.next=r,r.prev=s,i.next=s,s.prev=i,s}function M(e,t,r,s){var n=new P(e,t,r);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function O(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function P(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(e,t,r,s){for(var n=0,i=t,o=r-s;i<r;i+=s)n+=(e[o]-e[i])*(e[i+1]+e[o+1]),o=i;return n}r.d(t,{e:function(){return s}}),s.deviation=function(e,t,r,s){var n=t&&t.length,i=n?t[0]*r:e.length,o=Math.abs(S(e,0,i,r));if(n)for(var a=0,u=t.length;a<u;a++){var c=t[a]*r,l=a<u-1?t[a+1]*r:e.length;o-=Math.abs(S(e,c,l,r))}var h=0;for(a=0;a<s.length;a+=3){var d=s[a]*r,f=s[a+1]*r,p=s[a+2]*r;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},s.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},s=0,n=0;n<e.length;n++){for(var i=0;i<e[n].length;i++)for(var o=0;o<t;o++)r.vertices.push(e[n][i][o]);n>0&&(s+=e[n-1].length,r.holes.push(s))}return r}},40562:function(e,t,r){r.d(t,{XR:function(){return o},dE:function(){return a},ht:function(){return i}});var s=r(81066);const n=new(r(95016).O);function i(e,t,r,s){return n.execute(e,t,r,s,null)}function o(e,t,r,i){const o=n.executeMany(new s.S(e),t,r,i,null);return Array.from(o)}function a(){return n.supportsCurves()}},11879:function(e,t,r){r.d(t,{OA:function(){return u},XR:function(){return a},dE:function(){return c},ht:function(){return o}});var s=r(81066),n=(r(10057),r(11894),r(65513));r(60988);const i=new n.O;function o(e,t,r){return i.execute(e,t,r,null)}function a(e,t,r){const n=i.executeMany(new s.S(e),t,r,null);return Array.from(n)}function u(e,t,r){return i.isSimpleAsFeature(e,t,r,null,null)}function c(){return i.supportsCurves()}},70885:function(e,t,r){r.r(t),r.d(t,{fromExtent:function(){return m},fromGeometry:function(){return y},fromMultipoint:function(){return x},fromPoint:function(){return g},fromPolygon:function(){return v},fromPolyline:function(){return w},fromSpatialReference:function(){return R},getSpatialReference:function(){return _},toExtent:function(){return C},toGeometry:function(){return b},toMultipoint:function(){return A},toPoint:function(){return E},toPolygon:function(){return G},toPolyline:function(){return M}});var s=r(9519),n=(r(64699),r(10057)),i=r(60988),o=r(11894),a=r(65513),u=r(71354),c=r(82868),l=r(60508),h=r(67764),d=r(62197),f=(r(77245),r(56870));const p="_gxVersion";function _(e){return Array.isArray(e)?e[0].spatialReference:e.spatialReference}function y(e){switch(e.type){case"point":return g(e);case"multipoint":return x(e);case"polyline":return w(e);case"polygon":return v(e);case"extent":return m(e);default:throw new Error(`Unsupported geometry type: ${e.type}`)}}function m(e){if(!e.getCacheValue(p)){const t=new i.E;t.setCoords(e.xmin,e.ymin,e.xmax,e.ymax),e.hasM&&t.setInterval(2,0,e.mmin,e.mmax),e.hasZ&&t.setInterval(1,0,e.zmin,e.zmax),e.setCacheValue(p,t)}return e.getCacheValue(p)}function x(e){if(!e.getCacheValue(p)){const t=new o.M,r=new i.P,s=e.points,n=e.hasM,a=e.hasZ,u=a?3:2;for(let e=0,i=s.length;e<i;e++){const i=s[e];r.setXYCoords(i[0],i[1]),a&&r.setZ(i[2]??0),n&&r.setM(i[u]??NaN),t.add(r)}e.setCacheValue(p,t)}return e.getCacheValue(p)}function g(e){if(!e.getCacheValue(p)){const t=new i.P;t.setXYCoords(e.x,e.y),e.hasM&&t.setM(e.m),e.hasZ&&t.setZ(e.z),e.setCacheValue(p,t)}return e.getCacheValue(p)}function v(e){if(!e.getCacheValue(p)){const{curveRings:t,hasM:r,hasZ:s,rings:n}=e,i=(0,f.fromGeometryToGXGeometry)({curveRings:t,hasM:r,hasZ:s,rings:n});e.setCacheValue(p,i)}return e.getCacheValue(p)}function w(e){if(!e.getCacheValue(p)){const{curvePaths:t,hasM:r,hasZ:s,paths:n}=e,i=(0,f.fromGeometryToGXGeometry)({curvePaths:t,hasM:r,hasZ:s,paths:n});e.setCacheValue(p,i)}return e.getCacheValue(p)}function R(e){if(e.wkid)return(0,a.c)(e.wkid);const t=e.wkt2||e.wkt;return t?(0,a.a)(t):null}function b(e,t){if(e)switch(e.getGeometryType()){case n.G.enumPoint:return E(e,t);case n.G.enumEnvelope:return C(e,t);case n.G.enumMultiPoint:return A(e,t);case n.G.enumPolyline:return M(e,t);case n.G.enumPolygon:return G(e,t)}return null}function C(e,t){if(e.isEmpty())return null;const r=new u.Z({xmin:e.getXMin(),ymin:e.getYMin(),xmax:e.getXMax(),ymax:e.getYMax(),spatialReference:t}),s=e.getDescription();if(s.hasM()){const t=e.queryInterval(2,0);r.mmin=t.vmin,r.mmax=t.vmax}if(s.hasZ()){const t=e.queryInterval(1,0);r.zmin=t.vmin,r.zmax=t.vmax}return r.setCacheValue(p,e),r}function A(e,t){if(e.isEmpty())return null;const r=e.getDescription(),s=r.hasM(),n=r.hasZ(),o=[],a=new i.P;for(let t=0,r=e.getPointCount();t<r;t++){e.getPointByVal(t,a);const r=[a.getX(),a.getY()];n&&r.push(a.getZ()),s&&r.push(a.getM()),o.push(r)}const u=new c.Z({hasM:s,hasZ:n,points:o,spatialReference:t});return u.setCacheValue(p,e),u}function E(e,t){if(e instanceof s.P)return new l.Z({x:e.x,y:e.y,spatialReference:t});if(e.isEmpty())return null;const r=new l.Z({x:e.getX(),y:e.getY(),spatialReference:t}),n=e.getDescription();return n.hasM()&&(r.m=e.getM()),n.hasZ()&&(r.z=e.getZ()),r.setCacheValue(p,e),r}function G(e,t){if(e.isEmpty())return null;const r=h.Z.fromJSON({spatialReference:t,...(0,f.toGeometry)(e,null)});return r.setCacheValue(p,e),r}function M(e,t){if(e.isEmpty())return null;const r=d.Z.fromJSON({spatialReference:t,...(0,f.toGeometry)(e,null)});return r.setCacheValue(p,e),r}},66040:function(e,t,r){r.d(t,{d:function(){return i}});var s=r(99574),n=r(38766);function i(e,t,r){const i=Array.isArray(e),l=i?e.length/t:e.byteLength/(4*t),h=i?e:new Uint32Array(e,0,l*t),d=r?.minReduction??0,f=r?.originalIndices||null,p=f?f.length:0,_=r?.componentOffsets||null;let y=0;if(_)for(let e=0;e<_.length-1;e++){const t=_[e+1]-_[e];t>y&&(y=t)}else y=l;const m=Math.floor(1.1*y)+1;(null==c||c.length<2*m)&&(c=new Uint32Array((0,s.Sf)(2*m)));for(let e=0;e<2*m;e++)c[e]=0;let x=0;const g=!!_&&!!f,v=g?p:l;let w=(0,n.$z)(l);const R=new Uint32Array(p),b=1.96;let C=0!==d?Math.ceil(4*b*b/(d*d)*d*(1-d)):v,A=1,E=_?_[1]:v;for(let e=0;e<v;e++){if(e===C){const t=1-x/e;if(t+b*Math.sqrt(t*(1-t)/e)<d)return null;C*=2}if(e===E){for(let e=0;e<2*m;e++)c[e]=0;if(f)for(let e=_[A-1];e<_[A];e++)R[e]=w[f[e]];E=_[++A]}const r=g?f[e]:e,s=r*t,n=u(h,s,t);let i=n%m,a=x;for(;0!==c[2*i+1];){if(c[2*i]===n){const e=c[2*i+1]-1;if(o(h,s,e*t,t)){a=w[e];break}}i++,i>=m&&(i-=m)}a===x&&(c[2*i]=n,c[2*i+1]=r+1,x++),w[r]=a}if(0!==d&&1-x/l<d)return null;if(g){for(let e=_[A-1];e<R.length;e++)R[e]=w[f[e]];w=(0,n.UB)(R)}const G=i?new Array(x):new Uint32Array(x*t);x=0;for(let e=0;e<v;e++)w[e]===x&&(a(h,(g?f[e]:e)*t,G,x*t,t),x++);if(f&&!g){const e=new Uint32Array(p);for(let t=0;t<e.length;t++)e[t]=w[f[t]];w=(0,n.UB)(e)}return{buffer:Array.isArray(G)?G:G.buffer,indices:w,uniqueCount:x}}function o(e,t,r,s){for(let n=0;n<s;n++)if(e[t+n]!==e[r+n])return!1;return!0}function a(e,t,r,s,n){for(let i=0;i<n;i++)r[s+i]=e[t+i]}function u(e,t,r){let s=0;for(let n=0;n<r;n++)s=e[t+n]+s|0,s=s+(s<<11)+(s>>>2)|0;return s>>>0}let c=null},18344:function(e,t,r){r.d(t,{i:function(){return u}});var s=r(99574),n=r(26636),i=r(24910),o=r(93070),a=r(77773);function u(e,t,r){const u=function(e,t,r,s){const o=(e=>!Array.isArray(e[0]))(t)?(e,r)=>t[3*e+r]:(e,r)=>t[e][r],u=s?(0,n.c9)(s)/(0,n._R)(s):1;return(0,a.zu)(e,((e,t)=>(0,i.i)(e,o(t,0)*u,o(t,1)*u,o(t,2))),r)}(c,e,t,r)?(0,a.st)(c):[0,0,1];return Math.abs(u[2])>Math.cos((0,s.Vl)(80))?o.R.Z:Math.abs(u[1])>Math.abs(u[0])?o.R.Y:o.R.X}const c=(0,a.Ue)()},53328:function(e,t,r){r.d(t,{Ni:function(){return f},ZI:function(){return s},bT:function(){return d}});var s,n,i=r(38874),o=r(93070),a=r(28931),u=r(60199),c=r(38766),l=r(18344),h=r(66040);function d(e){const t=f(e.rings,e.hasZ,s.CCW_IS_HOLE,e.spatialReference),r=new Array;let n=0,o=0;for(const e of t.polygons){const s=e.count,a=e.index,l=(0,u.Rq)(t.position,3*a,3*s),h=e.holeIndices.map((e=>e-a)),d=(0,c.UB)((0,i.e)(l,h,3));r.push({position:l,faces:d}),n+=l.length,o+=d.length}const a=function(e,t,r){if(1===e.length)return e[0];const s=(0,u.bg)(t),n=new Array(r);let i=0,o=0,a=0;for(const t of e){for(let e=0;e<t.position.length;e++)s[i++]=t.position[e];for(const e of t.faces)n[o++]=e+a;a=i/3}return{position:s,faces:(0,c.UB)(n)}}(r,n,o),l=Array.isArray(a.position)?(0,h.d)(a.position,3,{originalIndices:a.faces}):(0,h.d)(a.position.buffer,6,{originalIndices:a.faces});return a.position=(0,u.QZ)(new Float64Array(l.buffer)),a.faces=l.indices,a}function f(e,t,r,n){const i=e.length,o=new Array(i),a=new Array(i),c=new Array(i);let l=0;for(let t=0;t<i;++t)l+=e[t].length;let h=0,d=0,f=0;const y=(0,u.bg)(3*l);let m=0;for(let u=i-1;u>=0;u--){const l=e[u],x=r===s.CCW_IS_HOLE&&_(l,t,n);if(x&&1!==i)o[h++]=l;else{let e=l.length;for(let t=0;t<h;++t)e+=o[t].length;const r={index:m,pathLengths:new Array(h+1),count:e,holeIndices:new Array(h)};r.pathLengths[0]=l.length,l.length>0&&(c[f++]={index:m,count:l.length}),m=x?p(l,l.length-1,-1,y,m,l.length,t):p(l,0,1,y,m,l.length,t);for(let e=0;e<h;++e){const s=o[e];r.holeIndices[e]=m,r.pathLengths[e+1]=s.length,s.length>0&&(c[f++]={index:m,count:s.length}),m=p(s,0,1,y,m,s.length,t)}h=0,r.count>0&&(a[d++]=r)}}for(let e=0;e<h;++e){const r=o[e];r.length>0&&(c[f++]={index:m,count:r.length}),m=p(r,0,1,y,m,r.length,t)}return a.length=d,c.length=f,{position:y,polygons:a,outlines:c}}function p(e,t,r,s,n,i,o){n*=3;for(let a=0;a<i;++a){const i=e[t];s[n++]=i[0],s[n++]=i[1],s[n++]=o&&i[2]?i[2]:0,t+=r}return n/3}function _(e,t,r){if(!t)return!(0,a.bu)(e);const s=e.length-1;switch((0,l.i)(e,s,r)){case o.R.X:return!(0,a.bu)(e,o.R.Y,o.R.Z);case o.R.Y:return!(0,a.bu)(e,o.R.X,o.R.Z);case o.R.Z:return!(0,a.bu)(e,o.R.X,o.R.Y)}}(n=s||(s={}))[n.NONE=0]="NONE",n[n.CCW_IS_HOLE=1]="CCW_IS_HOLE"},13689:function(e,t,r){r.d(t,{Z:function(){return g}});var s,n=r(73440),i=r(41773),o=r(63255),a=r(61100),u=r(17155),c=(r(61432),r(96711),r(83850),r(1194)),l=r(48023),h=r(29884),d=r(76554);let f=s=class extends o.Z{constructor(e){super(e)}async collectRequiredFields(e,t){return(0,d.io)(e,t,this.expression)}clone(){return new s({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};(0,n._)([(0,u.Cb)({type:String,json:{write:{isRequired:!0}}})],f.prototype,"expression",void 0),(0,n._)([(0,u.Cb)({type:String,json:{write:!0}})],f.prototype,"title",void 0),f=s=(0,n._)([(0,l.j)("esri.symbols.support.FeatureExpressionInfo")],f);const p=f;var _,y=r(46368);const m=(0,i.w)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),x=new i.X({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let g=class extends o.Z{static{_=this}constructor(e){super(e),this.featureExpressionInfo=void 0,this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e.expression?e:void 0:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,r,s){t[r]=e.write({},s),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):null!=e||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new _({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&(0,a._W)(this.featureExpressionInfo,e.featureExpressionInfo)}};(0,n._)([(0,u.Cb)({type:p,json:{write:!0}})],g.prototype,"featureExpressionInfo",void 0),(0,n._)([(0,c.r)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],g.prototype,"readFeatureExpressionInfo",null),(0,n._)([(0,h.c)("featureExpressionInfo",{featureExpressionInfo:{type:p},"featureExpression.value":{type:[0]}})],g.prototype,"writeFeatureExpressionInfo",null),(0,n._)([(0,u.Cb)({type:m.apiValues,nonNullable:!0,json:{type:m.jsonValues,read:m.read,write:{writer:m.write,isRequired:!0}}})],g.prototype,"mode",null),(0,n._)([(0,u.Cb)({type:Number,json:{write:!0}})],g.prototype,"offset",void 0),(0,n._)([(0,u.Cb)({type:y.f9,json:{type:String,read:x.read,write:x.write}})],g.prototype,"unit",null),g=_=(0,n._)([(0,l.j)("esri.symbols.support.ElevationInfo")],g)},27447:function(e,t,r){r.r(t),r.d(t,{FocusAreasView:function(){return ie}});var s=r(73440),n=r(70880),i=r(3480),o=r(43254),a=r(88194),u=r(96711),c=r(83986),l=r(61100),h=r(90403),d=r(26636),f=r(17155),p=(r(61432),r(48023)),_=r(38874),y=r(10934),m=r(82846),x=r(47925),g=r(60508),v=r(13132),w=r(40562),R=r(11879),b=r(70885),C=r(74238),A=r(60199),E=r(21414),G=r(38766),M=r(2875),O=r(56172),P=r(94290),S=r(25276),D=r(36027),Z=r(59894),I=(r(83850),r(26173)),T=r(52054),V=r(58257),j=r(29107),F=r(75621),k=r(51135);class N extends j.A{constructor(e,t){super(e,t,new V.J(F.a,(()=>r.e(97516).then(r.bind(r,97516)))))}initializePipeline(){return(0,k.sm)({colorWrite:k.gf})}}var z=r(26294),H=r(65650);let U=class extends T.Z{constructor(e){super({...e,view:e.focusAreasView.view}),this.consumes={required:[I.CM.FOCUSAREA_COLOR,I.CM.FOCUSAREA]},this.produces=I.CM.FOCUSAREA_COLOR,this._passParameters=new F.F}precompile(){this.techniques.precompile(N)}render(e){const t=this.techniques.get(N),r=e.find((({name:e})=>e===this.produces));if(!t.compiled)return this.requestRender(),r;const s=this.focusAreasView.style,n=this.bindParameters,i=n.camera,o=i.fullViewport[2],a=i.fullViewport[3],u=e.find((({name:e})=>e===I.CM.FOCUSAREA)),c=this.fboCache.acquire(o,a,this.produces),l=this.renderingContext;return l.bindFramebuffer(c.fbo),this._passParameters.color=r.getTexture(),this._passParameters.focusArea=u.getTexture(),this._passParameters.effect=q[s],l.bindTechnique(t,n,this._passParameters),l.screen.draw(),c.attachDepth(r.getAttachment(H.Lu)),c}};(0,s._)([(0,f.Cb)()],U.prototype,"consumes",void 0),(0,s._)([(0,f.Cb)()],U.prototype,"produces",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],U.prototype,"focusAreasView",void 0),U=(0,s._)([(0,p.j)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaColorNode")],U);const q={bright:z.j.BRIGHT,dark:z.j.DARK};var L=r(69371),W=r(75342);class Y extends j.A{constructor(e,t){super(e,t,new V.J(W.a,(()=>r.e(11348).then(r.bind(r,11348)))))}initializePipeline(){return(0,k.sm)({colorWrite:k.gf,depthTest:{func:H.wb.LEQUAL}})}}var B=r(75025),X=r(31214),K=r(32335),J=r(92761),$=r(74826);let Q=class extends T.Z{constructor(e){super({...e,view:e.focusAreasView.view}),this.consumes={required:[I.lu.TRANSPARENT]},this.produces=I.CM.FOCUSAREA,this._vaos=new Array,this._counts=new Array,this._origins=new Array,this._maskParameters=new W.F}initialize(){this.updateGeometries()}destroy(){this._vaos.forEach((e=>e.dispose())),this._vaos.length=this._counts.length=this._origins.length=0}precompile(){this.techniques.precompile(Y)}render(e){const t=this.techniques.get(Y),r=this.bindParameters,s=r.camera,n=s.fullViewport[2],i=s.fullViewport[3];if(!t.compiled||!this._vaos)return void this.requestRender();const o=e.find((({name:e})=>e===I.lu.TRANSPARENT)),a=this.renderingContext,u=this.fboCache.acquire(n,i,I.CM.FOCUSAREA,L.qz.RG8UNORM);this.view.stage.renderer.occludedRequiresStencil?(u.acquireDepth(L.qk.DEPTH24_STENCIL8),a.blitFramebuffer(o.fbo,u.fbo,H.Hf.DEPTH)):u.attachDepth(o.getAttachment(H.Lu)),a.bindFramebuffer(u.fbo),a.setClearColor(0,0,0,1),a.clear(H.Hf.COLOR|H.Hf.STENCIL),a.setViewport(0,0,n,i);const c=a.bindTechnique(t,r);a.setFaceCullingEnabled(!1),a.setStencilTestEnabled(!0),a.setStencilOpSeparate(H.LR.FRONT,H.xS.KEEP,H.xS.INCR_WRAP,H.xS.KEEP),a.setStencilOpSeparate(H.LR.BACK,H.xS.KEEP,H.xS.DECR_WRAP,H.xS.KEEP),a.setDepthWriteEnabled(!1);for(let e=0;e<this._vaos.length;e++){const t=this._vaos[e],s=this._counts[e];this._maskParameters.origin=this._origins[e],c.bindDraw(r,$.G,this._maskParameters),a.bindVAO(t),a.setDepthTestEnabled(!0),a.setStencilWriteMask(255),a.setStencilFunction(H.wb.ALWAYS,0,255),a.setColorMask(!1,!1,!1,!1),a.drawArrays(H.MX.TRIANGLES,0,s),a.setDepthTestEnabled(!1),a.setStencilWriteMask(0),a.setStencilFunction(H.wb.NOTEQUAL,0,255),a.setColorMask(!0,!0,!0,!0),a.drawArrays(H.MX.TRIANGLES,0,s)}return u}updateGeometries(){this.view.stage&&(this._vaos.forEach((e=>e.dispose())),this._vaos.length=this._counts.length=this._origins.length=0,this.focusAreasView.volumes.forEach((e=>e.forEach((e=>{const t=new Array,r=e.indicesBottom;for(let s=0;s<r.length;s++)t.push(e.positions[3*(r[s]-1)]),t.push(e.positions[3*(r[s]-1)+1]),t.push(e.positions[3*(r[s]-1)+2]);const s=e.indicesExtruded;for(let r=0;r<s.length;r++)t.push(e.positions[3*s[r]]),t.push(e.positions[3*s[r]+1]),t.push(e.positions[3*s[r]+2]);const n=new K.U(this.renderingContext,B.i,new Map([["geometry",X.ap]]),new Map([["geometry",J.f.createVertex(this.renderingContext,H.l1.STATIC_DRAW,new Float32Array(t))]]));this._vaos.push(n),this._counts.push(r.length+s.length),this._origins.push(e.origin)})))),this.requestRender())}};(0,s._)([(0,f.Cb)()],Q.prototype,"consumes",void 0),(0,s._)([(0,f.Cb)()],Q.prototype,"produces",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],Q.prototype,"focusAreasView",void 0),Q=(0,s._)([(0,p.j)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaMaskNode")],Q);class ee{constructor(e,t,r,s,n){this.positions=e,this.indicesBottom=t,this.indicesExtruded=r,this.height=s,this.origin=n}}var te=r(53147),re=r(51619),se=r(19596);let ne=class extends n.Z{constructor(e){super(e)}initialize(){this.addHandles([(0,h.YP)((()=>this.area.enabled),(()=>this._ensureElement()),h.nn),(0,h.YP)((()=>this.area.outline?.color),(e=>this._updateColor(e)),h.nn),(0,h.YP)((()=>this.area.geometries),(e=>this._updateGeometries(e)),h.nn)])}destroy(){this.removeAllHandles(),this._outlineElement=(0,l.SC)(this._outlineElement)}_ensureElement(){this.area.enabled&&this.area.outline?.color?this._outlineElement??=new re.k({view:this.view,geometry:this._mergePolygons(this.area.geometries),isDraped:!0,attached:!0,isDecoration:!1,color:te.Z.toUnitRGBA(this.area.outline?.color),renderOccluded:se.yD.OccludeAndTransparent,width:3}):this._outlineElement=(0,l.SC)(this._outlineElement)}_updateGeometries(e){this._ensureElement(),this._outlineElement&&(this._outlineElement.geometry=this._mergePolygons(e))}_updateColor(e){this._ensureElement(),this._outlineElement&&e&&(this._outlineElement.color=te.Z.toUnitRGBA(e))}_mergePolygons(e){if(!e||0===e.length)return null;const t=e.at(0).clone();return e.forEach((e=>{t.rings.push(...e.rings)})),t}};(0,s._)([(0,f.Cb)({constructOnly:!0})],ne.prototype,"view",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],ne.prototype,"area",void 0),ne=(0,s._)([(0,p.j)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaOutlineItem")],ne);let ie=class extends n.Z{constructor(e){super(e),this._volumes=new Map,this._elevationContext=new P.o,this._outlineMap=new o.Z}initialize(){this.addHandles([(0,h.YP)((()=>this.polygons),(e=>this._updateVolumes(e)),h.tX)]),this._outlineMap=(0,c.w)((()=>this.areas?.areas),(e=>new ne({area:e,view:this.view})),{recycleItems:!0})}destroy(){this.removeAllHandles(),this._outlineMap.destroy()}get areas(){return this.view.map?.focusAreas}get enabledAreas(){return this.areas?.areas.toArray().filter((({enabled:e})=>e))??[]}get style(){return this.areas?.style??"bright"}get polygons(){return this.enabledAreas.reduce(((e,t)=>e.concat(t.geometries.toArray())),new Array)}containsGeometry(e){if(0===this.polygons.length)return!0;const t=new g.Z(e);return this.polygons.some((e=>e.contains(t)))}_updateVolumes(e){this._extrude(e),this._ensureRenderNodes()}_extrude(e){if(!this.view.renderCoordsHelper||(0,i.fS)(Array.from(this._volumes.keys()),e))return;const t=this.view.renderCoordsHelper,r=(0,m.Ue)(),s=t.viewingMode===O.JY.Global,n=(0,y.Ue)(),o=(0,y.Ue)(),c=this.view.spatialReference,l=(0,b.fromSpatialReference)(c),h=(0,x.Iu)(c).radius/E.sv.radius,f=(0,d.nC)(5e5*h,"meters",c,!0);s||t.worldUpAtPosition([0,0,0],r);const p=new Map;for(const i of e){const e=this._volumes.get(i);if(e)p.set(i,e);else try{const e=c.equals(i.spatialReference)?i:(0,v.project)(i,c),a=Math.max(e.extent.width,e.extent.height),u=(0,d.qp)(a,c,"meters",!0),y=Math.max(5*u,2e4*h),m=s?h/10:h,x=this._reduceGeometryHeight(e,y,m),g=(0,D.zE)(x);if(null==g)continue;const E=(0,b.fromPolygon)(x),O=(0,R.ht)(E,l,!1)??E,P=(0,w.ht)(O,f,0,0),I=(0,b.toPolygon)(P,c);if(null==I)continue;(0,C.B)(c,[g.x,g.y,0],n,t.spatialReference),o[12]=-n[12],o[13]=-n[13],o[14]=-n[14];const T=(0,Z.VP)(I,this.view.elevationProvider,t,this._elevationContext),{polygons:V,mapPositions:j,position:F}=T,k=new Array;for(const e of V){const t=e.count,i=(0,_.e)(e.mapPositions,e.holeIndices,3);if(0===i.length)continue;const a=i.length,u=6*t,c=u+a,l=(0,A.bg)(3*u),h=(0,G.$z)(c),d=(0,G.$z)(a);(0,S.A)(F,j,i,e,l,null,null,null,h,d,y,r,s),(0,M.t)(l,l,o);const f=new ee(l,d,h,y,[n[12],n[13],n[14]]);k.push(f)}p.set(i,k)}catch(e){u.Z.getLogger(this).error(new a.Z("focusareasview:projection-failed","Failed to project focus area geometry to view spatial reference",{geometry:i,error:e}))}}this._volumes=p,this._maskRenderNode?.updateGeometries()}_ensureRenderNodes(){this.view.stage&&(0===this.volumes.size?(this._maskRenderNode=(0,l.SC)(this._maskRenderNode),this._colorRenderNode=(0,l.SC)(this._colorRenderNode)):(this._maskRenderNode??=new Q({focusAreasView:this}),this._colorRenderNode??=new U({focusAreasView:this}),this.view.stage.renderView.requestRender()))}_reduceGeometryHeight(e,t,r){const s=-12e5*r,n=Math.max(-t/2,s),i=e.rings.map((e=>e.map((e=>[e[0],e[1],n])))),o=e.clone();return o.rings=i,o.hasZ=!0,o}get volumes(){return this._volumes}};(0,s._)([(0,f.Cb)()],ie.prototype,"_volumes",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],ie.prototype,"view",void 0),ie=(0,s._)([(0,p.j)("esri.views.3d.FocusAreasView")],ie)},34105:function(e,t,r){r.d(t,{i:function(){return x}});var s=r(73440),n=r(70880),i=r(15894),o=r(17155),a=(r(61432),r(96711),r(83850),r(48023)),u=r(94808),c=r(89341),l=r(94125);class h{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=u.eZ.Outline}destroy(){this._destroyResources()}get resources(){return this._resources?.external}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new d({view:this._resourceFactory.view,renderGroup:this._renderGroup}),r=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:t,external:e,geometriesAdded:!1},r&&(this._resources.drapeSourceRenderer=r.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,c.T.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,c.T.UPDATE),this._resources.geometriesAdded=!0))}}let d=class extends(i.Z.IdentifiableMixin(n.Z)){constructor(e){super(e),this.drapeSourceType=u.Lw.Features,this.updatePolicy=l.j.SYNC,this.renderGroup=u.eZ.Outline}};(0,s._)([(0,o.Cb)({constructOnly:!0})],d.prototype,"view",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],d.prototype,"drapeSourceType",void 0),(0,s._)([(0,o.Cb)()],d.prototype,"renderGroup",void 0),d=(0,s._)([(0,a.j)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],d);var f=r(56960),p=r(90403),_=r(26475),y=r(65759);class m{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view.stage;if(null==this._resources||!e)return;const t=this._resources.object;t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer)}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,r=t.stage;if(!r)return;const s=new y.F(r,{pickable:!1,updatePolicy:l.j.SYNC}),n=new _.T({castShadow:!1}),i=e.createResources(n,s);s.add(n);const o=e.cameraChanged,a=o?(0,p.YP)((()=>t.state.camera),(e=>o(e)),p.nn):null;this._resources={layer:s,object:n,external:i,cameraHandle:a},this._syncVisible()}_destroyResources(){null!=this._resources&&(this._resources.layer.destroy(),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null)}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class x extends f.l{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new m(this.createObject3DResourceFactory(e.view)),this.drapedResources=new h(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}forEachMaterial(e){this.object3dResources?.forEachMaterial(e),this.drapedResources?.forEachMaterial(e)}}},51619:function(e,t,r){r.d(t,{k:function(){return b}});var s=r(87833),n=r(24910),i=r(82846),o=r(73749),a=r(27583),u=r(30146),c=r(16447),l=r(60199),h=r(60856),d=r(51870),f=r(13689),p=r(34105),_=r(82845),y=r(94290),m=r(55277),x=r(61324),g=r(19596),v=r(14357),w=r(52061),R=r(19843);class b extends p.i{constructor(e){super(e),this._attachmentOrigin=(0,h.T)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new s.Z,this._geometry=null,this._width=1,this._color=(0,a.al)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,a.al)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=g.yD.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new _.W({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:C,recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)},forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:C,recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()},forEachMaterial:(e,t)=>t(e.material)}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}get geometry(){return this._geometry}set geometry(e){const t=this._isClosed;this._geometry=e,this.recreateGeometry(),t!==this._isClosed&&this._updateMaterial()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,o.a)(e,this._color)||((0,o.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,o.a)(e,this._innerColor)||((0,o.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,o.a)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,a.d9)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=this.object3dResources.resources?.geometries;if(!e||0===e.length)return null;(0,n.i)(E,0,0,0);let t=0;for(const r of e)r.computeAttachmentOrigin(A)&&((0,n.f)(E,E,A),t++);return 0===t?null:((0,n.g)(E,E,1/t),this.view.renderCoordsHelper.fromRenderCoords(E,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){this.object3dResources.resources?.material.setParameters(this._materialParameters),this.drapedResources.resources?.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===g.yD.OccludeAndTransparentStencil?g.yD.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,r){this._createRenderGeometries(t,r);for(const t of r)e.addGeometry(t);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(e){const t=new R.U(this._materialParameters),r=new Array;return this._recreateGeometry(e,t,r),{material:t,geometries:r}}_createDrapedResources(){const e=new R.U(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:r}=this,s=r.basemapTerrain.spatialReference;return null==t||null==s?[]:(0,x.r)(t,s).lines.map((({position:t})=>{const n={overlayInfo:{spatialReference:s,renderCoordsHelper:r.renderCoordsHelper},attributeData:{position:t},removeDuplicateStartEnd:this._isClosed};return new v.z((0,m.Y)(e,n))}))}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const r of this.object3dResources.resources.geometries){const s=r.attributes.get(w.T.POSITION),n=(0,l.bg)(s.data.length);(0,u.projectBuffer)(s.data,t.spatialReference,0,n,this.view.spatialReference,0),(0,c.G1)(e,n)}return!0}_createRenderGeometries(e,t){const r=this.geometry;if(null==r)return;const s=(0,x.V)(r,this.view.elevationProvider,this.view.renderCoordsHelper,y.o.fromElevationInfo(this.elevationInfo??new f.Z({mode:(0,d.VW)(r,null)}))),n=new Array;for(const{position:r,mapPositions:i}of s.lines){const s={mapPositions:i,attributeData:{position:r},removeDuplicateStartEnd:this._isClosed};t.push((0,m.Y)(e,s)),n.push(r)}this._laserline.pathVerticalPlane=n}}function C(e){e.geometries=[]}const A=(0,i.Ue)(),E=(0,i.Ue)()},26294:function(e,t,r){var s;r.d(t,{j:function(){return s}}),function(e){e[e.BRIGHT=0]="BRIGHT",e[e.DARK=1]="DARK"}(s||(s={}))}}]);