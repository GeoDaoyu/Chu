"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[64467],{33287:function(e,t,r){r.d(t,{R:function(){return h}});var s=r(73440),i=r(70880),n=r(48797),a=r(17155),l=(r(61432),r(96711),r(83850),r(48023)),o=r(4469),y=r(44695),u=r(33285);const p={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let h=class extends i.Z{constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const t=(0,y.f)(this.floors,e);return e.toExportImageJSON(t)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,u.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.removeHandles("layer"),e&&this.addHandles([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(p[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=!!this.floors?.length,t=this.visibleSublayers.filter((t=>null!=t.definitionExpression||e&&null!=t.floorInfo));return t.length?JSON.stringify(t.reduce(((e,t)=>{const r=(0,y.f)(this.floors,t),s=(0,n._$)(r,t.definitionExpression);return null!=s&&(e[t.id]=s),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,r=this.scale,s=t=>{t.visible&&(0===r||(0,o.o2)(r,t.minScale,t.maxScale))&&(t.sublayers?t.sublayers.forEach(s):e.unshift(t))};t&&t.forEach(s);const i=this._get("visibleSublayers");return!i||i.length!==e.length||i.some(((t,r)=>e[r]!==t))?e:i}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};(0,s._)([(0,a.Cb)({readOnly:!0})],h.prototype,"dynamicLayers",null),(0,s._)([(0,a.Cb)()],h.prototype,"floors",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],h.prototype,"hasDynamicLayers",null),(0,s._)([(0,a.Cb)()],h.prototype,"layer",null),(0,s._)([(0,a.Cb)({readOnly:!0})],h.prototype,"layers",null),(0,s._)([(0,a.Cb)({readOnly:!0})],h.prototype,"layerDefs",null),(0,s._)([(0,a.Cb)({type:Number})],h.prototype,"scale",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],h.prototype,"version",null),(0,s._)([(0,a.Cb)({readOnly:!0})],h.prototype,"visibleSublayers",null),h=(0,s._)([(0,l.j)("esri.layers.support.ExportImageParameters")],h)},28371:function(e,t,r){r.d(t,{h:function(){return n}});r(3480),r(28947);var s=r(92161),i=r(85913);r(62052),r(72728);function n(e,t,r){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:n=!1,timeOffset:a,useViewTime:l}=e;let o=e.timeExtent;n&&(o=function(e){if(!e)return e;const{start:t,end:r}=e;return new i.T({start:null!=t?(0,s.Nm)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=r?(0,s.Nm)(r,r.getTimezoneOffset(),"minutes"):r})}(o));let y=l?t&&o?t.intersection(o):t||o:o;return!y||y.isEmpty||y.isAllTime?y:(a&&(y=y.offset(-a.value,a.unit)),n&&(y=function(e){if(!e)return e;const{start:t,end:r}=e;return new i.T({start:null!=t?(0,s.Nm)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=r?(0,s.Nm)(r,-r.getTimezoneOffset(),"minutes"):r})}(y)),y.equals(r)?r:y)}},64467:function(e,t,r){r.r(t),r.d(t,{default:function(){return m}});var s=r(73440),i=r(50702),n=(r(96711),r(61432),r(83850),r(88194),r(48023)),a=r(85360),l=r(50624),o=r(17155),y=r(33287),u=r(28371);const p=e=>{let t=class extends e{initialize(){this.exportImageParameters=new y.R({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}get timeExtent(){return(0,u.h)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return(0,s._)([(0,o.Cb)()],t.prototype,"exportImageParameters",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],t.prototype,"floors",null),(0,s._)([(0,o.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,s._)([(0,o.Cb)()],t.prototype,"layer",void 0),(0,s._)([(0,o.Cb)()],t.prototype,"suspended",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],t.prototype,"timeExtent",null),t=(0,s._)([(0,n.j)("esri.views.layers.MapImageLayerView")],t),t};let h=class extends(p(a.Z)){constructor(){super(...arguments),this.type="map-image-3d"}initialize(){this._updatingHandles.add((()=>this.exportImageVersion),(()=>this._updatingHandles.addPromise(this.refreshDebounced()))),this._popupHighlightHelper=new l.c({view:this.view,layerView:this,updatingHandles:this._updatingHandles}),this.addHandles((0,i.ed)(this._popupHighlightHelper))}fetchPopupFeaturesAtLocation(e,t){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(e,t)}highlight(e,t){return this._popupHighlightHelper.highlight(e,t)}getFetchOptions(){return{timeExtent:this.timeExtent}}};h=(0,s._)([(0,n.j)("esri.views.3d.layers.MapImageLayerView3D")],h);const m=h},62052:function(e,t,r){r.d(t,{s:function(){return n}});var s=r(15322);class i extends s.G{constructor(e,t){super(e,t,"webmap")}}function n(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass}new i(2,34)}}]);