"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[32776],{46965:function(e,t,i){var s;i.d(t,{Y:function(){return s}}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(s||(s={}))},69071:function(e,t,i){i.d(t,{Jv:function(){return n},M4:function(){return s},WJ:function(){return a},Xq:function(){return o},lN:function(){return r}});const s=-3,n=s-1;var r;!function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"}(r||(r={}));class o{constructor(e,t,i,s=0){this.name=e,this._storage=t,this.removeFunc=i,this._defaultPriority=s,this.id=`${l++}${c}`,this.size=0,this._hit=0,this._miss=0,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}set maxSize(e){this._storage.setMaxSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,i=this._defaultPriority){this._storage.put(this,e,t,t.cachedMemory,i)}pop(e){const t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){const t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t){this._storage.updateSize(this,e,t,t.cachedMemory)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}*[Symbol.iterator](){yield*this._storage.values(this)}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class a{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear()}register(e){this._users.set(e.id.slice(0,-1),e)}deregister(e){this.clear(e),this._sizeLimits.delete(e),this._users.delete(e.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){return this._db.get(e.id+t)?.size??0}put(e,t,i,o,a){t=e.id+t;const l=this._db.get(t);if(l&&(this._size-=l.size,e.size-=l.size,this._db.delete(t),l.entry!==i&&this._notifyRemove(t,l.entry,l.size,r.ALL)),o>this._maxSize)return void this._notifyRemove(t,i,o,r.ALL);if(void 0===i)return void console.warn("Refusing to cache undefined entry ");if(!o||o<0)return console.warn(`Refusing to cache entry with size ${o} for key ${t}`),void this._notifyRemove(t,i,0,r.ALL);const c=1+Math.max(a,n)-s;this._db.set(t,new u(i,o,c)),this._size+=o,e.size+=o,this._checkSize()}updateSize(e,t,i,s){t=e.id+t;const n=this._db.get(t);if(n&&n.entry===i){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const e=this._notifyRemove(t,i,s,r.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);s=e}n.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,t){t=e.id+t;const i=this._db.get(t);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(e,t){t=e.id+t;const i=this._db.get(t);if(void 0!==i)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}peek(e,t){const i=this._db.get(e.id+t);return i?++this._hit:++this._miss,i?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},i=new Array;this._db.forEach(((e,s)=>{const n=e.lifetime;i[n]=(i[n]||0)+e.size,this._users.forEach((i=>{const{id:n,name:r}=i;if(s.startsWith(n)){const i=t[r]||0;t[r]=i+e.size}}))}));const n={};this._users.forEach((e=>{const i=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const s=t[i]||0;t[i]=s,n[i]=Math.round(100*e.hitRate)+"%"}else n[i]="0%"}));const r=Object.keys(t);r.sort(((e,i)=>t[i]-t[e])),r.forEach((i=>e[i]=Math.round(t[i]/2**20)+"MB / "+n[i]));for(let t=i.length-1;t>=0;--t){const n=i[t];n&&(e["Priority "+(t+s-1)]=Math.round(n/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forEach((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,i)=>{i.startsWith(t)&&(this._size-=e.size,this._db.delete(i),this._notifyRemove(i,e.entry,e.size,r.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,r.ALL))),this._users.forEach((e=>e.size=0)),this._size=0,this._db.clear()}*values(e){for(const[t,i]of this._db)t.startsWith(e.id)&&(yield i.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,i,s){const n=this._users.get(e.split(c)[0])?.removeFunc,r=n?.(t,s,i);return"number"==typeof r?r:null}_checkSize(){this._sizeLimits.forEach(((e,t)=>this._checkSizeLimits(e,t))),this._checkSizeLimits(this.maxSize)}setMaxSize(e,t){null==t||t<=0?this._sizeLimits.delete(e):this._sizeLimits.set(e,t)}_checkSizeLimits(e,t){const i=t??this;if(i.size<=e)return;const s=t?.id;let n=!0;for(;n;){n=!1;for(const[r,o]of this._db)if(0===o.lifetime&&(!s||r.startsWith(s))){const s=t??this._users.get(r.split(c)[0]);if(this._purgeItem(r,o,s),i.size<=.9*e)return;n||=this._db.has(r)}}for(const[n,r]of this._db)if(!s||n.startsWith(s)){const s=t??this._users.get(n.split(c)[0]);if(this._purgeItem(n,r,s),i.size<=.9*e)return}}_purgeItem(e,t,i){if(this._db.delete(e),t.lives<=1){this._size-=t.size,i&&(i.size-=t.size);const s=this._notifyRemove(e,t.entry,t.size,r.SOME);null!=s&&s>0&&(this._size+=s,i&&(i.size+=s),t.lives=t.lifetime,t.size=s,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}let l=0;class u{constructor(e,t,i){this.entry=e,this.size=t,this.lifetime=i,this.lives=i}}const c=":"},88338:function(e,t,i){i.d(t,{Z:function(){return h}});var s,n,r=i(61432),o=i(85881),a=i(77450);(n=s||(s={}))[n.varint=0]="varint",n[n.fixed64=1]="fixed64",n[n.delimited=2]="delimited",n[n.fixed32=5]="fixed32",n[n.unknown=99]="unknown";const l=4294967296,u=new TextDecoder("utf-8"),c=(0,r.Z)("safari")||(0,r.Z)("ios")?6:(0,r.Z)("ff")?12:32;class h{constructor(e,t,i=0,n=(e?e.byteLength:0)){this._tag=0,this._dataType=s.unknown,this._init(e,t,i,n)}_init(e,t,i,s){this._data=e,this._dataView=t,this._pos=i,this._end=s}get usedMemory(){return 64+(0,o.G7)(this._data)}asUnsafe(){return this}clone(){return new h(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128)return e;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+e.getUint32(t+4,!0)*l;return this._skip(8),i}getSFixed64(){const e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+e.getInt32(t+4,!0)*l;return this._skip(8),i}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,i=this._toString(this._data,t,t+e);return this._skip(e),i}getBytes(){const e=this._getLength(),t=this._pos,i=this._toBytes(this._data,t,t+e);return this._skip(e),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,i,s){const n=this.getMessage(),r=e(n,t,i,s);return n.release(),r}processMessage(e){const t=this.getMessage(),i=e(t);return t.release(),i}getMessage(){const e=this._getLength(),t=h.pool.acquire();return t._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){h.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case s.varint:this._decodeVarint();break;case s.fixed64:this._skip(8);break;case s.delimited:this._skip(this._getLength());break;case s.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t=this._pos,i=0,s=0;if(this._end-t>=10)do{if(s=e[t++],i|=127&s,!(128&s))break;if(s=e[t++],i|=(127&s)<<7,!(128&s))break;if(s=e[t++],i|=(127&s)<<14,!(128&s))break;if(s=e[t++],i|=(127&s)<<21,!(128&s))break;if(s=e[t++],i+=268435456*(127&s),!(128&s))break;if(s=e[t++],i+=34359738368*(127&s),!(128&s))break;if(s=e[t++],i+=4398046511104*(127&s),!(128&s))break;if(s=e[t++],i+=562949953421312*(127&s),!(128&s))break;if(s=e[t++],i+=72057594037927940*(127&s),!(128&s))break;if(s=e[t++],i+=0x8000000000000000*(127&s),!(128&s))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;t!==this._end&&(s=e[t],128&s);)++t,i+=(127&s)*n,n*=128;if(t===this._end)throw new Error("Varint overrun!");++t,i+=s*n}return this._pos=t,i}_decodeSVarint(){const e=this._data;let t,i=0,s=0;const n=1&e[this._pos];if(s=e[this._pos++],i|=127&s,!(128&s))return n?-(i+1)/2:i/2;if(s=e[this._pos++],i|=(127&s)<<7,!(128&s))return n?-(i+1)/2:i/2;if(s=e[this._pos++],i|=(127&s)<<14,!(128&s))return n?-(i+1)/2:i/2;if(s=e[this._pos++],i|=(127&s)<<21,!(128&s))return n?-(i+1)/2:i/2;if(s=e[this._pos++],i+=268435456*(127&s),!(128&s))return n?-(i+1)/2:i/2;if(s=e[this._pos++],i+=34359738368*(127&s),!(128&s))return n?-(i+1)/2:i/2;if(s=e[this._pos++],i+=4398046511104*(127&s),!(128&s))return n?-(i+1)/2:i/2;if(t=BigInt(i),s=e[this._pos++],t+=0x2000000000000n*BigInt(127&s),!(128&s))return Number(n?-(t+1n)/2n:t/2n);if(s=e[this._pos++],t+=0x100000000000000n*BigInt(127&s),!(128&s))return Number(n?-(t+1n)/2n:t/2n);if(s=e[this._pos++],t+=0x8000000000000000n*BigInt(127&s),!(128&s))return Number(n?-(t+1n)/2n:t/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==s.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,i){if((i=Math.min(this._end,i))-t>c){const s=e.subarray(t,i);return u.decode(s)}let s="",n="";for(let r=t;r<i;++r){const t=e[r];128&t?n+="%"+t.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(t),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(e,t,i){return i=Math.min(this._end,i),new Uint8Array(e.buffer,t,i-t)}static{this.pool=new a.Z(h,void 0,(e=>{e._data=null,e._dataView=null}))}}},28960:function(e,t,i){i.d(t,{A4:function(){return r},L9:function(){return o},yV:function(){return n}});var s=i(87599);class n{static{this.instance=new s.vF("Etc/UTC")}}function r(e){return e instanceof s.ld?e===n.instance:"unknown"===e?.toString().toLowerCase()}function o(e){return r(e)?n.instance:e}},60147:function(e,t,i){i.d(t,{R:function(){return c}});var s=i(73440),n=i(70880),r=i(50702),o=i(90403),a=i(99153),l=i(17155),u=i(48023);let c=class extends n.Z{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,t,i={}){return this._installWatch(e,t,i,o.YP)}addWhen(e,t,i={}){return this._installWatch(e,t,i,o.gx)}addOnCollectionChange(e,t,{initial:i=!1,final:s=!1}={}){const n=++this._handleId;return this.addHandles([(0,o.on)(e,"after-changes",this._createSyncUpdatingCallback(),o.Z_),(0,o.on)(e,"change",t,{onListenerAdd:i?e=>t({added:e.toArray(),removed:[]}):void 0,onListenerRemove:s?e=>t({added:[],removed:e.toArray()}):void 0})],n),(0,r.kB)((()=>this.removeHandles(n)))}addPromise(e){if(null==e)return e;const t=++this._handleId;this.addHandles((0,r.kB)((()=>{this._pendingPromises.delete(e)&&(0!==this._pendingPromises.size||this.hasHandles(h)||this._set("updating",!1))})),t),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this.removeHandles(t);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,t,i={},s){const n=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,t,i);return this.addHandles(o,n),(0,r.kB)((()=>this.removeHandles(n)))}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),s=(0,o.YP)(e,i,{sync:!0,equals:()=>!1});return this.addHandles(s,t),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(h),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles((0,a.Os)((()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(h))})),h)}}};(0,s._)([(0,l.Cb)({readOnly:!0})],c.prototype,"updating",void 0),c=(0,s._)([(0,u.j)("esri.core.support.UpdatingHandles")],c);const h=-42},60199:function(e,t,i){i.d(t,{QZ:function(){return r},Rq:function(){return o},bg:function(){return n}});var s=i(59384);function n(e,t=!1){return e<=s.c8?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function r(e){return((0,s.fU)(e)?e.byteLength/8:e.length)<=s.c8?Array.from(e):new Float64Array(e)}function o(e,t,i){return Array.isArray(e)?e.slice(t,t+i):e.subarray(t,t+i)}},16447:function(e,t,i){i.d(t,{BD:function(){return C},Cb:function(){return v},FY:function(){return l},G1:function(){return y},G_:function(){return B},HH:function(){return h},I7:function(){return O},JR:function(){return Z},KE:function(){return k},TC:function(){return f},Tn:function(){return N},Ue:function(){return o},VK:function(){return p},Wi:function(){return g},Ye:function(){return F},Zp:function(){return E},al:function(){return a},bA:function(){return M},bM:function(){return G},bZ:function(){return j},be:function(){return T},bf:function(){return b},cS:function(){return A},cv:function(){return R},dp:function(){return S},eZ:function(){return c},fS:function(){return U},gy:function(){return L},is:function(){return D},kK:function(){return x},nX:function(){return d},op:function(){return z},pp:function(){return _},r3:function(){return I},re:function(){return H},sU:function(){return m},t8:function(){return P},wp:function(){return V},wq:function(){return u},wz:function(){return w},y8:function(){return q}});var s=i(71354),n=i(47566),r=i(60199);function o(e=G){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function a(e,t,i,s,n,r,a=o()){return a[0]=e,a[1]=t,a[2]=i,a[3]=s,a[4]=n,a[5]=r,a}function l(e,t=o()){return u(e,0,e.length/3,t)}function u(e,t,i,s=o()){return P(s,B),y(s,e,t,i),s}function c(e,t=(0,r.bg)(24)){const[i,s,n,o,a,l]=e;return t[0]=i,t[1]=s,t[2]=n,t[3]=i,t[4]=s,t[5]=l,t[6]=i,t[7]=a,t[8]=n,t[9]=i,t[10]=a,t[11]=l,t[12]=o,t[13]=s,t[14]=n,t[15]=o,t[16]=s,t[17]=l,t[18]=o,t[19]=a,t[20]=n,t[21]=o,t[22]=a,t[23]=l,t}function h(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new s.Z(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function d(e,t,i=o()){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=t[0],i[4]=t[1],i[5]=t[2],i}function f(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function p(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function _(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function y(e,t,i=0,s=t.length/3){let n=e[0],r=e[1],o=e[2],a=e[3],l=e[4],u=e[5];for(let e=0;e<s;e++)n=Math.min(n,t[i+3*e]),r=Math.min(r,t[i+3*e+1]),o=Math.min(o,t[i+3*e+2]),a=Math.max(a,t[i+3*e]),l=Math.max(l,t[i+3*e+1]),u=Math.max(u,t[i+3*e+2]);e[0]=n,e[1]=r,e[2]=o,e[3]=a,e[4]=l,e[5]=u}function g(e,t,i){const s=t.length;let n=e[0],r=e[1],o=e[2],a=e[3],l=e[4],u=e[5];if(i)for(let e=0;e<s;e++){const i=t[e];n=Math.min(n,i[0]),r=Math.min(r,i[1]),o=Math.min(o,i[2]),a=Math.max(a,i[0]),l=Math.max(l,i[1]),u=Math.max(u,i[2])}else for(let e=0;e<s;e++){const i=t[e];n=Math.min(n,i[0]),r=Math.min(r,i[1]),a=Math.max(a,i[0]),l=Math.max(l,i[1])}e[0]=n,e[1]=r,e[2]=o,e[3]=a,e[4]=l,e[5]=u}function m(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function b(e){return e[0]>=e[3]?0:e[3]-e[0]}function F(e){return e[1]>=e[4]?0:e[4]-e[1]}function v(e){return e[2]>=e[5]?0:e[5]-e[2]}function w(e){const t=b(e),i=v(e),s=F(e);return Math.sqrt(t*t+i*i+s*s)}function T(e,t=[0,0,0]){return t[0]=e[0]+b(e)/2,t[1]=e[1]+F(e)/2,t[2]=e[2]+v(e)/2,t}function S(e,t=[0,0,0]){return t[0]=b(e),t[1]=F(e),t[2]=v(e),t}function C(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function I(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function x(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function E(e,t){return null==t||x(e,t)}function O(e,t,i){let s=0,n=1;for(let r=0;r<3;++r){const o=e[r],a=e[r+3],l=t[r],u=i[r],c=u<l,h=c?u:l,d=c?l:u,f=Math.max(o,h),p=Math.min(a,d);if(f>p)return!1;if(d===h)break;const _=d-h,y=(f-h)/_,g=(p-h)/_;if(s=Math.max(s,c?1-g:y),n=Math.min(n,c?1-y:g),s>n)return!1}return!0}function R(e,t,i,s,n=e){return n[0]=e[0]+t,n[1]=e[1]+i,n[2]=e[2]+s,n[3]=e[3]+t,n[4]=e[4]+i,n[5]=e[5]+s,n}function M(e,t,i=e){const s=e[0]+b(e)/2,n=e[1]+F(e)/2,r=e[2]+v(e)/2;return i[0]=s+(e[0]-s)*t,i[1]=n+(e[1]-n)*t,i[2]=r+(e[2]-r)*t,i[3]=s+(e[3]-s)*t,i[4]=n+(e[4]-n)*t,i[5]=r+(e[5]-r)*t,i}function k(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function z(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function N(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function P(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function A(e){return e?P(e,B):o(B)}function q(e,t){return t||(t=(0,n.Ue)()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function Z(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function j(e,t,i,s,n){return e[0]=t,e[1]=i,e[2]=Number.NEGATIVE_INFINITY,e[3]=s,e[4]=n,e[5]=Number.POSITIVE_INFINITY,e}function D(e){return 6===e.length}function V(e){return 0===b(e)&&0===F(e)&&0===v(e)}function U(e,t,i){if(null==e||null==t)return e===t;if(!D(e)||!D(t))return!1;if(i){for(let s=0;s<e.length;s++)if(!i(e[s],t[s]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function H(e,t,i,s,n,r){return a(e,t,i,s,n,r,J)}const L=[-1/0,-1/0,-1/0,1/0,1/0,1/0],B=[1/0,1/0,1/0,-1/0,-1/0,-1/0],G=[0,0,0,0,0,0],J=o()},98842:function(e,t,i){i.d(t,{Mk:function(){return c},P$:function(){return h},qM:function(){return d}});var s=i(41773),n=i(71354),r=i(82890),o=i(82868),a=i(60508),l=i(67764),u=i(62197);const c=(0,s.w)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),h=(0,s.w)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"}),d={base:r.Z,key:"type",typeMap:{extent:n.Z,multipoint:o.Z,point:a.Z,polyline:u.Z,polygon:l.Z}}},15083:function(e,t,i){function s(e,t){switch(t.type){case"object-id":case"unique-id-simple":return e.attributes[t.fieldName];case"unique-id-composite":{const i=[];for(const s of t.fieldNames)i.push(e.attributes[s]??null);return JSON.stringify(i)}}}function n(e,t){if("uniqueIdFields"in t&&t.uniqueIdFields?.length){if(1===t.uniqueIdFields.length)return e.attributes?.[t.uniqueIdFields[0]];const i=t.uniqueIdFields.map((t=>e.attributes?.[t]));return JSON.stringify(i)}return"objectIdField"in t&&t.objectIdField?e.attributes?.[t.objectIdField]:null}i.d(t,{C:function(){return s},v:function(){return n}})},41964:function(e,t,i){i.d(t,{u:function(){return l}});var s,n=i(73440),r=i(63255),o=i(17155),a=(i(61432),i(96711),i(83850),i(48023));let l=s=class extends r.Z{constructor(e){super(e),this.name=null,this.code=null}clone(){return new s({name:this.name,code:this.code})}};(0,n._)([(0,o.Cb)({type:String,json:{write:{isRequired:!0}}})],l.prototype,"name",void 0),(0,n._)([(0,o.Cb)({type:[String,Number],json:{write:{isRequired:!0}}})],l.prototype,"code",void 0),l=s=(0,n._)([(0,a.j)("esri.layers.support.CodedValue")],l)},37127:function(e,t,i){i.d(t,{Z:function(){return h}});var s,n=i(73440),r=i(28947),o=i(17155),a=(i(61432),i(96711),i(79775)),l=i(48023),u=i(41964),c=i(85853);let h=class extends c.Z{static{s=this}constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some((e=>(String(e.code)===i&&(t=e.name),!!t)))}return t}clone(){return new s({codedValues:(0,r.d9)(this.codedValues),name:this.name})}};(0,n._)([(0,o.Cb)({type:[u.u],json:{write:{isRequired:!0}}})],h.prototype,"codedValues",void 0),(0,n._)([(0,a.J)({codedValue:"coded-value"})],h.prototype,"type",void 0),h=s=(0,n._)([(0,l.j)("esri.layers.support.CodedValueDomain")],h)},85853:function(e,t,i){i.d(t,{Z:function(){return c}});var s=i(73440),n=i(41773),r=i(63255),o=i(17155),a=(i(61432),i(96711),i(83850),i(79775)),l=i(48023);const u=new n.X({inherited:"inherited",codedValue:"coded-value",range:"range"});let c=class extends r.Z{constructor(e){super(e),this.name=null,this.type=null}};(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],c.prototype,"name",void 0),(0,s._)([(0,a.J)(u),(0,o.Cb)({json:{write:{isRequired:!0}}})],c.prototype,"type",void 0),c=(0,s._)([(0,l.j)("esri.layers.support.Domain")],c)},49651:function(e,t,i){i.d(t,{Z:function(){return _}});var s,n=i(73440),r=i(41773),o=i(63255),a=i(17155),l=i(95226),u=(i(61432),i(83850),i(79775)),c=i(1194),h=i(48023),d=i(76746),f=i(72396);const p=new r.X({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let _=class extends o.Z{static{s=this}constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(e,{description:t}){let i=null;try{i=t?JSON.parse(t):null}catch(e){}return i?.value??null}readValueType(e,{description:t}){let i=null;try{i=t?JSON.parse(t):null}catch(e){}return i?p.fromJSON(i.fieldValueType):null}clone(){return new s({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain?.clone()??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],_.prototype,"alias",void 0),(0,n._)([(0,a.Cb)({type:[String,Number],json:{write:{allowNull:!0}}})],_.prototype,"defaultValue",void 0),(0,n._)([(0,a.Cb)()],_.prototype,"description",void 0),(0,n._)([(0,c.r)("description")],_.prototype,"readDescription",null),(0,n._)([(0,a.Cb)({types:d.V5,json:{read:{reader:d.im},write:!0}})],_.prototype,"domain",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],_.prototype,"editable",void 0),(0,n._)([(0,a.Cb)({type:l.z8,json:{write:{overridePolicy:e=>({enabled:Number.isFinite(e)})}}})],_.prototype,"length",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],_.prototype,"name",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],_.prototype,"nullable",void 0),(0,n._)([(0,u.J)(f.v)],_.prototype,"type",void 0),(0,n._)([(0,a.Cb)()],_.prototype,"valueType",void 0),(0,n._)([(0,c.r)("valueType",["description"])],_.prototype,"readValueType",null),(0,n._)([(0,a.Cb)({type:Boolean,json:{read:!1}})],_.prototype,"visible",void 0),_=s=(0,n._)([(0,h.j)("esri.layers.support.Field")],_)},299:function(e,t,i){i.d(t,{Z:function(){return f}});var s=i(88194),n=i(96711),r=i(79577),o=i(28960),a=i(69306),l=i(76554),u=i(41801),c=i(88097),h=i(87599);const d=new Map;class f{static fromJSON(e){return new f(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new f(e.fields??[],g(e))}static fromLayerJSON(e){return new f(e.fields??[],g(e))}constructor(e=[],t){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const i=[];for(const e of this.fields){const t=e?.name,s=_(t);if(t&&s){const n=p(t);this._fieldsMap.set(t,e),this._fieldsMap.set(n,e),this._normalizedFieldsMap.set(s,e),i.push(`${n}:${e.type}:${this._timeZoneByFieldName?.get(t)}`),(0,l.y2)(e)?(this.dateFields.push(e),this._dateFieldsSet.add(e)):(0,l.H7)(e)&&(this._numericFieldsSet.add(e),this.numericFields.push(e)),(0,l.Dl)(e)||(0,l.Se)(e)||(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable)}}i.sort(),this.uid=i.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)(0,l.Dl)(e)||(0,l.Se)(e)||e.nullable||void 0!==(0,l.os)(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(p(e))??this._normalizedFieldsMap.get(_(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(e){const t=this.get(e&&"string"!=typeof e?e.name:e);return t?this._timeZoneByFieldName?this._timeZoneByFieldName.get(t.name):"date"===t.type||"esriFieldTypeDate"===t.type?(n.Z.getLogger("esri.layers.support.FieldsIndex").errorOnce(new s.Z("getTimeZone:no-timezone-information",`no time zone information for field '${t.name}'`)),u.pt):y.has(t.type)?u._4:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===u._4?o.yV.instance:t===u.pt?h.Qf.utcInstance:(0,r.s1)(d,t,(()=>h.vF.create(t))):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return(0,l.sX)(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map((e=>(0,a.A)(e)?e.toJSON():e)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function p(e){return e.trim().toLowerCase()}function _(e){return(0,l.q6)(e)?.toLowerCase()??""}const y=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function g(e){const t=new Map;if(!e.fields)return t;const i=!0===e.datesInUnknownTimezone,{timeInfo:s,editFieldsInfo:n}=e,r=(s?"startField"in s?s.startField:s.startTimeField:"")??"",o=(s?"endField"in s?s.endField:s.endTimeField:"")??"",a=function(e){return"dateFieldsTimeZone"in e}(e)?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?(0,c.Jv)(e.dateFieldsTimeReference):null,l=n?function(e){return"timeZone"in e}(n)?n.timeZone??a:n.dateFieldsTimeReference?(0,c.Jv)(n.dateFieldsTimeReference):a??u.pt:null,h=s?function(e){return"timeZone"in e}(s)?s.timeZone??a:s.timeReference?(0,c.Jv)(s.timeReference):a:null,d=new Map([[p(n?.creationDateField??""),l],[p(n?.editDateField??""),l],[p(r),h],[p(o),h]]);for(const{name:s,type:n}of e.fields)if(y.has(n))t.set(s,u._4);else if("date"!==n&&"esriFieldTypeDate"!==n)t.set(s,null);else if(i)t.set(s,u._4);else{const e=d.get(p(s??""))??a;t.set(s,e)}return t}},39502:function(e,t,i){i.d(t,{Z:function(){return l}});var s,n=i(73440),r=(i(96711),i(61432),i(83850),i(88194),i(79775)),o=i(48023),a=i(85853);let l=class extends a.Z{static{s=this}constructor(e){super(e),this.type="inherited"}clone(){return new s}};(0,n._)([(0,r.J)({inherited:"inherited"})],l.prototype,"type",void 0),l=s=(0,n._)([(0,o.j)("esri.layers.support.InheritedDomain")],l)},45107:function(e,t,i){i.d(t,{Z:function(){return u}});var s,n=i(73440),r=i(63255),o=i(17155),a=i(95226),l=(i(61432),i(83850),i(48023));let u=class extends r.Z{static{s=this}constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new s({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};(0,n._)([(0,o.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],u.prototype,"cols",void 0),(0,n._)([(0,o.Cb)({type:a.z8,json:{write:!0}})],u.prototype,"level",void 0),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],u.prototype,"levelValue",void 0),(0,n._)([(0,o.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],u.prototype,"origin",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{write:!0}})],u.prototype,"resolution",void 0),(0,n._)([(0,o.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],u.prototype,"rows",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{write:!0}})],u.prototype,"scale",void 0),u=s=(0,n._)([(0,l.j)("esri.layers.support.LOD")],u)},95951:function(e,t,i){i.d(t,{Z:function(){return u}});var s,n=i(73440),r=i(17155),o=(i(61432),i(96711),i(83850),i(79775)),a=i(48023),l=i(85853);let u=class extends l.Z{static{s=this}constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new s({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};(0,n._)([(0,r.Cb)({json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]},isRequired:!0}}})],u.prototype,"maxValue",void 0),(0,n._)([(0,r.Cb)({json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range?.[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]},isRequired:!0}}})],u.prototype,"minValue",void 0),(0,n._)([(0,o.J)({range:"range"})],u.prototype,"type",void 0),u=s=(0,n._)([(0,a.j)("esri.layers.support.RangeDomain")],u)},97550:function(e,t,i){i.d(t,{Z:function(){return v}});var s,n=i(73440),r=i(41773),o=i(63255),a=i(26636),l=i(17155),u=i(95226),c=(i(61432),i(83850),i(1194)),h=i(48023),d=i(29884),f=i(60508),p=i(45213),_=i(47566),y=i(8554),g=i(97290),m=i(45107),b=i(31743);const F=new r.X({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let v=class extends o.Z{static{s=this}static create(e={}){const{resolutionFactor:t=1,scales:i,size:n=256,spatialReference:r=p.Z.WebMercator,numLODs:o=24}=e;if(!(0,y.JY)(r)){const e=[];if(i)for(let t=0;t<i.length;t++){const s=i[t];e.push(new m.Z({level:t,scale:s,resolution:s}))}else{let t=5e-4;for(let i=o-1;i>=0;i--)e.unshift(new m.Z({level:i,scale:t,resolution:t})),t*=2}return new s({dpi:96,lods:e,origin:new f.Z(0,0,r),size:[n,n],spatialReference:r})}const l=(0,y.C5)(r),u=e.origin?new f.Z({x:e.origin.x,y:e.origin.y,spatialReference:r}):new f.Z(l?{x:l.origin[0],y:l.origin[1],spatialReference:r}:{x:0,y:0,spatialReference:r}),c=1/(39.37*(0,a.c9)(r)*96),h=[];if(i)for(let e=0;e<i.length;e++){const t=i[e],s=t*c;h.push(new m.Z({level:e,scale:t,resolution:s}))}else{let e=(0,y.sT)(r)?512/n*591657527.5917094:256/n*591657527.591555;const i=Math.ceil(o/t);h.push(new m.Z({level:0,scale:e,resolution:e*c}));for(let s=1;s<i;s++){const i=e/2**t,n=i*c;h.push(new m.Z({level:s,scale:i,resolution:n})),e=i}}return new s({dpi:96,lods:h,origin:u,size:[n,n],spatialReference:r})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=(0,y.C5)(e);return e.isWrappable&&!!i&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return f.Z.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,i=0;const s=[],n=this._levelToLOD={};e&&(t=-1/0,i=1/0,e.forEach((e=>{s.push(e.scale),t=e.scale>t?e.scale:t,i=e.scale<i?e.scale:i,n[e.level]=e}))),this._set("scales",s),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const i=Math.floor(e),s=i+1;return t[i]/(t[i]/t[s])**(e-i)}scaleToZoom(e){const t=this.scales,i=t.length-1;let s=0;for(;s<i;s++){const i=t[s],n=t[s+1];if(i<=e)return s;if(n===e)return s+1;if(i>e&&n<e)return s+Math.log(i/e)/Math.log(i/n)}return s}tileAt(e,t,i,s){const n=this.lodAt(e);if(!n)return null;let r,o;if("number"==typeof t)r=t,o=i;else if((0,y.fS)(t.spatialReference,this.spatialReference))r=t.x,o=t.y,s=i;else{const e=(0,g.iV)(t,this.spatialReference);if(null==e)return null;r=e.x,o=e.y,s=i}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return s||(s=new b.f(null,0,0,0,(0,_.Ue)())),s.level=e,s.row=Math.floor((this.origin.y-o)/l+.001),s.col=Math.floor((r-this.origin.x)/a+.001),this.updateTileInfo(s),s}updateTileInfo(e,t=s.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===s.ExtrapolateOptions.POWER_OF_TWO){const t=this.lods[this.lods.length-1];t.level<e.level&&(i=t)}if(!i)return;const n=e.level-i.level,r=i.resolution*this.size[0]/2**n,o=i.resolution*this.size[1]/2**n;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=(0,_.Ue)()),e.extent[0]=this.origin.x+e.col*r,e.extent[1]=this.origin.y-(e.row+1)*o,e.extent[2]=e.extent[0]+r,e.extent[3]=e.extent[1]+o}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))}getTileBounds(e,t){const i=this.lodAt(t.level);if(null==i)return null;const{resolution:s}=i,n=s*this.size[0],r=s*this.size[1];return e[0]=this.origin.x+t.col*n,e[1]=this.origin.y-(t.row+1)*r,e[2]=e[0]+n,e[3]=e[1]+r,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return s.fromJSON(this.write({}))}getCompatibleForVTL(e){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===e)return null;const t=(512===this.size[0]&&256===e?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===e&&0===t)return this;const i=[],n=this.lods.length-t;for(let e=0;e<n;e++){const s=e+t,{scale:n,resolution:r}=s>=0?this.lods[s]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};i.push(new m.Z({level:e,scale:n,resolution:r}))}return new s({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const s=e[i];this._upsampleLevels[s.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/s.resolution:0},t=s}}};var w,T;(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],v.prototype,"compressionQuality",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],v.prototype,"dpi",void 0),(0,n._)([(0,l.Cb)({type:String,json:{read:F.read,write:F.write,origins:{"web-scene":{read:!1,write:!1}}}})],v.prototype,"format",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],v.prototype,"isWrappable",null),(0,n._)([(0,l.Cb)({type:f.Z,json:{write:!0}})],v.prototype,"origin",void 0),(0,n._)([(0,c.r)("origin")],v.prototype,"readOrigin",null),(0,n._)([(0,l.Cb)({type:[m.Z],value:null,json:{write:!0}})],v.prototype,"lods",null),(0,n._)([(0,l.Cb)({readOnly:!0})],v.prototype,"scales",void 0),(0,n._)([(0,l.Cb)({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],v.prototype,"size",void 0),(0,n._)([(0,c.r)("size",["rows","cols"])],v.prototype,"readSize",null),(0,n._)([(0,d.c)("size",{cols:{type:u.z8},rows:{type:u.z8}})],v.prototype,"writeSize",null),(0,n._)([(0,l.Cb)({type:p.Z,json:{write:!0}})],v.prototype,"spatialReference",void 0),v=s=(0,n._)([(0,h.j)("esri.layers.support.TileInfo")],v),w=v||(v={}),(T=w.ExtrapolateOptions||(w.ExtrapolateOptions={}))[T.NONE=0]="NONE",T[T.POWER_OF_TWO=1]="POWER_OF_TWO"},31743:function(e,t,i){i.d(t,{f:function(){return s}});class s{constructor(e,t,i,s,n){this.id=e,this.level=t,this.row=i,this.col=s,this.extent=n}}},76746:function(e,t,i){i.d(t,{V5:function(){return a},im:function(){return l}});i(61432);var s=i(37127),n=i(85853),r=i(39502),o=i(95951);const a={key:"type",base:n.Z,typeMap:{range:o.Z,"coded-value":s.Z,inherited:r.Z}};function l(e){if(!e?.type)return null;switch(e.type){case"range":return o.Z.fromJSON(e);case"codedValue":return s.Z.fromJSON(e);case"inherited":return r.Z.fromJSON(e)}return null}},72396:function(e,t,i){i.d(t,{v:function(){return s}});const s=new(i(41773).X)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"})},609:function(e,t,i){function s(e){const t={};for(const i in e){if("declaredClass"===i)continue;const n=e[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){t[i]=[];for(let e=0;e<n.length;e++)t[i][e]=s(n[e])}else"object"==typeof n?n.toJSON&&(t[i]=JSON.stringify(n)):t[i]=n}return t}i.d(t,{A:function(){return s}})},49183:function(e,t,i){i.d(t,{G$:function(){return T},K9:function(){return E},wn:function(){return m}});var s=i(88194),n=i(88338),r=i(20722),o=i(12005);const a=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],l=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],u=["upperLeft","lowerLeft"];function c(e){return e>=a.length?null:a[e]}function h(e){return e>=l.length?null:l[e]}function d(e){return e>=u.length?null:u[e]}function f(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function p(e,t,i){const s=e.asUnsafe(),n=t.createPointGeometry(i);for(;s.next();)switch(s.tag()){case 3:{const e=s.getUInt32(),i=s.pos()+e;let r=0;for(;s.pos()<i;)t.addCoordinatePoint(n,s.getSInt64(),r++);break}default:s.skip()}return n}function _(e,t,i){const s=e.asUnsafe(),n=t.createGeometry(i),r=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;s.next();)switch(s.tag()){case 2:{const e=s.getUInt32(),i=s.pos()+e;let r=0;for(;s.pos()<i;)t.addLength(n,s.getUInt32(),r++);break}case 3:{const e=s.getUInt32(),i=s.pos()+e;let o=0;for(t.allocateCoordinates(n);s.pos()<i;)t.addCoordinate(n,s.getSInt64(),o),o++,o===r&&(o=0);break}default:s.skip()}return n}function y(e){const t=e.asUnsafe(),i=new r.Z;let s="esriGeometryPoint";for(;t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),s=t.pos()+e;for(;t.pos()<s;)i.lengths.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),s=t.pos()+e;for(;t.pos()<s;)i.coords.push(t.getSInt64());break}case 1:s=o.S[t.getEnum()];break;default:t.skip()}return{queryGeometry:i,queryGeometryType:s}}function g(e){const t=e.asUnsafe();for(;t.next();)switch(t.tag()){case 1:return t.getString();case 2:return t.getFloat();case 3:return t.getDouble();case 4:return t.getSInt32();case 5:return t.getUInt32();case 6:return t.getInt64();case 7:return t.getUInt64();case 8:return t.getSInt64();case 9:return t.getBool();default:return t.skip(),null}return null}function m(e){const t=e.asUnsafe(),i={type:c(0)};for(;t.next();)switch(t.tag()){case 1:i.name=t.getString();break;case 2:i.type=c(t.getEnum());break;case 3:i.alias=t.getString();break;case 4:i.sqlType=h(t.getEnum());break;case 5:default:t.skip();break;case 6:i.defaultValue=t.getString()}return i}function b(e){const t={},i=e.asUnsafe();for(;i.next();)switch(i.tag()){case 1:t.name=i.getString();break;case 2:t.isSystemMaintained=i.getBool();break;default:i.skip()}return t}function F(e,t,i,s){const n=t.createFeature(i);let r=0;for(;e.next();)switch(e.tag()){case 1:{const t=s[r++].name;n.attributes[t]=e.processMessage(g);break}case 2:n.geometry=e.processMessageWithArgs(_,t,i);break;case 4:n.centroid=e.processMessageWithArgs(p,t,i);break;default:e.skip()}return n}function v(e){const t=[1,1,1,1],i=e.asUnsafe();for(;i.next();)switch(i.tag()){case 1:t[0]=i.getDouble();break;case 2:t[1]=i.getDouble();break;case 4:t[2]=i.getDouble();break;case 3:t[3]=i.getDouble();break;default:i.skip()}return t}function w(e){const t=[0,0,0,0],i=e.asUnsafe();for(;i.next();)switch(i.tag()){case 1:t[0]=i.getDouble();break;case 2:t[1]=i.getDouble();break;case 4:t[2]=i.getDouble();break;case 3:t[3]=i.getDouble();break;default:i.skip()}return t}function T(e){const t={originPosition:d(0)},i=e.asUnsafe();for(;i.next();)switch(i.tag()){case 1:t.originPosition=d(i.getEnum());break;case 2:t.scale=i.processMessage(v);break;case 3:t.translate=i.processMessage(w);break;default:i.skip()}return t}function S(e){const t={},i=e.asUnsafe();for(;i.next();)switch(i.tag()){case 1:t.shapeAreaFieldName=i.getString();break;case 2:t.shapeLengthFieldName=i.getString();break;case 3:t.units=i.getString();break;default:i.skip()}return t}function C(e,t){const i=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:i.wkid=e.getUInt32();break;case 5:i.wkt=e.getString();break;case 2:i.latestWkid=e.getUInt32();break;case 3:i.vcsWkid=e.getUInt32();break;case 4:i.latestVcsWkid=e.getUInt32();break;default:e.skip()}return i}function I(e,t){const i=t.createFeatureResult(),s=e.asUnsafe();i.geometryType=f(t,0);let n=!1;for(;s.next();)switch(s.tag()){case 1:i.objectIdFieldName=s.getString();break;case 3:i.globalIdFieldName=s.getString();break;case 4:i.geohashFieldName=s.getString();break;case 5:i.geometryProperties=s.processMessage(S);break;case 7:i.geometryType=f(t,s.getEnum());break;case 8:i.spatialReference=s.processMessageWithArgs(C,t);break;case 10:i.hasZ=s.getBool();break;case 11:i.hasM=s.getBool();break;case 12:i.transform=s.processMessage(T);break;case 9:i.exceededTransferLimit=s.getBool();break;case 13:t.addField(i,s.processMessage(m));break;case 15:n||(t.prepareFeatures(i),n=!0),t.addFeature(i,s.processMessageWithArgs(F,t,i,i.fields));break;case 2:i.uniqueIdField=s.processMessage(b);break;default:s.skip()}return t.finishFeatureResult(i),i}function x(e,t){const i={};let s=null;for(;e.next();)switch(e.tag()){case 4:s=e.processMessageWithArgs(y);break;case 1:i.featureResult=e.processMessageWithArgs(I,t);break;default:e.skip()}return null!=s&&i.featureResult&&t.addQueryGeometry(i,s),i}function E(e,t){try{const i=2,s=new n.Z(new Uint8Array(e),new DataView(e)),r={};for(;s.next();)s.tag()===i?r.queryResult=s.processMessageWithArgs(x,t):s.skip();return r}catch(e){throw new s.Z("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e})}}},12005:function(e,t,i){i.d(t,{J:function(){return u},S:function(){return l}});var s=i(26636),n=i(8554),r=i(24564),o=i(42829),a=i(20722);const l=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class u{constructor(e){this._options=e,this.geometryTypes=l,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new o.Z}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||(0,n.fS)(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const t=(0,s._R)(this._options.sourceSpatialReference)/(0,s._R)(e.spatialReference);if(1!==t)for(const i of e.features){if(!(0,r.S6)(i))continue;const e=i.geometry.coords;for(let i=2;i<e.length;i+=3)e[i]*=t}}addFeature(e,t){e.features.push(t)}createFeature(){return new r.u_(null,{},null,0)}createSpatialReference(){return{wkid:0}}createGeometry(){return new a.Z}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new a.Z}}},52616:function(e,t,i){i.d(t,{C:function(){return n}});var s=i(49183);function n(e,t){const i=(0,s.K9)(e,t),n=i.queryResult.featureResult,r=i.queryResult.queryGeometry,o=i.queryResult.queryGeometryType;if(n&&n.features&&n.features.length&&n.objectIdFieldName){const e=n.objectIdFieldName;for(const t of n.features)t.attributes&&(t.objectId=t.attributes[e])}return n&&(n.queryGeometry=r,n.queryGeometryType=o),n}},96010:function(e,t,i){i.d(t,{Ev:function(){return y},JT:function(){return f},Vn:function(){return F},Vr:function(){return m},hH:function(){return g},n7:function(){return _},qp:function(){return p}});var s=i(78619),n=i(95490),r=i(90756),o=i(34042),a=i(8554),l=i(609),u=i(52616),c=i(41921);const h="Layer does not support extent calculation.";function d(e,t,i){const s=e.geometry,n=e.toJSON();delete n.compactGeometryEnabled,delete n.defaultSpatialReferenceEnabled;const o=n;let l,u,c;if(s&&(u=s.spatialReference,c=(0,a.B9)(u),o.geometryType=(0,r.Ji)(s),o.geometry=function(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}(s,e.compactGeometryEnabled),o.inSR=c),n.groupByFieldsForStatistics&&(o.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds)switch(i?.uniqueIdFields?.length){case void 0:o.objectIds=n.objectIds.join(",");break;case 1:o.uniqueIds=JSON.stringify(n.objectIds),delete o.objectIds;break;default:o.uniqueIds=JSON.stringify(n.objectIds.map((e=>JSON.parse(e)))),delete o.objectIds}if(n.orderByFields&&(o.orderByFields=n.orderByFields.join(",")),!n.outFields||!n.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete o.outFields:n.outFields.includes("*")?o.outFields="*":o.outFields=n.outFields.join(","),n.outSR?(o.outSR=(0,a.B9)(n.outSR),l=e.outSpatialReference):s&&(n.returnGeometry||n.returnCentroid)&&(o.outSR=o.inSR,l=u),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(o.outStatistics=JSON.stringify(n.outStatistics)),n.fullText&&(o.fullText=JSON.stringify(n.fullText)),n.pixelSize&&(o.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=u&&null!=e.quantizationParameters?.extent&&u.equals(e.quantizationParameters.extent.spatialReference)&&delete n.quantizationParameters.extent.spatialReference,o.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.parameterValues&&(o.parameterValues=JSON.stringify(n.parameterValues)),n.rangeValues&&(o.rangeValues=JSON.stringify(n.rangeValues)),n.dynamicDataSource&&(o.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource),n.timeExtent){const e=n.timeExtent,{start:t,end:i}=e;null==t&&null==i||(o.time=t===i?t:`${t??"null"},${i??"null"}`),delete n.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=u&&null!=l&&u.equals(l)&&(o.defaultSR=o.inSR,delete o.inSR,delete o.outSR),o}async function f(e,t,i,s,n){const r=t.timeExtent?.isEmpty?{data:{features:[]}}:await F(e,t,"json",s,void 0,n);return(0,c.p)(t,i,r.data),r}async function p(e,t,i,s,n){if(t.timeExtent?.isEmpty)return{data:i.createFeatureResult()};const r=await _(e,t,s,n),o=r;return o.data=(0,u.C)(r.data,i),o}function _(e,t,i,s){return F(e,t,"pbf",i,void 0,s)}function y(e,t,i,s){return t.timeExtent?.isEmpty?Promise.resolve({data:{objectIds:[]}}):F(e,t,"json",i,{returnIdsOnly:!0},s)}function g(e,t,i,s){return t.timeExtent?.isEmpty?Promise.resolve({data:{count:0}}):F(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0},s)}async function m(e,t,i){if(t.timeExtent?.isEmpty)return{data:{count:0,extent:null}};const s=await F(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}),n=s.data;if(n.hasOwnProperty("extent"))return s;if(n.features)throw new Error(h);if(n.hasOwnProperty("count"))throw new Error(h);return s}function b(e,t){if(!e.returnIdsOnly||!t.uniqueIdFields)return e;const i={...e,returnUniqueIdsOnly:!0};return delete i.returnIdsOnly,i}async function F(e,t,i,r={},a={},u={}){const c="string"==typeof e?(0,n.mN)(e):e,h=t.geometry?[t.geometry]:[],f=(await(0,o.aX)(h,null,{signal:r.signal}))?.[0];null!=f&&((t=t.clone()).geometry=f);const p=(0,l.A)({...c.query,f:i,...b(a,u),...d(t,a,u)});return(0,s.Z)((0,n.v_)(c.path,(_=a,null==t.formatOf3DObjects||_.returnCountOnly||_.returnExtentOnly||_.returnIdsOnly?"query":"query3d")),{...r,responseType:"pbf"===i?"array-buffer":"json",query:{...p,...r.query}});var _}},41921:function(e,t,i){i.d(t,{p:function(){return n}});var s=i(35675);function n(e,t,i){if(!i?.features||!i.hasZ)return;const n=(0,s.k)(i.geometryType,t,e.outSpatialReference);if(null!=n)for(const e of i.features)n(e.geometry)}},13689:function(e,t,i){i.d(t,{Z:function(){return b}});var s,n=i(73440),r=i(41773),o=i(63255),a=i(61100),l=i(17155),u=(i(61432),i(96711),i(83850),i(1194)),c=i(48023),h=i(29884),d=i(76554);let f=s=class extends o.Z{constructor(e){super(e)}async collectRequiredFields(e,t){return(0,d.io)(e,t,this.expression)}clone(){return new s({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};(0,n._)([(0,l.Cb)({type:String,json:{write:{isRequired:!0}}})],f.prototype,"expression",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],f.prototype,"title",void 0),f=s=(0,n._)([(0,c.j)("esri.symbols.support.FeatureExpressionInfo")],f);const p=f;var _,y=i(46368);const g=(0,r.w)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),m=new r.X({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let b=class extends o.Z{static{_=this}constructor(e){super(e),this.featureExpressionInfo=void 0,this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e.expression?e:void 0:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,s){t[i]=e.write({},s),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):null!=e||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new _({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&(0,a._W)(this.featureExpressionInfo,e.featureExpressionInfo)}};(0,n._)([(0,l.Cb)({type:p,json:{write:!0}})],b.prototype,"featureExpressionInfo",void 0),(0,n._)([(0,u.r)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],b.prototype,"readFeatureExpressionInfo",null),(0,n._)([(0,h.c)("featureExpressionInfo",{featureExpressionInfo:{type:p},"featureExpression.value":{type:[0]}})],b.prototype,"writeFeatureExpressionInfo",null),(0,n._)([(0,l.Cb)({type:g.apiValues,nonNullable:!0,json:{type:g.jsonValues,read:g.read,write:{writer:g.write,isRequired:!0}}})],b.prototype,"mode",null),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],b.prototype,"offset",void 0),(0,n._)([(0,l.Cb)({type:y.f9,json:{type:String,read:m.read,write:m.write}})],b.prototype,"unit",null),b=_=(0,n._)([(0,c.j)("esri.symbols.support.ElevationInfo")],b)},15331:function(e,t,i){i.r(t),i.d(t,{default:function(){return te}});var s,n=i(73440),r=i(87833),o=i(93568),a=i(90403),l=i(17155),u=(i(61432),i(96711)),c=(i(83850),i(48023)),h=i(60147),d=i(45213),f=i(90756),p=i(57536),_=i(95014),y=i(33235),g=i(97550),m=i(29191),b=i(13689),F=i(18012),v=i(6733),w=i(46264),T=i(70880),S=i(3480),C=i(29292),I=i(74355),x=i(18764),E=i(71354),O=i(47566),R=i(64246),M=i(66619),k=i(12005),z=i(96010);class N{constructor(e,t){this.data=e,this.resolution=t,this.state={type:s.CREATED},this.alive=!0}process(e){switch(this.state.type){case s.CREATED:return this.state=this._gotoFetchCount(this.state,e),this.state.task.promise.then(e.resume,e.resume);case s.FETCH_COUNT:break;case s.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,e),this.state.task.promise.then(e.resume,e.resume);case s.FETCH_FEATURES:break;case s.FETCHED_FEATURES:this.state=this._goToDone(this.state,e);case s.DONE:}return null}get debugInfo(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}get _featureCount(){switch(this.state.type){case s.CREATED:case s.FETCH_COUNT:return 0;case s.FETCHED_COUNT:return this.state.featureCount;case s.FETCH_FEATURES:return this.state.previous.featureCount;case s.FETCHED_FEATURES:return this.state.features.length;case s.DONE:return this.state.previous.features.length}}get _stateToString(){switch(this.state.type){case s.CREATED:return"created";case s.FETCH_COUNT:return"fetch-count";case s.FETCHED_COUNT:return"fetched-count";case s.FETCH_FEATURES:return"fetch-features";case s.FETCHED_FEATURES:return"fetched-features";case s.DONE:return"done"}}_gotoFetchCount(e,t){return{type:s.FETCH_COUNT,previous:e,task:(0,C.vr)((async e=>{const i=await(0,C.mt)(t.fetchCount(this,e));this.state.type===s.FETCH_COUNT&&(this.state=function(e,t){return{type:s.FETCHED_COUNT,featureCount:t,previous:e}}(this.state,i.ok?i.value:1/0))}))}}_gotoFetchFeatures(e,t){return{type:s.FETCH_FEATURES,previous:e,task:(0,C.vr)((async i=>{const n=await(0,C.mt)(t.fetchFeatures(this,e.featureCount,i));this.state.type===s.FETCH_FEATURES&&(this.state=function(e,t){return{type:s.FETCHED_FEATURES,previous:e,features:t}}(this.state,n.ok?n.value:[]))}))}}_goToDone(e,t){return t.finish(this,e.features),{type:s.DONE,previous:e}}reset(){const e=this.state;switch(this.state={type:s.CREATED},e.type){case s.CREATED:case s.FETCHED_COUNT:case s.FETCHED_FEATURES:case s.DONE:break;case s.FETCH_COUNT:case s.FETCH_FEATURES:e.task.abort()}}intersects(e){return null==e||!this.data.extent||((0,O.oJ)(e,P),(0,O.kK)(this.data.extent,P))}}!function(e){e[e.CREATED=0]="CREATED",e[e.FETCH_COUNT=1]="FETCH_COUNT",e[e.FETCHED_COUNT=2]="FETCHED_COUNT",e[e.FETCH_FEATURES=3]="FETCH_FEATURES",e[e.FETCHED_FEATURES=4]="FETCHED_FEATURES",e[e.DONE=5]="DONE"}(s||(s={}));const P=(0,O.Ue)();let A=class extends T.Z{get _minimumVerticesPerFeature(){switch(this.store?.featureStore.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":return 1;case"esriGeometryPolygon":return 4;case"esriGeometryPolyline":return 2}}get _mandatoryOutFields(){const e=new Set;return this.objectIdField&&e.add(this.objectIdField),this.globalIdField&&e.add(this.globalIdField),e}set outFields(e){const t=this._get("outFields"),i=(0,I.G0)(e,this._mandatoryOutFields);(0,I.fS)(i,t)||(this._set("outFields",i),(0,I.ik)(i,t)||this.refresh())}get outFields(){return this._get("outFields")??this._mandatoryOutFields}set filter(e){const t=this._get("filter"),i=this._filterProperties(e);JSON.stringify(t)!==JSON.stringify(i)&&this._set("filter",i)}set customParameters(e){const t=this._get("customParameters");JSON.stringify(t)!==JSON.stringify(e)&&this._set("customParameters",e)}get _configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(e){const t=this._get("tileInfo");t!==e&&(null!=e&&null!=t&&JSON.stringify(e)===JSON.stringify(t)||(this._set("tileInfo",e),this.store.tileInfo=e))}set tileSize(e){this._get("tileSize")!==e&&this._set("tileSize",e)}get updating(){return this._updatingHandles.updating}get hasZ(){return this.store.featureStore.hasZ}constructor(e){super(e),this.suspended=!0,this._historicMoment=null,this.tilesOfInterest=[],this.availability=0,this._pendingTiles=new Map,this._updatingHandles=new h.R}initialize(){this._initializeFetchExtent(),this._updatingHandles.add((()=>this._configuration),(()=>this.refresh())),this._updatingHandles.add((()=>this.tilesOfInterest),(()=>{this._updatePriorities(),this._process()}),{sync:!0,initial:!0,equals:(e,t)=>(0,S.fS)(e,t,(({id:e},{id:t})=>e===t))}),this.addHandles((0,a.gx)((()=>!this.suspended),(()=>this._process())))}_updatePriorities(){this.store.setPriorityOrderByKey(this.tilesOfInterest.map((e=>e.id??""))??[])}destroy(){this._pendingTiles.forEach((e=>this._deletePendingTile(e))),this._pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this._updatingHandles.destroy()}refresh(){this.store.refresh(),this._pendingTiles.forEach((e=>this._deletePendingTile(e))),this._process()}async handleEdits(e){if(e.historicMoment&&(this._historicMoment=e.historicMoment),!e.addedFeatures.length&&!e.updatedFeatures.length&&!e.deletedFeatures.length)return;for(const e of this._pendingTiles.values())e.reset();const t={...e,deletedFeatures:e.deletedFeatures.map((({objectId:e,globalId:t})=>e&&-1!==e?e:this._lookupObjectIdByGlobalId(t)))},i=(0,C.vr)((async e=>{try{await this.store.processEdits(t,((e,t)=>this._queryFeaturesById(e,t)),e),this._processPendingTiles()}catch(e){(0,o.r9)(e),u.Z.getLogger(this).warn("Failed to apply edits",e)}}));this.addHandles(i),await this._updatingHandles.addPromise(i.promise)}setHistoricMoment(e){e?.getTime()!==this._historicMoment?.getTime()&&(this._historicMoment=e,this.refresh())}_initializeFetchExtent(){if(!this.capabilities.query.supportsExtent||!(0,M.M8)(this.url))return;const e=(0,C.vr)((async e=>{try{const t=await(0,z.Vr)(this.url,new m.Z({where:"1=1",outSpatialReference:this.spatialReference,cacheHint:this.capabilities.query.supportsCacheHint??void 0}),{query:this._configuration.customParameters,signal:e});this.store.extent=E.Z.fromJSON(t.data?.extent)}catch(e){(0,o.r9)(e),u.Z.getLogger(this).warn("Failed to fetch data extent",e)}}));this._updatingHandles.addPromise(e.promise.then((()=>this._process()))),this.addHandles(e)}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this._pendingTiles.values()).map((e=>e.debugInfo)),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const e of this._pendingTiles.values())e.alive=!1}_createPendingTiles(){if(this.suspended)return;const e=this._collectMissingTilesInfo();if(this._setAvailability(null==e?1:e.coveredArea/e.fullArea),null!=e)for(const{data:t,resolution:i}of e.missingTiles){const e=this._pendingTiles.get(t.id);e?(e.resolution=i,e.alive=!0):this._createPendingTile(t,i)}}_collectMissingTilesInfo(){let e=null;for(const t of this.tilesOfInterest){const i=this.store.process(t,((e,t)=>this._verifyTileComplexity(e,t)),this.outFields);null==e?e=i:e.prepend(i)}return e}_deletePendingTiles(){for(const e of this._pendingTiles.values())e.alive||this._deletePendingTile(e)}_processPendingTiles(){const e={fetchCount:(e,t)=>this._fetchCount(e,t),fetchFeatures:(e,t,i)=>this._fetchFeatures(e,t,i),finish:(e,t)=>this._finishPendingTile(e,t),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(e))for(const t of this._pendingTiles.values())this._verifyTileComplexity(this.store.getFeatureCount(t.data),t.resolution)&&this._updatingHandles.addPromise(t.process(e))}_verifyTileComplexity(e,t){return this._verifyVertexComplexity(e)&&this._verifyFeatureDensity(e,t)}_verifyVertexComplexity(e){return e*this._minimumVerticesPerFeature<j}_verifyFeatureDensity(e,t){if(null==this.tileInfo)return!1;const i=this.tileSize*t;return e*(D/(i*i))<V}_ensureFetchAllCounts(e){let t=!0;for(const i of this._pendingTiles.values())i.state.type<s.FETCHED_COUNT&&this._updatingHandles.addPromise(i.process(e)),i.state.type<=s.FETCH_COUNT&&(t=!1);return t}_finishPendingTile(e,t){this.store.add(e.data,t),this._deletePendingTile(e),this._updateAvailability()}_updateAvailability(){const e=this._collectMissingTilesInfo();this._setAvailability(null==e?1:e.coveredArea/e.fullArea)}_setAvailability(e){this._set("availability",e)}_createPendingTile(e,t){const i=new N(e,t);return this._pendingTiles.set(e.id,i),i}_deletePendingTile(e){e.reset(),this._pendingTiles.delete(e.data.id)}async _fetchCount(e,t){return this.store.fetchCount(e.data,this.url,this._createCountQuery(e),{query:this.customParameters,timeout:Z,signal:t})}async _fetchFeatures(e,t,i){let s=0;const n=[];let r=0,o=t;for(;;){const a=this._createFeaturesQuery(e),l=this._setPagingParameters(a,s,o),{features:u,exceededTransferLimit:c}=await this._queryFeatures(a,i);l&&(s+=a.num),r+=u.length;for(const e of u)n.push(e);if(o=t-r,!l||!c||o<=0)return n}}_filterProperties(e){return null==e?{where:"1=1",gdbVersion:void 0,timeExtent:void 0}:{where:e.where||"1=1",timeExtent:e.timeExtent,gdbVersion:e.gdbVersion}}_lookupObjectIdByGlobalId(e){const t=this.globalIdField,i=this.objectIdField;if(null==t)throw new Error("Expected globalIdField to be defined");let s=null;const n=e?(0,x.L3)(e):e;if(this.store.featureStore.forEach((e=>{n===(0,x.L3)(e.attributes[t])&&(s=e.objectId??e.attributes[i])})),null==s)throw new Error(`Expected to find a feature with globalId ${e}`);return s}_queryFeaturesById(e,t){const i=this._createFeaturesQuery();return i.objectIds=e,this._queryFeatures(i,t)}_queryFeatures(e,t){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(e,t):this._queryFeaturesJSON(e,t)}async _queryFeaturesPBF(e,t){const{sourceSpatialReference:i}=this,{data:s}=await(0,z.qp)(this.url,e,new k.J({sourceSpatialReference:i}),{query:this._configuration.customParameters,timeout:Z,signal:t});return(0,R.lM)(s)}async _queryFeaturesJSON(e,t){const{sourceSpatialReference:i}=this,{data:s}=await(0,z.JT)(this.url,e,i,{query:this._configuration.customParameters,timeout:Z,signal:t});return(0,R.h_)(s,{type:"object-id",fieldName:this.objectIdField})}_createCountQuery(e){const t=this._createBaseQuery(e);return this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}_createFeaturesQuery(e=null){const t=this._createBaseQuery(e),i=null!=e?.data?this.store.getAttributesForTile(e?.data?.id):null,s=(0,I.G0)((0,I.e5)(this.outFields,i??new Set),this._mandatoryOutFields);return t.outFields=Array.from(s),t.returnGeometry=!0,null!=e&&(this.capabilities.query.supportsResultType?t.resultType="tile":this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0)),t}_createBaseQuery(e){const t=new m.Z({returnZ:this.hasZ,returnM:!1,historicMoment:this._historicMoment,geometry:null!=this.tileInfo&&null!=e?(0,O.HH)(e.data.extent,this.tileInfo.spatialReference):void 0}),i=this._configuration.filter;return null!=i&&(t.where=i.where,t.gdbVersion=i.gdbVersion,t.timeExtent=i.timeExtent),t.outSpatialReference=this.spatialReference,t}_setPagingParameters(e,t,i){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:s,supportsCacheHint:n,tileMaxRecordCount:r,maxRecordCount:o,supportsResultType:a}=this.capabilities.query,l=s?m.Z.MAX_MAX_RECORD_COUNT_FACTOR:1,u=l*((a||n)&&r?r:o||q);return e.start=t,s?(e.maxRecordCountFactor=Math.min(l,Math.ceil(i/u)),e.num=Math.min(i,e.maxRecordCountFactor*u)):e.num=Math.min(i,u),!0}};(0,n._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"url",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"objectIdField",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"globalIdField",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"capabilities",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"sourceSpatialReference",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"spatialReference",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"store",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],A.prototype,"_minimumVerticesPerFeature",null),(0,n._)([(0,l.Cb)()],A.prototype,"_mandatoryOutFields",null),(0,n._)([(0,l.Cb)()],A.prototype,"outFields",null),(0,n._)([(0,l.Cb)()],A.prototype,"suspended",void 0),(0,n._)([(0,l.Cb)()],A.prototype,"_historicMoment",void 0),(0,n._)([(0,l.Cb)()],A.prototype,"filter",null),(0,n._)([(0,l.Cb)()],A.prototype,"customParameters",null),(0,n._)([(0,l.Cb)({readOnly:!0})],A.prototype,"_configuration",null),(0,n._)([(0,l.Cb)()],A.prototype,"tileInfo",null),(0,n._)([(0,l.Cb)()],A.prototype,"tileSize",null),(0,n._)([(0,l.Cb)()],A.prototype,"tilesOfInterest",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],A.prototype,"updating",null),(0,n._)([(0,l.Cb)({readOnly:!0})],A.prototype,"availability",void 0),(0,n._)([(0,l.Cb)()],A.prototype,"hasZ",null),A=(0,n._)([(0,c.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher")],A);const q=2e3,Z=6e5,j=1e6,D=25,V=1;var U=i(46965),H=i(70677),L=i(31743);class B{constructor(){this._store=new Map,this._priorities=new Map}get size(){return this._store.size}setPriorityOrderByKey(e){this._priorities.clear();for(let t=e.length-1;t>=0;t--)this._priorities.set(e[t],e.length-t)}hasLowerPriority(e){const t=this._priorities.get(e);if(null==t)return!0;for(const[e]of this._store){const i=this._priorities.get(e);if(null==i||i<t)return!0}return!1}someFromLowestToHighestPriority(e){const{_priorities:t}=this;for(const[i,s]of this._store)if(!t.has(i)&&e(s,i))return!0;for(const[i]of t){const t=this._store.get(i);if(t&&e(t,i))return!0}return!1}set(e,t){this._store.set(e,t)}delete(e){return this._store.delete(e)}get(e){return this._store.get(e)}has(e){return this._store.has(e)}clear(){this._store.clear()}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}}let G=class extends T.Z{setPriorityOrderByKey(e){this._tiles.setPriorityOrderByKey(e)}get _memoryLimitExceeded(){return this.featureStore.usedMemory>=this.maximumByteSize}constructor(e){super(e),this.tileInfo=null,this.extent=null,this.maximumByteSize=10*U.Y.MEGABYTES,this._tileBounds=new H.H,this._tiles=new B,this._refCounts=new Map,this._tileFeatureCounts=new Map,this._tmpBoundingRect=(0,O.Ue)()}add(e,t){for(const e of t)this._referenceFeature(e.objectId);const i=this.featureStore.upsertMany(t),s=i.map((e=>new Set(Object.keys(e.attributes)))).reduce(((e,t)=>(0,I.jV)(e,t)),new Set(Object.keys(i[0]?.attributes??[]))),n=this._memoryLimitExceeded;this._addTileStorage(e,new Set(i.map((e=>e.objectId))),s),n&&this._applyCacheMemoryLimits()}_applyCacheMemoryLimits(){if(!this._memoryLimitExceeded)return;const{_tiles:e,featureStore:t,maximumByteSize:i}=this;e.someFromLowestToHighestPriority((e=>!this._memoryLimitExceeded||t.usedMemory-this._estimateRemoveTileMemoryReduction(e)<i||(this._removeTileStorage(e),!1)))}_estimateRemoveTileMemoryReduction(e){let t=0;for(const i of e.objectIds)if(1===this._refCounts.get(i)){const e=this.featureStore.getFeature(i);e&&(t+=this.featureStore.estimateFeatureUsedMemory?.(e)??0)}return t}getAttributesForTile(e){return e?this._tiles.get(e)?.attributeKeys:null}destroy(){this.clear(),this._tileFeatureCounts.clear()}clear(){this.featureStore.clear(),this._tileBounds.clear(),this._tiles.clear(),this._refCounts.clear()}refresh(){this.clear(),this._tileFeatureCounts.clear()}processEdits(e,t,i){return this._processEditsDelete(e.deletedFeatures.concat(e.updatedFeatures)),this._processEditsRefetch(e.addedFeatures.concat(e.updatedFeatures),t,i)}_addTileStorage(e,t,i){const s=e.id;this._tiles.set(s,new J(e,t,i)),this._tileBounds.set(s,e.extent),this._tileFeatureCounts.set(s,t.size)}_remove({id:e}){const t=this._tiles.get(e);t&&this._removeTileStorage(t)}_removeTileStorage(e){const t=[];for(const i of e.objectIds)this._unreferenceFeature(i)===K.REMOVED&&t.push(i);this.featureStore.removeManyById(t);const i=e.data.id;this._tiles.delete(i),this._tileBounds.delete(i)}_processEditsDelete(e){this.featureStore.removeManyById(e);for(const t of this._tiles.values()){for(const i of e)t.objectIds.delete(i);this._tileFeatureCounts.set(t.data.id,t.objectIds.size)}for(const t of e)this._refCounts.delete(t)}async _processEditsRefetch(e,t,i){if(!e.length)return;const s=(await t(e,i)).features,{hasZ:n,hasM:r}=this.featureStore;for(const e of s){const t=(0,R.$)(this._tmpBoundingRect,e.geometry,n,r);null!=t&&this._tileBounds.forEachInBounds(t,(t=>{const i=this._tiles.get(t);this.featureStore.add(e);const s=e.objectId;i.objectIds.has(s)||(i.objectIds.add(s),this._referenceFeature(s),this._tileFeatureCounts.set(i.data.id,i.objectIds.size))}))}}process(e,t=(()=>!0),i){if(null==this.tileInfo||!e.extent||null!=this.extent&&!(0,O.kK)((0,O.oJ)(this.extent,this._tmpBoundingRect),e.extent))return new $(e);if(this._memoryLimitExceeded&&!this._tiles.hasLowerPriority(e.id??""))return new $(e);const s=this.getAttributesForTile(e.id);if((0,I.ik)(i,s))return new $(e);const n=this._createTileTree(e,this.tileInfo);return this._simplify(n,t,null,0,1),this._collectMissingTiles(e,n,this.tileInfo,i)}get debugInfo(){return Array.from(this._tiles.values()).map((({data:e})=>({data:e,featureCount:this._tileFeatureCounts.get(e.id)||0})))}getFeatureCount(e){return this._tileFeatureCounts.get(e.id)??0}async fetchCount(e,t,i,s){const n=this._tileFeatureCounts.get(e.id);if(null!=n)return n;const r=await(0,z.hH)(t,i,s);return this._tileFeatureCounts.set(e.id,r.data.count),r.data.count}_createTileTree(e,t){const i=new W(e.level,e.row,e.col);return t.updateTileInfo(i,g.Z.ExtrapolateOptions.POWER_OF_TWO),this._tileBounds.forEachInBounds(e.extent,(s=>{const n=this._tiles.get(s)?.data;n&&function(e,t){if(!e||!t)return!1;if(e.level===t.level)return e.row===t.row&&e.col===t.col;const i=e.level<t.level,s=i?e:t,n=i?t:e,r=1<<n.level-s.level;return Math.floor(n.row/r)===s.row&&Math.floor(n.col/r)===s.col}(e,n)&&this._populateChildren(i,n,t,this._tileFeatureCounts.get(n.id)||0)})),i}_populateChildren(e,t,i,s){const n=t.level-e.level-1;if(n<0)return void(e.isLeaf=!0);const r=t.row>>n,o=t.col>>n,a=e.row<<1,l=o-(e.col<<1)+(r-a<<1),u=e.children[l];if(null!=u)this._populateChildren(u,t,i,s);else{const n=new W(e.level+1,r,o);i.updateTileInfo(n,g.Z.ExtrapolateOptions.POWER_OF_TWO),e.children[l]=n,this._populateChildren(n,t,i,s)}}_simplify(e,t,i,s,n){const r=n*n;if(e.isLeaf)return t(this.getFeatureCount(e),n)?0:(this._remove(e),null!=i&&(i.children[s]=null),r);const o=n/2,a=o*o;let l=0;for(let i=0;i<e.children.length;i++){const s=e.children[i];l+=null!=s?this._simplify(s,t,e,i,o):a}return 0===l?this._mergeChildren(e):1-l/r<Y&&(this._purge(e),null!=i&&(i.children[s]=null),l=r),l}_mergeChildren(e){const t=new Set;let i;this._forEachLeaf(e,(e=>{const s=this._tiles.get(e.id);if(s){i=i?(0,I.jV)(i,s.attributeKeys):new Set(s.attributeKeys);for(const e of s.objectIds)t.has(e)||(t.add(e),this._referenceFeature(e));this._remove(e)}})),this._addTileStorage(e,t,i??new Set),e.isLeaf=!0,e.children[0]=e.children[1]=e.children[2]=e.children[3]=null,this._tileFeatureCounts.set(e.id,t.size)}_forEachLeaf(e,t){for(const i of e.children)null!=i&&(i.isLeaf?t(i):this._forEachLeaf(i,t))}_purge(e){if(null!=e)if(e.isLeaf)this._remove(e);else for(let t=0;t<e.children.length;t++){const i=e.children[t];this._purge(i),e.children[t]=null}}_collectMissingTiles(e,t,i,s){const n=new Q(i,e,this.extent);return this._collectMissingTilesRecurse(t,n,1,s),n.info}_collectMissingTilesRecurse(e,t,i,s){const n=this.getAttributesForTile(e.id),r=n&&!(0,I.ik)(s,n);if(r&&t.addMissing(e.level,e.row,e.col,i),e.isLeaf)return;if(!e.hasChildren)return void(r||t.addMissing(e.level,e.row,e.col,i));const o=i/2;for(let i=0;i<e.children.length;i++){const n=e.children[i];null==n?t.addMissing(e.level+1,(e.row<<1)+((2&i)>>1),(e.col<<1)+(1&i),o):this._collectMissingTilesRecurse(n,t,o,s)}}_referenceFeature(e){const t=(this._refCounts.get(e)||0)+1;return this._refCounts.set(e,t),1===t?K.ADDED:K.UNCHANGED}_unreferenceFeature(e){const t=(this._refCounts.get(e)||0)-1;return 0===t?(this._refCounts.delete(e),K.REMOVED):(t>0&&this._refCounts.set(e,t),K.UNCHANGED)}get test(){}};(0,n._)([(0,l.Cb)({constructOnly:!0})],G.prototype,"featureStore",void 0),(0,n._)([(0,l.Cb)()],G.prototype,"tileInfo",void 0),(0,n._)([(0,l.Cb)()],G.prototype,"extent",void 0),(0,n._)([(0,l.Cb)()],G.prototype,"maximumByteSize",void 0),G=(0,n._)([(0,c.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTileStore")],G);class J{constructor(e,t,i){this.data=e,this.objectIds=t,this.attributeKeys=i}}class W{constructor(e,t,i){this.level=e,this.row=t,this.col=i,this.isLeaf=!1,this.extent=null,this.children=[null,null,null,null]}get hasChildren(){return!this.isLeaf&&(null!=this.children[0]||null!=this.children[1]||null!=this.children[2]||null!=this.children[3])}}class ${constructor(e,t=[]){this.missingTiles=t,this.fullArea=0,this.coveredArea=0,this.fullArea=(0,O.SO)(e.extent),this.coveredArea=this.fullArea}prepend(e){this.missingTiles=e.missingTiles.concat(this.missingTiles),this.coveredArea+=e.coveredArea,this.fullArea+=e.fullArea}}class Q{constructor(e,t,i){this._tileInfo=e,this._extent=null,this.info=new $(t),null!=i&&(this._extent=(0,O.oJ)(i))}addMissing(e,t,i,s){const n=new L.f(null,e,t,i);this._tileInfo.updateTileInfo(n,g.Z.ExtrapolateOptions.POWER_OF_TWO),null==n.extent||null!=this._extent&&!(0,O.kK)(this._extent,n.extent)||(this.info.missingTiles.push({data:n,resolution:s}),this.info.coveredArea-=(0,O.SO)(n.extent))}}const Y=.18751;var K,X;(X=K||(K={}))[X.ADDED=0]="ADDED",X[X.REMOVED=1]="REMOVED",X[X.UNCHANGED=2]="UNCHANGED";let ee=class extends r.Z.EventedAccessor{constructor(){super(...arguments),this._isInitializing=!0,this.remoteClient=null,this._whenSetup=(0,o.hh)(),this._elevationAligner=(0,F.p)(),this._elevationFilter=(0,v.c)(),this._symbologyCandidatesFetcher=(0,w.k)(),this._updatingHandles=new h.R,this._alignPointsInFeatures=async(e,t)=>{const i={query:e},s=await this.remoteClient.invoke("alignElevation",i,{signal:t});return(0,o.k_)(t),s},this._getSymbologyCandidates=async(e,t)=>{const i={candidates:e,spatialReference:this._spatialReference.toJSON()},s=await this.remoteClient.invoke("getSymbologyCandidates",i,{signal:t});return(0,o.k_)(t),s}}get updating(){return this._isInitializing||this._updatingHandles.updating||this._featureFetcher.updating}destroy(){this._featureFetcher?.destroy(),this._queryEngine?.destroy(),this._featureStore?.clear()}async setup(e){if(this.destroyed)return{result:{}};const{geometryType:t,objectIdField:i,timeInfo:s,fieldsIndex:n}=e.serviceInfo,{hasZ:r}=e,o=d.Z.fromJSON(e.spatialReference);this._spatialReference=o,this._featureStore=new _.Z({...e.serviceInfo,hasZ:r,hasM:!1}),this._featureStore.estimateFeatureUsedMemory=e=>e.usedMemory,this._queryEngine=new y.qq({spatialReference:e.spatialReference,featureStore:this._featureStore,geometryType:t,fieldsIndex:n,hasZ:r,hasM:!1,featureIdInfo:{type:"object-id",fieldName:i},timeInfo:s}),this._featureFetcher=new A({store:new G({featureStore:this._featureStore}),url:e.serviceInfo.url,objectIdField:e.serviceInfo.objectIdField,globalIdField:e.serviceInfo.globalIdField,capabilities:e.serviceInfo.capabilities,spatialReference:o,sourceSpatialReference:d.Z.fromJSON(e.serviceInfo.spatialReference),customParameters:e.configuration.customParameters});const l="3d"===e.configuration.viewType;return this._elevationAligner=(0,F.p)(l,{elevationInfo:null!=e.elevationInfo?b.Z.fromJSON(e.elevationInfo):null,alignPointsInFeatures:this._alignPointsInFeatures}),this._elevationFilter=(0,v.c)(l),this.addHandles([(0,a.YP)((()=>this._featureFetcher.availability),(e=>this.emit("notify-availability",{availability:e})),a.Z_),(0,a.YP)((()=>this.updating),(()=>this._notifyUpdating()))]),this._whenSetup.resolve(),this._isInitializing=!1,this.configure(e.configuration)}async configure(e){return await this._updatingHandles.addPromise(this._whenSetup.promise),this._updateFeatureFetcherConfiguration(e),ie}async setSuspended(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,o.k_)(t),this._featureFetcher.suspended=e,ie}async updateOutFields(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,o.k_)(t),this._featureFetcher.outFields=new Set(e??[]),ie}async fetchCandidates(e,t){await this._whenSetup.promise,(0,o.k_)(t);const i=function(e,t){const i=!!t||void 0;if(!e.filter)return{...e,query:{where:"1=1",returnZ:i}};const{distance:s,units:n,spatialRel:r,where:o,timeExtent:a,objectIds:l}=e.filter,u={geometry:e.filter.geometry?(0,f.im)(e.filter.geometry):void 0,distance:s,units:n,spatialRel:r,timeExtent:a,objectIds:l,returnZ:i,where:o??"1=1"};return{...e,query:u}}(e,this._featureStore.hasZ),s=t?.signal,n=await(0,p.T)(this._queryEngine,i,s);(0,o.k_)(s);const r=await this._elevationAligner.alignCandidates(n.candidates,d.Z.fromJSON(e.point.spatialReference)??d.Z.WGS84,s);(0,o.k_)(s);const a=await this._symbologyCandidatesFetcher.fetch(r,s);(0,o.k_)(s);const l=0===a.length?r:r.concat(a);return{result:{candidates:this._elevationFilter.filter(i,l)}}}async updateTiles(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,o.k_)(t),this._featureFetcher.tileSize=e.tileSize,this._featureFetcher.tilesOfInterest=e.tiles,this._featureFetcher.tileInfo=null!=e.tileInfo?g.Z.fromJSON(e.tileInfo):null,ie}async refresh(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,o.k_)(t),this._featureFetcher.refresh(),ie}async whenNotUpdating(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,o.k_)(t),await(0,a.N1)((()=>!this.updating),t),(0,o.k_)(t),ie}async getDebugInfo(e,t){return(0,o.k_)(t),{result:this._featureFetcher.debugInfo}}async handleEdits(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,o.k_)(t),await this._updatingHandles.addPromise(this._featureFetcher.handleEdits(e)),(0,o.k_)(t),ie}async setHistoricMoment(e,t){return this._featureFetcher.setHistoricMoment(e.moment),ie}async notifyElevationSourceChange(e,t){return this._elevationAligner.notifyElevationSourceChange(),ie}async notifySymbologyChange(e,t){return this._symbologyCandidatesFetcher.notifySymbologyChange(),ie}async setSymbologySnappingSupported(e){return this._symbologyCandidatesFetcher=(0,w.k)(e,this._getSymbologyCandidates),ie}_updateFeatureFetcherConfiguration(e){this._featureFetcher.filter=null!=e.filter?m.Z.fromJSON(e.filter):null,this._featureFetcher.customParameters=e.customParameters}_notifyUpdating(){this.emit("notify-updating",{updating:this.updating})}};(0,n._)([(0,l.Cb)({readOnly:!0})],ee.prototype,"updating",null),(0,n._)([(0,l.Cb)()],ee.prototype,"_isInitializing",void 0),ee=(0,n._)([(0,c.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker")],ee);const te=ee;const ie={result:{}}},18012:function(e,t,i){i.d(t,{p:function(){return l}});i(61432);var s=i(12853),n=i(79577),r=i(93568),o=i(26636),a=i(46368);function l(e=!1,t){if(e){const{elevationInfo:e,alignPointsInFeatures:i}=t;return new c(e,i)}return new u}class u{async alignCandidates(e,t,i){return e}notifyElevationSourceChange(){}}class c{constructor(e,t){this._elevationInfo=e,this._alignPointsInFeatures=t,this._alignmentsCache=new s.z(1024),this._cacheVersion=0}async alignCandidates(e,t,i){const s=this._elevationInfo;return null==s||"absolute-height"!==s.mode||s.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,i):(function(e,t,i){const{offset:s,unit:n}=i;if(null==s)return;const r=(0,o._R)(t),l=s*((0,a.Z7)(n??"meters")/r);for(const t of e)switch(t.type){case"edge":t.start.z+=l,t.end.z+=l;continue;case"vertex":t.target.z+=l;continue}}(e,t,s),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(e,t,i){const s=new Map;for(const t of e)(0,n.s1)(s,t.objectId,f).push(t);const[o,a,l]=this._prepareQuery(s,t),u=await this._alignPointsInFeatures(o,i);if((0,r.k_)(i),l!==this._cacheVersion)return this._alignComputedElevationCandidates(e,t,i);this._applyCacheAndResponse(o,u,a);const{drapedObjectIds:c,failedObjectIds:h}=u,d=[];for(const t of e){const{objectId:e}=t;c.has(e)&&"edge"===t.type&&(t.draped=!0),h.has(e)||d.push(t)}return d}_prepareQuery(e,t){const i=[],s=[];for(const[t,n]of e){const e=[];for(const i of n)this._addToQueriesOrCachedResult(t,i.target,e,s),"edge"===i.type&&(this._addToQueriesOrCachedResult(t,i.start,e,s),this._addToQueriesOrCachedResult(t,i.end,e,s));0!==e.length&&i.push({objectId:t,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:i},s,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,i,s){const n=d(e,t),r=this._alignmentsCache.get(n);null==r?i.push(t):s.push(new h(t,r))}_applyCacheAndResponse(e,{elevations:t,drapedObjectIds:i,failedObjectIds:s},n){for(const e of n)e.apply();let r=0;const o=this._alignmentsCache;for(const{objectId:n,points:a}of e.pointsInFeatures){if(s.has(n)){r+=a.length;continue}const e=!i.has(n);for(const i of a){const s=d(n,i),a=t[r++];i.z=a,e&&o.put(s,a,1)}}}}class h{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function d(e,{x:t,y:i,z:s,spatialReference:n}){return`${e}-${t}-${i}-${s??0}}-wkid:${n?.wkid}`}function f(){return[]}},6733:function(e,t,i){i.d(t,{c:function(){return o}});i(61432);class s{filter(e,t){return t}notifyElevationSourceChange(){}}class n{filter(e,t){const{point:i,distance:s}=e,{z:n}=i;if(null==n)return t;if(0===t.length)return t;const o=function(e){return"number"==typeof e?{x:e,y:e,z:e}:e}(s),a=this._updateCandidatesTo3D(t,i,o).filter(r);return a.sort(u),a}_updateCandidatesTo3D(e,t,i){for(const s of e)switch(s.type){case"edge":a(s,t,i);continue;case"vertex":l(s,t,i);continue}return e}}function r(e){return e.distance<=1}function o(e=!1){return e?new n:new s}function a(e,t,{x:i,y:s,z:n}){const{start:r,end:o,target:a}=e;e.draped||function(e,t,i,s){const n=s.x-i.x,r=s.y-i.y,o=s.z-i.z,a=n*n+r*r+o*o,l=(t.x-i.x)*n+(t.y-i.y)*r+o*(t.z-i.z),u=Math.min(1,Math.max(0,l/a)),c=i.x+n*u,h=i.y+r*u,d=i.z+o*u;e.x=c,e.y=h,e.z=d}(a,t,r,o);const l=(t.x-a.x)/i,u=(t.y-a.y)/s,c=(t.z-a.z)/n;e.distance=Math.sqrt(l*l+u*u+c*c)}function l(e,t,{x:i,y:s,z:n}){const{target:r}=e,o=(t.x-r.x)/i,a=(t.y-r.y)/s,l=(t.z-r.z)/n,u=Math.sqrt(o*o+a*a+l*l);e.distance=u}function u(e,t){return e.distance-t.distance}},46264:function(e,t,i){i.d(t,{k:function(){return a}});i(61432);var s=i(28947),n=i(12853),r=i(93568),o=i(29138);function a(e=!1,t){return e?new u(t):new l}class l{async fetch(){return[]}notifySymbologyChange(){}}class u{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new n.z(1024),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];const i=[],n=[],o=this._candidatesCache;for(const t of e){const e=c(t),r=o.get(e);if(r)for(const e of r)n.push((0,s.d9)(e));else i.push(t),o.put(e,[],1)}if(0===i.length)return n;const a=this._cacheVersion,{candidates:l,sourceCandidateIndices:u}=await this._getSymbologyCandidates(i,t);if((0,r.k_)(t),a!==this._cacheVersion)return this.fetch(e,t);const h=[],{length:d}=l;for(let e=0;e<d;++e){const t=l[e],n=c(i[u[e]]),r=o.get(n);r.push(t),o.put(n,r,r.length),h.push((0,s.d9)(t))}return n.concat(h)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function c(e){switch(e.type){case"vertex":{const{objectId:t,target:i}=e,s=`${t}-vertex-${i.x}-${i.y}-${i.z??0}`;return(0,o.hP)(s).toString()}case"edge":{const{objectId:t,start:i,end:s}=e,n=`${t}-edge-${i.x}-${i.y}-${i.z??0}-to-${s.x}-${s.y}-${s.z??0}`;return(0,o.hP)(n).toString()}default:return""}}}}]);