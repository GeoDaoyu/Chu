"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[74989],{45415:function(e,t,i){function s(e,t,i,s,r){n(e,t,i||0,s||e.length-1,r||a)}function n(e,t,i,s,a){for(;s>i;){if(s-i>600){var o=s-i+1,l=t-i+1,h=Math.log(o),c=.5*Math.exp(2*h/3),d=.5*Math.sqrt(h*c*(o-c)/o)*(l-o/2<0?-1:1);n(e,t,Math.max(i,Math.floor(t-l*c/o+d)),Math.min(s,Math.floor(t+(o-l)*c/o+d)),a)}var u=e[t],p=i,g=s;for(r(e,i,t),a(e[s],u)>0&&r(e,i,s);p<g;){for(r(e,p,g),p++,g--;a(e[p],u)<0;)p++;for(;a(e[g],u)>0;)g--}0===a(e[i],u)?r(e,i,g):r(e,++g,s),g<=t&&(i=g+1),t<=g&&(s=g-1)}}function r(e,t,i){var s=e[t];e[t]=e[i],e[i]=s}function a(e,t){return e<t?-1:e>t?1:0}i.d(t,{q:function(){return s}})},96946:function(e,t,i){i.d(t,{Q:function(){return o},b:function(){return E}});var s=i(3480),n=i(79487),r=(i(61432),i(63974)),a=i(45415);class o{constructor(e=9,t){this._compareMinX=u,this._compareMinY=p,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),x.prune(),C.prune(),w.prune(),S.prune()}all(e){l(this._data,e)}search(e,t){let i=this._data;const s=this._toBBox;if(b(e,i))for(x.clear();i;){for(let n=0,r=i.children.length;n<r;n++){const r=i.children[n],a=i.leaf?s(r):r;b(e,a)&&(i.leaf?t(r):m(e,a)?l(r,t):x.push(r))}i=x.pop()}}collides(e){let t=this._data;const i=this._toBBox;if(!b(e,t))return!1;for(x.clear();t;){for(let s=0,n=t.children.length;s<n;s++){const n=t.children[s],r=t.leaf?i(n):n;if(b(e,r)){if(t.leaf||m(e,r))return!0;x.push(n)}}t=x.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new O([]),this}remove(e){if(!e)return this;let t,i=this._data,r=null,a=0,o=!1;const l=this._toBBox(e);for(w.clear(),S.clear();i||w.length>0;){if(i||(i=w.pop(),r=w.data[w.length-1],a=S.pop()??0,o=!0),i.leaf&&(t=(0,s.cq)(i.children,(0,n.CY)(e),i.children.length,i.indexHint),-1!==t))return i.children.splice(t,1),w.push(i),this._condense(w),this;o||i.leaf||!m(i,l)?r?(a++,i=r.children[a],o=!1):i=null:(w.push(i),S.push(a),a=0,r=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,i,s){const n=i-t+1;let r=this._maxEntries;if(n<=r){const s=new O(e.slice(t,i+1));return h(s,this._toBBox),s}s||(s=Math.ceil(Math.log(n)/Math.log(r)),r=Math.ceil(n/r**(s-1)));const a=new G([]);a.height=s;const o=Math.ceil(n/r),l=o*Math.ceil(Math.sqrt(r));v(e,t,i,l,this._compareMinX);for(let n=t;n<=i;n+=l){const t=Math.min(n+l-1,i);v(e,n,t,o,this._compareMinY);for(let i=n;i<=t;i+=o){const n=Math.min(i+o-1,t);a.children.push(this._build(e,i,n,s-1))}}return h(a,this._toBBox),a}_insert(e,t,i){const s=this._toBBox,n=i?e:s(e);w.clear();const r=function(e,t,i,s){for(;s.push(t),!0!==t.leaf&&s.length-1!==i;){let i,s=1/0,n=1/0;for(let r=0,a=t.children.length;r<a;r++){const a=t.children[r],o=g(a),l=_(e,a)-o;l<n?(n=l,s=o<s?o:s,i=a):l===n&&o<s&&(s=o,i=a)}t=i||t.children[0]}return t}(n,this._data,t,w);for(r.children.push(e),d(r,n);t>=0&&w.data[t].children.length>this._maxEntries;)this._split(w,t),t--;!function(e,t,i){for(let s=i;s>=0;s--)d(t.data[s],e)}(n,w,t)}_split(e,t){const i=e.data[t],s=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,s);const r=this._chooseSplitIndex(i,n,s);if(!r)return;const a=i.children.splice(r,i.children.length-r),o=i.leaf?new O(a):new G(a);o.height=i.height,h(i,this._toBBox),h(o,this._toBBox),t?e.data[t-1].children.push(o):this._splitRoot(i,o)}_splitRoot(e,t){this._data=new G([e,t]),this._data.height=e.height+1,h(this._data,this._toBBox)}_chooseSplitIndex(e,t,i){let s,n,r;s=n=1/0;for(let a=t;a<=i-t;a++){const t=c(e,0,a,this._toBBox),o=c(e,a,i,this._toBBox),l=f(t,o),h=g(t)+g(o);l<s?(s=l,r=a,n=h<n?h:n):l===s&&h<n&&(n=h,r=a)}return r}_chooseSplitAxis(e,t,i){const s=e.leaf?this._compareMinX:u,n=e.leaf?this._compareMinY:p;this._allDistMargin(e,t,i,s)<this._allDistMargin(e,t,i,n)&&e.children.sort(s)}_allDistMargin(e,t,i,s){e.children.sort(s);const n=this._toBBox,r=c(e,0,t,n),a=c(e,i-t,i,n);let o=y(r)+y(a);for(let s=t;s<i-t;s++){const t=e.children[s];d(r,e.leaf?n(t):t),o+=y(r)}for(let s=i-t-1;s>=t;s--){const t=e.children[s];d(a,e.leaf?n(t):t),o+=y(a)}return o}_condense(e){for(let t=e.length-1;t>=0;t--){const i=e.data[t];if(0===i.children.length)if(t>0){const n=e.data[t-1],r=n.children;r.splice((0,s.cq)(r,i,r.length,n.indexHint),1)}else this.clear();else h(i,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function l(e,t){let i=e;for(C.clear();i;){if(!0===i.leaf)for(const e of i.children)t((0,n.CY)(e));else C.pushArray(i.children);i=C.pop()??null}}function h(e,t){c(e,0,e.children.length,t,e)}function c(e,t,i,s,n){n||(n=new O([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r,a=t;a<i;a++)r=e.children[a],d(n,e.leaf?s(r):r);return n}function d(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function u(e,t){return e.minX-t.minX}function p(e,t){return e.minY-t.minY}function g(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function y(e){return e.maxX-e.minX+(e.maxY-e.minY)}function _(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function f(e,t){const i=Math.max(e.minX,t.minX),s=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),r=Math.min(e.maxY,t.maxY);return Math.max(0,n-i)*Math.max(0,r-s)}function m(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function b(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function v(e,t,i,s,n){const r=[t,i];for(;r.length;){const t=r.pop(),i=r.pop();if(t-i<=s)continue;const o=i+Math.ceil((t-i)/s/2)*s;(0,a.q)(e,o,i,t,n),r.push(i,o,o,t)}}const x=new r.Z,C=new r.Z,w=new r.Z,S=new r.Z({deallocator:void 0});class E{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class I extends E{constructor(){super(...arguments),this.height=1,this.indexHint=new s.SO}}class O extends I{constructor(e){super(),this.children=e,this.leaf=!0}}class G extends I{constructor(e){super(),this.children=e,this.leaf=!1}}},92680:function(e,t,i){i.d(t,{e:function(){return a},s:function(){return o}});var s=i(3480),n=(i(61432),i(88194)),r=i(87644);function a(e){return null==e||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function o(e,t){if(null==e)return null;if(!a(e))return new n.Z("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case"simple":return function(e,t){const i={...r.K,...t,cimFallbackEnabled:!0};return l(e,(0,r.q)(e.symbol,i).error)}(e,t);case"unique-value":return function(e,t){const i={...r.K,...t,cimFallbackEnabled:!0},n=e.uniqueValueInfos?.map((e=>(0,r.q)(e.symbol,i).error)).filter(s.pC),a=(0,r.q)(e.defaultSymbol,i);return a.error&&n?.unshift(a.error),l(e,n)}(e,t);case"class-breaks":return function(e,t){const i={...r.K,...t,cimFallbackEnabled:!0},n=e.classBreakInfos.map((e=>(0,r.q)(e.symbol,i).error)).filter(s.pC),a=(0,r.q)(e.defaultSymbol,i);return a.error&&n.unshift(a.error),l(e,n)}(e,t);case"dictionary":case"heatmap":return null}return null}function l(e,t){if(!t)return null;if(Array.isArray(t)||(t=[t]),t.length>0){const i=t.map((e=>e.details.symbol.type||e.details.symbol.declaredClass)).filter((e=>!!e));i.sort();const s=new Array;return i.forEach(((e,t)=>{0!==t&&e===i[t-1]||s.push(e)})),new n.Z("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${s.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:t})}return null}},56216:function(e,t,i){i.d(t,{Kb:function(){return a},o2:function(){return h},sV:function(){return l},xn:function(){return o}});var s=i(53147),n=i(47747),r=i(71618);function a(e,t){const i=function(e,t){if(null!=e.symbol)return e.symbol;const i=t?.renderer;return null!=i&&"dot-density"!==i.type?i.getSymbol(e,t):null}(e,t);if(null==i)return null;const s=t?.renderer,a=new n.E(s,i);if(null==s||!("visualVariables"in s)||!s.visualVariables)return a;const o=(0,r.getVisualVariableValues)(s,e,t)??[],l=["proportional","proportional","proportional"];for(const{variable:e,value:t}of o)if(null!=t||"size"===e.type&&e.useSymbolValue)switch(e.type){case"color":a.color=t?.toRgba();break;case"size":if("outline"===e.target)a.outlineSize=t;else{const i=e.axis,s=e.useSymbolValue?"symbol-value":t??"proportional";switch(i){case"width":l[0]=s;break;case"depth":l[1]=s;break;case"height":l[2]=s;break;case"width-and-depth":l[0]=l[1]=s;break;default:l[0]=l[1]=l[2]=s}}break;case"opacity":a.opacity=t;break;case"rotation":switch(e.axis){case"tilt":a.tilt=t;break;case"roll":a.roll=t;break;default:a.heading=t}}return"proportional"===l[0]&&"proportional"===l[1]&&"proportional"===l[2]||(a.size=l),a}async function o(e,t){const i=await async function(e,t){return null!=e.symbol?e.symbol:t?.renderer?.getSymbolAsync(e,t)??null}(e,t);if(!i)return null;const a=t?.renderer,o=new n.E(a,i);if(!a||!("visualVariables"in a)||!a.visualVariables)return o;const l=(0,r.getVisualVariableValues)(a,e,t)??[],h=["proportional","proportional","proportional"];for(const{variable:e,value:t}of l)if("color"===e.type)o.color=s.Z.toUnitRGBA(t);else if("size"===e.type)if("outline"===e.target)o.outlineSize=t;else{const i=e.axis,s=e.useSymbolValue?"symbol-value":t;"width"===i?h[0]=s:"depth"===i?h[1]=s:"height"===i?h[2]=s:h[0]=h[1]="width-and-depth"===i?s:h[2]=s}else"opacity"===e.type?o.opacity=t:"rotation"===e.type&&"tilt"===e.axis?o.tilt=t:"rotation"===e.type&&"roll"===e.axis?o.roll=t:"rotation"===e.type&&(o.heading=t);return(isFinite(h[0])||isFinite(h[1])||isFinite(h[2]))&&(o.size=h),o}function l(e,t=0){const i=e[t];return"number"==typeof i&&isFinite(i)?i:null}function h(e){for(let t=0;t<3;t++){const i=e[t];if("number"==typeof i)return isFinite(i)?i:0}return 0}},24381:function(e,t,i){i.d(t,{A:function(){return c}});var s=i(73440),n=i(50702),r=i(93568),a=i(90403),o=i(17155),l=(i(61432),i(96711),i(83850),i(48023)),h=i(73584);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,h.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,n.kB)((()=>e.abort()))),await(0,a.N1)((()=>this.view.defaultsFromMap?.heightModelInfoReady),t),(0,r.k_)(t);const i=(0,h.Wt)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}};return(0,s._)([(0,o.Cb)()],t.prototype,"view",void 0),(0,s._)([(0,o.Cb)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,s._)([(0,l.j)("esri.views.3d.layers.LayerView3D")],t),t}},91775:function(e,t,i){i.r(t),i.d(t,{default:function(){return G}});var s=i(73440),n=i(43254),r=i(63727),a=i(61100),o=i(90403),l=i(17155),h=(i(61432),i(96711),i(83850),i(48023)),c=i(60458),d=i(13997),u=i(33086),p=i(88835),g=i(17303),y=i(41088),_=i(73358),f=i(24381),m=i(98185),b=i(15165),v=i(45239),x=i(94125),C=i(5527),w=i(43295),S=i(27546),E=i(92105);let I=class extends((0,f.A)(C.Z)){constructor(){super(...arguments),this.type="route-3d",this.loadedGraphics=new v.g,this._byObjectID=new Map,this.slicePlaneEnabled=!1,this.fullExtentInLocalViewSpatialReference=null}initialize(){this._set("processor",new m.D({owner:this,scaleVisibilityEnabled:!0,frustumVisibilityEnabled:!0})),this.addResolvingPromise(this.processor.initializePromise),this._updatingHandles.addOnCollectionChange((()=>this._routeItems),(e=>this._routeItemsChanged(e)),o.nn),"local"===this.view.viewingMode&&this.addResolvingPromise((async()=>this.fullExtentInLocalViewSpatialReference=await(0,E.i)(this.layer.fullExtent,this.view.spatialReference))()),this.addHandles((0,o.gx)((()=>this.view?.basemapTerrain?.ready),(()=>()=>this.notifyChange("updating")),{once:!0}))}destroy(){this._updatingHandles.removeAll(),this._set("processor",(0,a.SC)(this.processor)),this._get("_routeItems")?.destroy()}get _routeItems(){return new r.Z({getCollections:()=>[this.layer.pointBarriers,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.stops,this.layer.directionLines,this.layer.directionPoints,null!=this.layer.routeInfo?new n.Z([this.layer.routeInfo]):null]})}_routeItemsChanged(e){if(e.removed.length){this.loadedGraphics.removeMany(e.removed.map((e=>{const t=this._byObjectID.get(e);return this._byObjectID.delete(e),t})));for(const t of e.removed)this.removeHandles(t)}if(e.added.length){this.loadedGraphics.addMany(e.added.map((e=>{const t=e.toGraphic();return this._byObjectID.set(e,t),t})));for(const t of e.added)this.addHandles([(0,o.YP)((()=>t.geometry),((e,i)=>{this._updateGraphic(t,"geometry",e,i)})),(0,o.YP)((()=>t.symbol),((e,i)=>{this._updateGraphic(t,"symbol",e,i)}))],t)}}get legendEnabled(){return this.canResume()&&!this.processor?.frustumVisibilitySuspended}get visibleAtCurrentScale(){return(0,S.Dc)()?(0,S.GB)(this.layer.effectiveScaleRange,this.view.scale):!this.processor?.scaleVisibilitySuspended}getSuspendInfo(){const e=super.getSuspendInfo();return e.outsideOfView=this.processor?.frustumVisibilitySuspended??!1,e}getHit(e){return this.processor.getHit(e)}whenGraphicBounds(e,t){return this.processor.whenGraphicBounds(e,t)}computeAttachmentOrigin(e,t){return this.processor?.computeAttachmentOrigin(e,t)}getSymbolLayerSize(e,t){return this.processor.getSymbolLayerSize(e,t)}async queryGraphics(){return new n.Z(this.loadedGraphics.toArray())}maskOccludee(e){return this.processor.maskOccludee(e)}highlight(e,t){return function(e){return e instanceof c.Z||e instanceof d.Z||e instanceof u.Z||e instanceof p.Z||e instanceof g.Z||e instanceof y.Z||e instanceof _.Z}(e)&&(e=this._byObjectID.get(e)),this.processor.highlight(e,t?.name??w.b)}notifyContentGeometryUpdate(){this.emit("visible-geometry-changed")}get updatePolicy(){return this.processor?.graphicsCore.effectiveUpdatePolicy||x.j.SYNC}isUpdating(){return!(!this.processor?.updating&&this.view?.basemapTerrain?.ready)}get performanceInfo(){return new b.W(this.processor?.graphicsCore.usedMemory??0,this.loadedGraphics.length,-1,-1,0,this.processor?.graphicsCore.performanceInfo??null)}_updateGraphic(e,t,i,s){const n=this._byObjectID.get(e);n[t]=i,O.graphic=n,O.property=t,O.oldValue=s,O.newValue=i,this.processor?.graphicsCore.graphicUpdateHandler(O)}};(0,s._)([(0,l.Cb)()],I.prototype,"_routeItems",null),(0,s._)([(0,l.Cb)()],I.prototype,"loadedGraphics",void 0),(0,s._)([(0,l.Cb)({readOnly:!0})],I.prototype,"legendEnabled",null),(0,s._)([(0,l.Cb)({readOnly:!0})],I.prototype,"visibleAtCurrentScale",null),(0,s._)([(0,l.Cb)()],I.prototype,"layer",void 0),(0,s._)([(0,l.Cb)({readOnly:!0})],I.prototype,"processor",void 0),(0,s._)([(0,l.Cb)({type:Boolean})],I.prototype,"slicePlaneEnabled",void 0),I=(0,s._)([(0,h.j)("esri.views.3d.layers.RouteLayerView3D")],I);const O={graphic:null,property:null,oldValue:null,newValue:null},G=I},5473:function(e,t,i){i.d(t,{_:function(){return u}});var s=i(73440),n=i(70880),r=i(87833),a=i(90403),o=i(17155),l=(i(61432),i(96711),i(83850),i(48023)),h=i(70395),c=i(94125),d=i(50399);let u=class extends n.Z{constructor(e){super(e),this._dirtyExtents=new h.D,this._globalDirty=!1,this._averageExtentUpdateSize=0,this._dirtyGraphicsSet=new Set,this._updateElevation=!1,this.graphicsCoreOwner=null,this.graphicsCore=null,this.events=new r.Z}initialize(){const e=this.elevationProvider,t=this.graphicsCoreOwner.view.resourceController.scheduler;this._task=t.registerTask(p(this.graphicsCore.layer.elevationInfo?.mode),this),this.addHandles([e.on("elevation-change",(e=>this._elevationChanged(e))),(0,a.YP)((()=>this.graphicsCoreOwner.suspended),(()=>this._suspendedChange())),this._task,(0,a.YP)((()=>p(this.graphicsCore.layer.elevationInfo?.mode)),(e=>this._task.priority=e))])}destroy(){this._dirtyGraphicsSet.clear(),this.graphicsCoreOwner=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null,this.elevationProvider=null}clear(){this._dirtyGraphicsSet.clear(),this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this._globalDirty=!0,this.notifyChange("updating")}get updating(){return this.running}get running(){return this._dirtyGraphicsSet.size>0||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}get updatingRemaining(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}runTask(e){for(this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,e.madeProgress()),e.run((()=>this._dirtyExtents.merge(e)));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.notifyChange("updating")}_updateDirtyGraphics(e){const t=this.graphicsCoreOwner.view.renderCoordsHelper,i=this.graphicsCore.effectiveUpdatePolicy===c.j.ASYNC;for(const s of this._dirtyGraphicsSet.keys()){const n=this.graphicsCore.getGraphics3DGraphicById(s);if(this._dirtyGraphicsSet.delete(s),null!=n&&(n.alignWithElevation(this.elevationProvider,t,i),this.graphicsCore.deconflictor?.setDirty(),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this._dirtyExtents.empty&&!e.done;){const t=this._dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:t,spatialReference:i});const s=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,i,(e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);null!=t&&t.needsElevationUpdates()&&this._dirtyGraphicsSet.add(e)})),this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-s)+.9*this._averageExtentUpdateSize,e.madeProgress()}}_markAllGraphicsElevationDirty(){this._dirtyExtents.clear(),this._dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach(((e,t)=>this._dirtyGraphicsSet.add(t)))}_elevationChanged(e){if("scene"===e.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const t=e.extent;if(this.graphicsCoreOwner.suspended){if(!this._updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this._updateElevation=!0)}this.events.emit("invalidate-elevation",e)}else t[0]===-1/0?this._globalDirty=!0:this._dirtyExtents.add(t),this.notifyChange("updating")}};function p(e){return null==e?d.T8.ELEVATION_ALIGNMENT:"relative-to-scene"===e?d.T8.ELEVATION_ALIGNMENT_SCENE:d.T8.ELEVATION_ALIGNMENT}(0,s._)([(0,o.Cb)()],u.prototype,"graphicsCoreOwner",void 0),(0,s._)([(0,o.Cb)()],u.prototype,"graphicsCore",void 0),(0,s._)([(0,o.Cb)()],u.prototype,"queryGraphicUIDsInExtent",void 0),(0,s._)([(0,o.Cb)()],u.prototype,"elevationProvider",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],u.prototype,"updating",null),(0,s._)([(0,o.Cb)({readOnly:!0})],u.prototype,"updatingRemaining",null),u=(0,s._)([(0,l.j)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],u)},18234:function(e,t,i){i.d(t,{L:function(){return H}});var s=i(73440),n=i(70880),r=i(90403),a=i(17155),o=(i(61432),i(96711),i(83850),i(48023)),l=i(47925),h=i(79487),c=i(99574),d=i(31865),u=i(10934),p=i(24910),g=i(82846),y=i(74238),_=i(774),f=i(2051),m=i(16447),b=i(47566),v=i(33869),x=i(88970),C=i(77773),w=i(12659),S=i(56172),E=i(316);const I=.5*Math.PI,O=I/Math.PI*180;class G{constructor(e){this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:(0,g.Ue)(),direction:(0,g.Ue)()},this._renderCoordsHelper=e.renderCoordsHelper;for(let e=0;e<4;e++)this._extent[e]={origin:(0,g.Ue)(),direction:(0,g.Ue)(),cap:{next:null,direction:(0,g.Ue)()}},this._planes[e]=(0,C.Ue)();this._planes[v.Nu.NEAR]=(0,C.Ue)(),this._planes[v.Nu.FAR]=(0,C.Ue)(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,t,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,t,i),(0,p.f)(this._center.origin,n[0].origin,n[2].origin),(0,p.g)(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||(0,p.g)(this._center.direction,this._center.direction,-1);for(let e=0;e<4;e++){const t=n[e];this._renderCoordsHelper.worldUpAtPosition(t.origin,t.direction);const i=n[3===e?0:e+1];t.cap.next=i.origin,(0,p.E)(t.cap.direction,t.origin,i.origin),(0,C.my)(t.direction,t.cap.direction,t.origin,this._planes[e]),s||(0,p.g)(t.direction,t.direction,-1)}(0,C.my)(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[v.Nu.NEAR]),s?(0,C.tk)(this._planes[v.Nu.NEAR],this._planes[v.Nu.FAR]):((0,C.JG)(this._planes[v.Nu.FAR],this._planes[v.Nu.NEAR]),(0,C.tk)(this._planes[v.Nu.NEAR],this._planes[v.Nu.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=t,this._minGlobalAltitude=.9*(0,l.Iu)(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,t,i=!1){if(null==e)return!1;if(this._renderCoordsHelper.viewingMode===S.JY.Global){const i=this._maxSpanSpatialReference.isGeographic?O:I*t;if(this._maxSpan>i)return!0;if(null!=e.altitude&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(0===this._maxSpan){const t=this._extent[0];return!(i||!e.intersectsRay((0,w.re)(t.origin,t.direction)))}for(let t=0;t<this._extent.length;t++){const s=this._extent[t];if(!i&&e.intersectsRay((0,w.re)(s.origin,s.direction)))return!0;if(e.intersectsLineSegment((0,x.zk)(s.origin,s.cap.next,j),s.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let t=0;t<e.lines.length;t++){const i=e.lines[t];if((0,E.kD)(s,i.origin,i.endpoint,i.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,t,i){(0,b.be)(e,M),M[2]=i,(0,y.B)(t,M,R,this._renderCoordsHelper.spatialReference),(0,d.U_)(B,R),(0,m.cS)(A);for(const{x0:s,x1:n,y0:r,y1:a}of V)for(let o=0;o<5;o++){const l=o/4;M[0]=(0,c.t7)(e[s],e[n],l),M[1]=(0,c.t7)(e[r],e[a],l),M[2]=i,(0,f.S)(M,t,M,this._renderCoordsHelper.spatialReference),(0,p.t)(M,M,B),(0,m.pp)(A,M)}(0,p.i)(this._extent[0].origin,A[0],A[1],A[2]),(0,p.i)(this._extent[1].origin,A[3],A[1],A[2]),(0,p.i)(this._extent[2].origin,A[3],A[4],A[2]),(0,p.i)(this._extent[3].origin,A[0],A[4],A[2]);for(let e=0;e<4;++e)(0,p.t)(this._extent[e].origin,this._extent[e].origin,R)}_toRenderBoundingExtentLocal(e,t,i){(0,_.d)(e,t,D,this._renderCoordsHelper.spatialReference),(0,p.i)(this._extent[0].origin,D[0],D[1],i),(0,p.i)(this._extent[1].origin,D[2],D[1],i),(0,p.i)(this._extent[2].origin,D[2],D[3],i),(0,p.i)(this._extent[3].origin,D[0],D[3],i)}_toRenderBoundingExtent(e,t,i){switch(this._renderCoordsHelper.viewingMode){case S.JY.Global:this._toRenderBoundingExtentGlobal(e,t,i);break;case S.JY.Local:this._toRenderBoundingExtentLocal(e,t,i);break;default:(0,h.Bg)(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(e){if((0,C.jH)(e.planes[v.Nu.NEAR],this._center.origin)<0&&(0,p.e)(this._center.direction,e.direction)<0)return!0;for(let t=0;t<4;t++){const i=this._extent[t];if((0,C.jH)(e.planes[v.Nu.NEAR],i.origin)<0&&(0,p.e)(i.direction,e.direction)<0)return!0}return!1}}const V=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],M=(0,g.Ue)(),R=(0,u.Ue)(),B=(0,u.Ue)(),A=(0,m.Ue)(),D=(0,b.Ue)(),j=(0,x.Ue)();var P=i(50399),Y=i(78891);let H=class extends n.Z{constructor(e){super(e),this.suspended=!1,this._extent=null,this._extentIntersectionDirty=!0,this._isVisibleBelowSurfaceInternal=!1,this.graphicsCoreOwner=null,this.updating=!0}initialize(){const{graphicsCoreOwner:e}=this;this._extentIntersection=new G({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,i=t.basemapTerrain,s=t.resourceController.scheduler;this.addHandles([t.on("resize",(()=>this._viewChange())),(0,r.YP)((()=>t.state.camera),(()=>this._viewChange()),r.Z_),s.registerTask(P.T8.FRUSTUM_VISIBILITY,this),(0,r.YP)((()=>i.visibleElevationBounds),(()=>this._elevationBoundsChange()))]),"local"===t.viewingMode?this._isVisibleBelowSurface=!0:this.addHandles([(0,r.YP)((()=>[i.baseOpacity,i.wireframe,t.map?.ground?.navigationConstraint?.type]),(()=>this._updateIsVisibleBelowSurface()),r.nn)])}destroy(){this._set("graphicsCoreOwner",null),this._extent=null,this._extentIntersection=null}_setDirty(){this.updating||this._set("updating",!0)}setExtent(e){this._extent=e,this._extentIntersectionDirty=!0,this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty(),this._extentIntersectionDirty=!0}set _isVisibleBelowSurface(e){this._isVisibleBelowSurfaceInternal=e,this._setDirty(),this._extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){const e=this.graphicsCoreOwner.view,t=e.basemapTerrain,i="local"===e.viewingMode,s="none"===e.map.ground?.navigationConstraint?.type;this._isVisibleBelowSurface=i||!t.opaque||s}_updateExtentIntersection(){if(!this._extentIntersectionDirty)return;this._extentIntersectionDirty=!1;const e=this.graphicsCoreOwner.view;let t;if(this._isVisibleBelowSurfaceInternal)t=-.3*(0,l.Iu)(e.spatialReference).radius;else{const{min:i,max:s}=e.basemapTerrain.visibleElevationBounds;t=i-Math.max(1,(s-i)*(1.2-1))}this._extentIntersection.update(this._extent,e.spatialReference,t)}get running(){return this.updating}runTask(e){if(this._set("updating",!1),!this._extent)return this._set("suspended",!1),Y.J;this._updateExtentIntersection();const t=this.graphicsCoreOwner.view.frustum,i=(0,l.Iu)(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(t,i)),e.madeProgress()}};(0,s._)([(0,a.Cb)({readOnly:!0})],H.prototype,"suspended",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],H.prototype,"graphicsCoreOwner",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],H.prototype,"updating",void 0),H=(0,s._)([(0,o.j)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],H)},62564:function(e,t,i){i.d(t,{d:function(){return y}});var s=i(50702),n=(i(61432),i(32420));class r{}class a extends r{constructor(e,t){super(),this.objectStateId=e,this.object=t}remove(){this.object.removeStateID(this.objectStateId)}}class o extends r{constructor(e,t,i){super(),this.objectStateId=e,this.object=t,this.owner=i}remove(){this.owner.removeRenderGeometryObjectState(this.object,this.objectStateId)}}class l extends r{constructor(e,t){super(),this.objectStateId=e,this._removeCallback=t,this.object=null}remove(){this._removeCallback(this.objectStateId)}}class h{constructor(){this._items=[]}addObject(e,t){this._items.push(new a(t,e))}addRenderGeometry(e,t,i){this._items.push(new o(t,e,i))}addExternal(e,t){this._items.push(new l(t,e))}remove(e){this._remove((t=>t.objectStateId===e))}removeByObject(e){this._remove((t=>t.object===e))}removeAll(){this._items.forEach((e=>e.remove())),this._items=[]}_remove(e){const{_items:t}=this;for(let i=t.length-1;i>=0;--i){const s=t[i];e(s)&&(s.remove(),t.splice(i,1))}}}class c extends h{constructor(){super(...arguments),this.stateType=n.V_.MaskOccludee}}class d extends h{constructor(e){super(),this.highlightName=e,this.stateType=n.V_.Highlight}}class u{constructor(e){this.objectIdField=e,this.ids=new Set,this.paused=!1}hasGraphic(e){const t=this.objectIdField?e.graphic.attributes[this.objectIdField]:e.graphic.uid;return this.ids.has(t)}}class p extends u{constructor(e){super(e),this.stateType=n.V_.MaskOccludee,this.objectStateSet=new c}}class g extends u{constructor(e,t){super(t),this.highlightName=e,this.stateType=n.V_.Highlight,this.objectStateSet=new d(e)}}class y{constructor(e){this._graphicsCore=e,this._stateSets=new Array}destroy(){this.reset(),this._stateSets=null}reset(){this._stateSets&&(this._stateSets.forEach((e=>e.objectStateSet.removeAll())),this._stateSets.length=0)}acquireOccludeeSet(e){const t=new p(e);this._stateSets.push(t);const i=(0,s.kB)((()=>this.releaseSet(t)));return{set:t,handle:i}}acquireHighlightSet(e,t){const i=new g(e,t);this._stateSets.push(i);const n=(0,s.kB)((()=>this.releaseSet(i)));return{set:i,handle:n}}releaseSet(e){e.objectStateSet.removeAll();const t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}setUid(e,t){e.ids.add(t);const i=this._graphicsCore.graphics3DGraphics.get(t);i&&i.addObjectStateSet(e.objectStateSet)}setUids(e,t){t.forEach((t=>this.setUid(e,t)))}setObjectIds(e,t){t.forEach((t=>e.ids.add(t))),this._initializeSet(e)}addGraphic(e){this._stateSets.forEach((t=>{!t.paused&&t.hasGraphic(e)&&e.addObjectStateSet(t.objectStateSet)}))}removeGraphic(e){this._stateSets.forEach((t=>{t.hasGraphic(e)&&e.removeObjectState(t.objectStateSet)}))}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach((e=>e.objectStateSet.removeAll()))}_initializeSet(e){const t=this._graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach((t=>{t&&e.hasGraphic(t)&&t.addObjectStateSet(e.objectStateSet)})):e.ids.forEach((i=>{const s=t.get(i);s&&s.addObjectStateSet(e.objectStateSet)}))}get test(){}}},98185:function(e,t,i){i.d(t,{D:function(){return V}});var s=i(73440),n=i(46451),r=i(70880),a=i(50702),o=i(61100),l=i(93568),h=i(90403),c=i(17155),d=(i(61432),i(96711),i(83850),i(48023)),u=i(58426),p=i(60147),g=i(38209),y=i(74774),_=i(56216),f=i(29191),m=i(94808),b=i(47451),v=i(28994),x=i(5473),C=i(18234),w=i(62564),S=i(66290),E=i(36027),I=i(78637),O=i(94125),G=i(27546);let V=class extends r.Z{constructor(e){super(e),this.drapeSourcePriorityOffset=0,this.type="graphics-3d",this.graphicsCore=null,this.drapeSourceType=m.Lw.Features,this.scaleVisibilityEnabled=!1,this.frustumVisibilityEnabled=!1,this._suspendResumeExtent=null,this._updatingHandles=new p.R}initialize(){const{layer:e}=this,t="effectiveScaleRange"in e?e:null,i=!(0,G.Dc)()&&this.scaleVisibilityEnabled&&null!=t,s=new v.w({owner:this,layer:this.owner.layer,preferredUpdatePolicy:O.j.SYNC,graphicSymbolSupported:!0,componentFactories:{elevationAlignment:(e,t)=>new x._({graphicsCoreOwner:this,graphicsCore:e,queryGraphicUIDsInExtent:t,elevationProvider:this.view.elevationProvider}),scaleVisibility:i?(e,i)=>new S.c({graphicsCoreOwner:this,layer:t,queryGraphicUIDsInExtent:i,graphicsCore:e,basemapTerrain:this.owner.view.basemapTerrain}):null,objectStates:e=>new w.d(e)}});if(this._set("graphicsCore",s),this.frustumVisibilityEnabled&&this._set("frustumVisibility",new C.L({graphicsCoreOwner:this})),"fullOpacity"in this.owner){const e=this.owner;this._updatingHandles.add((()=>e.fullOpacity),(()=>this.graphicsCore.opacityChange()))}if("elevationInfo"in e){const t=e;this._updatingHandles.add((()=>t.elevationInfo),((e,t)=>{(0,u.Hg)(e,t)&&this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())}))}this._set("initializePromise",this._initializeAsync()),this._updatingHandles.addPromise(this.initializePromise)}async _initializeAsync(){try{await this.graphicsCore.initializePromise}catch(e){if((0,l.D_)(e))return;throw e}this.destroyed||(this.addHandles((0,h.YP)((()=>this.view.clippingArea),(()=>this._updateClippingExtent()),h.Z_)),this._updateClippingExtent(),this._setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this._updatingHandles.destroy(),this._set("frustumVisibility",(0,o.SC)(this.frustumVisibility)),this._set("graphicsCore",(0,o.SC)(this.graphicsCore))}get layer(){return this.owner.layer}get layerViewUid(){return this.owner.uid}get view(){return this.owner.view}get scaleVisibility(){return this.graphicsCore?.scaleVisibility}get elevationAlignment(){return this.graphicsCore?.elevationAlignment}get scaleVisibilitySuspended(){return!(null==this.scaleVisibility||!this.scaleVisibility.suspended)}get frustumVisibilitySuspended(){return null!=this.frustumVisibility&&this.frustumVisibility.suspended}get suspended(){return this.owner.suspended??!1}get updating(){return!!(this.graphicsCore?.updating||null!=this.scaleVisibility&&this.scaleVisibility.updating||null!=this.frustumVisibility&&this.frustumVisibility.updating||this._updatingHandles.updating)}get graphics3DGraphics(){return this.graphicsCore?.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphicsCore?.graphics3DGraphicsByObjectID}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner.fullOpacity??1}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}notifyGraphicGeometryChanged(e){this.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphicsCore.notifyGraphicVisibilityChanged(e)}notifyContentGeometryUpdate(){this.owner.notifyContentGeometryUpdate?.()}getRenderingInfo(e,t,i){const s=(0,_.Kb)(e,{renderer:t,arcade:i});if(s?.color){const e=s.color;e[0]=e[0]/255,e[1]=e[1]/255,e[2]=e[2]/255}return s}getRenderingInfoAsync(e,t,i,s){return(0,_.xn)(e,{renderer:t,arcade:i,...s})}getHit(e){if(this.owner.loadedGraphics){const t=this.owner.loadedGraphics.find((t=>t.uid===e));if(t){const e=this.layer instanceof g.Z?this.layer:null,i=(0,y.mW)(t,e);return{type:"graphic",graphic:i,layer:i.layer}}}return null}whenGraphicBounds(e,t){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(e,t):Promise.reject()}computeAttachmentOrigin(e,t){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(e,t):null}getSymbolLayerSize(e,t){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(e,t):null}maskOccludee(e){const t=this.graphicsCore?.objectStates;if(!t)return(0,a.kB)();const{set:i,handle:s}=t.acquireOccludeeSet(null);return t.setUid(i,e.uid),s}highlight(e,t){const i=this.graphicsCore?.objectStates;if(!i)return M;if(e instanceof f.Z)return M;const s=(0,I.OL)(e);if(0===s.length)return M;if(s[0]instanceof n.Z){const e=s.map((e=>e.uid)),{set:n,handle:r}=i.acquireHighlightSet(t,null);return i.setUids(n,e),r}if("number"==typeof s[0]){const e=s,{set:n,handle:r}=i.acquireHighlightSet(t,null);return i.setObjectIds(n,e),r}return M}_setupSuspendResumeExtent(){const{scaleVisibility:e,frustumVisibility:t}=this;if(null==e&&null==t)return;const i=({computedExtent:i,extentPadding:s})=>{this._suspendResumeExtent=(0,E.Go)(i,this._suspendResumeExtent,b.PY,s),null!=e&&e.setExtent(this._suspendResumeExtent),null!=t&&t.setExtent(this._suspendResumeExtent)};this.addHandles((0,h.YP)((()=>({computedExtent:this.graphicsCore?.computedExtent,extentPadding:this.graphicsCore?.extentPadding})),(e=>i(e)),h.tX))}_updateClippingExtent(){const e=this.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}};(0,s._)([(0,c.Cb)()],V.prototype,"drapeSourcePriorityOffset",void 0),(0,s._)([(0,c.Cb)()],V.prototype,"type",void 0),(0,s._)([(0,c.Cb)({constructOnly:!0})],V.prototype,"owner",void 0),(0,s._)([(0,c.Cb)()],V.prototype,"layer",null),(0,s._)([(0,c.Cb)()],V.prototype,"layerViewUid",null),(0,s._)([(0,c.Cb)()],V.prototype,"view",null),(0,s._)([(0,c.Cb)({constructOnly:!0})],V.prototype,"graphicsCore",void 0),(0,s._)([(0,c.Cb)()],V.prototype,"scaleVisibility",null),(0,s._)([(0,c.Cb)({constructOnly:!0})],V.prototype,"frustumVisibility",void 0),(0,s._)([(0,c.Cb)()],V.prototype,"elevationAlignment",null),(0,s._)([(0,c.Cb)()],V.prototype,"scaleVisibilitySuspended",null),(0,s._)([(0,c.Cb)({readOnly:!0})],V.prototype,"frustumVisibilitySuspended",null),(0,s._)([(0,c.Cb)()],V.prototype,"suspended",null),(0,s._)([(0,c.Cb)({readOnly:!0})],V.prototype,"updating",null),(0,s._)([(0,c.Cb)()],V.prototype,"loadedGraphics",null),(0,s._)([(0,c.Cb)()],V.prototype,"fullOpacity",null),(0,s._)([(0,c.Cb)()],V.prototype,"slicePlaneEnabled",null),(0,s._)([(0,c.Cb)()],V.prototype,"drapeSourceType",void 0),(0,s._)([(0,c.Cb)()],V.prototype,"updatePolicy",null),(0,s._)([(0,c.Cb)({constructOnly:!0})],V.prototype,"scaleVisibilityEnabled",void 0),(0,s._)([(0,c.Cb)({constructOnly:!0})],V.prototype,"frustumVisibilityEnabled",void 0),(0,s._)([(0,c.Cb)()],V.prototype,"initializePromise",void 0),V=(0,s._)([(0,d.j)("esri.views.3d.layers.graphics.GraphicsProcessor")],V);const M=(0,a.kB)()},45239:function(e,t,i){i.d(t,{g:function(){return a}});var s=i(87833),n=i(93399),r=i(39355);class a extends s.Z{constructor(){super(...arguments),this._set=new Set,this._length=(0,r.t)(0)}clear(){if(this._set.size>0){const e=this.toArray();this._set.clear(),this.emit("after-changes",{type:n.y.REMOVE}),this.emit("change",{added:[],removed:e})}}get length(){return this._length.value}addMany(e){if(0!==e.length){for(const t of e)this._set.add(t);this._length.value=this._set.size,this.emit("after-changes",{type:n.y.ADD}),this.emit("change",{added:e,removed:[]})}}remove(e){this._set.delete(e)&&(this._length.value=this._set.size,this.emit("after-changes",{type:n.y.REMOVE}),this.emit("change",{added:[],removed:[e]}))}removeMany(e){const t=[];for(const i of e)this._set.delete(i)&&t.push(i);t.length>0&&(this._length.value=this._set.size,this.emit("after-changes",{type:n.y.REMOVE}),this.emit("change",{added:[],removed:t}))}toArray(){return Array.from(this._set.values())}find(e){for(const t of this._set.values())if(e(t))return t}some(e){for(const t of this._set.values())if(e(t))return!0;return!1}forEach(e){this._set.forEach((t=>e(t)))}}},5527:function(e,t,i){i.d(t,{Z:function(){return g}});var s=i(73440),n=i(70880),r=i(87833),a=i(15894),o=i(96711),l=i(61100),h=i(76329),c=i(17155),d=(i(61432),i(83850),i(48023)),u=i(60147),p=i(27546);let g=class extends(a.Z.IdentifiableMixin(h.Z.EsriPromiseMixin(r.Z.EventedMixin(n.Z)))){get spatialReferenceSupported(){return!0}constructor(e){super(e),this._updatingHandles=new u.R,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer?.title||"no title";o.Z.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e)}}))}destroy(){this._updatingHandles=(0,l.SC)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const e=this.view.timeExtent,t=this.layer?.visibilityTimeExtent;return!e||!t||!e.intersection(t).isEmpty}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&this.parent&&!this.parent.suspended&&this.view?.ready&&(0,p.Cy)(e)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const e=this.parent?.suspended?this.parent.suspendInfo:{};this.view?.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0);const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,p.Cy)(t)&&this.visibleAtCurrentScale||(e.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(e.outsideVisibilityTimeExtent=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"spatialReferenceSupported",null),(0,s._)([(0,c.Cb)()],g.prototype,"view",void 0),(0,s._)([(0,c.Cb)()],g.prototype,"fullOpacity",null),(0,s._)([(0,c.Cb)()],g.prototype,"layer",void 0),(0,s._)([(0,c.Cb)()],g.prototype,"parent",void 0),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"suspended",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"suspendInfo",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"legendEnabled",null),(0,s._)([(0,c.Cb)({type:Boolean,readOnly:!0})],g.prototype,"updating",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"updatingProgress",null),(0,s._)([(0,c.Cb)()],g.prototype,"updateSuspended",null),(0,s._)([(0,c.Cb)()],g.prototype,"visible",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"visibleAtCurrentScale",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"visibleAtCurrentTimeExtent",null),g=(0,s._)([(0,d.j)("esri.views.layers.LayerView")],g)},85754:function(e,t,i){i.d(t,{V5:function(){return r},e7:function(){return n},zc:function(){return a}});var s=i(76554);async function n(e,t=e.popupTemplate){if(null==t)return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:n}=t,{objectIdField:r,typeIdField:a,globalIdField:o,relationships:l}=e;if(i.includes("*"))return["*"];const h=n?(0,s.CH)(e):[],c=(0,s.Q0)(e.fieldsIndex,[...i,...h]);return a&&c.push(a),c&&r&&e.fieldsIndex?.has(r)&&!c.includes(r)&&c.push(r),c&&o&&e.fieldsIndex?.has(o)&&!c.includes(o)&&c.push(o),l&&l.forEach((t=>{const{keyField:i}=t;c&&i&&e.fieldsIndex?.has(i)&&!c.includes(i)&&c.push(i)})),c}function r(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function a(e,t){return null!=r(e,{defaultPopupTemplateEnabled:t})}}}]);