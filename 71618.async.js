"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[71618],{18881:function(e,n,i){var t,a;function r(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function l(e){return null!=e&&!isNaN(e)&&isFinite(e)}function s(e){return e.valueExpression?t.Expression:e.field&&"string"==typeof e.field?t.Field:t.Unknown}function o(e,n){const i=n||s(e),r=e.valueUnit||"unknown";return i===t.Unknown?a.Constant:e.stops?a.Stops:null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?a.ClampedLinear:"unknown"===r?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?a.Proportional:a.Additive:a.Identity:a.RealWorldSize}i.d(n,{PS:function(){return s},QW:function(){return o},RY:function(){return t},hL:function(){return a},iY:function(){return r},qh:function(){return l}}),function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"}(t||(t={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(a||(a={}))},71618:function(e,n,i){i.r(n),i.d(n,{getAllSizes:function(){return F},getColor:function(){return h},getOpacity:function(){return b},getRotationAngle:function(){return m},getSize:function(){return V},getSizeForValue:function(){return w},getSizeFromNumberOrVariable:function(){return x},getSizeRangeAtScale:function(){return z},getVisualVariableValues:function(){return y},viewScaleRE:function(){return v}});var t=i(53147),a=i(46451),r=i(79487),l=i(96711),s=i(4207),o=i(18881);const u=()=>l.Z.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),c=e=>u().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),f=()=>u().error("Use of arcade expressions requires an arcade context"),d=new a.Z,p=Math.PI,v=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function h(e,n,i){const a="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!a)return;if("esri.renderers.visualVariables.ColorVariable"!==a.declaredClass)return void c("ColorVariable");const r="number"==typeof n,l=r?null:n,s=l?.attributes;let u=r?n:null;const d=a.field,{ipData:p,hasExpression:v}=a.cache;let h=a.cache.compiledFunc;if(!d&&!v){const e=a.stops;return e&&e[0]&&e[0].color}if("number"!=typeof u)if(v){if(null==i?.arcade)return void f();const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},n=i.arcade.arcadeUtils,t=n.getViewInfo(e),r=n.createExecContext(l,t,i.timeZone);if(!h){const e=n.createSyntaxTree(a.valueExpression);h=n.createFunction(e),a.cache.compiledFunc=h}u=n.executeFunction(h,r)}else s&&(u=s[d]);const b=a.normalizationField,m=null!=s&&null!=b?parseFloat(s[b]):void 0;if(null!=u&&(!b||r||!isNaN(m)&&0!==m)){(0,o.qh)(m)&&!r&&(u/=m);const e=g(u,p);if(e){const n=e[0],r=e[1],l=n===r?a.stops[n].color:t.Z.blendColors(a.stops[n].color,a.stops[r].color,e[2],null!=i?i.color:void 0);return new t.Z(l)}}}function b(e,n,i){const t="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!t)return;if("esri.renderers.visualVariables.OpacityVariable"!==t.declaredClass)return void c("OpacityVariable");const a="number"==typeof n,r=a?null:n,l=r?.attributes;let s=a?n:null;const u=t.field,{ipData:d,hasExpression:p}=t.cache;let v=t.cache.compiledFunc;if(!u&&!p){const e=t.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof s)if(p){if(null==i?.arcade)return void f();const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},n=i.arcade.arcadeUtils,a=n.getViewInfo(e),l=n.createExecContext(r,a,i.timeZone);if(!v){const e=n.createSyntaxTree(t.valueExpression);v=n.createFunction(e),t.cache.compiledFunc=v}s=n.executeFunction(v,l)}else l&&(s=l[u]);const h=t.normalizationField,b=null!=l&&null!=h?parseFloat(l[h]):void 0;if(null!=s&&(!h||a||!isNaN(b)&&0!==b)){(0,o.qh)(b)&&!a&&(s/=b);const e=g(s,d);if(e){const n=e[0],i=e[1];if(n===i)return t.stops[n].opacity;{const a=t.stops[n].opacity;return a+(t.stops[i].opacity-a)*e[2]}}}}function m(e,n,i){const t="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!t)return;if("esri.renderers.visualVariables.RotationVariable"!==t.declaredClass)return void c("RotationVariable");const a=t.axis||"heading",r="heading"===a&&"arithmetic"===t.rotationType?90:0,l="heading"===a&&"arithmetic"===t.rotationType?-1:1,s="number"==typeof n?null:n,o=s?.attributes,u=t.field,{hasExpression:d}=t.cache;let p=t.cache.compiledFunc,v=null;if(!u&&!d)return v;if(d){if(null==i?.arcade)return void f();const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},n=i.arcade.arcadeUtils,a=n.getViewInfo(e),r=n.createExecContext(s,a,i.timeZone);if(!p){const e=n.createSyntaxTree(t.valueExpression);p=n.createFunction(e),t.cache.compiledFunc=p}v=n.executeFunction(p,r)}else o&&(v=o[u]);return v="number"!=typeof v||isNaN(v)?null:r+l*v,v}function V(e,n,i){const t="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!t)return;if("esri.renderers.visualVariables.SizeVariable"!==t.declaredClass)return void c("SizeVariable");const a=w(function(e,n,i){const t="number"==typeof n,a=t?null:n,r=a?.attributes;let l=t?n:null;const{isScaleDriven:s}=e.cache;let u=e.cache.compiledFunc;if(s){const n=null!=i?i.scale:void 0,t=null!=i?i.view:void 0;l=null==n||"3d"===t?function(e){let n=null,i=null;const t=e.stops;return t?(n=t[0].value,i=t[t.length-1].value):(n=e.minDataValue||0,i=e.maxDataValue||0),(n+i)/2}(e):n}else if(!t)switch(e.inputValueType){case o.RY.Expression:{if(null==i?.arcade)return void f();const n={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,r=t.getViewInfo(n),s=t.createExecContext(a,r,i.timeZone);if(!u){const n=t.createSyntaxTree(e.valueExpression);u=t.createFunction(n),e.cache.compiledFunc=u}l=t.executeFunction(u,s);break}case o.RY.Field:r&&(l=r[e.field]);break;case o.RY.Unknown:l=null}if(!(0,o.qh)(l))return null;if(t||!e.normalizationField)return l;const c=r?parseFloat(r[e.normalizationField]):null;return(0,o.qh)(c)&&0!==c?l/c:null}(t,n,i),t,n,i,t.cache.ipData);return null==a||isNaN(a)?void 0:a}function x(e,n,i){return null==e?null:(0,o.iY)(e)?V(e,n,i):(0,o.qh)(e)?e:null}function S(e,n,i){return(0,o.qh)(i)&&e>i?i:(0,o.qh)(n)&&e<n?n:e}function w(e,n,i,t,a){switch(n.transformationType){case o.hL.Additive:return function(e,n,i,t){const a=x(n.minSize,i,t)||n.minDataValue;return null==e&&null==a?null:(e??0)+(a??0)}(e,n,i,t);case o.hL.Constant:return function(e,n,i){const t=e.stops;let a=t?.length&&t[0].size;return null==a&&(a=e.minSize),x(a,n,i)}(n,i,t);case o.hL.ClampedLinear:return function(e,n,i,t){const a=x(n.minSize,i,t);if(null==e)return a;const{minDataValue:r,maxDataValue:l}=n;if(null==r||null==l)return null;const s=(e-r)/(l-r),o=x(n.maxSize,i,t),u=null!=t?t.shape:void 0;if(e<=r)return a;if(e>=l)return o;if(null==a||null==o)return null;if("area"===n.scaleBy&&u){const e="circle"===u,n=e?p*(a/2)**2:a*a,i=n+s*((e?p*(o/2)**2:o*o)-n);return e?2*Math.sqrt(i/p):Math.sqrt(i)}return a+s*(o-a)}(e,n,i,t);case o.hL.Proportional:return function(e,n,i,t){const a=x(n.minSize,i,t);if(null==e||null==a)return a;const r=null!=t?t.shape:void 0,{minDataValue:l}=n;if(null==l)return null;const s=e/l,o=x(n.maxSize,i,t);let u=null;return u="circle"===r?2*Math.sqrt(s*(a/2)**2):"square"===r||"diamond"===r||"image"===r?Math.sqrt(s*a**2):s*a,S(u,a,o)}(e,n,i,t);case o.hL.Stops:return function(e,n,i,t,a){if(null==e)return null;const[r,l,s]=g(e,a);if(r===l)return x(n.stops?.[r].size,i,t);{const e=x(n.stops?.[r].size,i,t),a=x(n.stops?.[l].size,i,t);return null==e||null==a?null:e+(a-e)*s}}(e,n,i,t,a);case o.hL.RealWorldSize:return function(e,n,i,t){const a=(t?.resolution??1)*s.a[n.valueUnit],r=x(n.minSize,i,t),l=x(n.maxSize,i,t),{valueRepresentation:o}=n;if(null==e)return r;let u=null;return u="area"===o?2*Math.sqrt(e/p)/a:"radius"===o||"distance"===o?2*e/a:e/a,S(u,r,l)}(e,n,i,t);case o.hL.Identity:return e;case o.hL.Unknown:return null}}function z(e,n,i){const{isScaleDriven:t}=e.cache;if(!(t&&"3d"===i||n))return null;const a={scale:n,view:i};let r=x(e.minSize,d,a),l=x(e.maxSize,d,a);if(null!=r||null!=l){if(r>l){const e=l;l=r,r=e}return{minSize:r,maxSize:l}}}function y(e,n,i){if(!e.visualVariables)return;const t=[],a=[],r=[],l=[],s=[];for(const n of e.visualVariables)switch(n.type){case"color":a.push(n);break;case"opacity":r.push(n);break;case"rotation":s.push(n);break;case"size":l.push(n)}return a.forEach((e=>{const a=h(e,n,i);t.push({variable:e,value:a})})),r.forEach((e=>{const a=b(e,n,i);t.push({variable:e,value:a})})),s.forEach((e=>{const a=m(e,n,i);t.push({variable:e,value:a})})),l.forEach((e=>{const a=V(e,n,i);t.push({variable:e,value:a})})),t}function g(e,n){if(!n)return;let i=0,t=n.length-1;return n.some(((n,a)=>e<n?(t=a,!0):(i=a,!1))),[i,t,(e-n[i])/(n[t]-n[i])]}function F(e,n,i){const t=["proportional","proportional","proportional"];for(const a of e){const e=a.useSymbolValue?"symbol-value":V(a,n,i)??"proportional";switch(a.axis){case"width":t[0]=e;break;case"depth":t[1]=e;break;case"height":t[2]=e;break;case"width-and-depth":t[0]=e,t[1]=e;break;case"all":case void 0:case null:t[0]=e,t[1]=e,t[2]=e;break;default:(0,r.Bg)(a.axis)}}return t}}}]);