"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[19047],{25657:function(e,t,i){i.d(t,{Z:function(){return h}});var s,r=i(73440),n=i(89314),a=i(63255),o=i(17155),u=(i(61432),i(96711),i(83850),i(79775)),l=i(48023);let h=class extends(n.Z.ClonableMixin(a.Z)){static{s=this}constructor(e){super(e),this.type="georeferenced",this.origin=null}static{this.absolute=new s}};(0,r._)([(0,u.J)({georeferenced:"georeferenced"},{readOnly:!0})],h.prototype,"type",void 0),(0,r._)([(0,o.Cb)({type:[Number],nonNullable:!1,json:{write:!0}})],h.prototype,"origin",void 0),h=s=(0,r._)([(0,l.j)("esri.geometry.support.MeshGeoreferencedVertexSpace")],h)},93466:function(e,t,i){i.d(t,{Z:function(){return h}});var s=i(73440),r=i(89314),n=i(63255),a=i(17155),o=(i(61432),i(96711),i(83850),i(79775)),u=i(48023),l=i(82846);let h=class extends(r.Z.ClonableMixin(n.Z)){constructor(e){super(e),this.type="local",this.origin=(0,l.Ue)()}};(0,s._)([(0,o.J)({local:"local"},{readOnly:!0})],h.prototype,"type",void 0),(0,s._)([(0,a.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],h.prototype,"origin",void 0),h=(0,s._)([(0,u.j)("esri.geometry.support.MeshLocalVertexSpace")],h)},52861:function(e,t,i){i.d(t,{G7:function(){return c},QK:function(){return l},rU:function(){return h},vI:function(){return d},z1:function(){return o},zZ:function(){return u}});var s=i(24910),r=i(60508),n=i(25657),a=i(93466);function o(e){return null==e.origin}function u(e){return null!=e.origin}function l(e){return u(e.vertexSpace)}function h(e,t){if(!u(e))return null;const[i,s,n]=e.origin;return new r.Z({x:i,y:s,z:n,spatialReference:t})}function c(e,t){const{x:i,y:s,z:r,spatialReference:o}=e,u=[i,s,r??0];return"local"===(t?.vertexSpace??function(e){return e.isGeographic||e.isWebMercator?"local":"georeferenced"}(o))?new a.Z({origin:u}):new n.Z({origin:u})}function d(e,t){return e.type===t.type&&(e.origin===t.origin||null!=e.origin&&null!=t.origin&&(0,s.q)(e.origin,t.origin))}},61418:function(e,t,i){i.d(t,{Fz:function(){return u},fS:function(){return h},kg:function(){return o}});i(61432);var s=i(99574),r=i(8554);function n(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const s=e[i],r=t[i];if(s.length!==r.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!==r[e])return!1}return!0}function a(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}function o(e,t){return e===t||null!=e&&null!=t&&(0,r.fS)(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function u(e,t,i){return e===t||null!=e&&null!=t&&(0,r.fS)(e.spatialReference,t.spatialReference)&&(0,s.W8)(e.x,t.x,i)&&(0,s.W8)(e.y,t.y,i)&&(0,s.W8)(e.z??0,t.z??0,i)&&(0,s.W8)(e.m??0,t.m??0,i)}function l(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return o(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,r.fS)(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,r.fS)(e.spatialReference,t.spatialReference)&&a(e.paths,t.paths)}(e,t);case"polygon":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,r.fS)(e.spatialReference,t.spatialReference)&&a(e.rings,t.rings)}(e,t);case"multipoint":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,r.fS)(e.spatialReference,t.spatialReference)&&n(e.points,t.points)}(e,t);case"mesh":return!1;default:return}}function h(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!l(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;for(const s of i)if(e[s]!==t[s])return!1;return!0}(e.attributes,t.attributes)}},74774:function(e,t,i){i.d(t,{D:function(){return E},Ou:function(){return l},WG:function(){return f},kB:function(){return d},mW:function(){return c}});var s=i(46451),r=(i(61432),i(28947)),n=i(59384),a=i(45213),o=i(90756),u=i(60856);function l(e){return"declaredClass"in e}function h(e){return"declaredClass"in e}function c(e,t){return e?"declaredClass"in e?e:new s.Z({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,r.d9)(e.symbol),attributes:(0,r.d9)(e.attributes),geometry:d(e.geometry)}):null}function d(e){return null==e?null:l(e)?e:(0,o.im)(function(e){const{wkid:t,wkt:i,wkt2:s,latestWkid:r}=e.spatialReference,n={wkid:t,wkt:i,wkt2:s,latestWkid:r};switch(e.type){case"point":{const{x:t,y:i,z:s,m:r}=e;return{x:t,y:i,z:s,m:r,spatialReference:n}}case"polygon":{const{rings:t,hasZ:i,hasM:s}=e;return{rings:p(t),hasZ:i,hasM:s,spatialReference:n}}case"polyline":{const{paths:t,hasZ:i,hasM:s}=e;return{paths:p(t),hasZ:i,hasM:s,spatialReference:n}}case"extent":{const{xmin:t,xmax:i,ymin:s,ymax:r,zmin:a,zmax:o,mmin:u,mmax:l,hasZ:h,hasM:c}=e;return{xmin:t,xmax:i,ymin:s,ymax:r,zmin:a,zmax:o,mmin:u,mmax:l,hasZ:h,hasM:c,spatialReference:n}}case"multipoint":{const{points:t,hasZ:i,hasM:s}=e;return{points:g(t)?_(t):t,hasZ:i,hasM:s,spatialReference:n}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return g(t);return!1}(e)?e.map((e=>_(e))):e}function _(e){return e.map((e=>Array.from(e)))}function g(e){return e.length>0&&((0,n.xZ)(e[0])||(0,n.fS)(e[0]))}function f(e,t){if(!e)return null;let i;if(h(e)){if(null==t)return e.clone();if(h(t))return t.copy(e)}return null!=t?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=void 0,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=(0,u.T)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}function E(e){const{wkid:t,wkt:i,wkt2:s,latestWkid:r}=e,n={wkid:t,wkt:i,wkt2:s,latestWkid:r};return a.Z.fromJSON(n)}},47641:function(e,t,i){i.d(t,{b:function(){return a}});var s=i(93568),r=i(39355),n=i(78891);class a{constructor(){this._tasks=new Array,this._numPendingTasks=(0,r.t)(0),this._running=(0,r.t)(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get running(){return this._running.value}_updateRunning(){this._running.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return n.J;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return new Promise(((s,r)=>{this._tasks.push(new o(s,r,e,t,i)),++this._numPendingTasks.value,this._updateRunning()})).finally((()=>--this._numPendingTasks.value))}unshift(e,t,i){return new Promise(((s,r)=>{this._tasks.unshift(new o(s,r,e,t,i)),++this._numPendingTasks.value,this._updateRunning()})).finally((()=>--this._numPendingTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();this._updateRunning();try{const i=(0,s.Hc)(t.signal);if(i&&!t.abortCallback)t.reject((0,s.zE)());else{const r=i?t.abortCallback?.((0,s.zE)()):t.callback(e);(0,s.y8)(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(e){t.reject(e)}return!0}cancelAll(){const e=(0,s.zE)();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0,this._updateRunning()}}class o{constructor(e,t,i,s,r){this.resolve=e,this.reject=t,this.callback=i,this.signal=s,this.abortCallback=r}}},39088:function(e,t,i){i.r(t),i.d(t,{default:function(){return b}});var s=i(73440),r=i(88194),n=i(61100),a=i(90403),o=i(17155),u=(i(61432),i(96711),i(83850),i(48023)),l=i(24381),h=i(21143),c=i(98185),d=i(51335),p=i(15165),_=i(94125),g=i(5527),f=i(43295),E=i(27546),m=i(92105);let y=class extends((0,l.A)(g.Z)){constructor(){super(...arguments),this.type="graphics-3d",this.symbologySnappingSupported=!0,this._slicePlaneEnabled=!1,this.fullExtentInLocalViewSpatialReference=null,this.ignoresMemoryFactor=!0}get highlightOptions(){return null}initialize(){this._set("processor",new c.D({owner:this,scaleVisibilityEnabled:!0,frustumVisibilityEnabled:!0})),this.addResolvingPromise(this.processor.initializePromise),this.addHandles(this.layer.on("graphic-update",(e=>this.processor.graphicsCore.graphicUpdateHandler(e)))),this.layer.internal?this.notifyChange("updating"):("local"===this.view.viewingMode&&this.addResolvingPromise((async()=>this.fullExtentInLocalViewSpatialReference=await(0,m.i)(this.layer.fullExtent,this.view.spatialReference))()),this.addHandles((0,a.gx)((()=>this.view?.basemapTerrain?.ready),(()=>()=>this.notifyChange("updating")),{once:!0})))}destroy(){this._updatingHandles.removeAll(),this._set("processor",(0,n.SC)(this.processor))}get loadedGraphics(){return this.layer.graphics}get legendEnabled(){return this.canResume()&&!this.processor?.frustumVisibilitySuspended}get visibleAtCurrentScale(){return(0,E.Dc)()?(0,E.GB)(this.layer.effectiveScaleRange,this.view.scale):!this.processor?.scaleVisibilitySuspended}get slicePlaneEnabled(){const e=this.layer.internal;return this._slicePlaneEnabled&&!e}set slicePlaneEnabled(e){this._slicePlaneEnabled=e}getSuspendInfo(){const e=super.getSuspendInfo();return e.outsideOfView=this.processor?.frustumVisibilitySuspended??!1,e}getHit(e){return this.processor.getHit(e)}whenGraphicBounds(e,t){return this.processor.whenGraphicBounds(e,t)}computeAttachmentOrigin(e,t){return this.processor?.computeAttachmentOrigin(e,t)}getSymbolLayerSize(e,t){return this.processor.getSymbolLayerSize(e,t)}queryGraphics(){return Promise.resolve(this.loadedGraphics)}maskOccludee(e){return this.processor.maskOccludee(e)}highlight(e,t){return this.processor.highlight(e,t?.name??f.b)}notifyContentGeometryUpdate(){this.emit("visible-geometry-changed")}async elevationAlignPointsInFeatures(e,t){const{processor:i}=this;if(null==i?.graphics3DGraphics)throw new r.Z("graphicslayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");const{graphics3DGraphics:s}=i;return(0,h.W)(this.view,this.layer,(e=>"number"==typeof e?s.get(e):void 0),e,t)}async queryForSymbologySnapping(e,t){return(0,d.c)(this.processor,e,t)}get updatePolicy(){return this.processor?.graphicsCore.effectiveUpdatePolicy||_.j.SYNC}isUpdating(){return this.view&&this.layer&&!(!this.processor?.updating&&(this.layer.internal||this.view.basemapTerrain?.ready))}get performanceInfo(){return new p.W(this.usedMemory,this.loadedGraphics.length,-1,-1)}get usedMemory(){return this.processor?.graphicsCore?.usedMemory??0}get unloadedMemory(){return this.processor?.graphicsCore?.unprocessedMemoryEstimate}get test(){return{graphics3DProcessor:this.processor,loadedGraphics:this.loadedGraphics}}};(0,s._)([(0,o.Cb)()],y.prototype,"highlightOptions",null),(0,s._)([(0,o.Cb)()],y.prototype,"loadedGraphics",null),(0,s._)([(0,o.Cb)({readOnly:!0})],y.prototype,"legendEnabled",null),(0,s._)([(0,o.Cb)()],y.prototype,"layer",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],y.prototype,"processor",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],y.prototype,"visibleAtCurrentScale",null),(0,s._)([(0,o.Cb)()],y.prototype,"_slicePlaneEnabled",void 0),(0,s._)([(0,o.Cb)({type:Boolean})],y.prototype,"slicePlaneEnabled",null),y=(0,s._)([(0,u.j)("esri.views.3d.layers.GraphicsLayerView3D")],y);const b=y},98185:function(e,t,i){i.d(t,{D:function(){return k}});var s=i(73440),r=i(46451),n=i(70880),a=i(50702),o=i(61100),u=i(93568),l=i(90403),h=i(17155),c=(i(61432),i(96711),i(83850),i(48023)),d=i(58426),p=i(60147),_=i(38209),g=i(74774),f=i(56216),E=i(29191),m=i(94808),y=i(47451),b=i(28994),T=i(5473),C=i(18234),R=i(62564),I=i(66290),S=i(36027),A=i(78637),O=i(94125),w=i(27546);let k=class extends n.Z{constructor(e){super(e),this.drapeSourcePriorityOffset=0,this.type="graphics-3d",this.graphicsCore=null,this.drapeSourceType=m.Lw.Features,this.scaleVisibilityEnabled=!1,this.frustumVisibilityEnabled=!1,this._suspendResumeExtent=null,this._updatingHandles=new p.R}initialize(){const{layer:e}=this,t="effectiveScaleRange"in e?e:null,i=!(0,w.Dc)()&&this.scaleVisibilityEnabled&&null!=t,s=new b.w({owner:this,layer:this.owner.layer,preferredUpdatePolicy:O.j.SYNC,graphicSymbolSupported:!0,componentFactories:{elevationAlignment:(e,t)=>new T._({graphicsCoreOwner:this,graphicsCore:e,queryGraphicUIDsInExtent:t,elevationProvider:this.view.elevationProvider}),scaleVisibility:i?(e,i)=>new I.c({graphicsCoreOwner:this,layer:t,queryGraphicUIDsInExtent:i,graphicsCore:e,basemapTerrain:this.owner.view.basemapTerrain}):null,objectStates:e=>new R.d(e)}});if(this._set("graphicsCore",s),this.frustumVisibilityEnabled&&this._set("frustumVisibility",new C.L({graphicsCoreOwner:this})),"fullOpacity"in this.owner){const e=this.owner;this._updatingHandles.add((()=>e.fullOpacity),(()=>this.graphicsCore.opacityChange()))}if("elevationInfo"in e){const t=e;this._updatingHandles.add((()=>t.elevationInfo),((e,t)=>{(0,d.Hg)(e,t)&&this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())}))}this._set("initializePromise",this._initializeAsync()),this._updatingHandles.addPromise(this.initializePromise)}async _initializeAsync(){try{await this.graphicsCore.initializePromise}catch(e){if((0,u.D_)(e))return;throw e}this.destroyed||(this.addHandles((0,l.YP)((()=>this.view.clippingArea),(()=>this._updateClippingExtent()),l.Z_)),this._updateClippingExtent(),this._setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this._updatingHandles.destroy(),this._set("frustumVisibility",(0,o.SC)(this.frustumVisibility)),this._set("graphicsCore",(0,o.SC)(this.graphicsCore))}get layer(){return this.owner.layer}get layerViewUid(){return this.owner.uid}get view(){return this.owner.view}get scaleVisibility(){return this.graphicsCore?.scaleVisibility}get elevationAlignment(){return this.graphicsCore?.elevationAlignment}get scaleVisibilitySuspended(){return!(null==this.scaleVisibility||!this.scaleVisibility.suspended)}get frustumVisibilitySuspended(){return null!=this.frustumVisibility&&this.frustumVisibility.suspended}get suspended(){return this.owner.suspended??!1}get updating(){return!!(this.graphicsCore?.updating||null!=this.scaleVisibility&&this.scaleVisibility.updating||null!=this.frustumVisibility&&this.frustumVisibility.updating||this._updatingHandles.updating)}get graphics3DGraphics(){return this.graphicsCore?.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphicsCore?.graphics3DGraphicsByObjectID}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner.fullOpacity??1}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}notifyGraphicGeometryChanged(e){this.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphicsCore.notifyGraphicVisibilityChanged(e)}notifyContentGeometryUpdate(){this.owner.notifyContentGeometryUpdate?.()}getRenderingInfo(e,t,i){const s=(0,f.Kb)(e,{renderer:t,arcade:i});if(s?.color){const e=s.color;e[0]=e[0]/255,e[1]=e[1]/255,e[2]=e[2]/255}return s}getRenderingInfoAsync(e,t,i,s){return(0,f.xn)(e,{renderer:t,arcade:i,...s})}getHit(e){if(this.owner.loadedGraphics){const t=this.owner.loadedGraphics.find((t=>t.uid===e));if(t){const e=this.layer instanceof _.Z?this.layer:null,i=(0,g.mW)(t,e);return{type:"graphic",graphic:i,layer:i.layer}}}return null}whenGraphicBounds(e,t){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(e,t):Promise.reject()}computeAttachmentOrigin(e,t){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(e,t):null}getSymbolLayerSize(e,t){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(e,t):null}maskOccludee(e){const t=this.graphicsCore?.objectStates;if(!t)return(0,a.kB)();const{set:i,handle:s}=t.acquireOccludeeSet(null);return t.setUid(i,e.uid),s}highlight(e,t){const i=this.graphicsCore?.objectStates;if(!i)return v;if(e instanceof E.Z)return v;const s=(0,A.OL)(e);if(0===s.length)return v;if(s[0]instanceof r.Z){const e=s.map((e=>e.uid)),{set:r,handle:n}=i.acquireHighlightSet(t,null);return i.setUids(r,e),n}if("number"==typeof s[0]){const e=s,{set:r,handle:n}=i.acquireHighlightSet(t,null);return i.setObjectIds(r,e),n}return v}_setupSuspendResumeExtent(){const{scaleVisibility:e,frustumVisibility:t}=this;if(null==e&&null==t)return;const i=({computedExtent:i,extentPadding:s})=>{this._suspendResumeExtent=(0,S.Go)(i,this._suspendResumeExtent,y.PY,s),null!=e&&e.setExtent(this._suspendResumeExtent),null!=t&&t.setExtent(this._suspendResumeExtent)};this.addHandles((0,l.YP)((()=>({computedExtent:this.graphicsCore?.computedExtent,extentPadding:this.graphicsCore?.extentPadding})),(e=>i(e)),l.tX))}_updateClippingExtent(){const e=this.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}};(0,s._)([(0,h.Cb)()],k.prototype,"drapeSourcePriorityOffset",void 0),(0,s._)([(0,h.Cb)()],k.prototype,"type",void 0),(0,s._)([(0,h.Cb)({constructOnly:!0})],k.prototype,"owner",void 0),(0,s._)([(0,h.Cb)()],k.prototype,"layer",null),(0,s._)([(0,h.Cb)()],k.prototype,"layerViewUid",null),(0,s._)([(0,h.Cb)()],k.prototype,"view",null),(0,s._)([(0,h.Cb)({constructOnly:!0})],k.prototype,"graphicsCore",void 0),(0,s._)([(0,h.Cb)()],k.prototype,"scaleVisibility",null),(0,s._)([(0,h.Cb)({constructOnly:!0})],k.prototype,"frustumVisibility",void 0),(0,s._)([(0,h.Cb)()],k.prototype,"elevationAlignment",null),(0,s._)([(0,h.Cb)()],k.prototype,"scaleVisibilitySuspended",null),(0,s._)([(0,h.Cb)({readOnly:!0})],k.prototype,"frustumVisibilitySuspended",null),(0,s._)([(0,h.Cb)()],k.prototype,"suspended",null),(0,s._)([(0,h.Cb)({readOnly:!0})],k.prototype,"updating",null),(0,s._)([(0,h.Cb)()],k.prototype,"loadedGraphics",null),(0,s._)([(0,h.Cb)()],k.prototype,"fullOpacity",null),(0,s._)([(0,h.Cb)()],k.prototype,"slicePlaneEnabled",null),(0,s._)([(0,h.Cb)()],k.prototype,"drapeSourceType",void 0),(0,s._)([(0,h.Cb)()],k.prototype,"updatePolicy",null),(0,s._)([(0,h.Cb)({constructOnly:!0})],k.prototype,"scaleVisibilityEnabled",void 0),(0,s._)([(0,h.Cb)({constructOnly:!0})],k.prototype,"frustumVisibilityEnabled",void 0),(0,s._)([(0,h.Cb)()],k.prototype,"initializePromise",void 0),k=(0,s._)([(0,c.j)("esri.views.3d.layers.graphics.GraphicsProcessor")],k);const v=(0,a.kB)()},99734:function(e,t,i){var s;i.d(t,{n:function(){return s}}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(s||(s={}))},50399:function(e,t,i){i.d(t,{G5:function(){return w},S0:function(){return k},T8:function(){return s},sq:function(){return v},z4:function(){return m}});var s,r,n=i(12818),a=(i(61432),i(96711)),o=i(61100),u=i(24498),l=i(63974),h=i(93568),c=i(90403),d=i(39355),p=i(32555),_=i(47641),g=i(97332),f=i(99734),E=i(78891);function m(){return new A.Scheduler}(r=s||(s={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",r.RESOURCE_CONTROLLER="schedule",r.SLIDE="slide",r.STREAM_DATA_LOADER="stream loader",r.ELEVATION_QUERY="elevation query",r.TERRAIN_SURFACE="terrain",r.SURFACE_GEOMETRY_UPDATES="surface geometry updates",r.LOD_RENDERER="LoD renderer",r.GRAPHICS_CORE="Graphics3D",r.I3S_CONTROLLER="I3S",r.POINT_CLOUD_LAYER="point cloud",r.FEATURE_TILE_FETCHER="feature fetcher",r.OVERLAY="overlay",r.OVERLAY_RENDERER="overlay renderer",r.STAGE="stage",r.GRAPHICS_DECONFLICTOR="graphics deconflictor",r.FILTER_VISIBILITY="Graphics3D filter visibility",r.SCALE_VISIBILITY="Graphics3D scale visibility",r.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",r.POINT_OF_INTEREST_FREQUENT="POI frequent",r.POINT_OF_INTEREST_INFREQUENT="POI infrequent",r.LABELER="labeler",r.FEATURE_QUERY_ENGINE="feature query",r.FEATURE_TILE_TREE="feature tile tree",r.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",r.ELEVATION_ALIGNMENT="elevation alignment",r.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",r.TEXT_TEXTURE_ATLAS="text texture atlas",r.TEXTURE_UNLOAD="texture unload",r.LINE_OF_SIGHT_TOOL="line of sight tool",r.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",r.ELEVATION_PROFILE="elevation profile",r.SNAPPING="snapping",r.SHADOW_ACCUMULATOR="shadow accumulator",r.CLOUDS_GENERATOR="clouds generator",r.MAPVIEW_FETCH_QUEUE="mapview fetch queue",r.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",r.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",r[r.NONE=0]="NONE",r[r.TEST_PRIO=1]="TEST_PRIO";const y=new Map([[s.RESOURCE_CONTROLLER_IMMEDIATE,0],[s.RESOURCE_CONTROLLER,4],[s.SLIDE,0],[s.STREAM_DATA_LOADER,0],[s.ELEVATION_QUERY,0],[s.TERRAIN_SURFACE,1],[s.SURFACE_GEOMETRY_UPDATES,1],[s.LOD_RENDERER,2],[s.GRAPHICS_CORE,2],[s.I3S_CONTROLLER,2],[s.POINT_CLOUD_LAYER,2],[s.FEATURE_TILE_FETCHER,2],[s.CLOUDS_GENERATOR,2],[s.OVERLAY,4],[s.OVERLAY_RENDERER,4],[s.STAGE,4],[s.GRAPHICS_DECONFLICTOR,4],[s.FILTER_VISIBILITY,4],[s.SCALE_VISIBILITY,4],[s.FRUSTUM_VISIBILITY,4],[s.POINT_OF_INTEREST_FREQUENT,6],[s.POINT_OF_INTEREST_INFREQUENT,30],[s.LABELER,8],[s.FEATURE_QUERY_ENGINE,8],[s.FEATURE_TILE_TREE,16],[s.FEATURE_TILE_TREE_ACTIVE,0],[s.ELEVATION_ALIGNMENT,12],[s.ELEVATION_ALIGNMENT_SCENE,14],[s.TEXT_TEXTURE_ATLAS,12],[s.TEXTURE_UNLOAD,12],[s.LINE_OF_SIGHT_TOOL,16],[s.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[s.SNAPPING,0],[s.SHADOW_ACCUMULATOR,30],[s.MAPVIEW_FETCH_QUEUE,0],[s.MAPVIEW_LAYERVIEW_UPDATE,2],[s.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function b(e){return y.has(e)?y.get(e):"number"==typeof e?e:1}const T=(0,p.HA)(6.5),C=(0,p.HA)(1),R=(0,p.HA)(30),I=(0,p.HA)(1e3/30),S=(0,p.HA)(100);var A,O;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,d.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new u.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=f.n.INTERACTING,this._tasks=new l.Z,this._runQueue=new l.Z,this._load=0,this._idleStateCallbacks=new l.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,c.YP)((()=>g.Z.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),c.nn);for(const e of Object.keys(s))this.performanceInfo.tasks.set(s[e],new u.Z(s[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,o.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())})))}registerTask(e,i){const s=new t(this,e,i);return this._tasks.push(s),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new u.Z(e)),s}registerIdleStateCallbacks(e,t){const i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),this.state===f.n.IDLE&&this._idleUpdatesStartFired&&i.idleBegin();const s=this;return{remove:()=>this._removeIdleStateCallbacks(i),set idleBegin(e){s._idleUpdatesStartFired&&(i.idleEnd(),s._state===f.n.IDLE&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==f.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}frame(e){this._startFrameTaskTimes();const t=this._updateBudget(e);if(t){const e=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-e)}else this._recordFrameTaskTimes(0);return t}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=T,i=e.frameDuration,s=C;switch(this.state){case f.n.IDLE:t=(0,p.HA)(0),i=(0,p.HA)(Math.max(S,e.frameDuration)),s=R;break;case f.n.INTERACTING:i=(0,p.HA)(Math.max(I,e.frameDuration));case f.n.ANIMATING:}return i=(0,p.HA)(i-e.elapsedFrameTime-t),this.state!==f.n.IDLE&&i<C&&!this._forceTask?(this._forceTask=!0,!1):(i=(0,p.HA)(Math.max(i,s)),this._budget.reset(i),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case f.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case f.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset((0,p.HA)(0)),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return O.SCHEDULED;let t=O.IDLE;return this._tasks.forAll((i=>{i.name===e&&i.needsUpdate&&(i.schedulePriority<=1?t=O.READY:t!==O.READY&&(t=O.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((i=>{i.name===e&&(t+=i.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,i)=>{t+=e>1?` ${e}x ${i}`:` ${i}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((i=>{i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority&&i.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,i.basePriority),1===i.schedulePriority?(i.schedulePriority=0,this._runQueue.push(i)):--i.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do{for(;this._runQueue.length>0;){const e=this._budget.now(),t=this._runQueue.pop();this._budget.resetProgress();try{t.task.runTask(this._budget)===E.J&&(t.blockFrame=this._frameNumber)}catch(e){a.Z.getLogger("esri.views.support.Scheduler").error(`Exception in task "${t.name}"`,e),t.blockFrame=this._frameNumber}!this._budget.hasProgressed&&t.blockFrame!==this._frameNumber&&t.needsUpdate&&(t.name,s.I3S_CONTROLLER,t.blockFrame=this._frameNumber),t.schedulePriority=t.basePriority;const i=this._budget.now()-e;if(t.runtime+=i,this._frameTaskTimes.set(t.priority,this._frameTaskTimes.get(t.priority)+i),this._budget.remaining<=0)return void this._updatingChanged()}}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const e of Object.keys(s))this._frameTaskTimes.set(s[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).push(e))),this.performanceInfo.total.push(e)}get test(){return this._test}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,i){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new _.b,this._handles=new n.Z,this._basePriority=b(t),this.schedulePriority=this._basePriority,this._task=(0,d.t)(null!=i?i:this._queue),this._handles.add((0,c.gx)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(w),this._scheduler.removeTask(this),this.schedule=v.schedule,this.reschedule=v.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=b(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,i){return this._queue.push(e,t,i)}reschedule(e,t,i){return this._queue.unshift(e,t,i)}processQueue(e){return this._queue.runTask(e)}}class i{constructor(){this._begin=performance?.now()??0,this._budget=0,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e){this._begin=this.now(),this._budget=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=i}(A||(A={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(O||(O={}));const w=new A.Budget;function k(e){const t=new A.Budget;return t.reset(e),t}w.enabled=!1;const v=new class{remove(){}processQueue(){}schedule(e,t,i){try{if((0,h.Hc)(t)){const e=(0,h.zE)();return i?Promise.resolve(i(e)):Promise.reject(e)}return(0,h.gx)(e(w))}catch(e){return Promise.reject(e)}}reschedule(e,t,i){return this.schedule(e,t,i)}}},78891:function(e,t,i){i.d(t,{J:function(){return s}});const s=Symbol("Yield")},97332:function(e,t,i){i.d(t,{Z:function(){return u}});var s=i(73440),r=i(70880),n=i(17155),a=(i(61432),i(96711),i(83850),i(48023));let o=class extends r.Z{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,s._)([(0,n.Cb)()],o.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,s._)([(0,n.Cb)()],o.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o=(0,s._)([(0,a.j)("esri.views.support.debugFlags")],o);const u=new o}}]);