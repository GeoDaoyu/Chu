"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[50820,17623,66882],{92643:function(e,t,r){r.d(t,{Ch:function(){return $},EX:function(){return O},G:function(){return N},H0:function(){return z},Ht:function(){return T},K6:function(){return R},O:function(){return E},WC:function(){return F},Y3:function(){return I},_Y:function(){return C},_j:function(){return G},c9:function(){return D},gp:function(){return Z},jQ:function(){return l},mj:function(){return P},nR:function(){return L},sJ:function(){return k},vG:function(){return A},xr:function(){return x}});var n=r(53147),i=r(3480),o=r(28947),s=r(99574),a=r(73749),c=r(27583);function l(e){return"r"in e&&"g"in e&&"b"in e}function u(e){return"h"in e&&"s"in e&&"v"in e}function h(e){return"l"in e&&"a"in e&&"b"in e}function f(e){return"l"in e&&"c"in e&&"h"in e}const p=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],m=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function d(e,t){const r=[];let n,i;if(e[0].length!==t.length)throw new Error("dimensions do not match");const o=e.length,s=e[0].length;let a=0;for(n=0;n<o;n++){for(a=0,i=0;i<s;i++)a+=e[n][i]*t[i];r.push(a)}return r}function y(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),r=d(p,t);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function g(e){const t=d(m,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function M(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function b(e){const t=e.l,r=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function v(e){return function(e){const t=e.l,r=e.a,n=e.b,i=Math.sqrt(r*r+n*n);let o=Math.atan2(n,r);return o=o>0?o:o+2*Math.PI,{l:t,c:i,h:o}}(M(y(e)))}function w(e){return g(b(function(e){const t=e.l,r=e.c,n=e.h;return{l:t,a:r*Math.cos(n),b:r*Math.sin(n)}}(e)))}function x(e){return l(e)?e:f(e)?w(e):h(e)?function(e){return g(b(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?g(e):u(e)?function(e){const t=(e.h+360)%360/60,r=e.s/100,n=e.v/100*255,i=n*r,o=i*(1-Math.abs(t%2-1));let s;switch(Math.floor(t)){case 0:s={r:i,g:o,b:0};break;case 1:s={r:o,g:i,b:0};break;case 2:s={r:0,g:i,b:o};break;case 3:s={r:0,g:o,b:i};break;case 4:s={r:o,g:0,b:i};break;case 5:case 6:s={r:i,g:0,b:o};break;default:s={r:0,g:0,b:0}}return s.r=Math.round(s.r+n-i),s.g=Math.round(s.g+n-i),s.b=Math.round(s.b+n-i),s}(e):e}function C(e){return u(e)?e:function(e){const t=e.r,r=e.g,n=e.b,i=Math.max(t,r,n),o=i-Math.min(t,r,n);let s=i,a=0===o?0:i===t?(r-n)/o%6:i===r?(n-t)/o+2:(t-r)/o+4,c=0===o?0:o/s;return a<0&&(a+=6),a*=60,c*=100,s*=100/255,{h:a,s:c,v:s}}(x(e))}function I(e){return h(e)?e:function(e){return M(y(e))}(x(e))}function k(e){return f(e)?e:v(x(e))}function S(e){let{r:t,g:r,b:i,a:o}=e;return o<1&&(t=Math.round(o*t+255*(1-o)),r=Math.round(o*r+255*(1-o)),i=Math.round(o*i+255*(1-o))),new n.Z({r:t,g:r,b:i})}function O(e,t){const{r:r,g:n,b:i}=t?.ignoreAlpha?e:S(e);return.2126*r+.7152*n+.0722*i}var R,_;function P(e,t=R.High){return O(e,{ignoreAlpha:!0})>t?new n.Z([0,0,0,e.a]):new n.Z([255,255,255,e.a])}function G(e,t){const r=I(e);r.l*=1-t;const n=x(r),i=e.clone();return i.setColor(n),i.a=e.a,i}function N(e,t){const r=e.clone();return r.a*=t,r}function A(e,t){const r=C(e);r.s*=t;const n=x(r),i=e.clone();return i.setColor(n),i.a=e.a,i}function E(e){return n.Z.toUnitRGBA(e)}function F(e,t){return e===t||null!=e&&e.equals(t)}function T(e,t){return e===t||null!=e&&null!=t&&(0,a.e)(e,t)}function Z(e){return(0,c.al)(e[0],e[1],e[2],e.length>3?e[3]:1)}function D(e){return e[0]??=0,e[1]??=0,e[2]??=0,e}function L(e){return e.length=4,D(e),e[3]??=1,(0,s.uZ)(e[3],0,1),e}function $(e,t){const r=n.Z.toUnitRGBA(e);return r[3]*=t,r}function z(e,t,r={}){if(0===e.length||t<=0)return[];if(1===(e=e.map((e=>"string"==typeof e?new n.Z(e):e))).length||1===t){const r=[],n=e[0];for(let e=0;e<t;e++)r.push(n.clone());return r}if(r.shuffle&&(e=(0,i.TV)((0,o.d9)(e),r.seed)),e.length>=t){const r=[],n=(e.length-1)/(t-1);for(let i=0;i<t;i++){const t=Math.round(i*n);r.push(e[t].clone())}return r}return function(e,t,r={}){const n=[],o=e.length-1,s=Math.ceil((t-e.length)/o);e:for(let i=0;i<o;i++){const o=e[i],a=e[i+1];for(let i=1;i<=s;i++){const c=i/(s+1);if(n.push(V(o,a,c,r)),n.length+e.length===t)break e}}return[...e.map((e=>e.clone())),...(0,i.TV)(n,r.seed??1)]}(e,t,r)}(_=R||(R={}))[_.Low=160]="Low",_[_.High=225]="High";const H=(e,t)=>{const r=Math.floor(10*t())-5;return Math.min(255,Math.max(0,e+r))};function V(e,t,r,o={}){const s=e.r,a=e.g,c=e.b,l=t.r,u=t.g,h=t.b,f=Math.round(s+(l-s)*r),p=Math.round(a+(u-a)*r),m=Math.round(c+(h-c)*r);if(!o.offset)return new n.Z([f,p,m]);const d=(0,i.FS)(o.seed);return new n.Z([H(f,d),H(p,d),H(m,d)])}},50820:function(e,t,r){r.r(t),r.d(t,{CIMSymbolRasterizer:function(){return f}});var n=r(90756),i=r(88890),o=r(35236);class s{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const r=this._resourceMap.get(e);if(r)return{width:r.width,height:r.height};let n=this._inFlightResourceMap.get(e);return n?n.then((e=>({width:e.width,height:e.height}))):(n=(0,o.n$)(e,t),this._inFlightResourceMap.set(e,n),n.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,i.mx)(e)}}var a=r(32566),c=r(80746),l=r(17623),u=r(84210),h=r(61421);class f{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new s}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,r,i,o,s,a,f,m,d){if(!e)return null;const{data:y}=e;if(!y||"CIMSymbolReference"!==y.type||!y.symbol)return null;const{symbol:g}=y;s||(s=(0,h.JW)(g));const M=await l.OverrideHelper.resolveSymbolOverrides(y,t,this._spatialReference,o,s,a,f),b=this._cimResourceManager,v=[];c.B$.fetchResources(M,b,v),c.B$.fetchFonts(M,b,v),v.length>0&&await Promise.all(v);const{width:w,height:x}=r;let C=p(s,w,x,i,d);const I=c.B$.getEnvelope(M,C,b);if(!I)return null;I.x===1/0&&(I.x=w+2),I.y===1/0&&(I.y=-x/2),I.width===-1/0&&(I.width=w),I.height===-1/0&&(I.height=x);let k=1,S=0,O=0;switch(g.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;I.width>w&&(e=w/I.width);let t=1;I.height>x&&(t=x/I.height),"preview"===i&&(I.width<w&&(e=w/I.width),I.height<x&&(t=x/I.height)),k=Math.min(e,t),S=I.x+I.width/2,O=I.y+I.height/2}break;case"CIMLineSymbol":if(d){O=I.y+I.height/2,S=I.x+I.width/2;const e=I.width-w,t=I.height-x;C={paths:(0,u.bA)(C.paths,{xmin:-1*I.width/2+e,xmax:I.width/2-e,ymin:-1*I.height/2+t,ymax:I.height/2-t,width:I.width-2*e,height:I.height-2*t})}}else{(m||I.height>x)&&(k=x/I.height),O=I.y+I.height/2;const e=I.x*k+w/2,t=(I.x+I.width)*k+w/2,r=(0,n.l9)(C)?C.paths:(0,n.oU)(C)?C.rings:null;if(null===r)throw new Error("Bad geometry, can't rasterise symbol!");r[0][0][0]-=e/k,r[0][2][0]-=(t-w)/k}break;case"CIMPolygonSymbol":if(d){O=I.y+I.height/2,S=I.x+I.width/2;const e=I.width-w,t=I.height-x;C={paths:(0,u.bA)(C.rings,{xmin:-1*I.width/2+e,xmax:I.width/2-e,ymin:-1*I.height/2+t,ymax:I.height/2-t,width:I.width-2*e,height:I.height-2*t})}}else{S=I.x+I.width/2,O=I.y+I.height/2;const e=I.x*k+w/2,t=(I.x+I.width)*k+w/2,r=I.y*k+x/2,n=(I.y+I.height)*k+x/2,{rings:i}=C;e<0&&(i[0][0][0]-=e,i[0][3][0]-=e,i[0][4][0]-=e),r<0&&(i[0][0][1]+=r,i[0][1][1]+=r,i[0][4][1]+=r),t>w&&(i[0][1][0]-=t-w,i[0][2][0]-=t-w),n>x&&(i[0][2][1]+=n-x,i[0][3][1]+=n-x)}}const R={type:"cim",data:{type:"CIMSymbolReference",symbol:M}};return this.rasterize(R,w,x,S,O,k,s,1,C)}rasterize(e,t,r,n,i,o,s,c=0,l=null,u=window.devicePixelRatio||1){const{data:f}=e;if(!f||"CIMSymbolReference"!==f.type||!f.symbol)return null;const{symbol:m}=f,d=this._canvas,y=1.3333333333333333*u;d.width=t*y,d.height=r*y,s||(s=(0,h.JW)(m)),l||(l=p(s,t,r,"legend")),d.width+=2*c,d.height+=2*c;const g=d.getContext("2d",{willReadFrequently:!0}),M=a.zA.createIdentity();return M.translate(-n,-i),M.scale(o*y,-o*y),M.translate(t*y/2+c,r*y/2+c),g.clearRect(0,0,d.width,d.height),new a.cD(g,this._cimResourceManager,M,!0).drawSymbol(m,l),g.getImageData(0,0,d.width,d.height)}}function p(e,t,r,n,i){const o=-t/2+1,s=t/2-1,a=r/2-1,c=-r/2+1;if(i&&("esriGeometryPolygon"===e||"esriGeometryPolyline"===e)){const n=function(e,t,r,n){return"esriGeometryPolygon"===t?{rings:(0,u.Iu)((0,u.bA)(e.rings,{xmin:0,ymin:0,width:r,height:n}),-1*r/2,-1*n/2)}:"esriGeometryPolyline"===t?{paths:(0,u.Iu)((0,u.bA)(e.paths,{xmin:0,ymin:0,width:r,height:n}),-1*r/2,-1*n/2)}:null}(i,e,t,r);if(n)return n}switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[o,0],[0,0],[s,0]]]};default:return"legend"===n?{rings:[[[o,a],[s,0],[s,c],[o,c],[o,a]]]}:{rings:[[[o,a],[s,a],[s,c],[o,c],[o,a]]]}}}},17623:function(e,t,r){r.d(t,{OverrideHelper:function(){return h}});var n=r(53147),i=r(92643),o=r(28947),s=r(299),a=r(15065),c=r(61421),l=r(66882);const u=e=>{if(!e)return[0,0,0,0];const{r:t,g:r,b:n,a:i}=e;return[t,r,n,255*i]};class h{static findApplicableOverrides(e,t,r){if(e&&t){if(e.primitiveName){let n=!1;for(const t of r)if(t.primitiveName===e.primitiveName){n=!0;break}if(!n)for(const n of t)n.primitiveName===e.primitiveName&&r.push(n)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)h.findApplicableOverrides(n,t,r);if(e.symbolLayers)for(const n of e.symbolLayers)h.findApplicableOverrides(n,t,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const n of e.effects)h.findApplicableOverrides(n,t,r);if(e.markerPlacement&&h.findApplicableOverrides(e.markerPlacement,t,r),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const n of e.markerGraphics)h.findApplicableOverrides(n,t,r),h.findApplicableOverrides(n.symbol,t,r)}else"CIMCharacterMarker"===e.type?h.findApplicableOverrides(e.symbol,t,r):"CIMHatchFill"===e.type?h.findApplicableOverrides(e.lineSymbol,t,r):"CIMPictureMarker"===e.type&&h.findApplicableOverrides(e.animatedSymbolProperties,t,r)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&(0,c.hU)(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=(0,c.Ml)(e),n=e.primitiveName,i=[];for(const e of t)e.primitiveName===n&&i.push((0,c.Ml)(e));return{type:"cim-effect-param",effect:r,overrides:(0,c.Ul)(i)}}static async resolveSymbolOverrides(e,t,r,n,i,a,l){if(!e?.symbol)return null;let{symbol:u,primitiveOverrides:f}=e;const p=!!f;if(!p&&!n)return u;u=(0,o.d9)(u),f=(0,o.d9)(f);let m=!0;if(t||(t={attributes:{}},m=!1),p){if(m||(f=f.filter((e=>!e.valueExpressionInfo?.expression.includes("$feature")))),l||(f=f.filter((e=>!e.valueExpressionInfo?.expression.includes("$view")))),f.length>0){const e=(0,c.Qf)(t.attributes),n={spatialReference:r,fields:e,geometryType:i};await h.createRenderExpressions(f,n),h.evaluateOverrides(f,t,i??"esriGeometryPoint",a,l,new s.Z(e))}h.applyOverrides(u,f)}return n&&h.applyDictionaryTextOverrides(u,t,n,null),u}static{this._expressionToRenderExpression=new Map}static async createRenderExpressions(e,t){const r=[];for(const n of e){const e=n.valueExpressionInfo;if(!e||h._expressionToRenderExpression.has(e.expression))continue;const i=(0,a.Yi)(e.expression,t.spatialReference);r.push(i),i.then((t=>h._expressionToRenderExpression.set(e.expression,t)))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,t,r,n,o,s){const a={$view:{scale:o?.scale}};for(const o of e){o.value&&"object"==typeof o.value&&(0,i.jQ)(o.value)&&("Color"===o.propertyName||"StrokeColor"===o.propertyName)&&(o.value=u(o.value));const e=o.valueExpressionInfo;if(!e)continue;const c=h._expressionToRenderExpression.get(e.expression);c&&(o.value=(0,l.default)(c,t,a,r,s,n))}}static applyDictionaryTextOverrides(e,t,r,n,i="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const o=e.symbolLayers;if(!o)return;for(const s of o)s&&"CIMVectorMarker"===s.type&&h.applyDictionaryTextOverrides(s,t,r,n,"CIMTextSymbol"===e.type?e.textCase:i)}break;case"CIMVectorMarker":{const i=e.markerGraphics;if(!i)return;for(const e of i)e&&h.applyDictionaryTextOverrides(e,t,r,n)}break;case"CIMMarkerGraphic":{const o=e.textString;if(o&&o.includes("[")){const s=(0,c.H1)(o,r);e.textString=(0,c.E_)(t,s,n,i)}}}}static applyOverrides(e,t,r,n){if(e.primitiveName)for(const i of t)if(i.primitiveName===e.primitiveName){const t=(0,c.Le)(i.propertyName);if(n&&n.push({cim:e,nocapPropertyName:t,value:e[t]}),r){let t=!1;for(const n of r)n.primitiveName===e.primitiveName&&(t=!0);t||r.push(i)}null!=i.value&&(e[t]=i.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const i of e.effects)h.applyOverrides(i,t,r,n);if(e.symbolLayers)for(const i of e.symbolLayers)h.applyOverrides(i,t,r,n);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const i of e.effects)h.applyOverrides(i,t,r,n);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const i of e.markerGraphics)h.applyOverrides(i,t,r,n),h.applyOverrides(i.symbol,t,r,n)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const r of e)void 0!==r.value&&(t+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new n.Z(t).toRgba();return e[3]*=255,e}return t}}},66882:function(e,t,r){r.d(t,{default:function(){return s}});var n=r(88194),i=r(96711),o=r(96610);function s(e,t,r,n,o,s){if(null==e)return null;const a=e.references("geometry")&&s?c(t,n,s):t,l=e.repurposeFeature(a,o);try{return e.evaluate(l,r)}catch(e){return i.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}const a=new Map;function c(e,t,r){const{transform:s,hasZ:c,hasM:l}=r;a.has(t)||a.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,r,n,i)=>(0,o.U1)(r,t,e,n,i);case"esriGeometryPolygon":return(e,r,n,i)=>(0,o.Ie)(r,t,e,n,i);case"esriGeometryPolyline":return(e,r,n,i)=>(0,o.G6)(r,t,e,n,i);case"esriGeometryMultipoint":return(e,r,n,i)=>(0,o.J9)(r,t,e,n,i);default:return i.Z.getLogger("esri.views.2d.support.arcadeOnDemand").error(new n.Z("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const u=a.get(t)(e.geometry,s,c,l);return{...e,geometry:u}}}}]);