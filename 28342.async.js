"use strict";(self.webpackChunkscene_pro=self.webpackChunkscene_pro||[]).push([[28342],{13790:function(e,t,i){i.d(t,{C:function(){return g},b:function(){return p}});var n=i(27349),s=i(7086),r=i(13743),a=i(96541),o=i(19155),l=i(2013),h=i(48857),u=i(52061),c=i(75047),d=i(15150);function p(e){const t=new d.kG,{vertex:i,fragment:p,varyings:g}=t;return t.fragment.include(n.f5,e),t.include(s.H,e),t.include(c.j,e),(0,a.Sv)(i,e),t.attributes.add(u.T.POSITION,"vec3"),t.attributes.add(u.T.UV0,"vec2"),g.add("vUV","vec2"),g.add("vpos","vec3"),i.main.add(h.H`vUV = uv0;
vpos = position;
forwardViewPosDepth((view * vec4(position, 1.0)).xyz);
gl_Position = proj * view * vec4(position, 1.0);`),p.uniforms.add(new o.A("size",(e=>e.size))),p.uniforms.add(new l.N("color1",(e=>e.color1))),p.uniforms.add(new l.N("color2",(e=>e.color2))),p.include(r.Y),p.main.add(h.H`discardByTerrainDepth();
vec2 uvScaled = vUV / (2.0 * size);
vec2 uv = fract(uvScaled - 0.25);
vec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);
float fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));
float t = mix(abs(ab.x + ab.y), 0.5, fade);
fragColor = mix(color2, color1, t);
outputColorHighlightOID(fragColor, vpos, fragColor.rgb);`),t}const g=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}))},38874:function(e,t,i){function n(e,t,i){i=i||2;var n,r,o,l,h,u,d,p=t&&t.length,g=p?t[0]*i:e.length,_=s(e,0,g,i,!0),m=[];if(!_||_.next===_.prev)return m;if(p&&(_=c(e,t,_,i)),e.length>80*i){n=o=e[0],r=l=e[1];for(var y=i;y<g;y+=i)(h=e[y])<n&&(n=h),(u=e[y+1])<r&&(r=u),h>o&&(o=h),u>l&&(l=u);d=0!==(d=Math.max(o-n,l-r))?1/d:0}return a(_,m,i,n,r,d),m}function s(e,t,i,n,s){var r,a;if(s===O(e,t,i,n)>0)for(r=t;r<i;r+=n)a=L(r,e[r],e[r+1],a);else for(r=i-n;r>=t;r-=n)a=L(r,e[r],e[r+1],a);if(a&&C(a,a.next)){var o=a.next;D(a),a=o}return a}function r(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!C(n,n.next)&&0!==w(n.prev,n,n.next))n=n.next;else{var s=n.prev;if(D(n),(n=t=s)===n.next)break;i=!0}}while(i||n!==t);return t}function a(e,t,i,n,s,c,d){if(e){!d&&c&&m(e,n,s,c);for(var p,g,_=e;e.prev!==e.next;)if(p=e.prev,g=e.next,c?l(e,n,s,c):o(e))t.push(p.i/i),t.push(e.i/i),t.push(g.i/i),D(e),e=g.next,_=g.next;else if((e=g)===_){d?1===d?a(e=h(r(e),t,i),t,i,n,s,c,2):2===d&&u(e,t,i,n,s,c):a(r(e),t,i,n,s,c,1);break}}}function o(e){var t=e.prev,i=e,n=e.next;if(w(t,i,n)>=0)return!1;for(var s=e.next.next;s!==e.prev;){if(f(t.x,t.y,i.x,i.y,n.x,n.y,s.x,s.y)&&w(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function l(e,t,i,n){var s=e.prev,r=e,a=e.next;if(w(s,r,a)>=0)return!1;for(var o=s.x<r.x?s.x<a.x?s.x:a.x:r.x<a.x?r.x:a.x,l=s.y<r.y?s.y<a.y?s.y:a.y:r.y<a.y?r.y:a.y,h=s.x>r.x?s.x>a.x?s.x:a.x:r.x>a.x?r.x:a.x,u=s.y>r.y?s.y>a.y?s.y:a.y:r.y>a.y?r.y:a.y,c=y(o,l,t,i,n),d=y(h,u,t,i,n),p=e.prevZ,g=e.nextZ;p&&p.z>=c&&g&&g.z<=d;){if(p!==e.prev&&p!==e.next&&f(s.x,s.y,r.x,r.y,a.x,a.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,g!==e.prev&&g!==e.next&&f(s.x,s.y,r.x,r.y,a.x,a.y,g.x,g.y)&&w(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;p&&p.z>=c;){if(p!==e.prev&&p!==e.next&&f(s.x,s.y,r.x,r.y,a.x,a.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=d;){if(g!==e.prev&&g!==e.next&&f(s.x,s.y,r.x,r.y,a.x,a.y,g.x,g.y)&&w(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function h(e,t,i){var n=e;do{var s=n.prev,a=n.next.next;!C(s,a)&&b(s,n,n.next,a)&&M(s,a)&&M(a,s)&&(t.push(s.i/i),t.push(n.i/i),t.push(a.i/i),D(n),D(n.next),n=e=a),n=n.next}while(n!==e);return r(n)}function u(e,t,i,n,s,o){var l=e;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&x(l,h)){var u=V(l,h);return l=r(l,l.next),u=r(u,u.next),a(l,t,i,n,s,o),void a(u,t,i,n,s,o)}h=h.next}l=l.next}while(l!==e)}function c(e,t,i,n){var a,o,l,h=[];for(a=0,o=t.length;a<o;a++)(l=s(e,t[a]*n,a<o-1?t[a+1]*n:e.length,n,!1))===l.next&&(l.steiner=!0),h.push(v(l));for(h.sort(d),a=0;a<h.length;a++)i=r(i=g(h[a],i),i.next);return i}function d(e,t){return e.x-t.x}function p(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function g(e,t){var i=function(e,t){var i,n=t,s=e.x,r=e.y,a=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var o=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=s&&o>a){if(a=o,o===s){if(r===n.y)return n;if(r===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(s===a)return i;var l,h=i,u=i.x,c=i.y,d=1/0;n=i;do{s>=n.x&&n.x>=u&&s!==n.x&&f(r<c?s:a,r,u,c,r<c?a:s,r,n.x,n.y)&&(l=Math.abs(r-n.y)/(s-n.x),M(n,e)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&_(i,n)))&&(i=n,d=l)),n=n.next}while(n!==h);return i}(e,t);if(!i)return t;var n=V(i,e),s=r(i,i.next);let a=p(n);return r(a,a.next),s=p(s),p(t===i?s:t)}function _(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function m(e,t,i,n){var s=e;do{null===s.z&&(s.z=y(s.x,s.y,t,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){var t,i,n,s,r,a,o,l,h=1;do{for(i=e,e=null,r=null,a=0;i;){for(a++,n=i,o=0,t=0;t<h&&(o++,n=n.nextZ);t++);for(l=h;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(s=i,i=i.nextZ,o--):(s=n,n=n.nextZ,l--),r?r.nextZ=s:e=s,s.prevZ=r,r=s;i=n}r.nextZ=null,h*=2}while(a>1)}(s)}function y(e,t,i,n,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function f(e,t,i,n,s,r,a,o){return(s-a)*(t-o)-(e-a)*(r-o)>=0&&(e-a)*(n-o)-(i-a)*(t-o)>=0&&(i-a)*(r-o)-(s-a)*(n-o)>=0}function x(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&b(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(M(e,t)&&M(t,e)&&function(e,t){var i=e,n=!1,s=(e.x+t.x)/2,r=(e.y+t.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||C(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function C(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,i,n){var s=S(w(e,t,i)),r=S(w(e,t,n)),a=S(w(i,n,e)),o=S(w(i,n,t));return s!==r&&a!==o||!(0!==s||!P(e,i,t))||!(0!==r||!P(e,n,t))||!(0!==a||!P(i,e,n))||!(0!==o||!P(i,t,n))}function P(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function S(e){return e>0?1:e<0?-1:0}function M(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function V(e,t){var i=new A(e.i,e.x,e.y),n=new A(t.i,t.x,t.y),s=e.next,r=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function L(e,t,i,n){var s=new A(e,t,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function D(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function A(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,i,n){for(var s=0,r=t,a=i-n;r<i;r+=n)s+=(e[a]-e[r])*(e[r+1]+e[a+1]),a=r;return s}i.d(t,{e:function(){return n}}),n.deviation=function(e,t,i,n){var s=t&&t.length,r=s?t[0]*i:e.length,a=Math.abs(O(e,0,r,i));if(s)for(var o=0,l=t.length;o<l;o++){var h=t[o]*i,u=o<l-1?t[o+1]*i:e.length;a-=Math.abs(O(e,h,u,i))}var c=0;for(o=0;o<n.length;o+=3){var d=n[o]*i,p=n[o+1]*i,g=n[o+2]*i;c+=Math.abs((e[d]-e[g])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[g+1]-e[d+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},n.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,s=0;s<e.length;s++){for(var r=0;r<e[s].length;r++)for(var a=0;a<t;a++)i.vertices.push(e[s][r][a]);s>0&&(n+=e[s-1].length,i.holes.push(n))}return i}},28342:function(e,t,i){i.r(t),i.d(t,{default:function(){return Ot}});var n=i(73440),s=i(70880),r=(i(61432),i(61100)),a=i(17155),o=i(96711),l=(i(83850),i(48023)),h=i(5826),u=i(11674),c=i(73273),d=i(90403),p=i(99574),g=i(1925),_=i(26636),m=i(26821),y=i(41788),v=i(24910),f=i(82846),x=i(27583),w=i(47925),C=i(13132),b=i(70331),P=i(2051);function S(e,t,i,n,s){(0,v.c)(M,e),(0,v.f)(V,e,t),(0,P.S)(M,i,M,s),(0,P.S)(V,i,V,s),(0,v.d)(n,V,M),(0,v.n)(n,n)}const M=(0,f.Ue)(),V=(0,f.Ue)();var L=i(6961),D=i(93070),A=i(38766),O=i(60680),T=i(69055),U=i(79012),R=i(62520),G=i(90494),I=i(22365),z=i(73799),E=i(49510),k=i(10618),H=i(27250);class W{get numVertices(){return this._length}get hasStagedVertex(){return null!=this._lastCursorPoint}constructor(e,t,i){this._sceneView=e,this._geodesicAreaMeasurementUtils=t,this._geodesicLengthMeasurementUtils=i,this.validMeasurement=!1,this.positionsWorld=[],this.positionsRender=[],this.positionsFittedWorld=[],this.positionsFittedRender=[],this.positionsGeodesic=[],this.positionsSpherical=[],this.positionsStereographic=[],this.pathSegmentLengths=[],this.geodesicPathSegmentLengths=[],this.perimeterSegmentLengths=[],this.intersectingSegments=new Set,this.geodesicIntersectingSegments=new Set,this.triangleIndices=null,this.geodesicTriangleIndices=null,this.areaCentroidWorldCoords=(0,f.Ue)(),this.areaCentroidRenderCoords=(0,f.Ue)(),this.geodesicAreaCentroidRenderCoords=(0,f.Ue)(),this.fittingMode=null,this.area=null,this.geodesicArea=null,this.pathLength=null,this.geodesicPathLength=null,this.perimeterLength=null,this._length=0,this._centroidRenderCoords=(0,f.Ue)(),this._planeWorldCoords=(0,x.Ue)(),this._worldUp=(0,f.Ue)(),this._worldTangent=(0,f.Ue)(),this._frame=[(0,f.Ue)(),(0,f.Ue)(),(0,f.Ue)()],this._lastPathVersion=-1,this._lastCursorPoint=null,this._mode=null,this._tempU=(0,f.Ue)(),this._tempV=(0,f.Ue)(),this._tempVec3=(0,f.Ue)(),this._tempSphere=(0,T.c)();const n=(0,H.m)(e.spatialReference);this._measurementSR=n,this._lengthMeasurementUnit=(0,_.j5)(n)??"meters",this._areaMeasurementUnit=(0,_.oq)(n)??"square-meters"}update(e,t,i,n,s,r){const a=this._lastPathVersion===e.version,o=t?t.equals(this._lastCursorPoint):null==this._lastCursorPoint,l=this._mode===s;return!(a&&!r&&l&&o||(this._lastPathVersion=e.version,this._lastCursorPoint=t,this._updateCursorSegmentLength(e,t),this._update(e,t,i,n,s),0))}_update(e,t,i,n,s){const r=this._sceneView.renderSpatialReference,a=this._measurementSR,o=i.spatialReference;let l=e.numVertices;const h=!(null==t||t.equals(e.lastPoint)||l>2&&t.equals(e.firstPoint)||e.polygonIsClosed);h&&(l+=1);const u=!e.polygonIsClosed&&l>2,c=e.polygonIsClosed||u;this._resize(l);const d=(0,b.rS)(o),p=null!=o&&(0,k.op)(o)?o:null,_=null!=p&&(0,C.canProjectWithoutEngine)(o,d),{positionsGeodesic:m,positionsWorld:y,positionsRender:f,positionsSpherical:x}=this,w=(e,t)=>{(function(e,t){t.hasZ||(t.z=(0,G.KO)(e,t,"ground")??0)})(i.elevationProvider,e),(0,L.K)(e,y[t],a),(0,L.K)(e,f[t],r),_&&((0,L.K)(e,m[t],p),(0,L.K)(e,x[t],d),(0,v.n)(x[t],x[t]))};e.forEachVertexPosition(((e,t)=>w(e,t))),h&&w(t,l-1);const P=this._updatePathLengths(c);if(this.pathLength=this._length>1?(0,g.yG)(P,this._lengthMeasurementUnit):null,_){const e=this._updateGeodesicPathLengths(c,p);this.geodesicPathLength=null!=e&&this._length>1?e:null}else this.geodesicPathLength=null;if(this._updateMode(s),!c)return this.area=null,this.geodesicArea=null,this.perimeterLength=null,this.triangleIndices=null,this.geodesicTriangleIndices=null,this.intersectingSegments.clear(),this.geodesicIntersectingSegments.clear(),void(this.validMeasurement=!1);this._updateAreaAndPerimeterLength(i,r,a,n),_&&this._updateGeodesicArea(i,p),this.validMeasurement=!0}getData(){return{validMeasurement:this.validMeasurement,numVertices:this.numVertices,hasStagedVertex:this.hasStagedVertex,positionsRender:this.positionsRender,positionsFittedWorld:this.positionsFittedWorld,positionsFittedRender:this.positionsFittedRender,intersectingSegments:this.intersectingSegments,geodesicIntersectingSegments:this.geodesicIntersectingSegments,triangleIndices:this.triangleIndices,geodesicTriangleIndices:this.geodesicTriangleIndices,areaCentroidRenderCoords:this.areaCentroidRenderCoords,geodesicAreaCentroidRenderCoords:this.geodesicAreaCentroidRenderCoords,area:this.area,geodesicArea:this.geodesicArea,pathLength:this.pathLength,geodesicPathLength:this.geodesicPathLength,perimeterLength:this.perimeterLength,actualMeasurementMode:this.actualMeasurementMode}}_resize(e){for(e<this._length&&(this.positionsWorld.length=e,this.positionsRender.length=e,this.positionsFittedWorld.length=e,this.positionsFittedRender.length=e,this.positionsGeodesic.length=e,this.positionsSpherical.length=e,this.positionsStereographic.length=e,this.pathSegmentLengths.length=e,this.geodesicPathSegmentLengths.length=e,this.perimeterSegmentLengths.length=e,this._length=e);this._length<e;)this.positionsWorld.push((0,f.Ue)()),this.positionsRender.push((0,f.Ue)()),this.positionsFittedWorld.push((0,y.Ue)()),this.positionsFittedRender.push((0,f.Ue)()),this.positionsGeodesic.push((0,f.Ue)()),this.positionsSpherical.push((0,f.Ue)()),this.positionsStereographic.push((0,y.Ue)()),this.pathSegmentLengths.push(0),this.geodesicPathSegmentLengths.push(0),this.perimeterSegmentLengths.push(0),++this._length}_updatePathLengths(e){const t=this.positionsWorld,i=this.pathSegmentLengths;let n=0;const s=this._length;for(let r=0;r<s;++r){const a=i[r]=(0,v.j)(t[r],t[(r+1)%s]);(r<s-1||e)&&(n+=a)}return n}_updateGeodesicPathLengths(e,t){const i=this.positionsGeodesic,n=this.geodesicPathSegmentLengths;let s=0;const r=this._length;for(let a=0;a<r;++a){const o=this._geodesicLengthMeasurementUtils.geodesicDistance(i[a],i[(a+1)%r],t);if(null==o)return null;const l=(0,g.nn)(o,"meters").value,h=n[a]=l;(a<r-1||e)&&(s+=h)}return(0,g.yG)(s,"meters")}_updateAreaAndPerimeterLength(e,t,i,n){const s=e.renderCoordsHelper,r=this.positionsWorld,a=this.positionsRender,o=this.positionsFittedWorld,l=this.positionsFittedRender,h=this._planeWorldCoords,u=this._centroidRenderCoords;(0,I.$U)(a,u),s.worldUpAtPosition(u,this._worldUp),s.worldBasisAtPosition(u,D.R.X,this._worldTangent),S(u,this._worldUp,t,this._worldUp,i),S(u,this._worldTangent,t,this._worldTangent,i),r.length>2&&(0,R.l)(r,h),this.fittingMode=this._selectFittingMode(h,r,this._worldUp,n);let c=0;if("horizontal"===this.fittingMode){let e=-1/0;a.forEach(((t,i)=>{const n=s.getAltitude(a[i]);n>e&&(e=n,c=i)}))}const d=r[c];let p=h,g=this._worldTangent;"horizontal"===this.fittingMode?p=this._worldUp:"vertical"===this.fittingMode&&(p=this._tempVec3,g=this._worldUp,(0,I.T)(h,this._worldUp,p)),(0,v.c)(this._frame[2],p),(0,I.T)(g,p,this._frame[0]),(0,v.h)(this._frame[1],this._frame[0],this._frame[2]),(0,v.u)(this._frame[1],this._frame[1]);const _=this._tempVec3,y=this._tempU,f=this._tempV;for(let e=0;e<this._length;++e){const n=o[e],s=l[e];(0,v.d)(_,r[e],d),(0,m.t8)(n,(0,v.e)(this._frame[0],_),(0,v.e)(this._frame[1],_)),(0,v.g)(y,this._frame[0],n[0]),(0,v.g)(f,this._frame[1],n[1]),(0,v.f)(_,y,f),(0,v.f)(_,_,d),(0,P.S)(_,i,s,t)}this.perimeterLength=this._length>0?this._updatePerimeterLengths():null,(0,I.$U)(l,this.areaCentroidRenderCoords),(0,P.S)(this.areaCentroidRenderCoords,t,this.areaCentroidWorldCoords,i),this._updateIntersectingSegments(),this.area=0===this.intersectingSegments.size?this._computeArea():null}_updateGeodesicArea(e,t){const{renderCoordsHelper:i,spatialReference:n}=e,{positionsSpherical:s,positionsStereographic:r}=this,a=this._tempVec3,o=(0,R.wE)(s,a);if(!o)return void(this.geodesicArea=null);const l=this._tempU,h=this._tempV;(0,I._F)(a,l,h);for(let e=0;e<this._length;++e){const t=(0,v.e)(s[e],l),i=(0,v.e)(s[e],h),n=(0,v.e)(s[e],a);(0,m.t8)(r[e],t/n,i/n)}(0,v.g)(a,a,(0,w.Iu)(n).radius),i.toRenderCoords(a,(0,b.rS)(n),this.geodesicAreaCentroidRenderCoords),this._updateGeodesicIntersectingSegments(),this.geodesicArea=o&&0===this.geodesicIntersectingSegments.size?this._computeGeodesicArea(t):null}_updatePerimeterLengths(){const e=this.positionsFittedWorld,t=this.perimeterSegmentLengths;let i=0;for(let n=0;n<this._length;++n)i+=t[n]=(0,m.TE)(e[n],e[(n+1)%this._length]);return(0,g.yG)(i,this._lengthMeasurementUnit)}_updateIntersectingSegments(){const e=this.positionsFittedWorld,t=this.intersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let n=i+2;n<this._length;++n){if((n+1)%this._length===i)continue;const s=e[i],r=e[(i+1)%this._length],a=e[n],o=e[(n+1)%this._length];(0,O.UT)(s,r,a,o)&&(t.add(i),t.add(n))}}_computeArea(){const e=this.positionsFittedWorld,t=this.triangleIndices=(0,A.mi)((0,z.bT)(e));let i=0;for(let n=0;n<t.length;n+=3)i+=(0,U.wu)(e[t[n]],e[t[n+1]],e[t[n+2]]);return(0,g.ne)(i,this._areaMeasurementUnit)}_updateGeodesicIntersectingSegments(){const e=this.positionsStereographic,t=this.geodesicIntersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let n=i+2;n<this._length;++n){if((n+1)%this._length===i)continue;const s=e[i],r=e[(i+1)%this._length],a=e[n],o=e[(n+1)%this._length];(0,O.UT)(s,r,a,o)&&(t.add(i),t.add(n))}}_computeGeodesicArea(e){const t=this.positionsGeodesic,i=this.positionsStereographic,n=this.geodesicTriangleIndices=(0,A.mi)((0,z.bT)(i));let s=0;for(let i=0;i<n.length;i+=3){const r=(0,R.fq)(t[n[i]],t[n[i+1]],t[n[i+2]],e,this._geodesicAreaMeasurementUtils);if(null==r)return null;s+=(0,g.nn)(r,"square-meters").value}return(0,g.ne)(s,"square-meters")}_selectFittingMode(e,t,i,n){const s=t.map((t=>Math.abs((0,R.D1)(e,t)))).reduce(((e,t)=>Math.max(e,t)),0);(0,R.Ue)(t,this._tempSphere);const r=s/(2*this._tempSphere[3]),a=r<n.maxRelativeErrorCoplanar,o=r<n.maxRelativeErrorAlmostCoplanar;let l="horizontal";return a?l="oblique":o&&(l=Math.abs((0,v.e)(i,e))>Math.cos((0,p.Vl)(n.verticalAngleThreshold))?"horizontal":"vertical"),l}_updateCursorSegmentLength(e,t){const i=e.lastPoint;e.isValidPolygon||null==i||null==t?(this.geodesicStagedSegmentLength=null,this.stagedSegmentLength=null):(this.geodesicStagedSegmentLength=this._geodesicLengthMeasurementUtils.geodesicDistanceBetweenPoints(i,t),this.stagedSegmentLength=(0,E.Uy)(i,t)?.direct)}_updateMode(e){if(e===c.e.Auto){this.actualMeasurementMode="euclidean";let e=0;null!=this.geodesicPathLength&&(e+=this.geodesicPathLength.value),e>Z&&(this.actualMeasurementMode="geodesic")}else this.actualMeasurementMode=e===c.e.Euclidean?"euclidean":"geodesic";null==this.geodesicPathLength&&(this.actualMeasurementMode="euclidean"),this._mode=e}}const Z=1e5;let F=class extends s.Z{constructor(e){super(e)}initialize(){this._measurementDataManager=new W(this.view,this.geodesicAreaMeasurementUtils,this.geodesicLengthMeasurementUtils),this.addHandles([this.analysisViewData.path.on("change",(()=>this._update())),(0,d.YP)((()=>this.analysisViewData.stagedPoint),(()=>this._update()),d.Z_),(0,d.YP)((()=>this.analysisViewData.mode),(()=>this._update()),d.Z_)]),this._update()}_update(e=!1){const{analysisViewData:t,view:i}=this;this._measurementDataManager.update(t.path,t.stagedPoint,i,{maxRelativeErrorCoplanar:.005,maxRelativeErrorAlmostCoplanar:.01,verticalAngleThreshold:80},t.mode,e)&&(t.measurementData=this._measurementDataManager.getData())}};(0,n._)([(0,a.Cb)({constructOnly:!0})],F.prototype,"view",void 0),(0,n._)([(0,a.Cb)({constructOnly:!0})],F.prototype,"analysis",void 0),(0,n._)([(0,a.Cb)({constructOnly:!0})],F.prototype,"analysisViewData",void 0),(0,n._)([(0,a.Cb)({constructOnly:!0})],F.prototype,"geodesicAreaMeasurementUtils",void 0),(0,n._)([(0,a.Cb)({constructOnly:!0})],F.prototype,"geodesicLengthMeasurementUtils",void 0),F=(0,n._)([(0,l.j)("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurementController")],F);var q=i(87833),j=i(60508),N=i(47566),B=i(1505),Y=i(16171),K=i(61722),$=i(18208);let X=class extends q.Z.EventedAccessor{constructor(e={}){super(e),this._version=0,this._internalGeometryChange=!1,this._extent=(0,N.cS)()}set areaMeasurement(e){this._set("areaMeasurement",e),null!=e&&null!=this.view&&this._initialize(e,this.view)}set view(e){this._set("view",e),null!=e&&null!=this.areaMeasurement&&this._initialize(this.areaMeasurement,e)}get constructed(){return null!=this.areaMeasurement&&null!=this.view}get version(){return this._version}get isEmptyPolygon(){return!this.constructed||0===this._editGeometry.components.length}get isValidPolygon(){return this.constructed&&this.polygonIsClosed}get extent(){if(this.constructed&&this._editGeometry.components.length>0&&this._editGeometry.components[0].vertices.length>0){const e=(0,N.cS)(this._extent);return this.forEachVertex((t=>{(0,N.Ho)(e,t.pos)})),e}return null}get spatialReference(){return this.constructed?this._editGeometry.coordinateHelper.spatialReference:null}_initialize(e,t){this.removeAllHandles(),this.addHandles((0,d.YP)((()=>e.geometry),(()=>{this._updateEditGeometryFromModelGeometry(e,t)}),d.tX)),this._makeDirty(!0)}_makeDirty(e=!1){this.notifyChange("polygonIsClosed"),this.notifyChange("isValidPolygon"),this.notifyChange("initialized"),this.notifyChange("extent"),e&&this.notifyChange("numVertices")}_updateEditGeometryFromModelGeometry(e,t){if(this._version++,this._internalGeometryChange)return;this.removeHandles("EditGeometry");let i=e.geometry;if(null!=i){const n=(0,C.tryProjectWithZConversion)(i,t.spatialReference);null==n&&(0,B.e)(e,i.spatialReference,o.Z.getLogger(this)),i=n}this._editGeometryOperations=null!=i?$.c.fromGeometry(i,t.state.viewingMode):new $.c(new K.XE("polygon",(0,Y.Y6)(!0,!1,t.spatialReference)),t.state.viewingMode),this._makeDirty(!0),this.emit("change"),this.addHandles(this._editGeometry.on("change",(t=>{this._makeDirty(null!=t.addedVertices||null!=t.removedVertices),this._internalGeometryChange=!0,e.geometry=this.numVertices>0?this._editGeometry.geometry:null,this._internalGeometryChange=!1})),"EditGeometry")}get _editGeometry(){return this._editGeometryOperations.data}get vertices(){const e=[];return this.forEachVertex((t=>{e.push(t)})),e}get numVertices(){return this.constructed&&this._editGeometry.components.length>0?this._editGeometry.components[0].vertices.length:0}get polygonIsClosed(){return this._editGeometry.components.length>0&&this._editGeometry.components[0].isClosed()}get firstPoint(){if(this.constructed&&this._editGeometry.components.length>0){const e=this._editGeometry.components[0].getFirstVertex();if(null!=e)return this._editGeometry.coordinateHelper.vectorToPoint(e.pos)}return null}get lastPoint(){if(this.constructed&&this._editGeometry.components.length>0){const e=this._editGeometry.components[0].getLastVertex();if(null!=e)return this._editGeometry.coordinateHelper.vectorToPoint(e.pos)}return null}getVertex(e){if(!this.constructed||0===this._editGeometry.components.length||0===this._editGeometry.components[0].vertices.length)return null;const t=this._editGeometry.components[0].vertices[0];let i=t;do{if(i.index===e)return i;i=i.rightEdge.rightVertex}while(i!==t&&null!=i);return null}getVertexPositionAsPoint(e){return this._editGeometry.coordinateHelper.vectorToPoint(e.pos)}getVertexPositionAsPointFromIndex(e){return this._editGeometry.coordinateHelper.vectorToPoint(this.getVertex(e).pos)}forEachVertex(e){this.constructed&&this._editGeometry.components.length>0&&this._editGeometry.components[0].iterateVertices(e)}forEachVertexPosition(e){const t=this._editGeometry.coordinateHelper;this.forEachVertex(((i,n)=>{t.vectorToPoint(i.pos,J),e(J,n)}))}clear(){null!=this.areaMeasurement&&(this.areaMeasurement.geometry=null)}add(e){if(!this.constructed)return null;if(0===this._editGeometry.components.length){const e=this.view;this._editGeometry.components.push(new K.wA(e.spatialReference,e.state.viewingMode))}const t=this._editGeometryOperations.appendVertex(this._editGeometry.coordinateHelper.pointToVector(e));return this.emit("change"),t}close(){if(!this.constructed||0===this._editGeometry.components.length)return null;const e=this._editGeometryOperations.closeComponent(this._editGeometry.components[0]);return this.emit("change"),e}ensureContains(e,t=""){let i=!1;if(this._editGeometry.components.forEach((t=>{t.iterateVertices((t=>{t===e&&(i=!0)}))})),!i)throw new Error(`vertex doesnt exist ${t}`);return i}setVertexPosition(e,t){if(!this.constructed)return null;const i=this._editGeometryOperations.setVertexPosition(e,this._editGeometry.coordinateHelper.pointToVector(t));return this.emit("change"),i}equals(e){if(this.numVertices!==e.numVertices)return!1;let t=!0;return this.forEachVertexPosition(((i,n)=>{const s=e.getVertexPositionAsPointFromIndex(n);i.equals(s)||(t=!1)})),!!t}};(0,n._)([(0,a.Cb)({value:null})],X.prototype,"areaMeasurement",null),(0,n._)([(0,a.Cb)({value:null})],X.prototype,"view",null),(0,n._)([(0,a.Cb)()],X.prototype,"isEmptyPolygon",null),(0,n._)([(0,a.Cb)()],X.prototype,"isValidPolygon",null),(0,n._)([(0,a.Cb)()],X.prototype,"extent",null),(0,n._)([(0,a.Cb)()],X.prototype,"spatialReference",null),(0,n._)([(0,a.Cb)()],X.prototype,"numVertices",null),(0,n._)([(0,a.Cb)()],X.prototype,"polygonIsClosed",null),X=(0,n._)([(0,l.j)("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurementPathHelper")],X);const J=new j.Z;i(55214);var Q=i(92643),ee=i(55430),te=i(31865),ie=i(10934);function ne(e,t){return(0,g.nn)(e,(0,_.KR)(e.value,e.unit,t))}function se(e,t){return(0,g.nn)(e,re(e,t))}function re(e,t){const i=function(e){switch(e){case"metric":case"ares":case"hectares":return"metric";case"imperial":case"acres":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-nautical-miles":return"nautical-miles";case"square-us-feet":return"us-feet";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";case"square-meters":return"meters";case"square-kilometers":return"kilometers"}throw new Error("unhandled area unit")}(t);return(0,_.wd)(e.value,e.unit,i)}var ae=i(36158),oe=i(80075),le=i(73749),he=i(49102),ue=i(81749),ce=i(25952),de=i(19596),pe=i(52061),ge=i(41044),_e=i(59797),me=i(948),ye=i(29296),ve=i(36121),fe=i(42266),xe=i(58257),we=i(29107),Ce=i(33610),be=i(61536),Pe=i(13790),Se=i(51135);class Me extends we.A{constructor(e,t){super(e,t,new xe.J(Pe.C,(()=>i.e(37733).then(i.bind(i,37733)))))}initializePipeline(e){const{oitPass:t,transparent:i,polygonOffset:n,output:s}=e,r=t===Ce.M.NONE,a=t===Ce.M.FrontFace;return(0,Se.sm)({blending:i?(0,be.Wo)(t):null,depthTest:{func:(0,be.Bh)(t)},depthWrite:(0,be.W$)(e),drawBuffers:(0,be.u_)(t,s),colorWrite:Se.gf,polygonOffset:r||a?n?Ve:null:{factor:-1,units:-25}})}}const Ve={factor:0,units:-25};var Le=i(31839),De=i(34479),Ae=i(83046),Oe=i(91041);class Te extends Oe.W{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.polygonOffset=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=Le.I.None,this.emissionSource=De.jo.None,this.output=ge.H_.Color,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1,this.overlayEnabled=!1,this.draped=!1,this.snowCover=!1}get discardInvisibleFragments(){return this.transparent&&this.writeDepth}}(0,n._)([(0,Ae.o)()],Te.prototype,"transparent",void 0),(0,n._)([(0,Ae.o)()],Te.prototype,"writeDepth",void 0),(0,n._)([(0,Ae.o)()],Te.prototype,"polygonOffset",void 0),(0,n._)([(0,Ae.o)()],Te.prototype,"terrainDepthTest",void 0),(0,n._)([(0,Ae.o)()],Te.prototype,"cullAboveTerrain",void 0);var Ue=i(64801);class Re extends fe.c{constructor(e){super(e,Ie),this._configuration=new Te,this.produces=new Map([[me.r.OPAQUE_MATERIAL,e=>(0,ge.D5)(e)&&!this.transparent],[me.r.TRANSPARENT_MATERIAL,e=>(0,ge.D5)(e)&&this.transparent&&this.parameters.writeDepth],[me.r.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,ge.D5)(e)&&this.transparent&&!this.parameters.writeDepth]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.transparent=this.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color1[3]>=Ue.e||this.parameters.color2[3]>=Ue.e}get transparent(){return this.parameters.color1[3]<1||this.parameters.color2[3]<1}createGLMaterial(e){return new Ge(e)}createBufferWriter(){return new ye.G(ve.qj)}}class Ge extends _e.Z{beginSlot(e){return this.getTechnique(Me,e)}}class Ie extends de.Mt{constructor(){super(...arguments),this.size=(0,y.al)(1,1),this.color1=(0,x.al)(.75,.75,.75,1),this.color2=(0,x.al)(.5,.5,.5,1),this.writeDepth=!0,this.polygonOffset=!1}}class ze extends he._{constructor(e){super(e),this._checkerBoardMaterial=null,this._renderOccluded=de.yD.OccludeAndTransparent,this._geometry=null,this._size=(0,y.al)(1,1),this._color1=(0,x.al)(1,.5,0,.5),this._color2=(0,x.al)(1,1,1,.5),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){(0,m.JG)(this._size,e),this._updateMaterial()}get color1(){return this._color1}set color1(e){(0,le.a)(e,this._color1)||((0,le.c)(this._color1,e),this._updateMaterial())}get color2(){return this._color2}set color2(e){(0,le.a)(e,this._color2)||((0,le.c)(this._color2,e),this._updateMaterial())}_updateMaterial(){this._checkerBoardMaterial?.setParameters({size:this._size,color1:this._color1,color2:this._color2,renderOccluded:this._renderOccluded})}createExternalResources(){this._checkerBoardMaterial=new Re({size:this._size,color1:this._color1,color2:this._color2,writeDepth:!1,polygonOffset:!0,renderOccluded:de.yD.OccludeAndTransparent,isDecoration:this.isDecoration})}destroyExternalResources(){this._checkerBoardMaterial=null}forEachMaterial(e){e(this._checkerBoardMaterial)}createGeometries(e){if(null==this._geometry||null==this._checkerBoardMaterial)return;const t=Ee;(0,te.i0)(t,this.transform);const i=this._geometry,n=[],s=(0,f.Ue)();i.position.forEach((e=>{(0,v.d)(s,e,t),n.push(s[0],s[1],s[2])}));const r=[];i.uv.forEach((e=>{r.push(e[0],e[1])}));const a=new ce.Z(this._checkerBoardMaterial,[[pe.T.POSITION,new ue.a(n,i.triangleIndices,3,!0)],[pe.T.UV0,new ue.a(r,i.triangleIndices,2,!0)]]);e.addGeometry(a)}}const Ee=(0,f.Ue)();var ke=i(16374),He=i(85590),We=i(74765),Ze=i(12816);let Fe=class extends s.Z{get _parameters(){const{accentColor:e,textColor:t}=this.view.effectiveTheme,i=(0,Q.O)(e),n=(0,Q.Ch)(e,.5),s=(0,Q.Ch)((0,Q.mj)(e),.5),r=(0,Q.mj)(t,Q.K6.Low);return{accentColor:i,transparentAccentColor:n,transparentContrastColor:s,intersectingLineColor:[1,.2,0,1],textColor:t,textBackgroundColor:(0,Q.G)(r,.6),textCalloutColor:(0,Q.G)(r,.5),pathLineWidth:3,perimeterLineWidth:2,projectionLineWidth:2,projectionLineStippleSize:5,labelDistance:25}}get visible(){return this.analysisViewData.visible}get _renderUnits(){const e=this.view.renderCoordsHelper.spatialReference;return(0,_.j5)(e)??"meters"}get testData(){}constructor(e){super(e),this._path=null,this._intersectedPath=null,this._perimeter=null,this._intersectedPerimeter=null,this._projectionLines=null,this._measurementArea=null,this._areaLabel=null,this._perimeterLengthLabel=null,this._pathSegments=[],this._perimeterSegments=[],this._origin=(0,f.Ue)(),this._originTransform=(0,ie.Ue)(),this.messages=null,this.viewData=Ne,this.areaLabel=null,this.perimeterLengthLabel=null,this.loadingMessages=!0}initialize(){const{analysisViewData:e,_parameters:t,view:i}=this;this._path=new oe.r({view:i,attached:!0,width:t.pathLineWidth,polygonOffset:!0,renderOccluded:de.yD.OccludeAndTransparent,isDecoration:!0}),this._intersectedPath=new oe.r({view:i,attached:!0,width:t.pathLineWidth,polygonOffset:!0,renderOccluded:de.yD.OccludeAndTransparent,isDecoration:!0}),this._perimeter=new oe.r({view:i,attached:!0,width:t.perimeterLineWidth,polygonOffset:!0,renderOccluded:de.yD.OccludeAndTransparent,isDecoration:!0}),this._intersectedPerimeter=new oe.r({view:i,attached:!0,width:t.perimeterLineWidth,color:t.intersectingLineColor,polygonOffset:!0,renderOccluded:de.yD.OccludeAndTransparent,isDecoration:!0}),this._projectionLines=new oe.r({view:i,attached:!0,width:t.projectionLineWidth,stipplePattern:(0,He.z5)(t.projectionLineStippleSize),polygonOffset:!0,renderOccluded:de.yD.OccludeAndTransparent,isDecoration:!0}),this._measurementArea=new ze({view:i,attached:!0,isDecoration:!0});const n={attached:!0,view:i,isDecoration:!0};this._areaLabel=new ae.K({...n,fontSize:qe.Large}),this._perimeterLengthLabel=new ae.K({...n,fontSize:qe.Small}),this.addHandles([(0,d.YP)((()=>[e.mode,this.visible,e.unit,e.measurementData,e.stagedPoint]),(()=>this._update()),d.tX),(0,d.YP)((()=>i.state?.camera),(()=>this._updateLabels()),d.tX),(0,We.qe)((()=>this._updateMessageBundle())),(0,d.YP)((()=>this._parameters),(({accentColor:e,transparentAccentColor:t,transparentContrastColor:i,textColor:n,textBackgroundColor:s,textCalloutColor:r})=>{const{_path:a,_intersectedPath:o,_perimeter:l,_projectionLines:h,_measurementArea:u,_areaLabel:c,_perimeterLengthLabel:d}=this;a.color=e,o.color=e,l.color=e,h.color=e,u.color1=t,u.color2=i,c.textColor=n,c.backgroundColor=s,c.calloutColor=r,d.textColor=n,d.backgroundColor=s,d.calloutColor=r}),d.nn)]),this._updateMessageBundle()}destroy(){this._measurementArea=(0,r.SC)(this._measurementArea),this._path=(0,r.SC)(this._path),this._intersectedPath=(0,r.SC)(this._intersectedPath),this._perimeter=(0,r.SC)(this._perimeter),this._intersectedPerimeter=(0,r.SC)(this._intersectedPerimeter),this._areaLabel=(0,r.SC)(this._areaLabel),this._perimeterLengthLabel=(0,r.SC)(this._perimeterLengthLabel),this._projectionLines=(0,r.SC)(this._projectionLines),this.set("view",null)}_update(){if(this.destroyed||!this.view.ready||!this.view.renderCoordsHelper)return;const{analysisViewData:{measurementData:e},analysisViewData:t}=this;null!=e&&(this._updateViewData(e,t.path),this._updateOrigin(),this._updatePathSegments(),this._updatePerimeterSegments(),this._updateArea(),this._updateProjectionLines(),this._updateLabels())}_updateViewData(e,t){const i=e.validMeasurement,n="geodesic"===e.actualMeasurementMode,s=n?e.geodesicArea:e.area;let r=1;if(s){const e=ne(s,this.analysisViewData.unit);r=(0,p.sk)(Math.sqrt(e.value)/Math.sqrt(300)),r*=Math.sqrt((0,_.En)(1,e.unit,"square-meters")),r=(0,_.En)(r,"meters",this._renderUnits)}const a={validMeasurement:i,numVertices:e.numVertices,hasStagedVertex:e.hasStagedVertex,path:t,mode:e.actualMeasurementMode,positionsRender:e.positionsRender,positionsFittedWorld:e.positionsFittedWorld,positionsFittedRender:e.positionsFittedRender,intersectingSegments:n?e.geodesicIntersectingSegments:e.intersectingSegments,triangleIndices:n?e.geodesicTriangleIndices:e.triangleIndices,areaCentroid:n?e.geodesicAreaCentroidRenderCoords:e.areaCentroidRenderCoords,perimeterLengthLabelSegmentIndex:0,area:n?e.geodesicArea:e.area,pathLength:n?e.geodesicPathLength:e.pathLength,perimeterLength:e.perimeterLength,checkerSize:r};this._set("viewData",a)}_updateOrigin(){const e=this.viewData;(0,I.$U)(e.positionsRender,this._origin),(0,te.vc)(this._originTransform,this._origin),this._measurementArea.transform=this._originTransform,this._projectionLines.transform=this._originTransform}_createSegments(e){const t=this.viewData,i=this.view.renderCoordsHelper.spatialReference,n=t.mode,s=[],r=[],a=[],o=t.numVertices,l=t.validMeasurement?o:o-1;for(let h=0;h<l;++h){const l=t[e][h],u=t[e][(h+1)%o];let c=null;switch(n){case"euclidean":c=new ke.y(l,u);break;case"geodesic":c=new ke.u(l,u,i)}t.intersectingSegments.has(h)?a.push(c):r.push(c),s.push(c)}let h=null;return t.validMeasurement&&t.hasStagedVertex&&l>=2?h=s[s.length-2]:t.hasStagedVertex&&l>=1&&(h=s[s.length-1]),{all:s,nonIntersecting:r,intersecting:a,stagedSegment:h}}_updatePathSegments(){const{visible:e}=this,t=this._createSegments("positionsRender");this._path.setGeometryFromSegments(t.nonIntersecting,this._origin),this._path.visible=e,this._intersectedPath.setGeometryFromSegments(t.intersecting,this._origin),this._intersectedPath.visible=e,this._pathSegments=t.all}_updatePerimeterSegments(){const e=this.visible&&"euclidean"===this.viewData.mode&&this.viewData.path.numVertices>2,t=this._createSegments("positionsFittedRender");this._perimeter.setGeometryFromSegments(t.nonIntersecting,this._origin),this._perimeter.visible=e,this._intersectedPerimeter.setGeometryFromSegments(t.intersecting,this._origin),this._intersectedPerimeter.visible=e,this._perimeterSegments=t.all}_updateArea(){const e=this.viewData;switch(e.mode){case"euclidean":this._updateAreaEuclidean(e);break;case"geodesic":this._updateAreaGeodesic()}}_updateAreaEuclidean(e){const t=this.visible;e.validMeasurement&&0===e.intersectingSegments.size&&e.triangleIndices?(this._measurementArea.geometry={uv:e.positionsFittedWorld,position:e.positionsFittedRender,triangleIndices:e.triangleIndices},this._measurementArea.size=[e.checkerSize,e.checkerSize],this._measurementArea.visible=t):this._measurementArea.visible=!1}_updateAreaGeodesic(){this._measurementArea.visible=!1}_updateProjectionLines(){const e=this.viewData,t=this.visible,i=e.mode,n=e.numVertices;if(n>0&&e.validMeasurement&&"euclidean"===i){const i=[];for(let t=0;t<n;++t){const n=(0,f.Ue)();(0,v.d)(n,e.positionsRender[t],this._origin);const s=(0,f.Ue)();(0,v.d)(s,e.positionsFittedRender[t],this._origin),i.push([n,s])}this._projectionLines.geometry=i,this._projectionLines.visible=t}else this._projectionLines.geometry=null,this._projectionLines.visible=!1}_updateLabels(){if(this.destroyed)return;const{viewData:e}=this,{area:t,path:i}=e;if(!i)return;const n=this.visible,s=this._areaLabel,r=this._perimeterLengthLabel,a=e.validMeasurement;s.visible=!0,r.visible=!0;let o=!1;const l=function(e,t,i){return e&&t&&(0,ee.VG)(e,t,(0,_.KR)(t.value,t.unit,i))}(this.messages,t,this.analysisViewData.unit);if(null!=l&&n&&(s.geometry={type:"point",point:e.areaCentroid},s.text=l,o=e.validMeasurement&&0===e.intersectingSegments.size),this._set("areaLabel",l),n&&a&&0===e.intersectingSegments.size){const t="geodesic"===e.mode,i=t?e.pathLength:e.perimeterLength,n=function(e,t,i){return e&&t&&(0,ee.VG)(e,t,re(t,i))}(this.messages,i,this.analysisViewData.unit);this._set("perimeterLengthLabel",n),r.distance=this._parameters.labelDistance,r.anchor="top",r.text=n;let s=!0;for(let i=0;i<e.numVertices;++i){const n=(e.perimeterLengthLabelSegmentIndex+i)%e.numVertices,a=t?this._pathSegments[n]:this._perimeterSegments[n];if(s=!0,r.geometry={type:"segment",segment:a,sampleLocation:"center"},!r.overlaps(this._areaLabel))break;s=!1}r.visible=s}else r.visible=!1;s.visible=o}_updateMessageBundle(){this.loadingMessages=!0,(0,Ze.ME)("esri/core/t9n/Units").then((e=>{this.messages=e,this.view&&this._update()})).finally((()=>{this.loadingMessages=!1}))}};var qe,je;(0,n._)([(0,a.Cb)()],Fe.prototype,"_parameters",null),(0,n._)([(0,a.Cb)()],Fe.prototype,"view",void 0),(0,n._)([(0,a.Cb)()],Fe.prototype,"messages",void 0),(0,n._)([(0,a.Cb)()],Fe.prototype,"analysis",void 0),(0,n._)([(0,a.Cb)()],Fe.prototype,"viewData",void 0),(0,n._)([(0,a.Cb)()],Fe.prototype,"analysisViewData",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],Fe.prototype,"areaLabel",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],Fe.prototype,"perimeterLengthLabel",void 0),(0,n._)([(0,a.Cb)()],Fe.prototype,"loadingMessages",void 0),(0,n._)([(0,a.Cb)()],Fe.prototype,"visible",null),(0,n._)([(0,a.Cb)()],Fe.prototype,"_renderUnits",null),Fe=(0,n._)([(0,l.j)("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurementVisualization")],Fe),(je=qe||(qe={}))[je.Small=12]="Small",je[je.Large=16]="Large";const Ne={validMeasurement:!1,numVertices:0,hasStagedVertex:!1,path:null,mode:null,positionsRender:null,positionsFittedWorld:null,positionsFittedRender:null,intersectingSegments:null,triangleIndices:null,areaCentroid:null,perimeterLengthLabelSegmentIndex:null,checkerSize:null,area:null,pathLength:null,perimeterLength:null};var Be=i(30062),Ye=i(93568),Ke=i(60147),$e=i(74774),Xe=i(18036),Je=i(23857),Qe=i(53147),et=i(12818),tt=i(96094),it=i(3682),nt=i(77811),st=i(23496);class rt{constructor(e,t=null){this.screenPoint=e,this.result=t}}class at{constructor(e,t){this.scenePoint=e,this.mapPoint=t}}var ot=i(82845),lt=i(86026),ht=i(17188),ut=i(21498);class ct{constructor(e){this.vertexManipulators=[],this._destroyed=!1,this._isManipulatorsOwner=!0,this._visible=!0,this._listenerHandles=null,this._tempHandlePosition=(0,f.Ue)();const{analysisViewData:t,manipulators:i,toolState:n,view:s,visible:r}=e;this._analysisViewData=t,this._toolState=n,null!=i?(this._manipulators=i,this._isManipulatorsOwner=!1):this._manipulators=new ht.D,this._view=s,this._intersector=(0,ut.w)(s.state.viewingMode);const a=(0,nt.EA)(this._handleColor),o=[new st.r((0,lt.PI)(a,1,32,32))],l=new it.Z({view:s,renderObjects:o});l.available=!1,l.radius=_t,l.interactive=!1,this._manipulators.add(l),this._cursorManipulator=l,this._cursorManipulatorMaterial=a,this._laserLine=new ot.W({view:s,attached:!0,style:{glowWidth:dt,glowFalloff:pt,innerWidth:gt},isDecoration:!0}),this._updateVisibility(r??!0)}destroy(){this._listenerHandles=(0,r.SC)(this._listenerHandles),this._isManipulatorsOwner?this._manipulators=(0,r.SC)(this._manipulators):this._manipulators=null,this._laserLine=(0,r.SC)(this._laserLine),this._destroyed=!0}get destroyed(){return this._destroyed}get visible(){return this._visible}set visible(e){e?this.show():this.hide()}get testData(){}show(){this._setVisibility(!0)}hide(){this._setVisibility(!1)}_setVisibility(e){this._destroyed||this._visible===e||this._updateVisibility(e)}_updateVisibility(e){this._visible=e,this._laserLine.visible=e,e?(this._initializeListeners(),this._updateAll()):(this._destroyListeners(),this.vertexManipulators.forEach((({manipulator:e})=>this._removeVertexManipulator(e))),this.vertexManipulators=[],this._view.cursor=null)}vertexHandleAt(e,t){return this._manipulators.intersect(e,t)?.metadata}pick(e){const t=this._view.spatialReference,i=(0,tt.md)(e.screenPoint);this._view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const n=this._intersector.results.min,s=(0,f.Ue)();if(!n.getIntersectionPoint(s))return null;const r=this._view.renderCoordsHelper.fromRenderCoords(s,new j.Z({spatialReference:t}));return null==r?null:new at(s,r)}_updateAll(){this._visible&&(this._updateVertexManipulators(),this._updateLaserLine())}_createVertexManipulator(){const e=(0,nt.EA)(this._handleColor),t=[new st.r((0,lt.PI)(e,1,32,32))],i=new it.Z({view:this._view,renderObjects:t});return i.radius=_t,this._manipulators.add(i),{manipulator:i,material:e}}_removeVertexManipulator(e){this._manipulators.remove(e)}_updateVertexManipulators(){const{viewData:e}=this._analysisViewData,t=this._analysisViewData.path?this._analysisViewData.path.vertices:[],i=this.vertexManipulators;(function(e,t,i,n){for(;e.length<t;)e.push(i());if(n)for(;e.length>t;)n(e.pop());else e.length=t})(i,t.length,(()=>this._createVertexManipulator()),(({manipulator:e})=>this._removeVertexManipulator(e))),i.forEach((({manipulator:i},n)=>{i.metadata=t[n],i.renderLocation=e.positionsRender[n],i.cursor=0===n&&"drawing"===this._toolState.polygonState?"crosshair":null})),"drawing"===this._toolState.polygonState&&null!=this._analysisViewData.stagedPoint?(this._cursorManipulator.available=!0,this._cursorManipulator.location=this._analysisViewData.stagedPoint):this._cursorManipulator.available=!1}get _handleColor(){return(0,Q.Ch)(this._view.effectiveTheme.accentColor,.5)}_getFocusPoint(){const{lastDraggedVertex:e}=this._analysisViewData;switch(this._toolState.polygonState){case"drawing":return null!=this._analysisViewData.stagedPoint?this._analysisViewData.stagedPoint:null!=e?this._analysisViewData.path.getVertexPositionAsPoint(e):this._analysisViewData.path.lastPoint;case"editing":return null!=e?this._analysisViewData.path.getVertexPositionAsPoint(e):null;default:return this._analysisViewData.stagedPoint}}_updateLaserLine(){const e="measured"!==this._toolState.polygonState&&this._toolState.active,t=this._getFocusPoint();if(e&&null!=t){const e=this._tempHandlePosition;this._view.renderCoordsHelper.toRenderCoords(t,e),this._laserLine.heightManifoldTarget=e}else this._laserLine.heightManifoldTarget=null}_initializeListeners(){this._listenerHandles=new et.Z,this._listenerHandles.add([(0,d.YP)((()=>this._toolState.polygonState),(()=>this._updateLaserLine())),(0,d.YP)((()=>this._analysisViewData.viewData),(()=>this._updateAll()),d.Z_),(0,d.YP)((()=>({lastDraggedVertex:this._analysisViewData.lastDraggedVertex,cursorPoint:this._analysisViewData.stagedPoint})),(()=>this._updateLaserLine())),(0,d.YP)((()=>this._toolState.active),(()=>this._updateAll())),(0,d.YP)((()=>this._view.effectiveTheme.accentColor),(e=>{const t=(0,Q.Ch)(e,.5);for(const{material:e}of this.vertexManipulators)e.setParameters({color:t});this._cursorManipulatorMaterial.setParameters({color:t});const i=Qe.Z.toUnitRGB(e),n=Qe.Z.toUnitRGB((0,Q.mj)(e)),s=.75*e.a,r=this._laserLine,a=r.style;r.style={...a,glowColor:i,innerColor:n,globalAlpha:s}}),{initial:!0,equals:Q.WC})])}_destroyListeners(){this._listenerHandles=(0,r.SC)(this._listenerHandles)}}const dt=8,pt=8,gt=1,_t=5;var mt=i(86227),yt=i(69880),vt=i(18753),ft=i(39018),xt=i(23111),wt=i(42888),Ct=i(76010),bt=i(29668),Pt=i(70134);let St=class extends mt.f{constructor(e){super(e),this._updatingHandles=new Ke.R,this.polygonState="initial",this.removeIncompleteOnCancel=!1,this.manipulators=new ht.D,this._getSnappingContext=(0,Be.H)((e=>new ft.N({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new $.c(new K.XE("point",(0,Y.Y6)(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new Xe._})))}initialize(){const{view:e,analysisViewData:t,manipulators:i,visible:n}=this;this.measurementView=new ct({view:e,analysisViewData:t,toolState:this,manipulators:i,visible:n});const s=(0,wt.u)(e);this._snappingManagerResult=s,this.addHandles(s),this._snappingOperation=new Ct.y({view:e}),this._updatingHandles.add((()=>this.stagedPoint),(e=>{this.analysisViewData.stagedPoint=null!=e?(0,$e.WG)(e,new j.Z):null}),d.tX),(0,bt.Ob)(this,(()=>{const e=this.view.inputManager.latestPointerType??"mouse",t=this._getSnappingContext(e);this._updatingHandles.addPromise((0,Ye.R8)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,t)))})),this._setupManipulators(),this.addHandles([(0,d.gx)((()=>"measured"===this.state),(()=>this.finishToolCreation()),d.tX),this.analysisViewData.path.on("change",(()=>{const e=this.analysisViewData.path;"initial"!==this.polygonState||e.isEmptyPolygon||(e.isValidPolygon?this.polygonState="measured":this.polygonState="drawing")}))])}destroy(){this.measurementView.destroy(),this._set("measurementView",null),this._updatingHandles=(0,r.SC)(this._updatingHandles)}get _snappingManager(){return this._snappingManagerResult.snappingManager}get state(){return 0===this.analysisViewData.path.numVertices?"ready":this.analysisViewData.path.isValidPolygon&&"editing"!==this.polygonState?"measured":"measuring"}get cursor(){return this.active?"crosshair":null}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get stagedPoint(){return this._snappingOperation.stagedPoint}set stagedPoint(e){this._snappingOperation.stagedPoint=e}get snappingOptions(){return this._snappingManager.options}finishMeasurement(){const{path:e}=this.analysisViewData;e.numVertices<=2||(e.close(),this.polygonState="measured",this._resetSnappingState(),this.active&&(this.view.activeTool=null))}resetCreated(){super.resetCreated(),this._resetSnappingState(),this.polygonState="initial","measured"===this.state&&(this.polygonState="measured",this.finishToolCreation())}onShow(){this.measurementView.show()}onHide(){this.measurementView.hide()}onDeactivate(){this._resetSnappingState()}onInputEvent(e){switch(e.type){case"immediate-double-click":this._handleImmediateDoubleClick(e);break;case"immediate-click":this._handleImmediateClick(e);break;case"pointer-move":this._handlePointerMove(e);break;case"drag":this._handleDrag(e);break;case"key-down":this._handleKeyDown(e)}}_setupManipulators(){const e=e=>e.events.on("grab-changed",(()=>{if(this.analysisViewData.path.isValidPolygon){const e=this.manipulators.some((e=>e.manipulator.grabbing));this.polygonState=e?"editing":"measured"}})),t=t=>{this.addHandles([(0,yt.Xd)(t,((e,t,i,n)=>{const s=(0,Je.J4)(e),r=e.metadata,a=this._snappingManager,o=this._getSnappingContext(n),l=this._updatingHandles,{snappingStep:h,cancelSnapping:u}=(0,xt.W)({snappingManager:a,snappingContext:o,updatingHandles:l});i=i.next(s).next((t=>(this.analysisViewData.lastDraggedVertex=null,this.analysisViewData.path.setVertexPosition(r,c),e.location=c,t))).next(u),t.next(s).next((0,Je.gv)(this.view)).next(...h).next((t=>{e.location=t.mapEnd,this.analysisViewData.lastDraggedVertex="end"===t.action?null:r,this.analysisViewData.path.setVertexPosition(r,(0,$e.WG)(t.mapEnd))}));const c=(0,$e.WG)(this.analysisViewData.path.getVertexPositionAsPoint(r))})),e(t)],t)};this.manipulators.forEach((({manipulator:e})=>{t(e)})),this.addHandles([this.manipulators.on("after-add",(({item:{manipulator:e}})=>{t(e)})),this.manipulators.on("after-remove",(({item:{manipulator:e}})=>this.removeHandles(e)))])}_handleImmediateDoubleClick(e){(0,R.y1)(e)&&("drawing"===this.polygonState&&this.finishMeasurement(),e.stopPropagation())}_handleDrag(e){"editing"===this.polygonState&&e.stopPropagation()}_handleImmediateClick(e){if(!(0,R.y1)(e))return;const t=(0,Pt.vT)(e),{pointerType:i}=e;if(this.active)switch(this.polygonState){case"initial":case"measured":if(this._addVertexAt(t,i))return this.stagedPoint=null,this.polygonState="drawing",void e.stopPropagation();break;case"drawing":{const n=this.measurementView.vertexHandleAt(t,i);if(null==n){if(this._addVertexAt(t,i))return this.stagedPoint=null,void e.stopPropagation()}else 0===n.index&&(this.finishMeasurement(),e.stopPropagation());break}}"mouse"===e.pointerType&&this._hoverAt(t)}_handlePointerMove(e){if("mouse"===e.pointerType){const t=(0,Pt.vT)(e);this._hoverAt(t)}}_handleKeyDown(e){const{path:t}=this.analysisViewData;e.key===vt.Sn.complete&&"drawing"===this.polygonState&&t.numVertices>=3&&(this.stagedPoint=null,this.finishMeasurement(),e.stopPropagation())}_hoverAt(e){const{polygonState:t}=this;if(this.active&&Mt.has(t)){const t=this._pick(e);if(null!=t?.mapPoint){const e=this._getSnappingContext("mouse");this._updatingHandles.addPromise((0,Ye.R8)(this._snappingOperation.snap({point:t.mapPoint},this._snappingManager,e)))}}else this.stagedPoint=null}_addVertexAt(e,t){const i=this._pick(e)?.mapPoint;if(null==i)return!1;this.analysis.valid&&"measured"===this.polygonState&&(this.analysis.clear(),this._set("created",!1),this.polygonState="initial");const n=this._getSnappingContext(t),s=this._snappingOperation.update({point:i},this._snappingManager,n),r=(0,$e.WG)(s,new j.Z);return this.analysisViewData.path.add(r),!0}_pick(e){const t=new rt(e);return this.measurementView.pick(t)}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}get test(){}};(0,n._)([(0,a.Cb)({readOnly:!0})],St.prototype,"state",null),(0,n._)([(0,a.Cb)()],St.prototype,"polygonState",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],St.prototype,"cursor",null),(0,n._)([(0,a.Cb)()],St.prototype,"measurementView",void 0),(0,n._)([(0,a.Cb)()],St.prototype,"removeIncompleteOnCancel",void 0),(0,n._)([(0,a.Cb)({constructOnly:!0})],St.prototype,"view",void 0),(0,n._)([(0,a.Cb)({constructOnly:!0})],St.prototype,"analysis",void 0),(0,n._)([(0,a.Cb)({constructOnly:!0})],St.prototype,"analysisViewData",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],St.prototype,"manipulators",void 0),(0,n._)([(0,a.Cb)()],St.prototype,"updating",null),(0,n._)([(0,a.Cb)()],St.prototype,"stagedPoint",null),(0,n._)([(0,a.Cb)()],St.prototype,"snappingOptions",null),St=(0,n._)([(0,l.j)("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DTool")],St);const Mt=new Set(["initial","drawing","measured"]);var Vt=i(24468),Lt=i(72575),Dt=i(55274);let At=class extends((0,u.p)(s.Z)){constructor(e){super(e),this.type="area-measurement-view-3d",this.analysis=null,this.measurementData=null,this.lastDraggedVertex=null,this.stagedPoint=null,this.mode=c.e.Auto,this.tool=null,this.userOperation=null}initialize(){const{analysis:e,view:t}=this;this.path=new X({view:t,areaMeasurement:e}),this._analysisVisualization=new Fe({view:t,analysis:e,analysisViewData:this}),this.addResolvingPromise(Promise.all([(0,Lt.g)(),(0,Dt.H)()]).then((([i,n])=>{this.destroyed||(this._analysisController=new F({view:t,analysis:e,analysisViewData:this,geodesicAreaMeasurementUtils:i,geodesicLengthMeasurementUtils:n}))}))),this.addHandles((0,Vt.Lp)(this,St))}destroy(){(0,Vt.Yq)(this),this.userOperation=(0,r.IM)(this.userOperation),this._analysisController=(0,r.SC)(this._analysisController),this._analysisVisualization=(0,r.SC)(this._analysisVisualization),this.path.destroy()}get updating(){return!!this._analysisVisualization?.loadingMessages}get result(){const{measurementData:e}=this;if(null==e)return{area:null,mode:null,perimeter:null};const{unit:t}=this;if("euclidean"===e.actualMeasurementMode){const{area:i,perimeterLength:n}=e;return{area:null!=i?ne(i,t):null,perimeter:null!=n?se(n,t):null,mode:"euclidean"}}const{geodesicArea:i,pathLength:n}=e;return{area:null!=i?ne(i,t):null,perimeter:null!=n?se(n,t):null,mode:"geodesic"}}get viewData(){return this._analysisVisualization.viewData}get areaLabel(){return this._analysisVisualization.areaLabel}get perimeterLengthLabel(){return this._analysisVisualization.perimeterLengthLabel}get validMeasurement(){return this.path.isValidPolygon}get unit(){return this.analysis.unit??(0,h.R)(this.view)}get testData(){}place(e){return(0,Vt.tq)(this,{placementOptions:e})}};(0,n._)([(0,a.Cb)()],At.prototype,"_analysisVisualization",void 0),(0,n._)([(0,a.Cb)()],At.prototype,"_analysisController",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],At.prototype,"type",void 0),(0,n._)([(0,a.Cb)({constructOnly:!0,nonNullable:!0})],At.prototype,"analysis",void 0),(0,n._)([(0,a.Cb)()],At.prototype,"updating",null),(0,n._)([(0,a.Cb)()],At.prototype,"result",null),(0,n._)([(0,a.Cb)()],At.prototype,"measurementData",void 0),(0,n._)([(0,a.Cb)()],At.prototype,"viewData",null),(0,n._)([(0,a.Cb)()],At.prototype,"areaLabel",null),(0,n._)([(0,a.Cb)()],At.prototype,"perimeterLengthLabel",null),(0,n._)([(0,a.Cb)()],At.prototype,"validMeasurement",null),(0,n._)([(0,a.Cb)()],At.prototype,"path",void 0),(0,n._)([(0,a.Cb)()],At.prototype,"lastDraggedVertex",void 0),(0,n._)([(0,a.Cb)()],At.prototype,"stagedPoint",void 0),(0,n._)([(0,a.Cb)()],At.prototype,"mode",void 0),(0,n._)([(0,a.Cb)()],At.prototype,"unit",null),(0,n._)([(0,a.Cb)()],At.prototype,"tool",void 0),(0,n._)([(0,a.Cb)()],At.prototype,"userOperation",void 0),At=(0,n._)([(0,l.j)("esri.views.3d.analysis.AreaMeasurementAnalysisView3D")],At);const Ot=At},73273:function(e,t,i){var n;i.d(t,{e:function(){return n}}),function(e){e[e.Auto=0]="Auto",e[e.Euclidean=1]="Euclidean",e[e.Geodesic=2]="Geodesic"}(n||(n={}))},62520:function(e,t,i){i.d(t,{D1:function(){return u},Ue:function(){return l},fq:function(){return c},l:function(){return h},wE:function(){return d},y1:function(){return p}});var n=i(24910),s=i(82846),r=i(67764),a=i(69055),o=i(22365);function l(e,t){const i=(0,a.a)(t);(0,n.i)(i,0,0,0);for(let t=0;t<e.length;++t)(0,n.f)(i,i,e[t]);(0,n.g)(i,i,1/e.length);let s=0;for(let t=0;t<e.length;++t)s=Math.max(s,(0,n.s)(i,e[t]));t[3]=Math.sqrt(s)}function h(e,t){if(e.length<3)throw new Error("need at least 3 points to fit a plane");(0,o.pG)(e[0],e[1],e[2],t)}function u(e,t){return(0,n.e)(e,t)+e[3]}function c(e,t,i,s,{geodesicArea:r}){const a=g;return(0,n.c)(a.rings[0][0],e),(0,n.c)(a.rings[0][1],t),(0,n.c)(a.rings[0][2],i),(0,n.c)(a.rings[0][3],e),a.spatialReference=s,a.clearCache(),r(a)}function d(e,t=null,i=!0){const s=(e,t)=>{if(0===t[0]&&0===t[1]&&0===t[2])return!1;for(let i=0;i<e.length;++i)if((0,n.e)(t,e[i])<-1e-6)return!1;return!0};if(0===e.length)return!1;if(1===e.length)return t&&(0,n.c)(t,e[0]),!0;(0,n.i)(_,0,0,0);for(let t=0;t<e.length;++t)(0,n.f)(_,_,e[t]);if((0,n.n)(_,_),s(e,_))return t&&(0,n.c)(t,_),!0;if(!i)return!1;for(let i=0;i<e.length;++i)for(let r=0;r<e.length;++r)if(i!==r&&((0,n.h)(_,e[i],e[r]),(0,n.n)(_,_),s(e,_)))return t&&(0,n.c)(t,_),!0;return!1}function p(e){return"mouse"!==e.pointerType||0===e.button}const g=new r.Z({hasM:!1,hasZ:!0,rings:[[(0,s.Ue)(),(0,s.Ue)(),(0,s.Ue)(),(0,s.Ue)()]],spatialReference:null}),_=(0,s.Ue)()},36121:function(e,t,i){i.d(t,{IM:function(){return o},VD:function(){return h},qj:function(){return a},tl:function(){return l},wp:function(){return r}});var n=i(52890),s=i(52061);const r=(0,n.U$)().vec3f(s.T.POSITION),a=(0,n.U$)().vec3f(s.T.POSITION).vec2f16(s.T.UV0),o=(0,n.U$)().vec3f(s.T.POSITION).vec4u8(s.T.COLOR),l=((0,n.U$)().vec3f(s.T.POSITION).vec2f16(s.T.UV0).vec4u8(s.T.OLIDCOLOR),(0,n.U$)().vec3f(s.T.POSITION).vec2f(s.T.UV0)),h=(0,n.U$)().vec3f(s.T.POSITION).vec2f(s.T.UV0).vec4u8(s.T.OLIDCOLOR)},21498:function(e,t,i){i.d(t,{w:function(){return r}});var n=i(92490),s=i(61442);function r(e){const t=new n.r(e);return t.options.store=s.e.MIN,t.options.excludeLabels=!0,t}},76010:function(e,t,i){i.d(t,{y:function(){return u}});var n=i(73440),s=i(70880),r=i(61100),a=i(93568),o=i(17155),l=(i(61432),i(96711),i(83850),i(48023)),h=i(50399);let u=class extends s.Z{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,a.Ds)((async(e,t,i,n)=>{const s=this._frameTask;if(null==s)return;const r=await s.schedule((()=>t.snap({...e,context:i,signal:n})),n);r.valid&&await s.schedule((()=>{this.stagedPoint=r.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:i}))}),n)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=e?e.registerTask(h.T8.SNAPPING):h.sq}destroy(){this._abortController=(0,r.IM)(this._abortController),this._frameTask=(0,r.hw)(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:n,scenePoint:s}=e,r=t.update({point:n,scenePoint:s,context:i});return this.stagedPoint=r,r}async snap(e,t,i){const{point:n,scenePoint:s}=e;return this.stagedPoint=t.update({point:n,scenePoint:s,context:i}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,r.IM)(this._abortController),this._snapPoints=null}};(0,n._)([(0,o.Cb)({constructOnly:!0})],u.prototype,"view",void 0),(0,n._)([(0,o.Cb)()],u.prototype,"stagedPoint",null),(0,n._)([(0,o.Cb)()],u.prototype,"constrainResult",void 0),(0,n._)([(0,o.Cb)()],u.prototype,"_stagedPoint",void 0),u=(0,n._)([(0,l.j)("esri.views.interactive.snapping.SnappingOperation")],u)},73799:function(e,t,i){i.d(t,{X:function(){return p},bT:function(){return v},ln:function(){return y},oN:function(){return d}});var n=i(1925),s=i(26636),r=i(38874),a=i(24910),o=i(82846),l=i(2051),h=i(77773),u=i(79012),c=i(27250);function d(e,t={positionsWorldCoords:[]}){return g(e,t)}function p(e,t={positionsWorldCoords:[]}){return g(e,t,!1)}function g(e,t,i=e.hasZ){const r=(0,c.m)(e.spatialReference),d=(0,s.oq)(r);if(null==d)return null;const p=(e,t)=>!(t.length<2||((0,a.i)(e,t[0],t[1],i&&t[2]||0),0));let g=0;for(const i of e.rings){const n=i.length;if(n<3)continue;const{positionsWorldCoords:s}=t;for(;s.length<n;)s.push((0,o.Ue)());const c=_,d=(0,a.i)(m,0,0,0),y=1/n;for(let t=0;t<n;t++){if(!p(c,i[t]))return null;if(!(0,l.S)(c,e.spatialReference,s[t],r))return null;(0,a.b)(d,d,s[t],y)}const f=(0,h.zk)(s[0],s[1],d,(0,h.re)());if(0===(0,a.k)((0,h.st)(f)))continue;for(let e=0;e<n;e++)(0,h.tx)(f,d,s[e],s[e]);const x=v(s);for(let e=0;e<x.length;e+=3)g+=(0,u.wu)(s[x[e]],s[x[e+1]],s[x[e+2]])}return(0,n.ne)(g,d)}const _=(0,o.Ue)(),m=(0,o.Ue)();function y(){return{positionsWorldCoords:[]}}function v(e){return(0,r.e)(function(e){const t=new Float64Array(2*e.length);for(let i=0;i<e.length;++i){const n=e[i],s=2*i;t[s]=n[0],t[s+1]=n[1]}return t}(e),[],2)}},72575:function(e,t,i){i.d(t,{g:function(){return o}});var n=i(1925),s=i(95872),r=i(10618);const a=e=>({geodesicArea(t){const{spatialReference:i}=t;return(0,r.T5)(i,l,(t=>function(e,t){try{return(0,n.ne)(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch(e){return null}}(e,t)),t)}});async function o(){const e=await Promise.all([i.e(27093),i.e(13746)]).then(i.bind(i,13746));return a(e)}function l(e){return(0,n.ne)(Math.abs((0,s.p8)([e],"square-meters")[0]),"square-meters")}}}]);